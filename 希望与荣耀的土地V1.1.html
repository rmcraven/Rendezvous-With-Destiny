<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>希望与荣耀的土地</title>
<style title="Twine CSS">@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block !important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:#000;font-size:16px;font-weight:normal;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags="' attr(tags) '">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags="' attr(tags) '">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:"<tw-sidebar>"}.dom-debug-mode tw-hook::before{content:'<tw-hook name="' attr(name) '">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name="' attr(name) '">'}.dom-debug-mode tw-link::before{content:'<tw-link name="' attr(name) '">'}.dom-debug-mode tw-dialog::before{content:"<tw-dialog>"}.dom-debug-mode tw-columns::before{content:"<tw-columns>"}.dom-debug-mode tw-column::before{content:"<tw-column>"}.dom-debug-mode tw-align::before{content:"<tw-align>"}.dom-debug-mode tw-include::before{content:'<tw-include type="' attr(type) '" name="' attr(name) '">'}tw-open-button[goto]{display:none}.debug-mode tw-open-button[replay],.debug-mode tw-open-button[goto]{display:inline}.debug-mode tw-expression{display:inline-block !important}.debug-mode tw-expression[type=variable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"$" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"_" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,.2) !important}.debug-mode tw-expression[type=macro]::before{content:"(" attr(name) ":)";padding:0 .5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,.5)}.debug-mode tw-expression[title]:not([title=""]){cursor:help}.debug-mode tw-hook{background-color:rgba(0,85,255,.1) !important}.debug-mode tw-hook::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"["}.debug-mode tw-hook::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]"}.debug-mode tw-hook[name]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]<" attr(name) "|"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,.1) !important}.debug-mode tw-collapsed::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"{"}.debug-mode tw-collapsed::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"}"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"`"}.debug-mode tw-align[style*="text-align: center"]{background:linear-gradient(to right, hsla(14deg, 100%, 87%, 0) 0%, hsla(14deg, 100%, 87%, 0.25) 50%, hsla(14deg, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*="text-align: left"]{background:linear-gradient(to right, hsla(14deg, 100%, 87%, 0.25) 0%, hsla(14deg, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*="text-align: right"]{background:linear-gradient(to right, hsla(14deg, 100%, 87%, 0) 0%, hsla(14deg, 100%, 87%, 0.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,.2)}.debug-mode tw-enchantment{animation:enchantment .5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,.1)}.debug-mode tw-include::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(type) ' "' attr(name) '"'}.debug-dialogs tw-backdrop:not(.eval-replay):not(.harlowe-crash){pointer-events:none;opacity:.1}tw-eval-replay tw-eval-code,tw-eval-replay tw-eval-explanation{max-height:20vh;overflow:auto;margin:10px auto}tw-eval-replay tw-eval-code{display:block;font-family:monospace;padding-bottom:1ex;border-bottom:2px solid gray}tw-eval-replay tw-eval-explanation{display:block;text-align:center}tw-eval-replay tw-eval-explanation>code{white-space:pre-wrap}tw-eval-replay tw-eval-explanation>code.from-block{width:40%;display:inline-block;text-align:left;max-height:4em;overflow-wrap:anywhere;overflow-y:scroll}tw-eval-replay tw-eval-explanation>code.from-block~.to-desc{width:calc(40% - 2em);margin-left:2em;display:inline-block}tw-eval-replay tw-eval-explanation>code.from-block+span::after{content:"..."}tw-eval-replay tw-eval-explanation>code.from-inline{text-align:right}tw-eval-replay tw-eval-explanation>:nth-child(2){white-space:pre}tw-eval-replay tw-eval-explanation>.to-desc{text-align:left}tw-eval-replay tw-eval-explanation>table{width:100%;margin-top:1em}tw-eval-replay tw-eval-explanation>table td{white-space:pre-wrap !important;word-wrap:anywhere}tw-eval-replay tw-eval-reason{text-align:center;font-size:80%;font-style:italic;display:block}tw-eval-replay tw-eval-it{text-align:center;font-size:80%;display:block}tw-eval-replay tw-dialog-links{display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:14em;min-height:1em;padding:0em .5em .5em 1em;font-size:1.25em;font-family:sans-serif;color:#262626;background-color:#fff;border-left:solid #262626 2px;border-top:solid #262626 2px;border-top-left-radius:.5em;opacity:1}tw-debugger.fade-panel:not(:hover){opacity:.33}tw-debugger.theme-dark{color:#d9d9d9;background-color:#000}tw-debugger.theme-dark{border-color:#d9d9d9 rgba(0,0,0,0) rgba(0,0,0,0) #d9d9d9}tw-debugger select{margin-right:1em;width:12em}tw-debugger button,tw-debugger tw-link{border-radius:3px;border:solid #999 1px;margin:auto 4px;color:#262626;background-color:#fff;cursor:pointer}tw-debugger button.enabled,tw-debugger tw-link.enabled{color:#000;background-color:#d9d9d9;box-shadow:inset #999 3px 5px .5em}tw-debugger.theme-dark button,tw-debugger.theme-dark tw-link{color:#d9d9d9;background-color:#000;border-color:#666}tw-debugger.theme-dark button.enabled,tw-debugger.theme-dark tw-link.enabled{color:#e6e6e6;background-color:#424242;box-shadow:inset #666 3px 5px .5em}tw-debugger button{font-size:1em;overflow-x:hidden;text-overflow:ellipsis;white-space:pre}tw-debugger tw-link{font-size:1.25em;border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}tw-debugger tw-link:hover{border-color:#262626;color:#262626}tw-debugger.theme-dark tw-link:hover{border-color:#d9d9d9;color:#d9d9d9}tw-debugger tw-dialog{background-color:#fff;color:#000;font-size:1.25em}tw-debugger.theme-dark tw-dialog{background-color:#000;color:#e6e6e6}tw-debugger .panel{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;overflow-y:scroll;overflow-x:hidden;border:inherit;box-sizing:content-box;background-color:#fff;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger.theme-dark .panel{background-color:#000;border-bottom-color:#666}tw-debugger .panel-source .panel-row-buttons{width:2rem}tw-debugger .panel-source .source-tags{width:20%;font-style:italic}tw-debugger .panel-row-source td{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere;max-height:8rem;padding:1rem}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background-color:#e6e6e6}tw-debugger .panel-tools .panel-rows>*,tw-debugger .panel-options .panel-rows>*{margin-top:.4rem;display:block}tw-debugger.theme-dark .panel-rows>div:nth-of-type(2n){background-color:#212121}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:"~ No variables ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:"~ No enchantments ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:"~ No errors... for now. ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty+.panel-errors-bottom{display:none}tw-debugger.theme-dark .panel-variables .panel-rows:empty::before,tw-debugger.theme-dark .panel-enchantments .panel-rows:empty::before,tw-debugger.theme-dark .panel-errors .panel-rows:empty::before{color:#a8a8a8}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger th[data-col]{text-decoration:underline;cursor:pointer}tw-debugger th[data-col][data-order=asc]::after{content:"↓"}tw-debugger th[data-col][data-order=desc]::after{content:"↑"}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .storylet-exclusive,tw-debugger .storylet-urgent,tw-debugger .storylet-open{text-align:center}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:normal;opacity:.8;font-size:.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:" in "}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:bold}tw-debugger .variable-type{color:#575757;font-weight:normal;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger.theme-dark .variable-type{color:#a8a8a8}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,.3)}tw-debugger .error-row>*{display:table-cell;padding:.25em .5em}tw-debugger .error-row .error-message[title]:not([title=""]){cursor:help}tw-debugger .error-row .error-passage{color:#575757}tw-debugger.theme-dark .error-row .error-passage{color:#a8a8a8}tw-debugger .storylet-row{background-color:rgba(193,240,225,.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(152,231,204,.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;background-color:#fff}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:#e6e6e6}tw-debugger .storylet-row.storylet-closed>:not(.storylet-lambda){opacity:.6}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .storylet-row .storylet-lambda{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere}tw-debugger.theme-dark .storylet-row.storylet-closed{background-color:#000}tw-debugger.theme-dark .storylet-row.storylet-closed:nth-child(2n){background-color:#212121}tw-debugger .tabs{padding-bottom:.5em}tw-debugger .tab{border-radius:0px 0px .5em .5em;border-top:none;top:-2px}tw-debugger .resizer-h{position:absolute;height:14em;border-left:2px solid #999;border-right:2px solid #999;top:10px;left:4px;width:8px;cursor:ew-resize}tw-debugger.theme-dark .resizer-h{border-color:rgba(0,0,0,0) #666}tw-debugger .resizer-v{position:absolute;height:8px;border-top:2px solid #999;border-bottom:2px solid #999;margin-bottom:4px;top:4px;left:10px;width:95%;cursor:ns-resize;box-sizing:border-box}tw-debugger.theme-dark .resizer-v{border-color:#666 rgba(0,0,0,0)}tw-debugger mark{color:inherit;background-color:rgba(101,230,230,.3) !important}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media(min-width: 576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%;border:solid #fff !important}tw-dialog-links{text-align:right;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.8);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}tw-backdrop~tw-backdrop{display:none}tw-link,.enchantment-link{cursor:pointer;color:#4169e1;font-weight:bold;text-decoration:none;transition:color .2s ease-in-out}tw-passage [style^=color] tw-link:not(:hover),tw-passage [style*=" color"] tw-link:not(:hover),tw-passage [style^=color][hover=true] tw-link:hover,tw-passage [style*=" color"][hover=true] tw-link:hover,tw-passage [style^=color] .enchantment-link:not(:hover),tw-passage [style*=" color"] .enchantment-link:not(:hover),tw-passage [style^=color][hover=true] .enchantment-link:hover,tw-passage [style*=" color"][hover=true] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#dd4b39}.visited{color:#6941e1}tw-passage [style^=color] .visited:not(:hover),tw-passage [style*=" color"] .visited:not(:hover),tw-passage [style^=color][hover=true] .visited:hover,tw-passage [style*=" color"][hover=true] .visited:hover{color:inherit}.visited:hover{color:#e3e}tw-broken-link{color:#933;border-bottom:2px solid #933;cursor:not-allowed}tw-passage [style^=color] tw-broken-link:not(:hover),tw-passage [style*=" color"] tw-broken-link:not(:hover),tw-passage [style^=color][hover=true] tw-broken-link:hover,tw-passage [style*=" color"][hover=true] tw-broken-link:hover{color:inherit}tw-link.enchantment-mouseover,.link.enchantment-mouseover,tw-expression.enchantment-mouseover>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border-bottom:2px dashed #999}tw-link.enchantment-mouseover:hover,tw-link.enchantment-mouseover:active,.link.enchantment-mouseover:hover,.link.enchantment-mouseover:active,tw-expression.enchantment-mouseover>tw-link:hover,tw-expression.enchantment-mouseover>tw-link:active{color:inherit}tw-link.enchantment-mouseover.enchantment-button,.link.enchantment-mouseover.enchantment-button,tw-expression.enchantment-mouseover>tw-link.enchantment-button{border-style:dashed}tw-link.enchantment-mouseout,.link.enchantment-mouseout,tw-expression.enchantment-mouseout>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border:rgba(64,149,191,.6) 1px solid;border-radius:.2em}tw-link.enchantment-mouseout:hover,tw-link.enchantment-mouseout:active,.link.enchantment-mouseout:hover,.link.enchantment-mouseout:active,tw-expression.enchantment-mouseout>tw-link:hover,tw-expression.enchantment-mouseout>tw-link:active{color:inherit}tw-link.enchantment-mouseout:hover,.link.enchantment-mouseout:hover,tw-expression.enchantment-mouseout>tw-link:hover{background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 1px solid}tw-link.enchantment-dblclick,.link.enchantment-dblclick,tw-expression.enchantment-dblclick>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;cursor:pointer;border:2px solid #999;border-radius:0}tw-link.enchantment-dblclick:hover,tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:hover,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:hover,tw-expression.enchantment-dblclick>tw-link:active{color:inherit}tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:active{background-color:#999}tw-link.enchantment-button,.link.enchantment-button,.enchantment-button:not(.link) tw-link,.enchantment-button:not(.link) .link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}.enchantment-button{display:block}.enchantment-clickblock{cursor:pointer;width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,.5);transition:color .2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 .5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 .5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,.6) 2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 2px solid;border-radius:.2em}.enchantment-dblclickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;cursor:pointer;border:2px solid #999}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;font:100% Georgia,serif;box-sizing:border-box;width:100%;min-height:100%;font-size:1.5em;line-height:1.5em;padding:5% 5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media(min-width: 576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden}tw-story select{background-color:rgba(0,0,0,0);font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=text]{background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 .5em .5em .5em;vertical-align:middle}tw-story tw-noscript{animation:appear .8s}tw-passage{display:block}tw-sidebar{text-align:center;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}@media(min-width: 576px){tw-sidebar{left:-5em;width:3em;position:absolute;-ms-flex-direction:column;flex-direction:column}tw-enchantment[style*=width]>tw-sidebar{width:inherit}}tw-icon{display:inline-block;margin:.5em 0;font-size:66px;font-family:"Verdana",sans-serif}tw-icon[alt]{opacity:.2;cursor:pointer}tw-icon[alt]:hover{opacity:.4}tw-icon[data-label]::after{font-weight:bold;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:.2em;padding:.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0em;border-radius:4px;border:1px solid rgba(255,255,255,.5);font-size:.8rem;margin:0 .2rem;padding:3px;white-space:pre}tw-folddown::after{content:"▶"}tw-folddown.open::after{content:"▼"}tw-open-button[replay]{display:none}tw-error tw-open-button,tw-eval-replay tw-open-button{display:inline !important}tw-open-button::after{content:attr(label)}tw-notifier{border-radius:.2em;padding:.2em;font-size:1rem;background-color:rgba(223,182,58,.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid #000;display:inline-block;width:1em;height:1em}tw-enchantment:empty{display:none}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:.3em 0 .6em 0}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,.6);background-color:#ff9}ins{color:rgba(0,0,0,.6);background-color:rgba(255,242,204,.5);border-radius:.5em;box-shadow:0em 0em .2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-columns{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block !important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block !important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block !important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block !important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block !important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block !important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block !important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block !important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block !important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block !important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block !important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block !important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block !important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block !important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block !important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block !important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block !important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block !important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block !important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block !important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block !important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block !important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block !important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block !important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block !important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block !important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}
</style>
</head>
<body>
<tw-story><noscript><tw-noscript>JavaScript needs to be enabled to play 希望与荣耀的土地.</tw-noscript></noscript></tw-story>
<tw-storydata name="希望与荣耀的土地" startnode="1" creator="Twine" creator-version="2.8.1" format="Harlowe" format-version="3.3.8" ifid="F3899DE1-D42C-47E8-8E56-73FB297365DC" options="" tags="" zoom="1" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css"></style><script role="script" id="twine-user-script" type="text/twine-javascript"></script><tw-tag name="end" color="red"></tw-tag><tw-passagedata pid="1" name="Start" tags="" position="2200,325" size="100,100">(align:&quot;=&gt;&lt;=&quot;)[同心模拟联合国大会 周边文字游戏
希望与荣耀的土地 V1.1]

（游玩前须知）

1、本游戏为同心模拟联合国大会“冷战系统”会场的一款周边文字游戏，基于HTML实现，由《与命运相会》系列小说作者（B站：@吉拉德-佩雷恩元帅）使用Twine制作，由“铸梦计划”团队参与宣发。严禁出于盈利目的以任何形式使用本游戏。

2、本系列文字游戏基于“冷战系统”会场的改编文艺作品——架空冷战军事历史小说《与命运相会》系列（有声书和文字版首发于B站：https://www.bilibili.com/video/BV1xD421M7Zh/），内容和《与命运相会》紧密关联，其中所涉及的人物、事件、组织均在小说中有所涉及。如您不了解部分人物、事件和组织，可以阅读《与命运相会》系列小说。如果您无法理解游戏的部分结局，请务必重复游玩游戏直到探索出其他结局，或是阅读小说。

3、本游戏中所涉及的内容均为《与命运相会》半架空世界观或基于该世界观改编的内容，并借鉴了大量现实中存在的内容、与该半架空世界观相似的文艺作品中的虚构内容，包括但不限于人名、地名、事件等。若本游戏内容与现实或其他文艺作品有雷同，纯属巧合，请勿代入！

4、游玩过程中请尽量不要按左上角的返回键。若要重新体验之前的选择，请刷新页面或玩到一个结局后选择“重生”。

5、本游戏中的角色所表现的政治立场为《与命运相会》半架空世界观内容或为游戏情节需要而编写，不代表其创作者意见。

6、建议玩家在游玩过程中搜索部分取材自现实的游戏事件，会有全新体验。

7、本游戏共设置53个结局（不包括变体），~~以及一些彩蛋~~，需通过不同选择（以及一定运气）达到。

8、由于编辑器原因，本游戏可能存在一些文本显示错误和引号错误。受限于底层代码，结算界面显示的信息较为有限；如果多次触发同一个结局，结局列表中“已触发结局”的数量会出现错误。

9、本游戏部分事件中包含一些轻度血腥暴力内容。

10、玩得愉快！

[[开始 -&gt; begin]]


(if: $achieved is &gt;= 1)[[也可以先看看上一把结算]](if: $achieved is 0)[（在达成至少一个结局后可查看结局列表）]


(if: $achieved is &gt;= 1)[[结局列表（当心剧透！） -&gt; endings]]

(size:0.8)[版本记录：
2025.1.21 从V0换源为V1，重新说明了本款游戏的作者、背景世界观和宣发团队。同时修正了一大批bug（但恐怕还有很多没被发现）。

2025.8.21 换源为V1.1，修正了一些bug。]
</tw-passagedata><tw-passagedata pid="2" name=" begin" tags="" position="2200,450" size="100,100">1952年7月20日，联合王国。

海伦·A·帕克睁开眼，来到了这个世界。

她出生在……

[[苏格兰爱丁堡的一个中产家庭 -&gt; 1.1]]

[[伦敦切尔西的一个上层家庭 -&gt; 1.2]]

[[南约克郡谢菲尔德的一个工人家庭 -&gt; 1.3]]

(set:$birth to 0) (set: $soldier to 0)(set: $aristocratic to 0)(set: $foreignlanguage to 0)
(set: $luck to (random:1,100))(set: $party to &quot;neutral&quot;)(set: $university to &quot;null&quot;)
(set: $hardline to 0)(set: $entrancetopolitics to &quot;null&quot;)(set: $preevent to &quot;null&quot;)
(set: $vocation to &quot;null&quot;)(set: $degree to &quot;null&quot;)
(set: $vocation2 to &quot;null&quot;)(set: $special1 to &quot;null&quot;)(set: $special2 to &quot;null&quot;)</tw-passagedata><tw-passagedata pid="3" name=" endings" tags="" position="2100,200" size="100,100">[[返回介绍-&gt;Start]]

本次游玩已触发结局：(print: $achieved)/53
本次游玩已触发彩蛋：(print: $extra)/4


元世界线结局：
“太阳照常升起”


(text-colour:blue)[好结局：
“红色铁娘子”
“英国新生”
“为了女王和国家”
“战争女王”
“鹰翼之上”
“旋转门”（及其变体）
“奇异恩典”
“谢菲尔德魔女”（及其变体）
“冷心”
“是，外相”
“妥协的艺术”
“巾帼将军”
“人民旗帜最最红”（及其变体）
“法律与秩序”
“和平捍卫者”
“甜心帕克”（及其变体）
“心腹谋士”
“不屈的智囊”
“高冷新闻”]


(text-colour:green)[普通结局：
“第三势力”
“如影随形”
“女强人”
“主为我的防御而辩护”（及其变体）
“树枝与变色龙”（及其变体）
“权力的游戏”
“最后遗憾”
“不情愿的战争女王”
“唐宁街12号”
“蓝女士”（及其变体）
“临危受命”（及其变体）
“过渡选项”
“时运不济”
“贝尔法斯特甜心”
“大漠红花”
“蓝色流星”
“信仰捍卫者？”
“红玫瑰”
“舰队街的女掌柜”
“也就图一乐”]


(text-colour:red)[坏结局：
“冷寂”
“诸神的黄昏”
“黑棕部队滚出来！”
“我要在你坟头蹦迪”
“山寨铁娘子”（及其变体）
“最后的红星”
“帕克？那是谁？”]


(text-colour:yellow)[隐藏结局：
“破局者”
“一颗生菜”
“苏格兰之花”
“珀修斯”
“唐宁门事件”
“世界线收束”]


(if: $extra is 0)[触发至少一个彩蛋后可查看所有彩蛋]
(if: $extra is &gt;=1)[(text-colour:grey)[彩蛋：
~~作者的执念~~
~~■■竟在我身边~~
~~电视红人~~
~~老乡见老乡~~]]</tw-passagedata><tw-passagedata pid="4" name=" 1.1" tags="" position="2200,575" size="100,100">她的父亲是一位皇家海军中尉，母亲则刚刚入职爱丁堡大学，双亲都是苏格兰人。虽然家境称不上太优渥，但生活相当和谐；一切都刚刚好的家境意味着她许多时候，都能心无旁骛地追寻她热爱的事物。她相当聪明，而且争强好胜，十多岁时便展现出了超乎常人的智慧和能力，16岁时便完成中学学业，即将进入大学。


1956年10月，她的父亲消失了一会儿，但不久后就平安归来了。在爱丁堡郊区的小别墅里，他第一次给女儿讲了一段海上的故事——1914年12月，福克兰群岛，冯·施佩的最后一战。他有点闷闷不乐，语气也很沉重；当他将冯·施佩面对注定的命运仍战斗到最后一刻的故事娓娓道来时，她并不太懂，只感觉爸爸心里很压抑。

许多年后，帕克才知道父亲亲眼见证了英帝国的崩溃。因为，他指挥的登陆舰目的地是塞得港——他们的目的地，是苏伊士运河。


20世纪60年代的前半段飞速过去，她进入一所文法学校，朋友和家人都相信她有考取牛剑的潜力；她的哥哥则从伦敦政治经济学院毕业，在贝尔法斯特找到了一份不错的工作。但当时间来到1968年，同窗开始谈起越南战争、街头反战游行此起彼伏时，她也开始思考自己要不要参与其中。
(Set: $birth to 1)(set: $soldier to 1)
[[那不关我的事。 -&gt; 2.1A]]

[[好吧，但就是去看看。-&gt; 2.2A]]

[[越战是非正义的！-&gt; 2.3A]]</tw-passagedata><tw-passagedata pid="5" name=" 1.2" tags="" position="2325,575" size="100,100">她的父亲在英国石油公司工作，收入可观，但从她出生开始便一直在奔波，从伊朗到阿拉斯加。虽然含着金汤匙出生，但帕克可不是什么千金大小姐——她相当聪明，而且争强好胜，十多岁时便展现出了超乎常人的智慧和能力，16岁时便完成中学学业，即将进入大学。虽然她的闺蜜大多嫌她太高傲、太过贵族气息，但她不在乎。

20世纪60年代的前半段飞速过去，她进入一所女子文法学校，朋友和家人都相信凭她的能力，进入牛剑是板上钉钉。她的哥哥则从伦敦政治经济学院毕业，在贝尔法斯特找到了一份不错的工作。但当时间来到1968年，同窗开始谈起越南战争、街头反战游行此起彼伏时，她也开始思考自己要不要参与其中。她父亲对她只有一个要求：考入牛剑，别无其他选择。换言之，他显然不希望她多事。
(set: $birth to 2)
[[那不关我的事。 -&gt; 2.1B]]

[[好吧，但就是去看看。-&gt; 2.4]]</tw-passagedata><tw-passagedata pid="6" name=" 1.3" tags="" position="2075,575" size="100,100">她的父亲，正如南约克郡的许多人一样，是一名煤矿工人。她的家境并不好，公寓相当狭小，街道破破烂烂，南约克郡灰蒙蒙的天空让人感到阴郁。父亲总是在一天艰苦劳动后灰头土脸地回家，倒头就睡。尽管是家中四个孩子的长女，但她每年圣诞节能得到的礼物也不过是几个橘子和一些坚果——50-60年代的英国就是如此。

在这样一个以矿业为支柱产业的地区，可想而知工党能影响许多人生活的方方面面。她的父母都是工党党员，也积极参与工会的活动。从小生活在浓厚左翼氛围中的帕克决心要为了自己的同辈而读书，为他们能享有更美好的生活而斗争。读书虽然辛苦，但她乐在其中，学习成绩名列前茅。她相当聪明，而且争强好胜，十多岁时便展现出了超乎常人的智慧和能力，16岁时便完成中学学业，即将进入大学。

20世纪60年代的前半段飞速过去，她进入一所综合学校，朋友和家人相信以她的成绩，足以进入一所良好的大学，永远改变她的命运。但当时间来到1968年，同窗开始谈起越南战争、街头反战游行此起彼伏时，她也开始思考自己要不要参与其中。
(set: $birth to 3)
[[好吧，但就是去看看。-&gt; 2.2B]]

[[越战是非正义的！-&gt; 2.3]]</tw-passagedata><tw-passagedata pid="7" name=" 2.1A" tags="" position="2325,700" size="100,100">她没有参加抗议示威，没有和同辈多聊越战、反战运动、反核运动、嬉皮士或六八运动带来的一切，只是专注于书本。尽管如此，她仍心存疑虑。她的成绩尚不足以保证她进入梦寐以求的牛津，但爱丁堡大学并没有多少难度。六八年的盛夏相当煎熬。

(if:$luck is &gt;= 25)[幸运的是，过去的努力终究有了回报。当她收到那封信，正式被牛津大学默顿学院录取时，她终于有机会修读自己最热爱，也是全世界当时仅此一份的专业：哲学、政治学与经济学。

[[默顿学院在呼唤！-&gt;3.1]]](if:$luck is &lt; 25) [遗憾的是，她没能收到来自牛津的那封信，哲学、政治学与经济学专业与她擦肩而过。不过，能收到爱丁堡大学社会与政治科学学院的录取信，仍然是好事一桩。如果一切顺遂，四年之后，她将带着国际关系硕士的文凭开启下一段人生。

[[这是家的呼唤。-&gt; 3.2]]]</tw-passagedata><tw-passagedata pid="8" name=" 2.3" tags="" position="1950,700" size="100,100">她看到同辈抗议美国在越南的狂轰滥炸，控诉美军犯下的战争罪行。她感同身受，并且也参与其中，为结束这场血腥战争而摇旗呐喊，高举标语要求美军立刻撤出越南。毕竟，英国人受够了战争，她父亲也反复说，这场美国大资本家发动的战争只会让被强征入伍的美国少数族裔和无产者与越南人民毫无意义地厮杀。

但当她看到越来越多年轻人穿上嬉皮士装束、伴随着披头士起舞，或是听说不少美国大学生已经沉溺在大麻和LSD之中时，她感到相当迷茫。这些价值观难道不会腐蚀下一代人的心智，让他们自我堕落和麻痹吗？他们还能扛起工人运动的旗帜并高唱《红旗歌》吗？答案可能相当悲观——而她不希望未来就是这样。

她希望马上采取行动，从南约克郡开始，从谢菲尔德开始，甚至愿意为此放弃大学学业。但最终，她被父母劝住了——她只有16岁，有同龄人中过人的学识，现在就步入社会实在是太不划算了。尽管家里非常需要顶梁柱，但直接让她去工作显然是个下下策。

最终，她走进了谢菲尔德大学的校门。

[[希望几十年后不要后悔……-&gt;3.3]]</tw-passagedata><tw-passagedata pid="9" name=" 2.4" tags="" position="2575,700" size="100,100">当她看到同辈抗议美国在越南的狂轰滥炸时，她尚能勉强接受，毕竟英国人受够了战争；但当她看到越来越多年轻人穿上嬉皮士装束、伴随着披头士起舞，或是听说不少美国大学生已经沉溺在大麻和LSD之中时，她惊呆了。这就是他们的未来吗？一个庸俗、混乱、堕落和纵欲的未来？政见保守的父母一直反对这种瞎胡闹，她也在耳濡目染中接受了这一点。

她不想活在这样的世界之中——也正因此，她决心要按照她认为正确的方式生活，捍卫她认为正确的价值观。而这一切的起点将是牛津大学。
(set: $aristocratic to 1)
[[默顿学院在呼唤！-&gt;3.1]]</tw-passagedata><tw-passagedata pid="10" name="3.1" tags="" position="2500,825" size="100,100">对于争强好胜的帕克而言，在高手如林的牛津大学默顿学院就读不仅是享受，而且是严酷的挑战。争强好胜、力求上进的帕克虽然并不总能得到自己满意的成果，但至少也没有虚度光阴。在完成三年的本科学习阶段后，她即将开始深造，攻读国际关系学硕士学位。也是在这三年的辩论、阅读、交际之中，她开始思考是否要加入一个政党——毕竟自己的生活已经和政治紧密挂钩了。
(set: $university to &quot;ox&quot;)
[[保守党是个不错的选择。-&gt; 4.1A]]

[[不，维持政治中立更合适些。-&gt;4.1B]]

(if: $aristocratic is 0)[[工党是个明智之选。-&gt; 4.1C]](if: $aristocratic is 1) [[自由党？听上去有点老古董了，但不妨一试。-&gt; 4.1D ]]

(if: $birth is 1)[[苏格兰民族党？听起来真有趣……-&gt;4.2D]]</tw-passagedata><tw-passagedata pid="11" name=" 2.2A" tags="" position="2200,700" size="100,100">她看到同辈抗议美国在越南的狂轰滥炸，控诉美军犯下的战争罪行。她感同身受，并且也参与其中，为结束这场血腥战争而摇旗呐喊。毕竟，英国人受够了战争，她父亲也反复说海战是正人君子的战斗，但陆战则残酷得多。

但当她看到越来越多年轻人穿上嬉皮士装束、伴随着披头士起舞，或是听说不少美国大学生已经沉溺在大麻和LSD之中时，她有些迷茫。这些价值观难道要取代学校中教授的一切传统，成为这一代人的主旋律吗？她不知道。

无论如何，她人生的下一个阶段最终还是来到了。(if:$luck is &gt;= 50)[幸运的是，过去的努力终究有了回报。当她收到那封信，正式被牛津大学默顿学院录取时，她终于有机会修读自己最热爱，也是全世界当时仅此一份的专业：哲学、政治学与经济学。](if:$luck is &lt; 50)[遗憾的是，她没能收到来自牛津的那封信，哲学、政治学与经济学专业与她擦肩而过。不过，能收到爱丁堡大学社会与政治科学学院的录取信，仍然是好事一桩。如果一切顺遂，四年之后，她将带着国际关系硕士的文凭开启下一段人生。]

(if:$luck is &gt;= 50)[[[默顿学院在呼唤！-&gt;3.1]]](if:$luck is &lt; 50)[[[这是家的呼唤。-&gt; 3.2]]]</tw-passagedata><tw-passagedata pid="12" name=" 2.2B" tags="" position="2075,700" size="100,100">她看到同辈抗议美国在越南的狂轰滥炸，控诉美军犯下的战争罪行。她感同身受，并且也参与其中，为结束这场血腥战争而摇旗呐喊。毕竟，英国人受够了战争，她父亲也反复说，这场美国大资本家发动的战争只会让被强征入伍的美国少数族裔和无产者与越南人民毫无意义地厮杀。

但当她看到越来越多年轻人穿上嬉皮士装束、伴随着披头士起舞，或是听说不少美国大学生已经沉溺在大麻和LSD之中时，她有些迷茫。这些价值观难道不会腐蚀下一代人的心智，让他们自我堕落和麻痹吗？他们还能扛起工人运动的旗帜并高唱《红旗歌》吗？没人知道。

然而，有一点是确定无疑的——以她父母的积蓄，她想上大学将相当艰难。父母虽然不愿把话说明白，但她知道他们的意思——她必须勤工俭学，毕竟家里也没有闲钱。

她不想就这样离开课堂，她仍然希望靠教育和知识为她的家乡、她的同辈带去一点改变。她仍有希望进入这个国度最优秀的高等学府之一，并且凭这个机会改变命运。

经过深思熟虑，她……

[[向父母保证：本科毕业，马上就开始工作。 -&gt;3.3]]

[[什么都不说——我还想深造呢！-&gt;2.3]]</tw-passagedata><tw-passagedata pid="13" name=" 2.1B" tags="" position="2450,700" size="100,100">她没有参加抗议示威，没有和同辈多聊越战、反战运动、反核运动、嬉皮士或六八运动带来的一切，只是专注于书本。当她收到那封信，正式被牛津大学默顿学院录取时，她终于有机会修读自己最热爱，也是全世界当时仅此一份的专业：哲学、政治学与经济学。

于是，在同辈或艳羡或嫉妒的目光中，她登上了前往牛津的快车。

[[默顿学院在呼唤！-&gt;3.1]]</tw-passagedata><tw-passagedata pid="14" name=" 3.2" tags="" position="2250,825" size="100,100">对于争强好胜的帕克而言，在爱丁堡大学就读虽然经常面临挑战，但大多数时候是一帆风顺。许多时候，争强好胜、力求上进的帕克总能得到自己满意的成果，也几乎不曾虚度光阴。经过三年的辩论、阅读、交际，她开始思考是否要加入一个政党——毕竟自己的生活已经和政治紧密挂钩了。
(set: $university to &quot;edin&quot;)
[[保守党是个不错的选择。-&gt; 4.2A]]

[[不，维持政治中立更合适些。-&gt;4.2B]]

[[工党是个明智之选。-&gt; 4.2C]]

[[苏格兰民族党？听起来真有趣……-&gt;4.2D]]

[[自由党？听上去有点老古董了，但不妨一试。-&gt; 4.1D ]]</tw-passagedata><tw-passagedata pid="15" name=" 4.1A" tags="" position="2525,950" size="100,100">她加入了保守党，开始研究英国与欧共体关系，但对首相爱德华·希思的北爱尔兰政策略有不满——尤其是“血腥星期日”发生后更是如此。同时，她成为了牛津大学保守党协会主席的有力竞争者。生活前景似乎无比美好，但没过多久，灾难便降临在她身上。
(set: $party to &quot;con&quot;)
1972年3月23日，她看到电视上正连番报道贝尔法斯特多尼戈尔街的炸弹袭击事件。她顿时想起哥哥在那里工作，地点离袭击现场不远。她祈祷他能平安无事——然而事与愿违。第二天晚些时候，一封电报告诉她，她哥哥被爆炸碎片击中并当场遇难。而在此之前，临时爱尔兰共和军承认了这次袭击是他们所为。

完了。要做些什么呢？

[[让他们付出代价！-&gt; 5.2]]

[[冷静，海伦。上帝的正义会降临到他们头顶的。-&gt; 5.1]]</tw-passagedata><tw-passagedata pid="16" name="4.1B" tags="" position="2650,950" size="100,100">她没有加入任何政党，不过她自述还是个支持保守党的选民。她继续研究冷战背景下的英苏关系，也偶尔涉猎南非、罗得西亚这些全球冷战中的边缘地带，除此之外还学会了德语、俄语和西班牙语。生活前景似乎无比美好，但没过多久，灾难便降临在她身上。
(set: $foreignlanguage to 1)
1972年3月23日，她看到电视上正连番报道贝尔法斯特多尼戈尔街的炸弹袭击事件。她顿时想起哥哥在那里工作，地点离袭击现场不远。她祈祷他能平安无事——然而事与愿违。第二天晚些时候，一封电报告诉她，她哥哥被爆炸碎片击中并当场遇难。而在此之前，临时爱尔兰共和军承认了这次袭击是他们所为。

完了。要做些什么呢？

[[让他们付出代价！-&gt; 5.2]]

[[冷静，海伦。上帝的正义会降临到他们头顶的。-&gt; 5.1]]</tw-passagedata><tw-passagedata pid="17" name=" 4.1D " tags="" position="2900,950" size="100,100">她加入了自由党，接受了古典的保守主义和自由主义理念，并成为了(if: $university is &quot;ox&quot;)[牛津大学](if:$university is &quot;edin&quot;)[爱丁堡大学]自由党协会主席。生活前景似乎无比美好，但没过多久，灾难便降临在她身上。
(set: $party to &quot;lib&quot;)
1972年3月23日，她看到电视上正连番报道贝尔法斯特多尼戈尔街的炸弹袭击事件。她顿时想起哥哥在那里工作，地点离袭击现场不远。她祈祷他能平安无事——然而事与愿违。第二天晚些时候，一封电报告诉她，她哥哥被爆炸碎片击中并当场遇难。而在此之前，临时爱尔兰共和军承认了这次袭击是他们所为。

完了。要做些什么呢？

[[让他们付出代价！-&gt; 5.2]]

[[冷静，海伦。上帝的正义会降临到他们头顶的。-&gt; 5.1]]</tw-passagedata><tw-passagedata pid="18" name=" 4.1C" tags="" position="2775,950" size="100,100">她加入了工党，将更多精力用于研究凯恩斯主义经济学和“战后共识”下的英国政治，并成为了牛津大学工党协会主席的有力竞争者。生活前景似乎无比美好，但没过多久，灾难便降临在她身上。
(set: $party to &quot;lab&quot;)
1972年3月23日，她看到电视上正连番报道贝尔法斯特多尼戈尔街的炸弹袭击事件。她顿时想起哥哥在那里工作，地点离袭击现场不远。她祈祷他能平安无事——然而事与愿违。第二天晚些时候，一封电报告诉她，她哥哥被爆炸碎片击中并当场遇难。而在此之前，临时爱尔兰共和军承认了这次袭击是他们所为。

完了。要做些什么呢？

[[让他们付出代价！-&gt; 5.2]]

[[冷静，海伦。上帝的正义会降临到他们头顶的。-&gt; 5.1]]</tw-passagedata><tw-passagedata pid="19" name="3.3" tags="" position="1825,825" size="100,100">1968年，帕克进入谢菲尔德大学法学系。她希望成为一名律师，日后既能从政，也能为工人兄弟打抱不平。不过，生活仍然相当艰苦，家中日子过得相当拮据，她只能一边打零工一边苦读，将为数不多的结余寄回家中，让三个兄弟姐妹也有希望像她一样改变命运，而非继续当矿工或者矿工的妻子。1970年，她加入了工党。
(set: $university to &quot;shef&quot;)(set: $party to &quot;lab&quot;)
1971年，帕克从谢菲尔德大学毕业。家里人劝她尽快找工作，但她还是想再读一个硕士，或许能为日后的活动打下基础。她的男朋友——一位新闻学系的大学同学——则说，他无论如何都会支持她的决定。但这次，她认为自己责无旁贷了——是时候离开书斋，开始行动了。

[[这个社会需要我，我别无选择。-&gt;4.3]]</tw-passagedata><tw-passagedata pid="20" name="2.3" tags="" position="1950,825" size="100,100">当最终的结果出炉时，她很高兴能留在谢菲尔德——并且，能被谢菲尔德大学法学系录取。她希望成为一名律师，日后既能从政，也能为工人兄弟打抱不平。不过，生活仍然相当艰苦，家中日子过得相当拮据，她只能一边打零工一边苦读，将为数不多的结余寄回家中，让三个兄弟姐妹也有希望像她一样改变命运，而非继续当矿工或者矿工的妻子。1970年，她加入了工党。
(set: $university to &quot;shef&quot;)(set: $party to &quot;lab&quot;)
1971年，帕克从谢菲尔德大学毕业。家里人劝她尽快找工作，但她还是想再读一个硕士，或许能为日后的活动打下基础。她的男朋友——一位新闻学系的大学同学——则说，他无论如何都会支持她的决定。

[[家里人需要我，我别无选择。-&gt;4.3]]

[[知识可以改变许多。-&gt;4.4]]</tw-passagedata><tw-passagedata pid="21" name=" 4.2A" tags="" position="2025,950" size="100,100">她加入了保守党，开始研究英国与欧共体关系，但对首相爱德华·希思的北爱尔兰政策略有不满——尤其是“血腥星期日”发生后更是如此。同时，她成为了爱丁堡大学保守党协会主席的有力竞争者，甚至在空余时间自学了俄语、德语和西班牙语。生活前景似乎无比美好，但没过多久，灾难便降临在她身上。
(set: $party to &quot;con&quot;)(set: $foreignlanguage to 1)
1972年3月23日，她看到电视上正连番报道贝尔法斯特多尼戈尔街的炸弹袭击事件。她顿时想起哥哥在那里工作，地点离袭击现场不远。她祈祷他能平安无事——然而事与愿违。第二天晚些时候，一封电报告诉她，她哥哥被爆炸碎片击中并当场遇难。而在此之前，临时爱尔兰共和军承认了这次袭击是他们所为。

完了。要做些什么呢？

[[让他们付出代价！-&gt; 5.2]]

[[冷静，海伦。上帝的正义会降临到他们头顶的。-&gt; 5.1]]</tw-passagedata><tw-passagedata pid="22" name="4.2B" tags="" position="2150,950" size="100,100">她没有加入任何政党，不过她自述还是个支持保守党的选民。她继续研究冷战背景下的英苏关系，也偶尔涉猎南非、罗得西亚这些全球冷战中的边缘地带，除此之外还学会了德语、俄语和西班牙语。生活前景似乎无比美好，但没过多久，灾难便降临在她身上。
(set: $foreignlanguage to 1)
1972年3月23日，她看到电视上正连番报道贝尔法斯特多尼戈尔街的炸弹袭击事件。她顿时想起哥哥在那里工作，地点离袭击现场不远。她祈祷他能平安无事——然而事与愿违。第二天晚些时候，一封电报告诉她，她哥哥被爆炸碎片击中并当场遇难。而在此之前，临时爱尔兰共和军承认了这次袭击是他们所为。

完了。要做些什么呢？

[[让他们付出代价！-&gt; 5.2]]

[[冷静，海伦。上帝的正义会降临到他们头顶的。-&gt; 5.1]]</tw-passagedata><tw-passagedata pid="23" name=" 4.2C" tags="" position="2275,950" size="100,100">她加入了工党，将更多精力用于研究凯恩斯主义经济学和“战后共识”下的英国政治，并成为了爱丁堡大学工党协会主席的有力竞争者，甚至在空余时间自学了俄语、德语和西班牙语。生活前景似乎无比美好，但没过多久，灾难便降临在她身上。
(set: $party to &quot;lab&quot;)(set: $foreignlanguage to 1)
1972年3月23日，她看到电视上正连番报道贝尔法斯特多尼戈尔街的炸弹袭击事件。她顿时想起哥哥在那里工作，地点离袭击现场不远。她祈祷他能平安无事——然而事与愿违。第二天晚些时候，一封电报告诉她，她哥哥被爆炸碎片击中并当场遇难。而在此之前，临时爱尔兰共和军承认了这次袭击是他们所为。

完了。要做些什么呢？

[[让他们付出代价！-&gt; 5.2]]

[[冷静，海伦。上帝的正义会降临到他们头顶的。-&gt; 5.1]]</tw-passagedata><tw-passagedata pid="24" name=" 5.1" tags="" position="2625,1075" size="100,100">经过这次重大打击，她还是慢慢重回正轨，拾起课程，回归“正常”生活。

几周后，两名西装革履的男子找上了她，并和她进行了推心置腹的谈话。在谈话最后，他们亮明了身份——秘密情报局，或者说，军情六处。她修读过国家安全学课程，知道这是什么意思。实际上，她以为军情五处会先找上门，结果却并非如此。

除此之外，她也在研究英国军队在北爱尔兰的部署与动向。她知道另一条路是加入皇家陆军女子军团（WRAC），前往北爱尔兰问题的前线，协助警方开展行动。(if: $birth is 1)[父亲一直说参加英国军队是值得的，她也深信不疑。]虽然她上不了前线，但仍然可以为平定临时爱尔兰共和军这帮暴徒而作出贡献。以她的智慧和能力，二者都是可行的选择。

当然，她还有更多选择。她完全可以继续攻读博士学位，随后进入她想进入的任何领域。复仇不一定要马上开展。

现在轮到她做出抉择。

[[加入军情六处 -&gt;6.1]]

[[加入英国陆军 -&gt;6.2]]

[[继续学业 -&gt; 6.3]]</tw-passagedata><tw-passagedata pid="25" name=" 5.2" tags="" position="1700,1075" size="100,100">她逐渐荒废了学业，一心寻求复仇机会，许多个日夜都茶饭不思。不久，她便意识到自己没有回头路了——她的导师对她心不在焉虽然理解，但并不满意。如果她拿不到学位，就必须另谋出路。

幸运的是，她勉强毕业后几周，两名西装革履的男子找上了她，并和她进行了推心置腹的谈话。在谈话最后，他们亮明了身份——秘密情报局，或者说，军情六处。她修读过国家安全学课程，知道这是什么意思。实际上，她以为军情五处会先找上门，结果却并非如此。

除此之外，她也在研究英国军队在北爱尔兰的部署与动向。她知道另一条路是加入皇家陆军女子军团（WRAC），前往北爱尔兰问题的前线，协助警方开展行动。(if: $birth is 1)[父亲一直说参加英国军队是值得的，她也深信不疑。]虽然她上不了前线，但仍然可以为平定临时爱尔兰共和军这帮暴徒而作出贡献。以她的智慧和能力，二者都是可行的选择。

现在轮到她做出抉择。(set: $degree to &quot;BA&quot;)

[[加入军情六处 -&gt;6.1]]

[[加入英国陆军 -&gt;6.2]]</tw-passagedata><tw-passagedata pid="26" name="6.1" tags="" position="2000,1200" size="100,100">1972年，帕克加入军情六处。在军情六处中，帕克主要专精对华约国家情报活动和情报工作中后勤任务的研究。同时，她还有过人的化学、生物学知识，也曾涉猎心理控制和催眠。
(set: $entrance to 1972)(set: $vocation to &quot;mi6&quot;)
作为一名几乎全能的新晋干员，帕克被许多人认为是神童，她在军情六处内的地位也步步高升。1974年，年仅22岁的帕克被军情六处调入刚刚成立的、由美、英、法、西德等国情报机构参与的“铃”计划（BELL Project），并第一次与中情局干员罗素·阿德勒（Russell Adler）相识。他们对抗的是铁幕背后代号“珀修斯”的苏联国家安全委员会（克格勃）第十九总局——一个在全球各地都有情报网，抱持最原始的共产主义理想的团体。他们对自由世界的威胁胜过苏共中央政治局，甚至胜过整个华约组织。为此，“铃”计划于1972年设立，唯一目标就是反制他们。

1981年1月，帕克用氯化钾亲手杀了一个被俘的“珀修斯”高级干员——因为无人知道他的真名，所以阿德勒便用计划代号“贝尔”称呼他。8月，29岁的帕克被军情六处任命为英方在“铃”计划中的核心干员；同年11月，原摩萨德干员，现中情局人员埃利埃泽·“拉扎尔”·阿祖莱加入“铃”计划，并与帕克渐生情愫。

[[下一个任务是什么？-&gt; 8.1]]
</tw-passagedata><tw-passagedata pid="27" name="6.2" tags="" position="1700,1200" size="100,100">1972年，帕克在完成本科学业后就读军事学院，并以少尉军衔加入了皇家陆军女子军团。随后，她主动要求被分配到北爱尔兰。
(set: $vocation to &quot;army&quot;)
时间来到1977年，帕克所属的部队已经和贝尔法斯特的皇家阿尔斯特警察建立了紧密合作关系，并积极参与各种辅助行动，如盘查女性嫌疑人、入户搜查、通信工作等。不过，帕克是罕见的从事研究和观察任务的女性，负责协助制定辅助行动的方针和具体行动方案，主要目的是赢得贝尔法斯特人民，尤其是天主教徒的支持。

北爱尔兰的20世纪70年代以两次袭击告终：1979年8月27日，蒙巴顿勋爵的游艇遭临时爱尔兰共和军炸弹袭击，他本人遇难；同一天，18名英军空降兵被遥控炸弹炸死，成为英军进驻北爱尔兰以来死亡人数最多的单一事件。

不久，她接到指令，参与研究如何遏制爱尔兰共和军的炸弹袭击。并尽可能为政治解决北爱尔兰问题创造条件。

她决定：

[[按照上级指示来。（强硬）-&gt;7.7]]

[[纯粹的暴力不能解决问题。（温和）-&gt;7.8]]

</tw-passagedata><tw-passagedata pid="28" name=" 6.3" tags="" position="2625,1200" size="100,100">1976年，帕克取得(if: $university is &quot;edin&quot;)[爱丁堡大学国际关系](if: $university is &quot;ox&quot;)[牛津大学政治学]博士学位，也到了求职的时候。摆在面前的机会相当多——找一份收入颇丰的工作、步入政坛，甚至加入军情六处，都是可行的选择。她受过相当良好的教育，曾涉猎许多领域，总能找到适合自己的工作的。(set: $degree to &quot;PhD&quot;)
(set: $luck to (random:1,100))
(if: $party is &quot;con&quot; or &quot;neutral&quot;)[[智库听上去是个好东西。-&gt; 7.1]](if: $birth is 2 and $party is &quot;lib&quot;)[[智库听上去是个好东西。-&gt; 7.1A]](if: $party is &quot;lab&quot;)[[智库听上去是个好东西。-&gt; 7.1B]](if: $birth is 1 and $party is &quot;lib&quot;)[[智库听上去是个好东西。-&gt; 7.1C]]

(if: $party is &quot;con&quot; or &quot;neutral&quot; or &quot;lib&quot; )[[直接从政怎么样？-&gt; 7.2]](if: $party is &quot;lab&quot;)[[直接从政怎么样？-&gt; 7.2A]]

[[或许应该再试试军情六处？-&gt; 7.3]]

(if: $party is &quot;scot&quot; )[[无论如何，先回到苏格兰吧。-&gt; 7.4]]

(if: $birth is 2)[[想这么多干嘛？跟着老爸走准没错。-&gt; 7.5]]

(if: $foreignlanguage is 1 or $foreignlanguage is not 1 and $luck is &gt;=50)[[女王陛下外务官队伍肯定是个好主意。-&gt; 7.6]]</tw-passagedata><tw-passagedata pid="29" name="4.2D" tags="" position="2400,950" size="100,100">彼时的苏格兰民族党还是个小党，在议会只有一个席位。许多朋友根本不理解帕克为何要加入这个似乎毫无前途的小党，难道只因为她是苏格兰人吗？无论如何，至少对于她而言，日常生活没有什么变化。但没过多久，灾难便降临在她身上。
(set: $party to &quot;scot&quot;)
1972年3月23日，她看到电视上正连番报道贝尔法斯特多尼戈尔街的炸弹袭击事件。她顿时想起哥哥在那里工作，地点离袭击现场不远。她祈祷他能平安无事——然而事与愿违。第二天晚些时候，一封电报告诉她，她哥哥被爆炸碎片击中并当场遇难。而在此之前，临时爱尔兰共和军承认了这次袭击是他们所为。

完了。要做些什么呢？

[[让他们付出代价！-&gt; 5.2]]

[[冷静，海伦。上帝的正义会降临到他们头顶的。-&gt; 5.1]]</tw-passagedata><tw-passagedata pid="30" name=" 7.1" tags="" position="3975,1325" size="100,100">1977年，帕克加入政策研究中心（Centre for Policy Studies），虽然这是一家偏右翼的智库，但她尽可能做到政治中立。她的主要研究领域是英国与欧共体和东欧集团的关系，同时也涉及过不少英国内政议题。虽然她相当喜欢运用自己的聪明才智协助制定政策并开展前瞻性研究，但她并不想做纯学术，仍然想参与到政治之中。1981年，她结了婚，并在伦敦定居下来。
(set: $vocation to &quot;poli&quot;)
虽然有朋友劝她在1983年竞选下议院议员，但她婉拒了，1987年也是如此。到1990年，她已经成为政策研究中心研究总监，她执掌的研究项目对保守党过去11年的执政产生了不小影响——无论内政还是外交。然而，撒切尔夫人执政后期的刚愎自用和内政外交议题上的诸多失误，导致她开始考虑直接从政，尽自己所能真正让保守党回到正轨。

不过，她的一些同事和朋友并不建议她这么做。他们认为，过去13年从事高度学术性的研究工作，已经让她失掉了不少政治素养；如果她投身政坛，哪怕只是在保守党研究部工作，也可能被权力斗争吞噬，或是因为缺少行政岗位经验而面临巨大挑战。但她知道，政治实践和政治科学终究是不分家的，空有知识而没有权力，不会产生什么真正的结果。
(set: $entrancetopolitics to &quot;thinktank&quot;)
[[知道如何使用权力，那总得实践一下，哪怕不喜欢。-&gt;8.2]]</tw-passagedata><tw-passagedata pid="31" name=" 7.2" tags="" position="2500,1325" size="100,100">1979年，年仅27岁的帕克决定竞选下议院议员。(if: $party is &quot;lib&quot;)[在选举前，由于她认为自由党在议会选举中毫无胜算，因此她改换门庭加入了保守党。]由于卡拉汉的工党政府因“不满的冬天”而受到巨大冲击，支持率被保守党拉开，因此帕克相信她能取得胜利。作为一位本地的新起之秀，帕克已经参与了两年多的政治活动，并成为了地方议会议员，前途似乎一片大好，她年轻的特质预计也会让选民耳目一新。
(set: $vocation to &quot;poli&quot;)
经过一场悬念不算太大的选战，帕克最终当选下议院议员。1979年大选标志着保守党的长期执政岁月开始，玛格丽特·撒切尔成为了英国首相。不过，由于年龄太小加上经验不足，帕克在前四年议员生涯中并没有太多参与行政岗位，更与内阁无缘。

1983年大选中，由于工党竞选纲领的失误，以及马岛战争胜利和经济复苏对保守党政府带来的巨大增益，保守党毫无悬念地获得下议院绝对多数，帕克则轻松保住了自己的席位。选举结果出炉后，工党党魁迈克尔·富特引咎辞职，尼尔·基诺克（Neil Kinnock）接替了党魁一职。也是在这次选举后，撒切尔夫人开始重视这位保守党的明日新星。(if: $birth is 1)[帕克起初希望与撒切尔夫人保持距离，但很快她也意识到跟着“铁娘子”能为她带来巨大利好。](if: $birth is 2)[在帕克这位富家小姐眼里，撒切尔夫人是保守党所代表的一切意识形态的化身——自由主义、保守主义、小政府……这一切正是英国走出凯恩斯主义带来的阴霾所必需的。]

[[看看“铁娘子”能带给我什么……-&gt;8.13]]</tw-passagedata><tw-passagedata pid="32" name=" 7.3" tags="" position="2000,1325" size="100,100">出乎众人意料的是，1976年，本可找份好工作安稳度过一生的帕克居然选择了军情六处——或许是因为她有一颗不安分的心吧。在军情六处中，帕克主要专精对华约国家情报活动和情报工作中后勤任务的研究。同时，她还有过人的化学、生物学知识，也曾涉猎心理控制和催眠。
(set: $entrance to 1976)(set: $vocation to &quot;mi6&quot;)
1979年，帕克被军情六处调入刚刚成立的、由美、英、法、西德等国情报机构参与的“铃”计划（BELL Project），并第一次与中情局干员罗素·阿德勒（Russell Adler）相识。他们对抗的是铁幕背后代号“珀修斯”的苏联国家安全委员会（克格勃）第十九总局——一个在全球各地都有情报网，抱持最原始的共产主义理想的团体。他们对自由世界的威胁胜过苏共中央政治局，甚至胜过整个华约组织。为此，“铃”计划于1972年设立，唯一目标就是反制他们。

1981年1月，帕克用氯化钾亲手杀了一个被俘的“珀修斯”高级干员——因为无人知道他的真名，所以阿德勒便用计划代号“贝尔”称呼他。8月，29岁的帕克被军情六处任命为英方在“铃”计划中的核心干员；同年11月，原摩萨德干员，现中情局人员埃利埃泽·“拉扎尔”·阿祖莱加入“铃”计划，并与帕克渐生情愫。

[[下一个任务是什么？-&gt; 8.1]]
</tw-passagedata><tw-passagedata pid="33" name=" 7.4" tags="" position="3325,1325" size="100,100">在伦敦住了一年后，帕克于1977年回到爱丁堡，在那里的企业找到一份不错的工作，次年结了婚，先后育有三个孩子。
(set: $vocation to &quot;poli&quot;)
1979年，本就因“不满的冬天”而声誉尽毁的首相詹姆斯·卡拉汉又因为《苏格兰法案》公投失败而失去苏格兰民族党信任供给，在不信任动议通过后下台。

作为苏格兰民族党成员，帕克一直支持苏格兰自治，尤其是北海油田被发现后，她更加相信自治是必须的；如果可以，苏格兰甚至应当谋求独立。这一鲜明立场，再加上良好的教育背景、广泛人脉和年富力强的形象，使帕克在苏格兰民族党内步步高升。

1987年，苏格兰民族党在英国议会大选中赢得4个席位，帕克也惊险地成为南爱丁堡选区议员。同时，帕克也积极参与苏格兰众议院运动（Campaign for a Scottish Assembly），于1979年失败的公投后一直向当时的撒切尔夫人政府施压，强烈主张苏格兰人民的固有主权，要求建立苏格兰自治政府。

1997年大选前，工党承诺就是否支持成立苏格兰议会及交由其选出新的苏格兰政府进行公民表决。在选举前，工党派人联系帕克，暗示她如果做出“巨大转变”，将会获得她想都不敢想的利益。

[[看来得支持一回托尼·布莱尔了。-&gt; 8.5]]</tw-passagedata><tw-passagedata pid="34" name=" 7.5" tags="" position="4550,1325" size="100,100">凭着她父亲的身份和人脉，她顺利进入英国石油公司，谋得一份薪水不菲的工作。尽管一些同事不喜欢她自命不凡、甚至称得上冷峻的性格，但随着时间流逝，她也逐渐变得更加随和温柔。唯一让她不太满意的，就是这份工作似乎与她就读的专业实在不太沾边——说到底，她还是想去政坛试试水。到1990年，她已升至经理岗位，前途一片大好。

(if: $party is &quot;lib&quot;)[1988年，自由党和社会民主党合并为自由民主党，大有继续维持英国议会第三大党并进一步扩大规模的势头。她嗅到了机会——从现在开始为竞选议员做准备，1992年她或许就有机会进入议会。在那之后，她就可以在政治舞台上大展拳脚。](if: $party is &quot;con&quot; or &quot;neutral&quot;)[1990年约翰·梅杰接替撒切尔夫人担任首相后，保守党向她伸去了橄榄枝，邀请她在两年后竞选议会议员，并暗示她未来将提供更多好处——当然，代价是她放弃生意，转投政治。]

所以，是进入政坛，还是维持现状？

(if: $party is &quot;con&quot; or &quot;neutral&quot;)[[何不尝试点新东西呢？-&gt;8.2]]

[[就当个企业家不好吗？-&gt;8.4]]

(if: $party is &quot;lib&quot;)[[谁不想当自由民主党的元老呢？-&gt;8.3]]</tw-passagedata><tw-passagedata pid="35" name=" 7.6" tags="" position="3100,1325" size="100,100">1977年，帕克(if: $party is not &quot;neutral&quot;)[在放弃党籍后]进入英国外务官队伍，开始了外交官生涯。由于开展过大量与东欧集团有关的研究，(if: $foreignlanguage is 1)[又会俄语和德语，]因此帕克很快被分配到东欧司，以随员身份开始了外交官生涯。1979年，她被派驻到东德，随后几年间在波兰、捷克斯洛伐克、芬兰和匈牙利流转。1981年12月13日，当波兰统一工人党第一书记雅鲁泽尔斯基宣布戒严时，她就在华沙的英国大使馆馆舍。
(set: $vocation to &quot;civil&quot;)(set: $party to &quot;neutral&quot;)
不久后，军情六处因帕克的学术经历而找上了她，她也随之成为军情六处的正式情报人员。1985年，她协助被克格勃发现的双面间谍奥列格·戈尔季耶夫斯基经陆路从莫斯科前往赫尔辛基，进入英国大使馆，随后返回英国。帕克日后称，这段经历使她日后有了谋求成为秘密情报局（军情六处）局长的想法。


1989年11月9日晚，帕克正在英国驻东德大使馆和同事用餐，电视上放着BBC一台的新闻。突然有人大喊：“快换到东德电视台！有大事！”

她起身换了台，眼前的一幕她永生难忘。统一社会党东柏林市委第一书记沙博夫斯基正板着苦脸说：”旅行证件无需先决条件或家庭关系即可申请……通行证将很快签发。“之后，记者询问新规生效的时间。沙博夫斯基迟疑片刻，答道：“就我所掌握的，法律即刻生效，没有拖延。”尽管他身旁的对外贸易部长想阻止他，但他却继续往下读，并且证实了记者的猜想：新规对前往西柏林一样生效。

一会儿后，新闻发布会结束，餐厅里的每一个人都呆住了，等待着沙博夫斯基接下来会说什么。NBC的汤姆·布罗考采访了他，他再次重申新规立即执行，民主德国公民可以穿过边境。

帕克知道没什么好犹豫的了。她站起来大喊——

[[墙要倒了！-&gt;8.10]]

</tw-passagedata><tw-passagedata pid="36" name=" 8.1" tags="" position="2000,1450" size="100,100">1983年8月，“铃”计划人员收到命令，在9月1日派出干员渗透进东柏林，执行监听、情报窥探等多项行动，旨在反制珀修斯在东柏林地区的活动，并进一步探明苏联对北约的立场和行动计划。帕克受命从腓特烈大街车站渗透入卡尔霍斯特，在那里的安全屋安顿下来，并在执行完一个月的任务后回到西柏林的基地。

行动开始前一天，阿德勒的老朋友、荣誉勋章得主、空军上校蒂莫西·法兰德带人前来与他们接触。然而仅仅几个小时后，阿德勒便通知所有人员，一名行动的外围人员——西德联邦情报局的卢卡斯·里希特——三天前在东柏林失联了，很有可能是被国家安全部（史塔西）生擒。

帕克听到这消息，心里有点发怵。虽然按照阿德勒的简报，里希特只是个相当次要的人员，不太可能掌握多少机密，但她总还是感到担忧。她决定……
(set: $luck to (random:1,100))
(if: $luck is &gt;=25)[[[和阿德勒谈谈，我不希望有太多风险。-&gt;9.3]]](if: $luck is &lt; 25)[[[和阿德勒谈谈，我不希望有太多风险。-&gt;9.3A]]]

[[管他呢，上吧！-&gt;9.4]]

</tw-passagedata><tw-passagedata pid="37" name="8.3" tags="" position="4550,1450" size="100,100">1992年大选中，帕克在充足的资金支持下当选下议院议员，正式进入政坛。由于她在商界的工作经历，因此她在第一个议员任期内主要负责党的资金，也参与到争取商界支持的活动中。
(set: $vocation to &quot;poli&quot;)
1997年大选后，她成为自由民主党的教育事务发言人，并在1999年支持查尔斯·肯尼迪竞选自由民主党党魁。2001年大选后，她又晋升为欧洲事务发言人，辅佐外交事务发言人孟席斯·坎贝尔。

2005年大选后，自由民主党内部呈现三头鼎立局势——由于肯尼迪健康状况不佳，他有意在2006年辞去党魁一职。此时，财政事务发言人帕克、外交事务发言人坎贝尔和欧洲事务发言人尼克·克莱格（Nick Clegg）是公认的自由民主党三大领袖。

2006年肯尼迪辞职后，坎贝尔继任党魁。然而，坎贝尔并不是一个受人欢迎的人物，在议会的“首相答问时间”环节经常出丑。到2007年下旬，自由民主党内部决定必须换掉坎贝尔。

在这一情况下，帕克意识到一个事实——如果她不能和克莱格谈妥条件，否则她就必须和他竞争党魁职务；但是在这场斗争中，她的资历更丰富，似乎处于优势。因此，她出乎意料地没有和克莱格谈判，而是直接宣布自己将竞选党魁。
(set: $luck to (random:1,100))
(if: $luck is &lt; 33)[[应该不会出岔子吧？-&gt;9.11]](if: $luck is &gt;= 33)[[应该不会出岔子吧？-&gt;9.11A]]</tw-passagedata><tw-passagedata pid="38" name="8.4" tags="end" position="4675,1450" size="100,100">帕克谢绝了进入政坛的邀请，继续在英国石油公司工作，并随着时间流逝步步高升。尽管在此期间保守党和工党都曾找上门，请她步入政坛，但她都婉言谢绝了。
(set: $vocation to &quot;entre&quot;)
2000年，英国石油公司改名BP。2000年代初，她参与了巴库-第比利斯-杰伊汉原油管道的策划和监督工作，并在2005年成为公司运营总监。2010年末，在应付完墨西哥湾石油泄漏事件后，帕克成为BP的首席执行官，并一直担任这个职务长达10年。她曾短暂担任过俄罗斯石油公司的董事，但在2014年克里米亚危机爆发后辞去了这个职务。

2020年帕克退休后，她也没有闲下来，成为捷豹路虎公司的董事，至今仍在企业界发光发热，是一位当之无愧的女强人。她早年的许多朋友至今仍惊讶于她放弃从政，留在商界，并给出了无数种解释。

实际上，可能只是她父亲深深地影响了她吧。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“女强人”]
海伦·A·帕克（1952.7.20-），企业家，英国石油公司（BP）首席执行官（2010-2020）。定个小目标，先赚他一亿（英镑）！//&#39;&#39;

（注：本结局比较短，但本结局的前序事件最终可以引向的结局相当有趣！）

[[重生-&gt;Start]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="39" name=" 8.5" tags="" position="3325,1450" size="100,100">1997年5月1日，英国举行议会大选，布莱尔带领工党大获全胜，帕克也保住了自己的席位。同年9月11日，苏格兰举行公民投票，绝对多数的选民支持成立苏格兰议会，并赋予苏格兰议会变更税收的权力。

1998年11月19日，伊丽莎白二世御准《1998年苏格兰法案》，正式组建苏格兰议会和权力下放政府。然而在1999年的苏格兰议会选举中，苏格兰民族党未能获得多数席位，也没能参与权力下放政府。摆在帕克面前的选择仍然不少：她可以留在苏格兰民族党，党魁亚历克斯·萨尔蒙德甚至许诺她可以担任下一任党魁，只要时机成熟。

然而，她还有另一个选择：投奔工党，加入布莱尔内阁——布莱尔已经暗示过她，只要她改旗易帜，放弃激进的苏格兰独立立场，苏格兰事务大臣的大门可以为她敞开。(if: $university is &quot;edin&quot;)[除此之外，她还收到了一个意想不到的朋友的邀请——比她大一届的爱丁堡大学校友、财政大臣戈登·布朗邀请她加入工党。]

当然，一旦她选择更换政党，不仅要承担一些人的敌意，而且这么做也绝无回头路。

[[抱歉，但我不能放弃立场。-&gt;9.1]]

[[学会和强者结盟总有好处。-&gt;9.2]]</tw-passagedata><tw-passagedata pid="40" name="9.1" tags="" position="3325,1575" size="100,100">经过深思熟虑，帕克放弃了一切改换门庭的主意，决心留下来继续推动苏格兰独立。经过几年苦熬，2007年，苏格兰民族党终于得以组建一个少数派政府，她担任副首席部长兼卫生大臣。2011年，苏格兰民族党获得苏格兰议会多数，她也相应地留任。至此，萨尔蒙德和她都坚信，是时候推动苏格兰独立了。

2012年10月15日，英国首相卡梅伦和苏格兰首席大臣萨尔蒙德在苏格兰首府爱丁堡签署了关于苏格兰进行独立公投的最终协议，协议规定，苏格兰独立公投在2014年举行，投票公民的年龄必须16岁以上。帕克开始深度参与“是的苏格兰”（YesScotland）运动，同时参与起草关于苏格兰如何从联合王国脱离并成为独立国家的白皮书。2013年3月，萨尔蒙德宣布投票时间为2014年9月18日。

到2014年初，关于苏格兰独立的民调大多显示支持独立和反对独立者无法拉开差距，但绝大多数投票中反对独立一方占据优势。萨尔蒙德提出一个方案：把帕克从宣传岗位上撤下来，让她全力投入完善白皮书，尤其要解决苏格兰的欧盟成员国资格问题、货币问题（英国政府表示苏格兰如果独立不能使用英镑）、部署在苏格兰的英国核潜艇问题、苏格兰独立后的国家安全问题等等。

[[重点是唬住选民，独立具体要干什么晚点再说。-&gt;10.1]]

[[如果选民不知道苏格兰要怎么独立，他们怎么可能投支持票呢？-&gt;10.2]]</tw-passagedata><tw-passagedata pid="41" name="9.2" tags="" position="3450,1575" size="100,100">2000年初，帕克突然宣布退出苏格兰民族党，转为独立议员。次年大选之后，她加入工党，并且几乎完全逆转了对苏格兰问题的立场，开始反对苏格兰独立。这一巨大转变几乎让她在苏格兰的名声瞬间崩塌，尤其是在大选之后才转投工党的操作使她被许多乡亲骂成“叛徒”。

当然，改换门庭也有好处。在担任了两年议员后，帕克于2003年6月13日被任命为苏格兰事务大臣，并一致任职到2007年戈登·布朗上台。2005年大选中，她以微弱优势保住了自己的议席。

2007年大选前夕，布莱尔宣布自己不再谋求连任，计划将首相一职让给布朗。帕克面临这样一个前景：她可以做出保证，不再参加下一次议会选举并退休，也可以直接改换选区参加下一次大选。前者的好处是她剩下来的政治生涯无后顾之忧，后者则是她可以进一步获得权力，甚至谋求成为首相——当然，考虑到她在苏格兰名望不佳，而且改换选区只会加剧她变色龙的名声，她还是想见好就收。

(if: $university is &quot;edin&quot;)[这时，布朗再次找上她并给她开出了难以想象的价码：首先担任内政大臣，在下一次议会选举后，如果工党可以独立组阁，就任命她为副首相。]

[[给后人留下一个圆满的名声更合适些。-&gt;10.5]]

[[权力属于敢于掌握权力的人。-&gt;10.6]]</tw-passagedata><tw-passagedata pid="42" name="10.1" tags="" position="3325,1700" size="100,100">帕克拒绝了萨尔蒙德的提案，留在当前岗位上。萨尔蒙德对此并不满意，事实证明这有可能是正确的——支持独立一方的民调情况在此后几个月中一直没有起色，这很有可能是因为许多媒体反复指出，苏格兰民族党政府根本没有准备好独立方案，他们对独立的设想是“天真幼稚”的。

2014年9月18日早上，帕克早早投了票，然后前往苏格兰民族党党部。她知道，如果公投失败，她的政治生涯可能会马上完蛋；如果公投成功——虽然可能性似乎不大——那么，接下来的几年一样会相当艰难。

[[会赢吗？-&gt;11.1]]</tw-passagedata><tw-passagedata pid="43" name="10.2" tags="" position="3450,1700" size="100,100">帕克接受了萨尔蒙德的提案，转向完善苏格兰独立的计划。在公投前的最后九个月中，帕克带领她的团队提出了一整套虽然仍有不少漏洞，但至少能吸引中间派民众的方案：

关于苏格兰的欧盟成员国资格问题和货币问题，她考虑到苏格兰民众大多亲欧盟，明确表示会努力争取苏格兰加入欧盟并采用欧元。

关于部署在苏格兰的英国核潜艇问题，她表示最终不会允许苏格兰领土上出现核武器，但她表示将会通过“耐心的协商”，在“较长的一段时间内”使英国皇家海军的弹道导弹核潜艇彻底撤出苏格兰。

关于苏格兰独立后的国家安全问题，她一方面主张与英国缔结共同防御协定，另一方面则表示苏格兰需要与英国合作建立一套相对完整的国家安全体系，包括内部安全机构和对外情报机构。

另外，帕克还表示苏格兰的国体问题完全可以谈判，她愿意建立一个苏格兰共和国，也可以尊伊丽莎白二世为君主。

在这套方案陆续出炉后，民调显示支持苏格兰独立一方已经将劣势缩小到1-3%，接近统计误差。当然，仍有很多人质疑这套方案的可行性，一些人则斥责其为和尚念经式的车轱辘话。不过，从民调来看，方案仍然吸引了不少中间派民众，让他们相信独立至少是可行的——哪怕要花个八年十年……

2014年9月18日早上，帕克早早投了票，然后前往苏格兰民族党党部。她知道，如果公投失败，她的政治生涯可能会马上完蛋；如果公投成功——虽然可能性似乎不大——那么，接下来的几年一样会相当艰难。
(set: $luck to (random:1,100))
(if: $luck &lt;= 66)[[会赢吗？-&gt;11.1]](if: $luck &gt; 66)[[会赢吗？-&gt;11.2]]

</tw-passagedata><tw-passagedata pid="44" name="11.1" tags="" position="3325,1825" size="100,100">2014年9月18日可能是海伦·帕克一辈子最煎熬的一天。这天深夜，公投结果出炉——不出意料，失败了。44.7%选民支持独立，55.3%反对。第二天早上，萨尔蒙德宣布自己对公投结果不满，并将为此承担全部责任。因此，他将在11月辞去苏格兰首席部长职务。

帕克此时面临一个两难抉择：作为推定的下一任苏格兰首席部长和苏格兰民族党党魁，如果她宣布不寻求这两个职务，那么苏格兰民族党将会失去两大主心骨；然而，她积极参与独立运动，声誉并不出彩。而如果她选择接替萨尔蒙德，如何让苏格兰民族党走出这次败仗的阴影又会是另一个大麻烦。

说实话，她累了，年纪也大了，不是很想谋求接替萨尔蒙德。但某种意义上，她也别无选择——如果苏格兰独立运动的两大推动者就这么辞职了，那这运动还有希望吗？

怎么办？

[[抱歉，苏格兰同胞。我心意已决。（退休）-&gt;12.1]]

[[独立运动将会继续，这个梦不会死！（连任）-&gt;12.2]]</tw-passagedata><tw-passagedata pid="45" name="12.1" tags="end" position="3325,1950" size="100,100">2014年9月21日，一条令苏格兰和全英人民震惊的消息传来：苏格兰民族党二号人物、苏格兰副首席部长海伦·帕克宣布，不谋求获取苏格兰民族党党魁职务，并将在今年11月退休。这条消息震惊了整个苏格兰民族党和苏格兰独立运动——对于这个党，帕克这位近四十年的老党员的退出无异于一记重锤；苏格兰独立运动连续失去两员大将，基本就等同于苏格兰再无独立的可能。

在2015年英国议会选举中，群龙无首的苏格兰民族党表现极其差劲，只获得59个席位中的9个。此后，苏格兰民族党虽然反复要求举行第二次独立公投，但应者寥寥。2016年，该党又在苏格兰议会选举中惨败，成为在野党，直到今天。


如今，许多支持独立的苏格兰人记恨帕克，认为她在最关键的时刻“明哲保身”，葬送了苏格兰独立运动；许多英国人则对她怀有一种说不清道不明的情感，觉得她论政绩并不多，但论历史影响却极其深远。

但他们隐隐约约还能感觉到一点：她选择背负荆棘，换来联合王国的统一。



触发结局：
//&#39;&#39;(text-colour: green)[普通结局：“主为我的防御而辩护”]
海伦·A·帕克（1952.7.20-），苏格兰副首席部长（2007-2014），苏格兰独立运动的推动者……与掘墓人？&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)

(text-size: 0.5)[（小小彩蛋：这是本游戏作者第一个做出来的结局）]</tw-passagedata><tw-passagedata pid="46" name="12.2" tags="end" position="3450,1950" size="100,100">2014年11月，在苏格兰民族党代表大会上，海伦·帕克因无竞争者而自动当选党魁，并继任苏格兰首席部长。在2015年英国议会选举中，苏格兰民族党大获全胜，获得英国议会苏格兰地区59个席位中的56个。此后，苏格兰民族党虽然反复要求举行第二次独立公投，但应者寥寥。

随着年龄增长，帕克愈发感到撑不住了——她的健康状况每况愈下，青年时的烟瘾也影响着她的呼吸道健康。新冠疫情最终击倒了她——2020年末，在勉强康复后，她决定辞去苏格兰民族党党魁和苏格兰首席部长职务。此后不久，她被查出患上了肺癌。


2023年8月5日，在新冠病毒和癌细胞的双重摧残下，“坚强的帕克”在爱丁堡的乡间别墅告别了人世，享年71岁。在逝世后，帕克获得了相对公允的评价：支持者肯定她作为政治家经验丰富、能言善辩，苏格兰独立运动支持者更是称她为“口直心快甜心”；然而，她的反对者则抨击她是个“危险分子”，甚至说她是“英国最危险的女人”。

是非功过就都任人评说吧。



触发结局：
//&#39;&#39;(text-colour: green)[普通结局：“主为我的防御而辩护”（变体）]
海伦·A·帕克（1952.7.20-2023.8.5），苏格兰副首席部长（2007-2014），苏格兰民族党党魁兼苏格兰首席部长（2014-2020）。苏格兰独立运动的重要推动者，一位毁誉参半的政治人物。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="47" name="11.2" tags="end" position="3450,1825" size="100,100">2014年9月18日可能是海伦·帕克一辈子最煎熬的一天。这天深夜，公投结果出炉——

&#39;&#39;//什么？50.6%赞成，49.4%反对？只差四万票？不会吧？//&#39;&#39;

当全世界震惊地看着苏格兰就这样迈向独立时，帕克已经回家了。她回到爱丁堡的乡间别墅，和早已等在那里的父母、丈夫和孩子一道举杯相庆。过去六十多年的经历浓缩成一个个片段，逐一映入她的脑海。历经艰难险阻，她终于走到如今这一步——尽管日后可能是更多艰险，但至少，今晚值得开香槟庆祝。

零点钟声敲响时，她年近九旬的父亲凑到她耳边说：“我可能不支持苏格兰独立……但我以你为豪，海伦。”

窗外，爱丁堡是一片狂喜的海洋。

(set: $special1 to &quot;scot&quot;)
2024年6月24日，班诺克本战役710周年、独立公投近十年后，在响彻苏格兰低地的礼花声中，苏格兰正式作为一个英联邦王国独立。同日，年逾七旬的海伦·帕克宣读了苏格兰独立宣言，并在仪式最后和内阁成员手挽着手高唱国歌《苏格兰之花》和《友谊地久天长》。

而她的身份是……对，你没猜错，苏格兰总理。当然，民族主义热情上脑的、敬爱她的苏格兰人已经管她叫“国母”或者“女布鲁斯”（指罗伯特·布鲁斯，苏格兰民族英雄，恢复了苏格兰王国）了。


(align:&quot;=&gt;&lt;=&quot;)+(box:&quot;===XXXX===&quot;)[//那些日子已经过去
它们却不会
随着时间流逝
但我们依然可以奋起
重建我们的国家！//]
(align:&quot;==&gt;&quot;)+(box:&quot;=X&quot;)[&#39;&#39;——《苏格兰之花》&#39;&#39;]


哦，对了，在联合王国剩下来的那些部分，她又是什么个评价呢？



触发结局：
//&#39;&#39;(text-colour: yellow)[隐藏结局：“苏格兰之花”]
海伦·A·帕克（1952.7.20-？），苏格兰副首席部长（2007-2014），苏格兰民族党党魁兼首席部长（2014-2024），苏格兰总理（2024-？）。

对于苏格兰人，她是民族英雄；

(size: 1.1)[对于英格兰、威尔士和北爱尔兰联合王国的不少人而言，她比撒切尔夫人还可恨114514倍！]&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="48" name="9.3" tags="" position="1775,1575" size="100,100">在和阿德勒谈过话后，中情局和军情六处决定临时更改行动方案，帕克的安全屋地点被从卡尔霍斯特改到了特雷普托。9月4日，行动正式开展，帕克从腓特烈大街车站进入东柏林，并抵达安全屋，开始搜集信号情报。

幸运的是，这次行动最终没有出任何岔子。11月，她从东柏林回到西柏林，一切如常。但她听说，她原定的安全屋被史塔西和克格勃盯上了；同时，他们也查明里希特在被捕后叛变，供出了他所知道的一切。

[[好险……-&gt;10.9]]</tw-passagedata><tw-passagedata pid="49" name="9.4" tags="" position="2025,1575" size="100,100">1983年9月6日凌晨。

帕克安坐在安全屋中，凝视着父母和她在父亲退役仪式上拍下的照片。这时她听见门外有点动静，直觉告诉她有什么不对劲，但理性告诉她不要多疑。

一两分钟过去了，没有任何异常。又过去一两分钟，还是一切如常。但她知道，要是门背后是史塔西或克格勃，而自己逃不出去，就必须以死保守秘密——她的眼镜右腿中藏着氰化物胶囊，只要她咬下去，上帝都救不了她。

正当她想稍微放松一点时，门口突然传来一声巨响，足以让她也浑身一抖。

&#39;&#39;我暴露了！&#39;&#39;

她必须在千钧一发之际做出决定——自己是要牺牲，还是要活下去。

[[永别了……-&gt;10.3]]

[[不！再等等！-&gt;10.4]]</tw-passagedata><tw-passagedata pid="50" name="10.3" tags="end" position="1900,1700" size="100,100">“警察！举起手来！”

“国家安全部！不要动！”

两名东德第九连特警首先破门而入，看到那个模糊的人影手中似乎拿着什么细长的东西。随后，她猛地把那东西举到嘴边，似乎默念了些什么，随后咬了下去。

“该死！”

时间似乎停止了两秒钟，随后，一股浓烈的苦杏仁味在整个房间中散开。特警和两名史塔西干员马上后退，几秒钟后才上前拨动她的身躯。她倒在地上，深蓝的眼瞳逐渐散大，面色粉红。

“解毒药——”

“没救了。报告总部，任务失败，目标已死亡。叫人来收尸吧。”



触发结局：
//&#39;&#39;(text-colour: red)[坏结局：“冷寂”]
海伦·A·帕克（1952.7.20-1983.9.6），军情六处干员，官方档案显示她在1983年9月的任务中殉职。两德统一后，英国外交部和军情六处派人查找了原史塔西档案——但她的遗体从未被找到。

When you go home, tell them of us and say
For your tomorrow, we gave our today.

&#39;&#39;当你归去时，告诉同胞曾有我们，
为了你们的明天，我们献出了今天。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="51" name="10.4" tags="" position="2025,1700" size="100,100">“警察！举起手来！”

“国家安全部！不要动！”

两名东德第九连特警首先破门而入，她马上扣下麻醉枪的扳机，但没打穿防弹衣。几秒之后，她便被五花大绑，套上了头套。周围的世界化作一片黑暗。

她很清楚，自己某种意义上已经被抹去了；而且，从现在开始，唯一的盟友就是自己。

[[接下来会被送到哪里？史塔西总部还是卢比扬卡？-&gt;11.3]]</tw-passagedata><tw-passagedata pid="52" name="11.3" tags="" position="2025,1825" size="100,100">列福尔托沃监狱，莫斯科，1984年3月17日。

这已经是她被关押的第六个月了。这天早晨，一张不同的年轻面孔走进她的单人牢房，开始审讯她。这姑娘似乎比其他人更加文绉绉一些，虽然语气还是一样地毒辣。

审讯自然是无果而终，不过这位干员提到了美苏关系。虽然她口中里根还是那个战争狂人，但帕克知道转机实际上已经出现了——美苏关系如果改善，或许她哪一天能在囚犯交换中返回西方，重新开始生活。

自然地，那位克格勃女干员给她的印象比其他人深一些。

[[还能怎么办？等换囚吧……-&gt;12.3]]</tw-passagedata><tw-passagedata pid="53" name="12.3" tags="" position="2025,1950" size="100,100">格利尼克桥，波茨坦，1985年6月12日。

她从奔驰车上下车，望向几米外的另一个世界——西柏林。经过二十一个月的等待，二十一个月的顽强抵抗与不吐一言，她终于等到了这次换囚机会。原本她已经死了心，因为到这年3月，没有任何迹象显示她还有机会回家。

但出乎意料地是，第二个月克格勃官员就开始暗示她即将开展一次大规模换囚，而她在名单上。她不知道自由世界要用哪条大鱼来换自己，只要她能回家，一切就都好。

双方官员示意后，她向前走，跨过“间谍之桥”的中线，回到了自由世界。她自由了，即将回到自己的故乡。她渴望回到岗位上，和阿德勒他们重聚，再也不要和心爱的拉扎尔分离。

一切都会好起来的，她走上西柏林的土地时告诉自己。

[[是啊，一切都会好起来的！-&gt;13.1]]
</tw-passagedata><tw-passagedata pid="54" name="13.1" tags="" position="2025,2075" size="100,100">她打开那瓶琴酒，倒上满满一杯，随后点了一根烟。这是1987年3月18日，哈默史密斯一个平凡而压抑的下午。

她原以为过去一年半会充满生机，结果却令人窒息。1984年6月，中情局一处原属于“铃”计划的安全屋无意间被发现。当时就有军情六处和中情局的“天才”说一定是她泄了密。8月，中情局总部收到一封信件，称她落入克格勃手中后，“剑桥五杰”第三人金·菲尔比和叛逃到苏联的原军情六处成员乔治·布莱克都曾见过她。这当然是鬼扯，菲尔比和布莱克在她眼里是两个恶名昭彰的叛徒。

这还没完。1985年7月奥列格·戈尔季耶夫斯基因为身份暴露而被迫逃亡英国，他们说这是她泄了密。11月，“铃”计划在克格勃的内线别里科夫被捕，不到一年后被枪毙——他们说这是她干的。一言以蔽之，“铃”计划的参与机构中，许多人都觉得她当了叛徒，或者泄露了机密；为此，他们要惩罚她。

“铃”计划的干员当然都为她申冤，但没什么用。由于工资被停发且受到军情五处监视，她只能借酒浇愁，靠读书消磨时间。她已经预感到了自己的结局——被踢出军情六处，像不光彩退役的军人一样自生自灭。

门铃响了，打开门后，她收到了那封注定她命运的信——她被军情六处开除了。

[[不，不！-&gt;14.1]]</tw-passagedata><tw-passagedata pid="55" name="14.1" tags="" position="2025,2200" size="100,100">1988年11月9日。

帕克坐在厨房窗边，颤抖的手握着茶杯，里面的酒早已一饮而尽。她从没有这么靠近过死亡。对她而言，活下去就意味着煎熬，一了百了可能是一种更好的选择。

过去一年八个月中，她的生活全靠亲友和朋友接济，身体也一点一点垮了。怒火与绝望控制了她的意识，她渴求改变，渴求复仇，不仅要证明自己无罪，而且要让毁掉她人生的那些人付出代价。她不想继续像个重罪犯一样被监视，不想像这样毫无尊严地苟活。

但她无力改变这一切，而这种绝望摧垮了她的意志。

她站起身，在厨房里来回踱步，双手抱头，知道不远处军情五处把她的动向看得一清二楚。她已经无路可走。

她……

[[最终还是坐回桌边，打开《圣经》，寻求一点内心的平静。-&gt;15.1]]

[[打开厨房窗户，坐到窗框上，看向三层楼下的草坪。-&gt;15.2]]

[[换上衬衫，打理了一下容貌，随后走向天台。-&gt;15.3]]</tw-passagedata><tw-passagedata pid="56" name="15.1" tags="" position="1900,2325" size="100,100">她坐回桌边，翻开《圣经》，默念了一句“我们在天上的父”。不久后，她拿出酒杯，又倒上一杯琴酒。窗外的哈默史密斯一如既往。


幸运的是，这样的日子很快有了转变——1990年1月，军情六处最终决定恢复她的退休金，五处则取消了监视。2月，已经从中情局退休的阿德勒来拜访她，还带来了一封亲笔信。他将这段经历娓娓道来：

1989年11月，阿德勒实在走投无路，决定借助老朋友法兰德的人脉帮一把帕克。他找到法兰德在美国空军中的朋友理查德·克拉文上将，托他把一封信转交给他的兄长——电子数据系统公司首席执行官赫伯特·克拉文。在这封信中，阿德勒概述了她的情况，并请求了一笔无息贷款。

他知道赫伯特是个尊重军人、很有责任感的企业家——1979年，他和电子数据系统公司主席罗斯·佩罗（Ross Perot）组织人力进入正处在伊斯兰革命高潮的伊朗，将两名被伊朗政府逮捕的公司雇员救出伊朗，带回美国。赫伯特是他最后一个能找的人了——而他同意了，给了阿德勒一笔一万美元的两年期无息贷款，附上一封亲笔信，祝帕克一切都好。

在概述完这段经历后，阿德勒给了帕克两个建议：其一是回到她熟悉的研究领域，为智库供稿，恢复大脑运转；其二是为赫伯特干活，加入电子数据系统公司。不过，阿德勒也建议帕克先去治病。

[[世界上还是好人多啊……-&gt;16.1]]</tw-passagedata><tw-passagedata pid="57" name="15.2" tags="" position="2025,2325" size="100,100">当军情五处的人意识到帕克打开了厨房窗户，坐在窗框上时，已经太晚了。一声巨响惊动了领里，人们赶到公寓后的草坪上时，只听到撕心裂肺的惨叫。她被救护车送进了哈默史密斯医院，医生抢救了几个小时才保住她的双腿。如果她不是头朝上砸在地上，或者高度再高一点，那她肯定没命了。

但这次求死而不得，却没有让她就此打住。她本以为这会让军情六处好好想想要不要继续把她当重罪犯对待，结果，没有什么变化——她还是一样绝望，一样处于精神崩溃的边缘，一样只想快点解脱。1月6日，她用氧气软管缠住了自己的脖子，随后翻下了病床。但这次，门外的护士赶忙推门冲进来，再次救下了她的性命。

军情六处最终还是松动了——毕竟如果她真死了，对他们没有好处，而看来帕克是愿意一心求死的。这个月晚些时候，军情六处终于恢复了她的退休金，五处也取消了监视。2月，一位意料之外的朋友终于来见她了——罗素·阿德勒。

[[罗斯？竟然是你？-&gt;16.4]]
</tw-passagedata><tw-passagedata pid="58" name="15.3" tags="end" position="2150,2325" size="100,100">当军情五处的人意识到帕克不在公寓里时，已经太晚了。一声巨响惊动了邻里，人们赶到公寓后的草坪上时，必然的命运已经降临。

海伦·帕克死了。



她的死某种意义上深远地影响了每一个身边人，以及这个世界。在得知他深爱的帕克自寻短见后，拉扎尔·阿佐莱在悲痛中离开了中情局，回到以色列老家。在他的后半生中，他一直郁郁寡欢，每年都去哈默史密斯公墓为她献上一枝虞美人。最终，他还是勉强走出了痛苦——不过那已经是十多年后了。

但这不是她的死给世人带来的最大影响。早在她纵身一跃之前，军情六处便预感到如果帕克非正常死亡，整个“铃”计划都有可能暴露。结果，墨菲定律凑效了——1991年，在“珀修斯”随着苏联解体而崩溃的前夕，调查记者撰写了一篇关于帕克生平的文章。文章发布后引起轩然大波，迫使英国政府和议会介入调查，随后风波扩大到“铃”计划的所有成员国。1992年，在美国参议院情报委员会的调查下，与“铃”计划相关的不少美方档案被迫解密，并导致计划被迫提前一年结束。此后发生的是一场不亚于MKUltra的丑闻——但这已经和她没关系了。

直到2018年，她殒命30年之后，军情六处才恢复了她的名誉——而那时，她的战友多已不在人世。在军情六处作出这一决定的几天前，拉扎尔·阿佐莱也抵不过时间，在特拉维夫病逝。



触发结局：
//(text-colour: red)[&#39;&#39;坏结局：“诸神的黄昏”&#39;&#39;]
&#39;&#39;海伦·A·帕克（1952.7.20-1988.9.11），军情六处干员，1988年9月11日自杀身亡。她死后引起的波澜直接导致了“铃”计划的提前终结，而她迟到的正义也几乎无人见证。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1]</tw-passagedata><tw-passagedata pid="59" name=" 2.3A" tags="" position="2075,825" size="100,100">她看到同辈抗议美国在越南的狂轰滥炸，控诉美军犯下的战争罪行。她感同身受，并且也参与其中，为结束这场血腥战争而摇旗呐喊。毕竟，英国人受够了战争，她父亲也反复说海战是正人君子的战斗，但陆战则残酷得多。

但当她看到越来越多年轻人穿上嬉皮士装束、伴随着披头士起舞，或是听说不少美国大学生已经沉溺在大麻和LSD之中时，她有些迷茫。这些价值观难道要取代学校中教授的一切传统，成为这一代人的主旋律吗？她不知道。

遗憾的是，参与学生运动影响了她的学业。牛津是没希望了，哲学、政治学与经济学专业与她渐行渐远。不过，能收到爱丁堡大学社会与政治科学学院的录取信，仍然是好事一桩。如果一切顺遂，四年之后，她将带着国际关系硕士的文凭开启下一段人生。

[[这是家的呼唤。-&gt; 3.2]]</tw-passagedata><tw-passagedata pid="60" name="10.5" tags="end" position="3575,1700" size="100,100">2007年6月24日，工党选举戈登·布朗为新一任党魁，布莱尔随即辞去首相职务，由布朗接替。次日，海伦·帕克被任命为内政大臣，也是第一位女性内政大臣。两天后，她公开宣布不会参加下一届大选。

帕克的内政大臣任期中，恐怖主义是一个相当大的麻烦，同时打击犯罪也消耗了相当大的精力。总体而言，她的政策好评多于差评，但诸如允许警察不经起诉拘留“恐怖分子嫌疑人”、引入犯罪地图系统等措施招致了不少争议。民众对她的私德评价也较高，这使她在没有经历任何重大丑闻的情况下坚持到了2010年大选。

但工党就没这么幸运了——2008年经济衰退后，工党受欢迎度开始下滑，2009年在地方和欧洲议会选举中连续受挫。在2010年大选中，保守党和工党均未取得过半多数，导致两党都开始与自由民主党谈判组建联合政府。然而，5月11日，布朗承认与自由民主党的谈判失败，保守党和后者将组建联合政府。为此，他辞去首相一职。


不过对于海伦·帕克而言，这一切已经不重要了。她早早结束议员任期，回到家，过起了退休生活。爱丁堡的生活相当平静，唯一的波澜是2014年苏格兰独立公投前夕，她和布朗发生了分歧——布朗反对独立，而她相对支持。不过，她最终还是选择不表态，安心隐居。2024年，当斯塔默带领工党赢得议会选举的压倒性胜利时，她再次出面支持斯塔默。

然而，在苏格兰，帕克仍是一个极具争议性的人物。许多人称她在世纪之交做了“变色龙”，从苏格兰民族党叛逃到工党，放弃了坚持二十多年的苏格兰独立立场，唾弃她的人格。或许，这就是她选择隐居的原因吧。



触发结局：
//&#39;&#39;(text-colour: green)[普通结局：“树枝与变色龙”]
海伦·A·帕克（1952.7.20-），苏格兰事务大臣（2003-2006），内政大臣（2007-2010），在苏格兰之外的地区是位中规中矩的政客，在苏格兰则和撒切尔夫人一样毁誉参半。
“树枝不会在变色龙的手中折断”&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="61" name="10.6" tags="" position="3700,1700" size="100,100">2007年6月24日，工党选举戈登·布朗为新一任党魁，布莱尔随即辞去首相职务，由布朗接替。次日，海伦·帕克被任命为内政大臣，也是英国第一位女性内政大臣。几个月后，面对愈发汹涌的苏格兰民意，她公开宣布会参加下一届大选。

帕克的内政大臣任期中，恐怖主义是一个相当大的麻烦，同时打击犯罪也消耗了相当大的精力。总体而言，她的政策好评多于差评，但诸如允许警察不经起诉拘留“恐怖分子嫌疑人”、引入犯罪地图系统等措施招致了不少争议。民众对她的私德评价也较高，这使她在没有经历任何重大丑闻的情况下坚持到了2010年大选。大选前，她将自己的选区改到了大伦敦的工党稳得选区，并当选议员。

但工党就没这么幸运了——2008年经济衰退后，工党受欢迎度开始下滑，2009年在地方和欧洲议会选举中连续受挫。在2010年大选中，保守党和工党均未取得过半多数，导致两党都开始与自由民主党谈判组建联合政府。然而，5月11日，布朗承认与自由民主党的谈判失败，保守党和后者将组建联合政府。为此，他辞去首相一职。

(if: $university is &quot;edin&quot;)[几天后，布朗再次找上她，并直接向她提出了一个惊人的要求——他希望她竞选工党党魁，而她最大的对手将会是能源与气候变化大臣艾德·米利班德（Ed Miliband）。

[[看来必须拼一把了。-&gt;11.4]]

[[不，我不想总是亦步亦趋。-&gt;11.5]]]

(if: $university is not &quot;edin&quot;)[[下一步是什么？-&gt;11.5]]</tw-passagedata><tw-passagedata pid="62" name="11.4" tags="end" position="3575,1825" size="100,100">2010年9月的工党党魁选举开始前，帕克决定参选。然而，由于和布朗的联系太过紧密，并且她曾突然改换党籍，帕克在第一轮便被淘汰，艾德·米利班德当选党魁。虽然帕克留任影子内政大臣，但这个职务基本是安慰性的。

2015年，帕克决定再次出山，和更加偏左的杰里米·科尔宾竞争工党党魁一职。科尔宾作为一匹黑马，民调显示他的支持率一直高于50%。然而，出人意料的是，帕克宣布参选后获得了布朗、布莱尔、米利班德兄弟等工党元老的一致支持，他们担心“极左”的科尔宾会直接葬送工党赢得议会选举的机会。由于科尔宾和帕克声誉都不太高，并且都有各自的软肋，这次党魁选举被亲保守党的媒体讽刺为“一个左派和一条变色龙较劲”。

最终，经过两轮投票，帕克以极其微弱的优势当选工党党魁。事实证明，帕克仍然很有实力——在2017年大选中，保守党因脱欧谈判问题失去了不少选票，未能获得过半选票，不得不组建少数派政府；但在2019年大选中，工党失去了不少席位，保守党得以单独执政。

2019年大选最终还是压垮了帕克——她的年龄问题成为许多人怀疑的对象，她的政治蓝图也被许多人认为不过是布朗的翻版。2020年4月，她宣布因健康原因辞去工党党魁和议会议员职务，退出政坛。



许多人对帕克在权力的游戏中始终未能真正有所斩获感到遗憾，另一些人则幸灾乐祸。一些人认为这是因为她离开布朗的荫护后就难有建树，甚至干脆称她是“戈登·布朗异父异母的妹妹”。在苏格兰，帕克仍是一个极具争议性的人物。许多人称她在世纪之交做了“变色龙”，从苏格兰民族党叛逃到工党，放弃了坚持二十多年的苏格兰独立立场，唾弃她的人格。

但她知道，这就是权力的代价。



触发结局：
//&#39;&#39;(text-colour: green)[普通结局：“权力的游戏”]
非常尊敬的达尔基斯女男爵海伦·A·帕克（1952.7.20-），苏格兰事务大臣（2003-2007），内政大臣（2007-2010），工党党魁（2015-2020）。她为谋取政治权力而活动了近三十五年，最终却始终未能触及首相的门槛。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="63" name="11.5" tags="end" position="3700,1825" size="100,100">经过评估，帕克没有参与当年9月的工党党魁竞选，而是乖乖等待影子内阁任命。不出所料，她被任命为影子内政大臣。

然而，保守党的当选开启了一个由它主导的时代——而显然，她撑不到这个时代结束的一刻了。2015年，更加偏左的杰里米·科尔宾当选工党党魁后，工党的境遇毫无起色，而帕克的年龄也日趋增长，让她感到力不从心。因此，她放弃了影子内政大臣职务。2019年大选前，意识到工党毫无胜算，她艰难地做出了决定：结束政治生涯，回家。



时至今日，在苏格兰，帕克仍是一个极具争议性的人物。许多人称她在世纪之交做了“变色龙”，从苏格兰民族党叛逃到工党，放弃了坚持二十多年的苏格兰独立立场，唾弃她的人格。或许，这就是她选择隐居的原因吧。



触发结局：
//&#39;&#39;(text-colour: green)[普通结局：“树枝与变色龙”（变体）]
海伦·A·帕克（1952.7.20-），苏格兰事务大臣（2003-2006），内政大臣（2007-2010），影子内政大臣（2010-2015）。在苏格兰之外的地区是位中规中矩的政客，在苏格兰则和撒切尔夫人一样毁誉参半。
“树枝不会在变色龙的手中折断”&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="64" name=" 7.1A" tags="" position="2250,1325" size="100,100">1977年，帕克加入政策研究中心（Centre for Policy Studies）。并在那里逐渐意识到，自由党的政见已经过时，它自身也毫无竞争力可言。因此，她决定改换门庭，加入保守党。
(set: $party to &quot;con&quot;)(set: $entrancetopolitics to &quot;thinktank&quot;)(set: $vocation to &quot;poli&quot;)
到1982年，帕克已经迅速升至政策研究中心研究总监，并开始接触保守党的核心圈。由于她的主要研究领域之一是教育，加之政策研究中心对保守党影响力强大，因此她逐渐开始考虑竞选议员，随后进入内阁。这时，撒切尔夫人向她伸来了橄榄枝，邀请她参加次年大选。

1983年大选中，帕克凭着充裕的资金和广泛人脉当选议员，并在两年后被任命为教育部政务次官。尽管如此，但帕克也逐渐发现她和撒切尔夫人并不是完全的同路人——尤其当撒切尔夫人愈发刚愎自用时，更是如此。

到1987年，尽管她和撒切尔夫人已经产生了一点矛盾，但她仍被任命为外交和联邦事务部政务次官，虽然积极推行对苏联的遏制政策，但在欧共体问题上和撒切尔夫人的分歧却愈发严重。帕克暗中开始与反对撒切尔夫人的其他保守党大佬联系，希望设法把这个“杂货店主的女儿”搞下去。

1990年，撒切尔夫人强推人头税的举动导致她的政府陷入分裂。虽然她自己出身富家，不太在乎人头税本身，但她实在无法忍受撒切尔夫人的刚愎自用了。11月1日，外交大臣杰弗里·豪因与撒切尔夫人无法弥合的矛盾而请辞。他责难撒切尔夫人对欧洲共同体的政策严重损害英国利益，并公开鼓励“其他保守党党员对首相的支持作重新考虑”。结果，前国防大臣赫塞尔廷（Michael Heseltine）宣布挑战撒切尔夫人的党魁和首相地位。

在党魁选举前夕，撒切尔夫人选择财政大臣约翰·梅杰为接班人，而赫塞尔廷拉拢帕克，并开出了难以想象的价码——在他的内阁中让只有38岁的她担任外交和联邦事务部国务大臣（副大臣）。

要怎么做？

[[支持赫塞尔廷-&gt;8.6]]

(if: $aristocratic is 0)[[静观其变-&gt;8.7]](if: $aristocratic is 1)[[[静观其变-&gt;8.7A]]]


</tw-passagedata><tw-passagedata pid="65" name="8.6" tags="" position="2125,1450" size="100,100">事实证明，支持赫塞尔廷使这颗冉冉升起的政治新星蒙受了一次挫败。尽管她倒向赫塞尔廷一方并公开站出来摇旗呐喊，但在11月的党魁选举上，笑到最后的却是约翰·梅杰。梅杰并不喜欢在撒切尔夫人内阁中“暗中作乱”的帕克，把她调到财政部担任政务副官。1992年大选后，她被调任商务与贸易部国务大臣。

1995年，梅杰因自己在党内的地位不断受挑战和威胁，决定辞去党魁一职，并宣布重新参选党魁。结果在迈克尔·赫塞尔廷的支持下，约翰·梅杰以微弱优势当选。其后，梅杰为报答赫塞尔廷，委任他为英国副首相，而帕克则终于得到了外交和联邦事务部国务大臣的职位。

不幸的是，到1997年大选前夕，保守党对选民已经毫无吸引力可言。在这年的大选中，托尼·布莱尔打出“新工党，英国新生”的口号以压倒性优势赢得选举，入主唐宁街。保守党在经历此次挫败后，在野长达13年。

对于帕克而言，这段在野经历并不好受。虽然她在2001年成为影子外交和联邦事务大臣，并且参加了2005年保守党党魁选举，但戴维·卡梅伦最终击败了她——而这也是她政治生涯的转折点。尽管她被任命为影子内政大臣，但在此之后，她(if: $entrancetopolitics is &quot;thinktank&quot;)[逐渐怀念起智库的时光，]渐渐厌倦了在政治的纸牌屋中和党内外的敌人斗争。2010年，她出乎意料地选择不参选，在保守党大获全胜的同时离开了政坛(if: $entrancetopolitics is &quot;thinktank&quot;)[，回到了智库]。
(set: $ending to &quot;8.6&quot;)
(if: $entrancetopolitics is &quot;thinktank&quot;)[[然后呢？-&gt;9.5]]

(if: $entrancetopolitics is not &quot;thinktank&quot;)[[然后呢？-&gt;9.5B]]</tw-passagedata><tw-passagedata pid="66" name="8.7" tags="" position="2250,1450" size="100,100">事实证明，没有把自己的立场展现出来是个好主意。在11月的党魁选举上，约翰·梅杰笑到了最后，他决定把这位前途不可限量的年轻女士调到外交和联邦事务部，继续担任政务副官。1992年大选后，帕克升任该部国务大臣。

1995年，梅杰因自己在党内的地位不断受挑战和威胁，决定辞去党魁一职，并宣布重新参选党魁。结果在迈克尔·赫塞尔廷的支持下，约翰·梅杰以微弱优势当选。其后，梅杰为报答赫塞尔廷，委任他为英国副首相，而帕克则升任商务与贸易大臣。

不幸的是，到1997年大选前夕，保守党对选民已经毫无吸引力可言。在这年的大选中，托尼·布莱尔打出“新工党，英国新生”的口号以压倒性优势赢得选举，入主唐宁街。保守党在经历此次挫败后，在野长达13年。

对于帕克而言，这段在野经历并不好受。虽然她在2001年成为影子外交和联邦事务大臣，并且参加了2005年保守党党魁选举，但戴维·卡梅伦最终击败了她——而这也是她政治生涯的转折点。尽管她被任命为影子内政大臣，但在此之后，她逐渐怀念起智库的时光，厌倦了在政治的纸牌屋中和党内外的敌人斗争。2010年，她出乎意料地选择不参加议会大选，在保守党大获全胜的同时离开了政坛，回到了智库。
(set: $ending to &quot;8.7&quot;)
[[然后呢？-&gt;9.5]]</tw-passagedata><tw-passagedata pid="67" name="9.5" tags="end" position="2175,1575" size="100,100">2017年，帕克成为政策研究中心主席，跻身全球智库领域最有影响力的人之一，经常就国际贸易、地缘政治、国际秩序等各方面的议题发表文章，并仍然能对保守党产生深远影响。她仍然拥护小政府、自由市场和减税这些自由主义的政策，也仍然没有失去父母带给他的上流气息。与此同时，她和卡梅伦的关系也改善了不少——2005年卡梅伦在党魁选举中击败她后，她和他的关系就很紧绷，而卡梅伦当上首相后她就没怎么跟他说过话。

与此同时，一个人生经历和她略有点相似的女子，出现在了英国政治的舞台上。

2022年10月，英国政府爆发危机，刚刚上任首相没多久且经历了伊丽莎白二世驾崩的利兹·特拉斯因草率地提出减税和大规模借款方案，导致保守党内陷入混乱。10月24日，特拉斯宣布辞职，结束了仅仅50天的首相任期。

帕克作为一个旁观者，想起了二十多年前的自己——当时她也像特拉斯一样年轻，一样渴望权力，但或许也一样缺乏经验。当然，她那时肯定不敢奢求成为首相。再说了，在智库领域工作这么多年，她觉得这个归宿也不错，至少她从未丧失对这个国家和世界的影响力。


&#39;&#39;//但如果她真的走到台前了呢？//&#39;&#39;



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“旋转门”]
海伦·A·帕克（1952.7.20-），(if:$ending is &quot;8.7&quot;)[商务与贸易大臣（1995-1997），]影子外交和联邦事务大臣（2001-2005），影子内政大臣（2005-2010），政策研究中心主席（2017-）。她曾进入英国内阁，如今则借着“旋转门”制度继续用知识影响着这个世界。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="68" name="8.7A" tags="" position="2375,1450" size="100,100">事实证明，没有把自己的立场展现出来是个好主意。在11月的党魁选举上，约翰·梅杰笑到了最后，他决定把这位前途不可限量的年轻女士调到外交和联邦事务部，继续担任政务次官。1992年大选后，帕克升任该部国务大臣；1994年，她又升任外交和联邦事务大臣——此时，她仅有42岁。这位年轻的外交大臣上任后开始积极推动英国与欧盟的合作，在其他领域也有建树，逐渐积累了作为大臣的政治资本。

到了1996年，梅杰因自己在党内的地位不断受挑战和威胁，加之内政外交方面始终毫无起色，决定辞去党魁一职。他原本打算重新竞选党魁，但出人意料的是，赫塞尔廷居然不支持他。此时，未曾设想的事情发生了——赫塞尔廷找到帕克，开口第一句话便是：

&#39;&#39;//“我可以让你成为首相，海伦。”//&#39;&#39;

她惊到了，但以她的权力欲望、教育背景、履职经验和家庭出身，这似乎不是一个不可能的选择。赫塞尔廷告诉她，她可能是保守党内部最容易被人接受的人选——众人也把她的经历看在眼里，只要没有其他候选人，所有不愿意接受梅杰的人都会选她。

三思之后，她接受了。

[[豁出去了！-&gt;9.6]]</tw-passagedata><tw-passagedata pid="69" name="9.6" tags="" position="2300,1575" size="100,100">1996年3月15日，经过三轮投票，海伦·帕克以微弱优势击败约翰·梅杰，成为新一任保守党党魁和英国历史上第三年轻的首相（43岁）。在上任前，她提出一套减税方案，承诺英国不使用欧洲货币，并表示将加快经济复苏。

然而，帕克上任时面临的是一个极其混乱的保守党。帕克上任不到一周，由于对让这样一个“年轻女子”担任首相极其不满，十多名保守党议员愤而退党，导致保守党在议会不再拥有过半多数。同时，匆忙推行的给富人大幅度降低税率的减税方案也重挫了市场信心，并直接导致英镑兑美元汇率大跌。许多人称帕克根本不知道民间疾苦，甚至说她是一个出生在切尔西、在牛津上大学，脱离社会几十年的千金大小姐。

无论如何，到了5月上旬，帕克的地位已经岌岌可危，保守党甚至开始有后座议员要求帕克下台。5月1日，帕克在首相答问时间面对工党党魁布莱尔表示“我是斗士，不会放弃”。结果，《卫报》在第二天的头版展示了一颗披着黑色假发、贴了一双蓝眼睛贴纸的球生菜，并以“生菜先腐烂还是帕克先滚蛋”为标题。

到5月6日晚，帕克已经山穷水尽了。由于已经有3名保守党党员呼吁她下台，加之党内正考虑宣布议会提前选举（在当时的情况下等于向工党投降），当天晚上，她联系了父母，得到的回答是让她做“她认为正确的一切”。

[[好吧，没有选择了。辞职。-&gt;9.6.1]]</tw-passagedata><tw-passagedata pid="70" name="9.6续" tags="end" position="2300,1825" size="100,100">在担任了满打满算一共78天（其中25天是看守政府！）的首相后，海伦·帕克不出所料地失去了下议院议席，选区得票数甚至差一点低于自由民主党候选人。她创下了一个不光彩的纪录——英国历史上任期最短的首相。她在英国和全世界一度成为家喻户晓的笑话，以至于被嘲讽为“全国的代课老师”。至于那颗生菜，日后被冠名“帕克生菜”，每当公众人物把自己变成一个大笑话时，就有人把这个梗拿来说事。

她很少为自己辩解，即使开口反驳那些冲着她来的言论，也会说这是她和保守党的错。的确，执政已17年的保守党自撒切尔夫人后期就开始陷入内斗，把帕克推出来某种意义上也是因为没有更好的人选。但是，如果有人提“帕克生菜”，她就会马上抨击这是“幼稚的小把戏”——迄今为止都是如此。不过，她一直没有原谅一个人——迈克尔·赫塞尔廷。因为她认为，赫塞尔廷纯粹是不想扛下保守党的烂摊子，才把首相职务给了她。



等等，这个帕克不就是现实位面的莉兹·特拉斯吗？

帕克读的牛津大学默顿学院哲学、政治学与经济学，特拉斯也是；

帕克先加入自由党后加入保守党，特拉斯也是（当时已经是自由民主党了）；

帕克在智库工作过，特拉斯也是；

帕克当过外交和联邦事务大臣，特拉斯也是；

帕克当上了首相，特拉斯也是；

帕克在78天后下台了，而特拉斯甚至都没撑到这个数字！



触发结局：
//&#39;&#39;(text-colour: yellow)[隐藏结局：“一颗生菜”]
海伦·A·帕克（1952.7.20-），外交和联邦事务大臣（1994-1996），英国首相（1996）。担任首相仅78天就在一片混乱中下台。如果本故事线位面没有特拉斯，那她就是英国历史上最短命的首相了！&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="71" name="7.7" tags="" position="1625,1325" size="100,100">在提交给上级的报告中，帕克建议维持不经陪审团审判被俘的爱尔兰共和军人员，并按照一般囚犯而非政治犯的待遇对待他们，同时调派对反叛乱作战更有经验的特种部队，也就是特种空勤团（SAS），进入北爱尔兰以开展高难度的破坏、侦查、暗杀任务。
(set: $hardline to $hardline +1)
报告获得了她上级的好评，但也使她进入了爱尔兰共和军的视线。当然，此时她只是个少尉，似乎还不至于被爱尔兰共和军定点清除掉。

是吗？

[[任务继续……-&gt;8.8]]</tw-passagedata><tw-passagedata pid="72" name="7.8" tags="" position="1750,1325" size="100,100">在提交给上级的报告中，帕克建议改变审判爱尔兰共和军人员的方式，允许陪审团审判，并按照政治犯的待遇对待他们——允许不穿囚服、提高写信限额等等。当然，她也没有忘记同时调派对反叛乱作战更有经验的特种部队，也就是特种空勤团（SAS），进入北爱尔兰以开展高难度的破坏、侦查、暗杀任务。

报告并没有获得她上级的一致好评，有些人认为她太过激进，甚至违抗命令。但无论如何，她的一些建议还是获得了有限的采纳。

[[任务继续……-&gt;8.8]]
</tw-passagedata><tw-passagedata pid="73" name="8.8" tags="" position="1625,1450" size="100,100">1981年，帕克晋升中尉，并很快遇上了当年的爱尔兰共和军第二次绝食抗议。23人开始绝食，要求英国政府满足五项要求：有权不穿囚服；有权不做监狱安排的工作；有权和其他囚犯自由结交，并组织教育和娱乐活动；有权每周接受一次来访，收一封信和一件包裹；重新获得因示威活动而丧失的提前释放权。其中，囚犯博比·桑兹（Bobby Sands）在绝食运动期间当选为下院议员，这激起了全世界媒体的兴趣。

然而，撒切尔夫人拒绝接受任何一项要求，哪怕桑兹在5月5号因饥饿而死，也拒绝改变立场。此时，帕克收到命令，要求她协助评估如何应对此次绝食抗议，阻止爱尔兰共和军和新芬党进一步发展势力，使北爱尔兰“无从管制”。她注意到新芬党似乎支持一手议会斗争，一手武装斗争——这或许是个突破口。

(if: $hardline is 0)[[[能用选票解决，就不要用子弹解决。-&gt;9.7]]](if: $hardline is 1)[[[我改主意了。能用选票解决，就不要用子弹解决。-&gt;9.7]]]

[[新芬党一样是恐怖分子，怎么可能议和？-&gt;9.8]]

</tw-passagedata><tw-passagedata pid="74" name="9.7" tags="" position="1500,1575" size="100,100">在提交给上级的报告中，帕克建议对新芬党予以一定程度的“宽限”，包括但不限于减少对其进入北爱尔兰各地方议会和英国下议院的限制，以将北爱尔兰问题朝着和平的议会斗争方向引导。她同时还建议事实上解除所有对爱尔兰共和军囚犯的人身限制。

这份报告褒贬不一，据称在传到撒切尔夫人那里后，她并不买账，但其他内阁成员大多认为，英国难以再承受一次绝食导致的公关灾难了，必须展现出一点缓解局势的诚意。

1983年，新芬党时隔二十多年再次参加英国议会选举，并出乎意料地获得一个席位（虽然议员拒绝宣誓就职）。同年，第一名新芬党议员加入贝尔法斯特市议会。进入1984年，随着英国政府展现出了诚意，新芬党开始考虑放弃在爱尔兰议会中的弃权政策。然而，爱尔兰共和军没有放弃炸弹袭击——1983年12月17日，他们对伦敦哈罗德百货发动炸弹袭击，造成6人死亡。越来越多的情报显示，他们正准备策划更大规模的袭击，将矛头直指英国政府高官。

[[接下来又会发生什么？-&gt;10.7]]

</tw-passagedata><tw-passagedata pid="75" name="9.8" tags="" position="1625,1575" size="100,100">在提交给上级的报告中，帕克建议对新芬党继续强力打压，阻止其进入北爱尔兰的各级地方议会，并且反对解除最后一条对爱尔兰共和军囚犯的人身限制——有权不参与监狱劳动。
(set: $hardline to $hardline +1)
这份报告据称在传到撒切尔夫人那里后，获得了她的好评，但其他内阁成员大多认为，英国难以再承受一次绝食导致的公关灾难了，必须展现出一点缓解局势的诚意——而这份报告只起到了火上浇油的作用。

1983年，新芬党时隔二十多年再次参加英国议会选举，并出乎意料地获得一个席位（虽然议员拒绝宣誓就职）。同年，第一名新芬党议员加入贝尔法斯特市议会。然而，爱尔兰共和军没有放弃炸弹袭击——1983年12月17日，他们对伦敦哈罗德百货发动炸弹袭击，造成6人死亡。越来越多的情报显示，他们正准备策划更大规模的袭击，将矛头直指英国政府高官。

1984年10月初，已经晋升上尉的帕克收到上级口述的绝密情报：撒切尔夫人将在10月12日，在英格兰南部的布莱顿召开保守党年会；会议结束后，她希望邀请包括帕克在内的英军参谋和情报人员召开关于北爱尔兰问题的密会。

(if: $hardline is not 2)[[[还能怎样？去布莱顿酒店吧。-&gt;10.8A]]](if: $hardline is 2)[[[还能怎样？去布莱顿酒店吧。-&gt;10.8B]]]

</tw-passagedata><tw-passagedata pid="76" name="10.7" tags="" position="1375,1700" size="100,100">1984年的绝大部分时间波澜不惊。6月，帕克晋升上尉，但在10月12日早晨，当她听到布莱顿酒店发生爆炸案、撒切尔夫人幸免于难时，她马上便知道这是爱尔兰共和军干的好事——看来，和平是短暂的，并且已经破灭。此后，各类爆炸案层出不穷，更加严重的暴力袭击也让皇家阿尔斯特警察自顾不暇。1985年2月28日，9名皇家阿尔斯特警察遭迫击炮弹袭击身亡。

对此，英国政府增派更多特种空勤团人员，通过特种作战定点清除爱尔兰共和军人员。1987年5月8日，8名爱尔兰共和军人员尝试袭击一处警察局，结果被特种空勤团全数击毙。这样的武装冲突每年都会发生好几次，并且似乎永无止境。

然而，爱尔兰共和军虽然并未放弃武装斗争，但新芬党却似乎开始松动了。1986年11月，新芬党党代会通过决议，放弃一贯以来的弃权政策（即议员被选入爱尔兰议会众议院后，拒绝宣誓就职）。同年，北爱尔兰社会主义民主工党开始与新芬党谈判。

1989年，帕克晋升少校。她已经在北爱尔兰服役12年，渴求的和平却一直没有到来。她仍然希望为哥哥复仇，只不过如今她并不想把爱尔兰共和军斩草除根，只是希望这片土地能尽早恢复和平与安全。新芬党出现的变化似乎还是不足以带去和平，这让她相当遗憾，甚至感到悲哀。

但她也别无选择。只有……

[[保持冷静，继续前进。-&gt;12.15]]</tw-passagedata><tw-passagedata pid="77" name="10.8A" tags="" position="1500,1700" size="100,100">1984年10月12日凌晨，帕克和战友回到布莱顿酒店的房间，准备明天与撒切尔夫人和保守党高官的密会。出乎意料的是，安排此次保守党年会的人直接把从北爱尔兰来的英军小组安排在这里住宿，而非别处。她有种隐隐的预感，爱尔兰共和军可能要对这里下手。

她没躺下多久，便听到不远处传来一身巨大的爆炸声，整座楼都在剧烈震动。

“有炸弹！撤离！”

她跳下床，迅速穿上制服，和战友一起冲出房间，沿途敲响所有房门，按照预先通知的撤离路线冲下楼。当他们完成撤离、长官开始清点人数时，帕克看到的全都是熟悉面孔——没有落下一个人。

第二天早上，全世界都知道了布莱顿酒店爆炸案。袭击造成5人死亡、12人受伤，撒切尔夫人的房间也部分损毁，但她幸免于难。爱尔兰共和军认领了此次袭击，并表示称：“今天我们不走运，但记住我们只需要走一次运，而你们需要一直走运。”

帕克和她的战友可能差点就没命了——爱尔兰共和军安放的炸弹炸毁了一座烟囱的底座，导致烟囱掉下来砸穿了它下方所有的房间，而撒切尔夫人的套房就在最底层，他们军人的房间距离也不远。

[[见鬼……-&gt;11.6]]</tw-passagedata><tw-passagedata pid="78" name="10.8B" tags="end" position="1625,1700" size="100,100">1984年10月12日凌晨，帕克和战友回到布莱顿酒店的房间，准备明天与撒切尔夫人和保守党高官的密会。出乎意料的是，安排此次保守党年会的人直接把从北爱尔兰来的英军小组安排在这里住宿，而非别处。她有种隐隐的预感，爱尔兰共和军可能要对这里下手。

她听到的最后一个声响，似乎是一声模糊的爆炸声。



第二天早上，全世界都知道了布莱顿酒店爆炸案。袭击造成9人死亡、24人受伤，撒切尔夫人原定的套房完全损毁，但她在警方建议下从套房临时更换到了普通房间，并幸免于难。爱尔兰共和军认领了此次袭击，并表示称：“我们此次袭击是为了消灭英国内阁、保守党战争贩子和英国占领军的智囊……今天我们不走运，但记住我们只需要走一次运，而你们需要一直走运。”

但帕克和她的战友耗光了所有运气——当救援人员找到她被压在炸毁的烟囱下、身首异处的遗体时，一切都结束了。事后证明，爱尔兰共和军使用了更大当量的炸弹，并且掌握了英军小组住在哪些房间——他们有备而来。



触发结局：
//(text-colour: red)[&#39;&#39;坏结局：“黑棕部队滚出来！”&#39;&#39;]
////&#39;&#39;海伦·A·帕克（1952.7.20-1984.10.12），英国陆军上尉（追授少校），北爱尔兰问题专家，1984年10月12日在布莱顿酒店爆炸案中死亡。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="79" name="11.6" tags="" position="1500,1825" size="100,100">看来，北爱尔兰是不会有和平了。布莱顿酒店爆炸案后，各类暴力袭击层出不穷，让皇家阿尔斯特警察自顾不暇。1985年2月28日，9名皇家阿尔斯特警察遭迫击炮弹袭击身亡。

对此，英国政府增派更多特种空勤团人员，通过特种作战定点清除爱尔兰共和军人员。1987年5月8日，8名爱尔兰共和军人员尝试袭击一处警察局，结果被特种空勤团全数击毙。这样的武装冲突每年都会发生好几次，并且似乎永无止境。

然而，爱尔兰共和军虽然并未放弃武装斗争，但新芬党却似乎开始松动了。1986年11月，新芬党党代会通过决议，放弃一贯以来的弃权政策（即议员被选入爱尔兰议会众议院后，拒绝宣誓就职）。同年，北爱尔兰社会主义民主工党开始与新芬党谈判。

1989年，帕克晋升少校。她已经在北爱尔兰服役12年，渴求的和平却一直没有到来。她仍然希望为哥哥复仇，仍然希望把爱尔兰共和军斩草除根——可能只有这样，这片土地才能尽早恢复和平与安全。至于和平解决？她已经不敢想了。

对于她，只有……

[[保持冷静，继续前进。-&gt;12.15]]</tw-passagedata><tw-passagedata pid="80" name=" 7.1B" tags="" position="2900,1325" size="100,100">1977年，帕克加入费边社，主要研究领域是英国与欧共体和东欧集团的关系。虽然她相当喜欢运用自己的聪明才智协助制定政策并开展前瞻性研究，但她并不想做纯学术，仍然想参与到政治之中。1981年，她结了婚，并在伦敦定居下来。
(set: $vocation to &quot;poli&quot;)(set: $entrancetopolitics to &quot;thinktank&quot;)
与此同时，她意识到工党内部存在以党魁迈克尔·富特（Michael Foot）为代表的老左派（主张英国退出北约、单方面核裁军、废除上议院、维持工党党章第四条关于公有制的条文等）和相对温和的“软左派”。由于在智库工作的经验告诉她，老左派的立场过于陈旧，已经不能适应英国和欧洲的现状，因此她很快加入了“软左派”，不过在公开场合仍然与工党主流保持意见一致。

1983年大选前，她在智库工作的工党同仁纷纷支持她竞选议员。于是，她横下心参加大选，并顺利当选议员，进入下议院。然而，当年的大选中，工党蒙受惨败，富特引咎辞职，尼尔·基诺克（Neil Kinnock）接替了党魁一职。

而在同一次大选中，两位和她年龄相仿的工党政客也进入了议会——托尼·布莱尔和戈登·布朗。

[[至少基诺克没那么左了。-&gt;8.9]]</tw-passagedata><tw-passagedata pid="81" name="16.1" tags="" position="1900,2450" size="100,100">1991年初，帕克被确诊肝硬化，经过一年治疗才有所好转。这一年中，她为智库写了一些文章，虽然收入不多但基本够用。1992年初，阿德勒再次拜访她，带来了一些有趣的新消息：

1991年5月，退役南非国防军中校伊本·巴洛（Eeben Barlow）在伦敦组建了一家名为索尔兹伯里安保集团（Sailsbury Security Corporation, SSC）的私人军事服务公司（PMC），主要业务是军事训练、军事行动、设施保卫、信息安全、情报工作、后勤保障、人身保镖等。这家公司的一个特点是，前南非国防军和罗得西亚安全部队的退役军人占比很高——他们自称是“受害者”，通过共同的对军事职业和技能的骄傲，联系在一起，并吸纳了冷战结束后不少北约和华约成员国的退役军人。

索尔兹伯里与阿德勒产生联系的途径比较复杂——索尔兹伯里的成立，背后是一个以理查德·克拉文上将为领袖的秘密集团——“战隼帮”（the Fighting Falcon Gang）在主导。“战隼帮”源自20世纪60年代约翰·博伊德（John Boyd）创立的“战斗机黑手党”，后来由克拉文接班，并发展成美军和北约国家军队内部一个强大的改革派系。冷战结束后，“战隼帮”意识到私人军事服务领域的蓝海，决定施加影响。而阿德勒是从“战隼帮”成员法兰德少将那里得知这一切的。

阿德勒的意思相当明确：他建议帕克加入仍处于初创期的索尔兹伯里，因为他有种预感，以帕克的健康状况，她可能坚持不了多久了——至少，坚持不到她在电子数据系统公司出人头地的那一天。

[[看来也没得选……-&gt;17.1]]</tw-passagedata><tw-passagedata pid="82" name="17.1" tags="" position="1900,2575" size="100,100">1992年下半年，帕克作为索尔兹伯里的第一位女性成员（也是很长时间里唯一一位）加入公司。伊本·巴洛作为南非英裔白人相当老派，原本不希望让帕克这样一个女子加入，但当他和她见了面后，他马上就改主意了。


时间来到1996年，帕克已经做到了索尔兹伯里安保集团情报处副处长，而美英政府因为索尔兹伯里在非洲多次开展雇佣兵性质的业务（包括但不限于参与安哥拉内战、在卢旺达种族灭绝中作为安保力量保卫比利时航空的千丘酒店等等）而开始对其打压。更关键的是，军情五处也加强了对索尔兹伯里和帕克本人的监视。

此时，“战隼帮”在法国和德国的势力开始联系帕克和三年前退役、回到以色列的阿佐莱，希望将他和她撮合起来组建一家欧洲国家的私人军事服务公司，作为欧洲国家日后发展对外影响力和干涉能力的重要力量。在他们的计划中，索尔兹伯里和这家新公司将会划分势力范围，彼此互不干涉——毕竟，英美的“战隼帮”和欧洲大陆的“战隼帮”是从1980年开始，在一根藤上结出的两个果。

然而，不幸的是，1996年下半年，帕克确诊了肝癌。医生表示由于病情严峻，她可能只有不超过五年的时间了。11月，她和阿佐莱重聚，两人除了谈感情，还谈到了私人军事服务公司的事情。阿佐莱的意思很明确：她可以尽自己的力量开创她热爱的事业，并像她曾经愿为女王、联合王国和自由世界而死一样，为之而死；当然，她也可以忘掉这一切，回家安心休养，战胜病魔。

[[我可不想不到五十岁就告别这个世界……-&gt;18.1]]

[[我为我的事业而活，为我的事业而死。-&gt;18.2]]</tw-passagedata><tw-passagedata pid="83" name="18.1" tags="" position="1900,2700" size="100,100">在医生的强烈建议下，帕克最终婉拒了这个机会，选择安心治病，而组建欧洲大陆的私人军事服务公司的事宜也就没了下文。经过三年痛苦的治疗，到1999年末，她奇迹般地基本战胜了病魔，身体也基本恢复了。此后，她的生活重新回到正轨——2001年，她终于实现了夙愿，嫁给了拉扎尔·阿佐莱。她也成为了虔诚的(if:$birth is 1)[苏格兰长老会](if:$birth is 2)[圣公会]教友，相信自己是凭着上帝的恩典才走出一段又一段的黑暗岁月。

与此同时，她将眼光重新投向电子数据系统公司。遗憾的是，赫伯特虽然很想为她找一份合适的工作，但最终未能如愿——一定程度上是因为她仍然相当“有名”，赫伯特知道这会引来太多不必要的关注。

2003年9月6日，在帕克被俘二十周年的纪念日，她联合许多战友再次向军情六处请愿，要求彻底为她平反。经过两年调查，2005年下旬，军情六处最终承认1985-1987年强加在她身上的所有罪名均为冤假错案，决定为她平反，恢复荣誉退役身份和待遇，并发放赔偿金。

在得到这笔巨额赔偿后，她没了后顾之忧，开始和老友一道游历世界。从柏林到莫斯科，从开普敦到哈拉雷（也就是索尔兹伯里），从福克兰群岛到香港……她去遍了所有能去的地方，将四十多年前游历全球冷战中边缘地带的愿望完全实现。她也非常喜欢克拉文兄弟的家乡纽波特纽斯和法兰德的家乡波士顿，经常去那里做客。



遗憾的是，她最终还是没能逃过病魔。2018年，她被查出因长期吸烟而导致的肺癌；尽管许多朋友担心她可能撑不了多久，但她却在得过一次新冠肺炎的情况下顽强地坚持了近五年。

2023年7月，她在病床上提出了一个出人意料，但细细想来又相当合理的要求——她希望见一见珀修斯曾经的成员，如果他们还活着的话。他们经过中间人联系了尚在世的珀修斯成员，后者欣然同意。

[[相逢一笑泯恩仇，不是吗？-&gt;19.1]]</tw-passagedata><tw-passagedata pid="84" name="18.2" tags="end" position="2025,2700" size="100,100">尽管医生强烈反对，阿佐莱也有不小顾虑，但帕克还是毅然决定在癌症治疗期间参与到这家新私人军事服务公司的组建之中。1997年初，帕克因健康原因辞去了索尔兹伯里安保集团的大部分职务，又在同年8月正式辞职，带着一个十多人的小团队离开了集团。
(set: $vocation2 to &quot;PMC&quot;)
很快，团队转移到直布罗陀，阿佐莱也前往那里，开始筹备新私人军事服务公司的成立。1998年3月1日，帕克和阿佐莱防务公司（Park &amp; Azoulay Defense Company, PADEC）正式成立。到次年，借着南斯拉夫内战导致的巴尔干地区的安全真空，公司已经开始在克罗地亚、塞尔维亚展开业务，雇员数量超过了2,000人。

然而，帕克也燃尽了她生命的最后一点火焰。1999年初，她的肝癌病情已经严重恶化，体重下降到了40千克。原本她住在直布罗陀，以协调公司的各种业务，但在医生的强烈建议下，她先是前往伦敦治疗，随后回到了(if: $birth is 1)[爱丁堡](if: $birth is 2)[切尔西]的家中休养。此时，已经没有什么可以挽救她了。

1999年8月5日凌晨，在阿德勒、阿佐莱、法兰德、赫伯特等人的陪伴下，海伦·帕克告别了人世，年仅47岁。



在她逝世后，帕克和阿佐莱防务公司逐渐发展为欧洲最大的私人军事服务公司之一，深度参与欧盟各国的国防建设，甚至还能在以色列和索尔兹伯里安保集团争夺业务。公司的雇员数量先是达到五位数，随后甚至突破了六位数。时至今日，帕克和阿佐莱防务公司已经成为欧洲安全秩序中一股重要的潜在力量。

但海伦·帕克已经看不到这一切了。



触发结局：
//&#39;&#39;(text-colour: green)[普通结局：“最后遗憾”]
海伦·A·帕克（1952.7.20-1999.8.5），军情六处干员，帕克和阿佐莱防务公司联合创始人，被一些人称作私人军事服务公司领域的“教母”。她的最后遗憾又是什么呢？未能看到她的心血发展壮大的一天？没来得及和她心爱的拉扎尔喜结连理？或许都有吧。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="85" name="10.9" tags="" position="1775,1700" size="100,100">此后的时光对于帕克而言波澜不惊。她先后前往华沙、列宁格勒执行间谍行动，此后又辗转南非、阿富汗，在她的岗位上为“铃”计划默默奉献。1985年，一位法国小伙路易·德格拉斯作为对外安全总局干员加入“铃”计划，马上和所有成员混熟了，和她关系也很好。1989年11月9日，她在西柏林的安全屋得知了柏林墙的倒塌。

这是历史的终结。



1990年起，“铃”计划对抗珀修斯的任务逐渐减少，研究、考察和总结则多了起来。她多次前往曾经的铁幕背后，走遍了原华约成员国，见证了共产主义制度在东欧的崩溃和中东欧国家向“民主国家”转型的第一步。在这个计划的最后两年，帕克实际上成为了行动组的核心人物——这一点就连她自己都未曾预料到过。

1993年，随着“铃”计划完成使命，帕克也面临一个重要选择。她可以选择退休，离开军情六处，开始一段新生活，也可以留下来继续为女王和国家服务。阿佐莱说他会离开中情局，并打趣说如果她也退休，那他做的第一件事就是求婚。

[[是时候休憩一下了。-&gt;11.7]]

[[或许应该还是再为国家多服务一下？-&gt;11.8]]</tw-passagedata><tw-passagedata pid="86" name="11.7" tags="" position="1900,1825" size="100,100">1994年1月，帕克在为军情六处服役(if:$entrance is 1972)[22](if:$entrance is 1976)[18]年后结束了特工生涯。当年4月，她看到一则新闻：卢旺达发生种族大屠杀后，一支“白人雇佣兵小队”进驻卢旺达首都基加利的千丘酒店，保护了在那里的1200多名难民免于屠杀。到7月底屠杀结束时，这支小队就撤离了。她动用自己的人脉了解了情况，但许多信息语焉不详——最关键的是，阿德勒居然说自己“不便透露”这是怎么回事。



无论如何，除去这个小插曲，20世纪90年代下半叶的时光对于帕克相当平静。1995年，她和拉扎尔喜结连理，不过没有子女。然而到1998年，她的生活又出现了转机——这年初，在一次战友聚会上，阿德勒请来了已经官至美国参谋长联席会议副主席的蒂莫西·法兰德上将、法兰德的朋友，前任空军参谋长理查德·克拉文上将，以及理查德的哥哥，电子数据系统公司（EDS）主席赫伯特·克拉文。面对这三位新朋友，阿德勒把他认识他们的经历娓娓道来：

1968年1月，阿德勒和法兰德作为研究观察团成员参加了岘港战役，法兰德在那场战役中荣获荣誉勋章，他们也成了一辈子的朋友。1980年代中期，法兰德上校加入了一个由理查德·克拉文为领袖的秘密集团——“战隼帮”（the Fighting Falcon Gang）在主导。“战隼帮”源自20世纪60年代约翰·博伊德（John Boyd）创立的“战斗机黑手党”，后来由克拉文接班，并发展成美军和北约国家军队内部一个强大的改革派系。

与此同时，理查德的兄长赫伯特的经历则更加有趣——他是个相当成功的企业家和亿万富翁，和罗斯·佩罗（Ross Perot）一道组建了电子数据系统公司这家IT界的超级巨头。但他的经历还不止于此。

1979年，他和时任电子数据系统公司主席佩罗组织人力进入正处在伊斯兰革命高潮的伊朗，将两名被伊朗政府逮捕的公司雇员救出伊朗，带回美国。1983年，作家肯·福莱特（Ken Follett）将这段经历写成小说《鹰翼之上》（On Wings of Eagles），1986年小说被改编为电视电影。

到这里，赫伯特向帕克伸出了橄榄枝——他邀请她加入电子数据系统公司，开始一段新生活。

[[别赋闲了，找点事干吧！-&gt;12.4]]

[[要不再等等？再问问阿德勒94年到底怎么回事？-&gt;12.5]]</tw-passagedata><tw-passagedata pid="87" name="11.8" tags="end" position="1775,1825" size="100,100">经过慎重考虑，帕克决定留在军情六处，成为”铃“计划最早一批干员中少数仍然留在情报界的人员之一。事实证明，参与”铃“计划成为了一笔巨大的政治资本——在此后的时间中，她一点一点步步高升，经历了90年代军情六处的多次大裁员，却丝毫未受影响。

阿富汗战争、伊拉克战争相继爆发后，帕克的仕途更加顺利了。她在自己的岗位上主导了军情六处在伊拉克的多项行动，和特种空勤团、特种舟艇团、中央情报局、美国联合特战司令部等部门紧密合作，取得了不错的成果，当然也遇到了不少虐囚和刑讯逼供的指责。2006年，她升任秘密情报局情报处长。

2009年，帕克被任命为秘密情报局局长，登上服役生涯的顶峰。2009年10月，在“伊拉克战争调查”中，她就英国政府在伊拉克战争中扮演的角色接受枢密院质询。叙利亚战争爆发后，她拟定了一项为反政府武装提供资金，建立一支5万人规模的部队以推翻巴沙尔·阿萨德的方案，但毫无悬念地被否决了。

2014年，帕克决定退休，随后被封为女男爵，进入上议院。不过在此之后，她也没有闲下来——她先后担任议会情报和安全委员会成员、外交和联邦事务大臣菲利普·哈蒙德的顾问、智库外交政策中心（FPC）的顾问委员会成员、战略与国际研究中心（CSIS）的客座研究员。2018年“铃”计划的大部分档案解密后，她更是高调地站出来，称自己对这段服役经历无比自豪。

值得一提的是，由于她在情报界有(if:$entrance is 1976)[近四十年](if:$entrance is 1972)[四十多年]的服役经历，曾深度参与“铃”计划，并且在退休后一直没有退出公众视野，因此英国等西方国家民间一直有阴谋论，称帕克背后是一个从“铃”计划走出的，涵盖美英等国对外情报机构、国家安全机构、军情机构和特种部队的巨型“深层暴力机关”，而她就是这个“深层暴力机关”的首脑之一。当然，对于这种纯粹的扯淡，她从未回应过，甚至懒得正眼看待这种说法。


不过，或许她隐瞒了一些事情……？



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“冷心”]
非常尊敬的(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]海伦·A·帕克（1952.7.20-），军情六处特工(if:$entrance is 1972)[（1972-2014）](if:$entrance is 1976)[（1976-2014）]，为“铃”计划效力最久的成员之一，秘密情报局局长（2009-2014），英国上议院议员。一位凭运气和能力攀登到顶峰，作风严苛、胆大心细，极具旧贵族气质的情报首脑。//&#39;&#39;

[[结局名称是不是有点怪？先来看彩蛋]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="88" name="12.4" tags="end" position="1900,1950" size="100,100">1999年，帕克加入电子数据系统公司董事会，并在此后担任公司与英国国防部和英国情报机构谈判的中间人，为公司服务近二十年。一直到2018年，她才因年龄原因卸任。在她任内，她谈妥了价值近百亿英镑的订单，确保英国国防部、军情五处和军情六处可以获得安全、高效的数据外包服务。她相当享受在电子数据系统公司工作的日子，也经常在英美两国之间穿梭。
(set: $vocation2 to &quot;EDS&quot;)
退休后的帕克仍然相当活跃，不时举办战友聚会、研讨会，或是为企业和学校开展讲座。同时，她还为赫伯特晚年设立的“赫伯特·克拉文基金会”做了不少贡献，甚至在一次活动上与赫伯特和美国前总统吉米·卡特并肩而立。



在一次活动上，当被年轻人问及她最喜欢哪一句格言时，她略加思索，说出了一个没人能料到的答案——那是《鹰翼之上》记述的电子数据系统公司的格言。

&#39;&#39;//雄鹰不会成群，必须逐一寻觅。
Eagles don&#39;t flock; you have to find them one at a time. //&#39;&#39;



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“鹰翼之上”]
海伦·A·帕克（1952.7.20-），军情六处干员(if:$entrance is 1972)[（1972-1994）](if:$entrance is 1976)[（1976-1994）]，电子数据系统公司董事（1999-2018）。一位先后在情报界和企业界发光发热，又收获了爱情、事业和理想的成功人士。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="89" name="12.5" tags="" position="1775,1950" size="100,100">1999年2月，阿德勒找上帕克，并向她交代了1994年一切的原委：

1991年5月，退役南非国防军中校伊本·巴洛（Eeben Barlow）在伦敦组建了一家名为索尔兹伯里安保集团（Sailsbury Security Corporation, SSC）的私人军事服务公司（PMC），主要业务是军事训练、军事行动、设施保卫、信息安全、情报工作、后勤保障、人身保镖等。这家公司的一个特点是，前南非国防军和罗得西亚安全部队的退役军人占比很高——他们自称是“受害者”，通过共同的对军事职业和技能的骄傲，联系在一起，并吸纳了冷战结束后不少北约和华约成员国的退役军人。

索尔兹伯里的成立，背后是“战隼帮”在主导。冷战结束后，“战隼帮”意识到私人军事服务领域的蓝海，决定施加影响。而阿德勒是从法兰德那里得知这一切的。阿德勒从1992年开始，就在参与这家公司的业务，只不过一直没有全身心投入其中。

1994年的那支“白人雇佣兵小队”，就是索尔兹伯里派往卢旺达的人员——他们原本受比利时政府委托保护千丘酒店这座比利时航空的财产，结果却在不知不觉间当了一回人道主义干涉力量，保护了一千多条生命。

1998年，由于索尔兹伯里安保集团在非洲开展的多次大规模行动（包括但不限于上述的卢旺达行动）使美英政府感受到了威胁，并被认为会对非洲的安全格局造成重大破坏，因此公司遭到舆论攻击——有人泄露了伊本·巴洛和他的南非朋友酒后失言的录音，随后的舆论风波导致巴洛决定金盆洗手，并导致他从南非和罗得西亚带来的初创团队几乎全部流失了。然而，“战隼帮”不愿意就这样放弃这家公司，因此正在四处网罗人手尝试维持并继续发展公司。

阿德勒此时相当诚恳——他需要帕克和阿佐莱的帮助，否则这家公司就完蛋了。他找上了“铃”计划的前干员德格拉斯，后者同意帮忙。他劝说的话很简单——为了我们二十多年的交情，为了曾经在铁幕两侧对峙的战士可以为非洲的和平而战。显然，帕克不好意思拒绝老朋友的邀请——哪怕这意味着引火烧身。

[[看来不得不同意了。-&gt;13.2]]</tw-passagedata><tw-passagedata pid="90" name="13.2" tags="" position="1775,2075" size="100,100">1999年下旬，帕克和阿佐莱行动起来，四处动用人脉为索尔兹伯里安保集团招募人马。在他们的不懈努力下，公司逐渐有了转机——而九一一事件发生、美国入侵阿富汗，则给了公司一个大发展的机会。出乎意料的是，美国政府似乎并不想完全消灭索尔兹伯里安保集团，而是将其作为一个可以控制和利用的存在。
(set: $vocation2 to &quot;PMC&quot;)
身为情报处长的帕克，以及阿佐莱和德格拉斯决定善用这个机会。从2001年开始，索尔兹伯里安保集团被美国政府选定为防务承包商，负责训练阿富汗军人与警察、维持后方治安、后勤运输、情报处理与分析、要人安保等业务。索尔兹伯里的人员很快膨胀到超过3万人，其中至少有1万人派驻阿富汗。

2003年伊拉克战争爆发后，索尔兹伯里也顺风顺水地获得了美国政府的订单，开始派遣人员进入伊拉克，开展与阿富汗近似的业务。同时，英国也通过索尔兹伯里参与到了这两场战争中。2004年初，索尔兹伯里的人员数量达到60,000人，其中三分之二派驻阿富汗和伊拉克。然而，美国政府意识到一家巨型私人军事服务公司可能对国家安全造成巨大风险，并开始通过干涉索尔兹伯里在阿富汗和伊拉克两地的活动来削弱它。

2004年4月，美国CBS新闻公布伊拉克阿布格莱布监狱内美英军事人员虐待囚犯的影像后，随即引起全世界关注，并激起了浩大的谴责声浪。美国国防部声称，该监狱是索尔兹伯里安保集团负责监管的，而公司高层则称他们只负责监狱外围安保，不负责审问囚犯。然而，当许多真真假假的证据开始流出时，索尔兹伯里迅速输掉了舆论战，遭到国际舆论的广泛谴责和质疑。

[[好吧，看看媒体的笔杆子能扯什么出来。-&gt;14.2]]</tw-passagedata><tw-passagedata pid="91" name="14.2" tags="end" position="1775,2200" size="100,100">2005年9月，电影《战争之王》上映后，尼古拉斯·凯奇饰演的军火商人尤里·奥洛夫一度成为了公众热议的形象。2005年11月，《镜报》刊载了一篇题为《我们也有“战争女王”》的文章，用“战争女王”这个绰号称呼海伦·帕克，并称她“主导了索尔兹伯里在阿富汗的行动，用雇佣兵虐待战俘，靠战争大发横财”。帕克原本想发表声明予以还击，但在公关团队建议下最终不得不避其锋芒——阿布格莱布已经搞了个大新闻，天知道要是她反驳，媒体这次会扯什么东西呢！

2007年9月16日，索尔兹伯里安保集团的保安分队在护送美国国务院一列车队，前往巴格达西部与美国国际开发署官员见面时，突然向路边的伊拉克平民开火。事件中17名伊拉克平民被杀害，24人受伤。这成为了该集团在伊拉克业务的转折点。2009年1月，由于此次枪击案等一连串事件，索尔兹伯里安保集团停止了在伊拉克的所有业务。

面对汹涌的舆论压力和美英国防部的施压，帕克、阿佐莱和德格拉斯等公司元老逐渐意识到他们应该退场了。2010年，帕克因厌倦了媒体对她和她战友铺天盖地的流言蜚语，以及开始质疑美国在伊拉克和阿富汗的战争究竟是为了什么，决定辞去情报处长职务；阿佐莱和德格拉斯也先后辞了职。此后，她一直对这段经历保持缄默。



2020年，帕克在回忆录中首次谈到了自己在索尔兹伯里安保集团的经历。在关于这段经历的章节最后，她坦白道：

//“现在，我对当时接受这个提议有一点后悔。我不知道事情会是这个结局。某种意义上，我们背离了索尔兹伯里安保集团成立时的初衷——我们希望让退役但又无法融入公民社会的战士有一个好归宿，但我们没能做到。
“我知道时至今日很多人会嘲讽我是‘战争女王’。我仍然厌恶这个称呼。但显然，这不全是他们在诽谤我。他们也有道理。”//



触发结局：
//&#39;&#39;(text-colour: green)[普通结局：“不情愿的战争女王”]
海伦·A·帕克（1952.7.20-），军情六处干员(if:$entrance is 1972)[（1972-1994）](if:$entrance is 1976)[（1976-1994）]，索尔兹伯里安保集团情报处长（1999-2010）。一位不情愿但却名副其实的“战争女王”？&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="92" name="9.3A" tags="" position="1900,1575" size="100,100">在和阿德勒谈过话后，中情局和军情六处却没有更改行动方案，因为他们认为里希特的情况是“可控的”。这给整个行动蒙上了一层阴影，也让帕克感到忧虑——她有时会难以控制自己的情绪。

1983年9月4日清晨，他们从安全屋出发，各自坐上地铁，奔赴同一个地点——腓特烈大街车站。从那里，他们将穿过铁幕。

[[开始任务吧。-&gt;9.4]]</tw-passagedata><tw-passagedata pid="93" name="19.1" tags="end" position="1900,2825" size="100,100">2023年7月20日，帕克的生日。

有人敲了敲病房门，陪伴着她的阿德勒应了一声“来了”。打开门后，他看到两位老太太。其中一位年长些的女士大约九十岁，安坐在轮椅上，穿着打理得一尘不染的克格勃少将制服，左胸前除了许多排勋略，还有一枚苏联英雄的金星勋章，而稍微年轻些的那位也至少六十岁了。

”我是伊琳娜·马克西莫夫娜·波特诺娃，“年轻些的女士说，她看向帕克，露出了神秘的微笑。“生日快乐，海伦·帕克。”

…………

波特诺娃握住帕克的手。“你还记得我吗，帕克？”

帕克思索片刻，但似乎从一开始就知道她记不起来的。“不记得了。你那时在卢比扬卡？”

“不，列福尔托沃监狱。84年3月17日。但我没和你说几句话，我只记得觉得你非常顽强。当然，我们认为那叫死硬。”

帕克用全身力气轻笑了两下。“是啊，是啊。”


2023年8月5日，在新冠病毒和癌细胞的双重打击下，海伦·帕克在阿德勒、拉扎尔、法兰德和克拉文兄弟的陪伴下告别了人世，享年71岁。



触发结局：
//&#39;&#39;(text-colour: blue)[好结局：“奇异恩典”]
海伦·A·帕克（1952.7.20-2023.8.5），军情六处干员，曾无数次陷入灾难，但最终都走了出来，并最终安度晚年，在被俘四十年后和曾经的敌人再次聚首。“坚强的帕克”或许也不过如此吧。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="94" name="8.9" tags="" position="2900,1450" size="100,100">1983-1987年，帕克先后在影子贸易团队、外交和联邦事务团队、影子内政团队任职，逐渐积攒政治资本和人脉。她和托尼·布莱尔、戈登·布朗建立了友谊，但也感受得到他们三人日后可能要为了权力而斗个你死我活。

1987年大选后，年仅35岁的帕克出乎意料地进入影子内阁，被任命为影子环境大臣。10月，英国发生黑色星期五股灾。事后，她批评一些伦敦商人“软弱无能”，以及伦敦证券交易所未有为小股民提供合理的服务，这些言论使她受到了相当的重视。当时便有人预测，帕克、布莱尔和布朗日后会成为工党的重要人物。

1992年大选前，备受基诺克本人青睐的帕克多次公开发表演讲，获得不少好评。然而，本届选举中工党虽然获得了比上届大选更多的席位，但仍然无法执政。与此同时，东欧剧变、苏联解体意味着传统的“真实存在的社会主义”已经失败，工党很有可能需要实施大刀阔斧的改革才能入主唐宁街。

(if: $preevent is not &quot;7.2A&quot;)[此时，布莱尔是影子内政大臣，布朗是影子财政大臣，而帕克则是影子外交和联邦事务大臣——在智库工作、与思想为伴的历程，促使她把握住了这个潜在机会。如果她抢先于布莱尔和布朗，明确工党如何改革，那么她将有更多竞争首相一职的资本。然而，她也意识到，任何根本改革都要求工党放弃生产资料公有制、部分甚至全部接受新自由主义的底层逻辑，并且转向阶级调和，疏远工会。]

经过审慎考虑，她心想……

(if: $preevent is not &quot;7.2A&quot;)[[[可能我们确实要革新工党了。况且这对我也好。-&gt;9.9]]](if: $preevent is &quot;7.2A&quot;)[[[可惜了，我无论如何都没办法拿出一套自己的改革方案来。-&gt;9.10]]]

(if: $preevent is not &quot;7.2A&quot;)[[[必须花更多时间考虑改革的问题，哪怕意味着浪费时机。-&gt;9.10]]]</tw-passagedata><tw-passagedata pid="95" name="9.9" tags="" position="2775,1575" size="100,100">1992年末，帕克开始秘密和费边社的同事接触，商议“新工党”改革方案。其中一项重大问题是，工党党章第四条如何修改——当时的第四条规定，工党“确保生产工具，分销渠道和交易媒介均为共同拥有”，即生产资料公有制（实际操作中是国有化）。

1993年10月，她为费边社写了一篇文章，指出第四条把“结果” 和“方法”两个概念混淆了起来。她认为社会主义的价值观是不会改变的，但用来达到社会主义的政策必须根据社会变迁而改变。

到1993年末，她和她的小团队已经完成一份初步方案，准备在次年的工党大会上公布。这份方案包括：修改第四条并明确工党的民主社会主义性质；强调实现社会公正（而非平等）是工党的最高目标；强调机会平等；认为市场经济可用来实现工党的目标；认为工党是一个不分阶级的政党；强调教育、福利、遏制犯罪在建立公正社会中的作用。她知道布莱尔肯定已经开始行动了，但也肯定落后她一步。

1994年5月12日，工党党魁约翰·史密斯突发心脏病逝世。很快，党魁选举被定在7月21日。帕克意识到，如果她要成为党魁，必须马上拿出点东西让布莱尔和布朗闭嘴，最好是跟他们达成君子协议。

[[首先是党魁，然后是新工党，最后就是首相。-&gt;10.10]]

</tw-passagedata><tw-passagedata pid="96" name="9.10" tags="" position="2900,1575" size="100,100">帕克没有投入太多精力去研究工党改革方案，虽然她的确意识到工党应当实施大改革，也支持英国与欧共体深化合作，反对英国退出北约，但她仍然坚持废除上议院、实施单方面核裁军等立场，并且反对把工党的基本盘扩大到中产阶级，也反对减弱工会对工党的影响力。

然而与此同时，她开始收到风声，称布莱尔和布朗已经开始推动工党的改革方案，初步代号是“新工党”。1994年5月12日，工党党魁约翰·史密斯突发心脏病逝世。很快，党魁选举被定在7月21日。她不打算参加选举，但有种预感，布莱尔会在党魁选举和其后的代表大会上提到“新工党”——并且，他会因此一战成名。但在此之前，她要和他们谈谈。

[[还能干什么呢？静观其变吧。-&gt;10.11]]</tw-passagedata><tw-passagedata pid="97" name="10.10" tags="" position="2775,1700" size="100,100">1994年6月，帕克、布莱尔和布朗在伦敦私下见面。虽然布莱尔和布朗早已知道帕克正尝试制定工党的改革方案，但当她拿出“新工党”计划的草稿时，他们便意识到她抢占了先机，恐怕也没什么好讨价还价的了。三人很快达成一致——帕克会参加党魁竞选，而布莱尔和布朗不会。

然而，到了分蛋糕的环节，三人还是产生了矛盾。布朗坚持要求担任财政大臣，并且给予他在财政事务方面最大的自主权，而布莱尔也依样画瓢，要求担任副首相。帕克则认为这样做无异于架空她的权力，并且会导致未来的政府四分五裂。最终，三人经过讨价还价，决定：

帕克参加工党党魁竞选，布莱尔和布朗不反对；她预计将会稳得党魁一职，并在下一次议会选举中成为首相；

布朗继续担任影子财政大臣，在大政方针上服从帕克，除此之外对财政事务有完全的自主权；

布莱尔担任副首相，以及他希望的其他内阁职务（外交、内政、国防这三个岗位除外）；

帕克承诺只担任两届首相（不超过10年）。

[[先生们，应该抛下成见了。一切为了工党。-&gt;11.9]]</tw-passagedata><tw-passagedata pid="98" name="11.9" tags="" position="2775,1825" size="100,100">1994年7月21日，海伦·帕克击败玛格丽特·贝克特和约翰·普雷斯科特，成为工党党魁。在10月的工党大会上，帕克公布了名为“新工党，英国新生”的工党改革方案，列出以下要点：

在1995年修改工党党章第四条并明确工党的民主社会主义性质；

强调实现社会公正（而非平等）是工党的最高目标；

强调机会平等；

认为市场经济可用来实现工党的目标，并依靠公私合作和企业筹集资金；

认为工党是一个不分阶级的政党，并认为建设良好的劳资关系是工党的要务；

强调教育、福利、遏制犯罪在建立公正社会中的作用；

加税并设置累进税，同时提升社会保障水平。

“新工党”成为了工党的转折点——本来，保守党就因为经济衰退、失业率高涨而逐渐失去民心，如今“新工党”的提出无疑为这个老党打了一剂强心针，使工党的面貌焕然一新。1995年4月，虽然遭到一些传统左派的反对，但工党党章第四条仍然被修改；到1997年大选前夕，所有民调都显示工党将以压倒性优势赢得大选。

[[唐宁街10号的大门已经敞开。-&gt;12.6]]</tw-passagedata><tw-passagedata pid="99" name="12.6" tags="" position="2775,1950" size="100,100">1997年5月1日，工党以压倒性优势赢得大选，海伦·A·帕克入主唐宁街10号，以44岁的年龄成为英国历史上第三年轻的首相。

在国内事务上，帕克选择在在卫生和教育事务上大幅度增加公共开支，并在这些领域引入具争议性的“市场主导改革”。在她任内，最低工资得到完全落实、高等教育学费有所上升，同时还进行了大幅度宪法改革，根据苏格兰和威尔士的全民公投，建立了权力下放政府。

1998年4月10日，英国、爱尔兰以及北爱尔兰的八个政党或团体之间达成协议，即《贝尔法斯特协议》，旨在解决联合王国内的北爱尔兰政府架构与地位问题、北爱尔兰与爱尔兰共和国的关系问题、爱尔兰共和国与联合王国的关系问题。《贝尔法斯特协议》建立了北爱尔兰实现和平的框架，成为政治解决北爱尔兰问题的基础。

同时，英国经济在帕克任内也实现快速增长，通胀率相当低，失业率则逐年下降。工党在一定程度上实现了它关于社会公正的主张，虽然也有很大的批评声称工党实际上已经和保守党合流，拥抱了新自由主义。

2001年大选中，工党维持压倒性优势。然而到了2001年9月11日，九一一事件导致美国开始准备入侵阿富汗、推翻塔利班政权。此时，帕克和许多欧洲的北约成员国首脑一样受到了邀请——和美国一道出兵阿富汗。她接受了邀请，派遣英国军人参加国际安全援助部队（ISAF），以及美国主导的“持久自由行动”。

[[似乎没什么大不了的。-&gt;13.3]]</tw-passagedata><tw-passagedata pid="100" name="13.3" tags="" position="2775,2075" size="100,100">2003年初，执政已6年的帕克面临一个重大挑战——伊拉克问题。虽然美国总统小布什坚持出兵伊拉克推翻萨达姆政权，但这次北约的许多欧洲成员国——尤其是法国和德国——都不愿参与其中。小布什希望在“美英特殊关系”下，英国会和美国一道出兵，推翻萨达姆，建立一个民主的伊拉克，并防止伊拉克的“大规模杀伤性武器”对世界和平造成威胁。

然而，帕克并不想大举干涉伊拉克——她知道工党内部反战声音很强，许多人希望多关注内政问题而不是贸然参与一场战争。同时，她知道当初和布莱尔还有布朗定下的君子协定快要到期了。如果她违反协定再谋求一次连任，那么显然她不能冒着失去民众支持的巨大风险参与出兵伊拉克。此时，布朗表达了反对入侵伊拉克的意见，但布莱尔却表示支持。

[[让美国人先去，我们静观其变。-&gt;14.3]]

[[为了找到大规模杀伤性武器并维护人权，战争是必须的。-&gt;14.4]]</tw-passagedata><tw-passagedata pid="101" name="14.3" tags="" position="2775,2200" size="100,100">2003年3月20日，美国、澳大利亚、新西兰和波兰组成的多国联军开始入侵伊拉克。与强烈反对这次行动的法国总统希拉克、德国总理施罗德不同，帕克没有在公开场合强硬反对，但她也明确表示不会出兵。此举严重损害了美英关系，但也极大巩固了帕克的民望——尤其是在多国联军根本没有发现“大规模杀伤性武器”、伊拉克陷入治安战后更是如此。
(set: $special1 to &quot;iraq&quot;)
2005年，帕克决定提前一年解散议会并举行大选，并开始考虑自己要不要再谋求一个任期。工党内部对此存在争议，一些人认为帕克的领导风格愈发刚愎自用，她和布莱尔、布朗的关系也越来越紧绷。她很清楚，如果自己明哲保身，不再谋求连任，那么，她有可能成为民众眼中二战后英国最杰出的首相之一；然而，她也不想完全放弃继续追求权力，但那样做的代价可能是晚节不保。

思前想后，她还是决定赌一把。

[[何不继续领导这个国家呢？-&gt;15.4]]

</tw-passagedata><tw-passagedata pid="102" name="14.4" tags="" position="2900,2200" size="100,100">2003年3月20日，美国、英国澳大利亚、新西兰和波兰组成的多国联军开始入侵伊拉克。与强烈反对这次行动的法国总统希拉克、德国总理施罗德不同，帕克在公开场合表示了对入侵伊拉克的支持，称此举是为了维护伊拉克的人权并推翻萨达姆的邪恶政权。然而据内阁成员称，帕克自己实际上不想出兵，此事很大程度上是布莱尔在推动。

然而，入侵在英国国内遇到了大规模的反对意见。由于工党的许多议员投票反对出兵，出兵决议实际上是在保守党和工党部分议员的推动下通过的。虽然萨达姆政权崩溃后，她的支持度一度飙升，但入侵伊拉克的决定，以及她和布朗关于财政事务愈演愈烈的矛盾，成为工党经过长期执政开始走向分裂的标志——到2004年，全世界都大致知道帕克、布莱尔和布朗的龃龉了。

2005年大选后，工党虽然仍然获得多数席位，但帕克的首相职务愈发岌岌可危。2006年年初，工党爆出“金钱换爵位”经济丑闻，几名被工党提名为上院议员候选人的富商被曝在2005年议会选举前向工党提供了价值数百万英镑的秘密贷款。3月18日，一名工党内部人士表示这起事件与帕克有联系。5月4日，工党在地方选举中大败；7月，由于迟迟不就以色列与黎巴嫩真主党冲突表态或呼吁双方停火，帕克又遭到了一波舆论攻击。而最致命的是，伊拉克的战事逐渐变成了一摊烂泥，多国联军伤亡与日俱增，“大规模杀伤性武器”更是连影子都没有。工党内部越来越多人开始认为，帕克应该下台了，甚至已经有议员在要求她辞职的联名信上签名。

2006年10月，布莱尔和布朗向帕克重新提了当年她口头承诺的任期限制。此时，帕克才意识到这两人一直在秘密串联——而他们的意思是希望临阵换帅，声称这样可以保住她九年来的好名声，别让她晚节不保。他们同时还暗示，如果帕克不辞职，她就会重蹈撒切尔夫人的覆辙——考虑到帕克并没有像撒切尔夫人一样培养继承人，这基本无异于一场不流血政变。

帕克说到底不是撒切尔夫人，推不出一个能与布莱尔和布朗竞争的接班人。于是，她同意了。

[[就这样吧。-&gt;15.5]]</tw-passagedata><tw-passagedata pid="103" name="15.4" tags="" position="2775,2325" size="100,100">在2005年5月5日的大选中，帕克再次带领工党取得胜利。然而，工党的支持率相较前两次大选有所下降，相比上一次的412席，此次仅获得355个席位。与此同时，帕克的内阁也发生了重大变化：约翰·普雷斯科特成为副首相，而布莱尔则转任内政大臣。

此时，工党内部对于帕克的领导已经存在一定不满。她的一些成员称她过于自负，经常在不充分咨询内阁的情况下依靠自己的幕僚做出决策，财政政策也经常和布朗领导下的财政部产生冲突。也是在这时，开始有人称帕克为“红色铁娘子”——红色代表工党，而她确实也像“铁娘子”撒切尔夫人一样，担任首相相当长时间了。

帕克当选后，工党先后面临一连串危机。2005年7月7日，伦敦发生七七爆炸案，56人死亡，784人受伤；2005年12月，年仅39岁的戴维·卡梅伦成为保守党新一任党魁，短时间内大幅提振了保守党的支持率；2006年年初，工党爆出“金钱换爵位”经济丑闻，几名被工党提名为上院议员候选人的富商被曝在2005年议会选举前向工党提供了价值数百万英镑的秘密贷款。3月18日，一名工党内部人士表示这起事件与帕克有联系。2006年夏，由于迟迟不就以色列与黎巴嫩真主党冲突表态或呼吁双方停火，帕克又遭到了一波舆论攻击。

2006年7月21日，帕克向全国观众发表电视讲话，就“金钱换爵位”丑闻、阿富汗局势、黎以冲突等问题阐明了自己的立场。她否认“金钱换爵位”和自己有关，但表示对这一事件感到相当遗憾；她出乎意料地呼吁真主党和以色列尽快停火，并谴责了真主党和以色列对平民定居点的无差别轰炸。这次讲话稳住了她的支持率，也部分恢复了英国民众对她的信心。但是，工党内部要求她辞职的声音并没有就此消失；10月，12名工党议员签署联名信，呼吁帕克在2007年9月的工党大会前辞去党魁一职，并称她的领导风格“和撒切尔夫人一样粗暴、独断”。

(if: $birth is 1 and $university is &quot;edin&quot;)[2006年末，帕克刚刚稳住阵脚，却又遭到重重一击——她相识很久的同乡兼校友戈登·布朗托人向她递交了一封信，指出她的领导风格已经“暴露出许多弊病”，并建议她尽快决定在明年9月的工党大会上是要正式辞去党魁和首相一职，还是继续任职；他还明确表示，不相信帕克可以坚持到2010年议会大选。在信件最后，布朗奉劝帕克“不要成为第二个撒切尔夫人”。]

到2007年1月，帕克意识到如果自己不想毁掉十年来的英名，就必须准备辞职了。已经有20多名工党议员呼吁她辞职，如果他们在议会反对工党提出的议案，并导致议案被否决，那么无异于不信任动议被通过。而布莱尔也找到她，表示虽然过去十年来和她共事的经历相当好，但他不希望帕克坚持拒绝辞职；如果帕克决定辞职，他也会辞职。

[[也许确实不应该步撒切尔夫人的后尘？-&gt;16.2]]</tw-passagedata><tw-passagedata pid="104" name="16.2" tags="" position="2775,2450" size="100,100">2007年2月，在公众猜测许久后，海伦·帕克做出了预料之中的决定：她宣布将在2007年9月的工党大会上辞去工党党魁一职，并辞去首相职务。许多人对帕克的离去相当惋惜，称她是他们所见过的最好的首相。“红色铁娘子”的称呼也在此时传开了——不过，帕克的劣迹可比撒切尔夫人少多了。

在她最终离任前，她仍有一件事要决定——谁适合成为工党下一任党魁。她不想看到布莱尔和布朗在她走后马上陷入内斗，并尝试调和两人之间的矛盾。然而，布莱尔最终按计划主动退让，将首相一职让给了布朗，并决定退出政坛。

2007年9月22日，帕克在工党大会全体参与者的掌声中，宣布自己辞去工党党魁一职，并卸任首相。在随之而来的新任党魁选举中，戈登·布朗在无反对者的情况下自动当选，成为新一任首相。当帕克最后一次在唐宁街10号门前演说时，她流泪了——这可能是“坚强的帕克”一辈子第一次流泪。

[[唐宁街10号度过的10年岁月啊……-&gt;17.2]]

</tw-passagedata><tw-passagedata pid="105" name="17.2" tags="end" position="2775,2575" size="100,100">事实证明，帕克做出了一个极其英明的决定，并且省去了一大堆烂摊子——布朗上台后支持率一度很高，但随着2008年全球金融危机爆发，布朗政府使出浑身解数仍然无法遏制经济下行，工党的支持率大跌，并在2009年欧洲议会和地方议会选举中大败。2009年6月，两名内阁大臣陷入财政丑闻，更使评论认为布朗开始失去对局面的掌控。到2010年议会大选前，绝大部分民调认为工党最多只能和自由民主党组建联合政府。

2010年5月6日的议会大选中，工党席位从349席下降到258席，不得不寻求与自由民主党谈判组建联合政府。然而，布朗在5月11日宣布谈判失败，次日辞职，戴维·卡梅伦成为新任首相。至于帕克，她连任了议员，不过如今也只是一位普通的后座议员了。同年，维基解密泄露大量美国外交电报后，好事者发现美国国务院官员曾在2003年帕克拒绝参与入侵伊拉克后怒斥她是个“疯婆子”，小布什的核心决策圈则认为她“不可信”。

2014年苏格兰公投前夕，关系已经改善许多的帕克和布朗再次发声，支持苏格兰留在联合王国。2015年大选中，帕克和布朗都没有寻求连任。

卸任后的帕克民望高得惊人，以至于有许多人认为她应该受封世袭贵族爵位——如果此事成真，她将成为哈罗德·麦克米伦后又一位获封世袭贵族的前首相。(if:$birth is 1)[最终，她谢绝了这个爵位，甚至一并谢绝了终身贵族，只获封了女爵士。](if:$birth is 2)[最终，她接受了这个爵位——这在当时引发了一点争议，不过过半数英国民众认为她实至名归。]她没有沉寂下来，而是继续参与政治和公共生活，撰写回忆录和其他著作。2024年，基尔·斯塔默当选首相后，她祝贺这位老相识带领工党取得了又一次选举胜利。



与第一位“铁娘子”撒切尔夫人相比，海伦·帕克的风评好许多。2021年，利兹大学研究团队制作的1885年以来的英国首相排名中，帕克排在第二位，仅次于克莱门特·艾德礼，甚至超过了撒切尔夫人。她付诸实践的“新工党”理念使英国享受了十多年的经济繁荣，社会矛盾也得到缓解——更关键的是，她不惜影响美英特殊关系，拒绝参与事后被证明徒劳无功的伊拉克战争，将绝大部分精力用于给英国人民创造一个正义、公平、繁荣、充满希望的社会。当然，她没能完全实现夙愿，“新工党”作为一种政治哲学日后也饱受质疑，从根本上困扰英国社会的矛盾（尤其是移民和恐怖主义问题）也未曾得到化解；保守党也从未停止过对她的攻击，尤其是在外交政策方面。

在私人场域，帕克则和里根一样得到了“特氟龙”的绰号——这是指她像不粘锅一样，可以甩掉几乎所有政治丑闻，而且和所有人都融洽相处，哪怕是反对党领袖。在这方面，恐怕就更少有人可以挑她的刺了。

所以，无论外人怎样评价，都不能改变她名垂青史的绰号——“红色铁娘子”。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“红色铁娘子”]
(if: $birth is 2)[第一代富勒姆女伯爵海伦·A·帕克](if: $birth is 1)[非常尊敬的海伦·A·帕克女爵士]（1952.7.20-），英国首相（1997-2007），英国近现代史上任期第二长的首相（仅次于撒切尔夫人）。迄今为止，她仍然是英国近现代史上评价最高、最被人爱戴和怀念的首相之一。//&#39;&#39;

[[在重生前先看一个小彩蛋]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="106" name="15.5" tags="" position="2900,2325" size="100,100">2006年12月，在公众猜测许久后，海伦·帕克做出了预料之中的决定：她宣布将在2007年9月的工党大会上辞去工党党魁一职，并辞去首相职务。许多人对帕克的离去相当惋惜，称她是他们所见过的最好的首相；但也有许多人抨击她是“战争贩子”，在伊拉克参加了一场未经安理会授权、毫无国际法根据的侵略战争。

2007年9月22日，帕克在工党大会上宣布自己辞去工党党魁一职，并卸任首相，同时也不会参与2010年的议会大选。在随之而来的新任党魁选举中，早已和布莱尔谈妥的戈登·布朗在无反对者的情况下自动当选，并马上任命布莱尔为外交和联邦事务大臣。

[[天下没有不散的筵席……-&gt;15.5续]]</tw-passagedata><tw-passagedata pid="107" name="10.11" tags="" position="2900,1700" size="100,100">1994年6月，帕克、布莱尔和布朗在伦敦私下见面。虽然帕克知道“新工党”，但当布莱尔拿出“新工党”计划的草稿时，她意识到自己显然不是来这里讨价还价的，因为她没什么拿得出手的东西。三人很快达成一致——布莱尔会参加党魁竞选，而帕克和布朗不会。

然而，到了分蛋糕的环节，三人还是产生了矛盾。布朗坚持要求担任财政大臣，并且给予他在财政事务方面最大的自主权；帕克则要求担任另外三个重要的大臣职务（外交、内政、国防）之一。起初，布莱尔甚至不想同意帕克的这个要求，(if: $birth is 1 and $university is &quot;edin&quot;)[对布朗和帕克不仅是老乡而且是校友这一点也有所提防]，但最终他看在帕克从1983年一路走来，而且相当年富力强的份上，同意了她。同时，布莱尔还做了一个单方面承诺，不会谋求担任首相超过两个任期。

[[先生们，应该抛下成见了。一切为了工党。-&gt;11.10]]</tw-passagedata><tw-passagedata pid="108" name="11.10" tags="" position="2900,1825" size="100,100">1994年7月21日，托尼·布莱尔击败玛格丽特·贝克特和约翰·普雷斯科特，成为工党党魁。在10月的工党大会上，布莱尔公布了名为“新工党，英国新生”的工党改革方案，列出以下要点：

在1995年修改工党党章第四条并明确工党的民主社会主义性质；

强调实现社会公正（而非平等）是工党的最高目标；

强调机会平等；

认为市场经济可用来实现工党的目标，并依靠公私合作和企业筹集资金；

认为工党是一个不分阶级的政党，并认为建设良好的劳资关系是工党的要务；

强调教育、福利、遏制犯罪在建立公正社会中的作用；

加税并设置累进税，同时提升社会保障水平。

“新工党”成为了工党的转折点——本来，保守党就因为经济衰退、失业率高涨而逐渐失去民心，如今“新工党”的提出无疑为这个老党打了一剂强心针，使工党的面貌焕然一新。1995年4月，虽然遭到一些传统左派的反对，但工党党章第四条仍然被修改；到1997年大选前夕，所有民调都显示工党将以压倒性优势赢得大选，影子外交和联邦事务大臣海伦·帕克虽然从未完全接受“新工党”的政治哲学，但也做好了入主威斯敏斯特的外交部大楼的准备。

[[一切都水到渠成。-&gt;12.7]]</tw-passagedata><tw-passagedata pid="109" name="12.7" tags="" position="2900,1950" size="100,100">1997年5月1日，工党以压倒性优势赢得大选，海伦·A·帕克成为外交和联邦事务大臣。在她上任后，英国先后参与了科索沃战争、塞拉利昂维和行动，并经过谈判使伊朗政府取消了对萨勒曼·鲁西迪的追杀令，恢复了英国和伊朗的外交关系。同时，她还设法缓解了由于泛美航空103号航班空难而极度紧张的英国和利比亚关系，使利比亚交出了两名犯罪嫌疑人。

虽然政绩充足，但由于在外交政策上和布莱尔经常意见相左，2001年大选后，她被任命为国防大臣，虽然是英国第一位女性国防大臣，但实际上算是降职。2003年，帕克虽然并不支持布莱尔入侵伊拉克的决定，但为了避免造成政府危机，决定保持沉默并执行他的要求。虽然此后英国在伊拉克的军事行动愈发艰难，帕克和布莱尔蒙受的攻击也越来越多，但她圆满地履行了职责。

2005年大选后，帕克出乎意料地被任命为内政大臣，并开始处理包括七七爆炸案在内的一连串国内恐怖袭击事件。这个岗位可以说比前两个岗位都更加具有挑战性，帕克在这个岗位上受到的抨击也是最多的。2005年底，她发现内政部释放或即将释放一批外国囚犯（犯下的罪行包括性侵儿童、杀人、抢劫等暴力犯罪），却没有考虑将这些人遣返，随即组织人力堵住漏洞。事后证明，这个决定挽救了她的部长生涯。

[[很好啊，接下来还会有什么呢？-&gt;13.4]]</tw-passagedata><tw-passagedata pid="110" name="13.4" tags="end" position="2900,2075" size="100,100">2007年6月27日，布莱尔辞去工党党魁首相职务。帕克知道布朗很快就会被选举为新一任党魁和首相，并等待下一个任命，同时向布朗暗示自己无意担任副首相。最终，布朗当选首相后，帕克被任命为财政大臣。然而，当全球金融危机来袭时，帕克遇到了人生中最大的挑战——尽管她执行布朗的政策，对英国银行业进行资本重组，以及实施临时财政刺激，但英国经济仍然陷入困难，使布朗与工党支持率不断下降，甚至多次有资深党员要求他辞职。同时，帕克也意识到，自己的健康状况和作为财政大臣的糟糕口碑，意味着她不适合继续担任前座议员了。

2010年大选前，帕克表示自己无意继续担任内阁成员。5月6日的议会大选中，工党席位从349席下降到258席，不得不寻求与自由民主党谈判组建联合政府。然而，布朗在5月11日宣布谈判失败，次日辞职，戴维·卡梅伦成为新任首相。至于帕克，她连任了议员，不过如今也只是一位普通的后座议员了。

2015年大选中，帕克没有谋求连任。她随后获封(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]，进入上议院。



帕克是少数曾担任英国四大内阁重臣（首相、外交大臣、内政大臣、财政大臣）之三的政治人物之一，也被广泛认为是一位懂得靠妥协和在各方势力之间游走，以获得最大利益的女强人——除了她，没有人能够在布莱尔和布朗的五届内阁待上13年。无论是在外交部、国防部、内政部还是财政部，她都有相对可圈可点的政绩；但她的财政大臣任期可以说相当艰难。

不过，无论如何，她都是位杰出的政治家，不是吗？



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“妥协的艺术”]
非常尊敬的(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]海伦·A·帕克（1952.7.20-），外交和联邦事务大臣（1997-2001），国防大臣（2001-2005），内政大臣（2005-2007），财政大臣（2007-2010）。虽然她有成为首相的能力，但她却从未谋求入主唐宁街10号——该说是遗憾呢，还是该尊重她的意愿呢？//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="111" name="9.11" tags="" position="4425,1575" size="100,100">10月15日，坎贝尔辞去自由民主党党魁一职，帕克和克莱格随后各自宣布将角逐党魁职务。然而，在投票还没开始多久的18日，帕克在自己的选区与民众见面时，一名老太太抱怨英国有太多来自东欧的移民和本地人抢夺职位。几分钟后，帕克向自己的助理私下抱怨这名老太太“食古不化”，并开玩笑地说“我才不担心，反正他们挣不到那么多钱”。21日，录音被泄露了出来。

这次失言重创了帕克的竞选活动，也直接葬送了她成为党魁的计划。据称，她听到录音泄露的消息时“先是大惊失色，随后双手掩面”。虽然她及时道歉，但为时已晚——12月18日，党魁选举结果出炉，帕克可想而知地落选了。

2010年5月6日的议会大选中，工党席位从349席下降到258席，不得不寻求与自由民主党谈判组建联合政府。同时，保守党也未能获得绝对多数，不得不开始组阁谈判。最终，保守党和自由民主党成功组建联合政府，戴维·卡梅伦和克莱格同意让帕克担任财政部首席秘书。

[[好吧，也不是满盘皆输。-&gt;10.12]]</tw-passagedata><tw-passagedata pid="112" name="9.11A" tags="" position="4550,1575" size="100,100">10月15日，坎贝尔辞去自由民主党党魁一职，帕克和克莱格随后各自宣布将角逐党魁职务。12月18日，党魁选举结果出炉，帕克以几百票的微弱优势击败克莱格。

(if: $birth is 1)[(text-size: 0.75)[[这儿有个小彩蛋]]]

2010年5月6日的议会大选中，工党席位从349席下降到258席，不得不寻求与自由民主党谈判组建联合政府。同时，保守党也未能获得绝对多数，不得不开始同样的组阁谈判。帕克意识到，与工党或保守党组建联合政府都意味着放弃竞选宣言的内容，导致支持率大跌。因此，最好的方案并非联合政府，而是信任供给——不参与政府，但支持保守党。不过，党内也有许多人要求她尽快和保守党谈判组建联合政府，至于工党则实际上已经出局了。

5月9日晚上，帕克把自己一个人关在办公室里，知道在零点钟声敲响前，必须做出决定了。她回顾了一下党的软肋——最大的莫过于调高学校学费的问题，他们党曾誓言不调高学费，但保守党和工党都支持调高。不过，她也有自己的法宝——选举制度改革。

[[信任供给保守党，但他们必须批准就选举制度改革举行公投。-&gt;10.13]]

[[联合政府吧，公投也一并搞。-&gt;10.14]]</tw-passagedata><tw-passagedata pid="113" name="10.12" tags="" position="4425,1700" size="100,100">在和保守党组建联合政府后，自由民主党的支持率却迅速下滑。一部分原因是，该党不得不公开投票反对一些竞选纲领中包含的内容，如提高大学学费。同时，自由民主党要求的选举制度改革最终也失败了。从2011年开始，自由民主党在各级选举中的情况都非常糟糕。

在担任了5年的财政部首席秘书后，帕克也面临2015年大选。选举前，民调普遍显示由于苏格兰独立公投的影响，苏格兰几乎所有的下议院席位都会被支持独立的苏格兰民族党包揽；由于英国独立党的分票效应，自由民主党的选情会极其艰难。

但是，帕克没有料到结果会多么糟糕——2015年5月7日选举结果出炉后，帕克震惊地发现自己的席位都丢掉了，而自由民主党仅仅得到可怜的8个席位，上一届则是65个。尽管党内许多人希望把克莱格撤掉，但他们的中意对象帕克却因为落选而无法担任党魁一职。

在失去议席后，帕克决定退出政坛一段时间，回到企业界。2017年大选中，虽然许多人呼吁她出马，但她还是没有参选。2019年也一样如此。这两次选举中，自由民主党的的表现都相当令人失望。


但到了2022年，随着保守党陷入混乱、约翰逊、特拉斯和苏纳克先后像走马灯一样轮替，民调显示根据支持率，自由民主党又重新成为了英国第三大党。虽然她有意出山，但她的年龄已经偏大，不适合担任前座议员了。最终，在党魁艾德·戴维的支持下，帕克重新出山，决心重返威斯敏斯特宫。

[[回到议会的感觉一定很好。-&gt;11.11]]</tw-passagedata><tw-passagedata pid="114" name="11.11" tags="end" position="4425,1825" size="100,100">在2024年7月4日的议会选举中，帕克顺利当选下议院议员，在整整9年后重回议会。自由民主党也获得大胜，赢得72个席位，成为议会第三大党。虽然自由民主党或需要再等候许多年才能进入内阁，但至少对于72岁的她而言，能继续为国家和选民服务，总是好事一桩。

帕克是极少数从1992年选举一路走来的自由民主党议员。许多人提到这个党，除了想起帕迪·阿什顿、查尔斯·肯尼迪、尼克·克莱格这些曾经的党魁，还会想起她这块自由民主党的活化石。虽然她沉寂过一段时间，但她从未完全离开过政治舞台。也正因此，她的名字对许多自由民主党选民而言，无比熟悉；对于自由民主党党员，她则是一位有过争议，但仍然受人尊敬、极具魅力、气质高贵的领袖人物。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“第三势力”]
海伦·A·帕克（1952.7.20-），英国下议院议员（1992-2015；2024-）。自由民主党元老，第三势力的代言人，甚至称得上英国政坛的常青树。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="115" name="10.13" tags="" position="4550,1700" size="100,100">5月11日，海伦·帕克宣布自由民主党与保守党达成信任供给协定；同日，布朗宣布辞去工党党魁和首相职务。然而，保守党政府很快就开始推动提高学校学费这一议题，导致自由民主党内部严重分裂。帕克不得不放弃这条竞选承诺，支持提高学费。2010年12月9日，在就调高学校学费上限的议案进行表决时，自由民主党有27人支持、21人反对，8人弃权。这次事故差点摧垮了自由民主党与保守党的合作关系。

不过，2010年7月，帕克拿出了自由民主党的杀手锏——她要求在当年举行一次公投，决定是否在英国议会选举中以排序复选制替代单议席单票制，以改变两党独大造成的得票率与获得议席不成比例的问题。新选举制度对保守党和工党不利，保守党也明确反对，因此问题是能否争取到工党的不反对。

公投时间最终被定在2011年5月5日。公投前两个月，民调显示支持改革一方居于显著劣势，支持率不超过40%；然而，预计投票率也很低，因此如果能动员年轻人参加投票，或许还有希望。帕克决定赌上一切，说服工党鼓励选民投票，以避免保守党动员民众投反对票，导致提案夭折。工党党魁米利班德对这个提案并不太热衷，但似乎仍然留有一点回旋余地。与此同时，自由民主党也动用一切资源（甚至包括帕克的个人积蓄），宣传排序复选制的优势并驳斥对这种制度的攻击。宣传攻势取得了一点成果，而帕克个人的良好名声对此也有帮助。

但是，帕克知道，不成功便成仁——而且成仁的概率看来不小。
(set: $luck to (random:1,100))
(if: $luck is &gt;= 66)[[[等那一天来吧。-&gt;11.13]]](if: $luck is &lt; 66)[[[等那一天来吧。-&gt;11.12]]]


</tw-passagedata><tw-passagedata pid="116" name="11.13" tags="" position="4675,1825" size="100,100">在公投前的最后时刻，工党突然松动了。4月中旬，工党党魁米利班德表示，这次公投“对英国相当重要”，并呼吁英国人民投下自己的一票，但没有明确支持任何一种投票制度。虽然工党内有一些资深党员呼吁保持旧制度，但是，一旦不满英国陈旧选举制度的年轻人被动员起来，那么排序复选制一方仍然有胜算。

到4月下旬民调截止前，许多民调都显示支持排序复选制的一方比例超过了维持现状的一方，然而8-10%的未决定选民仍然足以决定公投结果。帕克知道，这次公投某种意义上是她的信任投票——她希望自己不仅过关，而且这次公投可以成为英国的新黎明，她可以成为古老政治制度的破局者。

[[上帝保佑我们……-&gt;12.8]]</tw-passagedata><tw-passagedata pid="117" name="11.12" tags="end" position="4550,1825" size="100,100">5月5日来临前，帕克便知道自己的政治生涯估计要受到重创了——由于工党拒绝明确表态，民调显示支持排序复选制一方几乎毫无胜算。果不其然，在5月5日的投票中，支持排序复选制一方只获得了34.1%的得票，支持旧制度的则达到65.9%。

在此次公投失利后，帕克和自由民主党的声誉一落千丈。更糟糕的是，其对保守党的信任供给开始出现更大裂痕，而诸如是否要举行苏格兰独立公投、是否要举行英国脱离欧盟公投等问题更是几乎使整个党分裂。

2014年10月，由于支持率不断上涨，加之自由民主党内部的意见不一致经常导致保守党推行的法案陷入困境，首相卡梅伦决定在12月提前大选。尽管帕克抵挡住了部分党员要求临阵换帅的提议，但她知道这次选举中自由民主党已经完了——本来民调数据就很难看，苏格兰独立公投后，支持独立的苏格兰民族党更是进一步迅速分走了自由民主党的选票。在选举中，保守党获得330席，自由民主党则从57席骤减到8席。随后，保守党组建多数派政府，而海伦·帕克也知道，只剩下辞职一条路了。

当她重新成为后座议员后，一家小报用“她以为她是铁娘子”报道帕克领导下自由民主党四年来的失败。结果，帕克得到了“山寨铁娘子”或者“自封铁娘子”的绰号——虽然说实话，她可不像执政末期的撒切尔夫人一样决策失当、天怒人怨。观察者认为自由民主党可能从此一蹶不振。某种意义上，确实是这样的——2017、2019年大选中，自由民主党的选情都极其令人失望。

不过，这已经和帕克没关系了——2019年，她宣布不再谋求连任议员，结束政治生涯。退休后的帕克很少露面，也背负了“山寨铁娘子”这个实在不怎么好听的绰号。许多自由民主党党员不喜欢她，因为她先是放弃了竞选纲领，又领导了一场简直自取其辱的公投，任内也没什么成绩可言。一些人更是把自由民主党此后长期毫无起色的锅都全盘扣给她。一直到2024年，自由民主党重回议会第三大党，人们对她的口诛笔伐才少了一点。

她又能怎么办呢？只能扛下一切……



触发结局：
//(text-colour: red)[&#39;&#39;坏结局：“山寨铁娘子”&#39;&#39;]
&#39;&#39;海伦·A·帕克（1952.7.20-），自由民主党党魁（2007-2014），2010-2014年间因一连串不合理的决策或纯粹不走运，成为了自由民主党由盛转衰的关键人物——真的吗？难道一切都是她的错吗？&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="118" name="10.14" tags="" position="4675,1700" size="100,100">5月11日，海伦·帕克宣布自由民主党与保守党将组建联合政府；同日，布朗宣布辞去工党党魁和首相职务，卡梅伦成为首相，帕克成为副首相。然而，保守党政府很快就开始推动提高学校学费这一议题，导致自由民主党内部严重分裂。帕克不得不放弃这条竞选承诺，支持提高学费。2010年12月9日，在就调高学校学费上限的议案进行表决时，自由民主党有27人支持、21人反对，8人弃权。这次事故差点摧垮了自由民主党与保守党的合作关系。

不过，2010年7月，帕克拿出了自由民主党的杀手锏——她要求在当年举行一次公投，决定是否在英国议会选举中以排序复选制替代单议席单票制，以改变两党独大造成的得票率与获得议席不成比例的问题。新选举制度对保守党和工党不利，保守党也明确反对，因此问题是能否争取到工党的不反对。

公投时间最终被定在2011年5月5日。公投前两个月，民调显示支持改革一方居于显著劣势，支持率不超过40%；然而，预计投票率也很低，因此如果能动员年轻人参加投票，或许还有希望。帕克决定赌上一切，说服工党鼓励选民投票，以避免保守党动员民众投反对票，导致提案夭折。

然而，工党党魁米利班德很快便明确表示，他们不会呼吁民众支持或反对排序复选制——换言之，他们要和保守党一道扼杀改革选举制度的尝试。尽管自由民主党也动用一切资源（甚至包括帕克的个人积蓄），宣传排序复选制的优势并驳斥对这种制度的攻击，但宣传攻势无法改变排序复选制支持者比例很低的事实。

帕克知道，这次公投某种意义上是她的信任投票——而且，结果大概率是不信任。

[[等那一天来吧。-&gt;11.12A]]</tw-passagedata><tw-passagedata pid="119" name="11.12A" tags="end" position="4800,1825" size="100,100">5月5日来临前，帕克便知道自己的政治生涯估计要受到重创了——由于工党拒绝明确表态，民调显示支持排序复选制一方几乎毫无胜算。果不其然，在5月5日的投票中，支持排序复选制一方只获得了32.1%的得票，支持旧制度的则达到67.9%。

在此次公投失利后，帕克和自由民主党的声誉一落千丈。更糟糕的是，其对保守党的信任供给开始出现更大裂痕，而诸如是否要举行苏格兰独立公投、是否要举行英国脱离欧盟公投等问题更是几乎使整个党分裂。

2014年10月，由于支持率不断上涨，加之自由民主党内部的意见不一致经常导致保守党推行的法案陷入困境，首相卡梅伦决定在12月提前大选。尽管帕克抵挡住了部分党员要求临阵换帅的提议，但她知道这次选举中自由民主党已经完了——本来民调数据就很难看，苏格兰独立公投后，支持独立的苏格兰民族党更是进一步迅速分走了自由民主党的选票，在选举中，保守党获得330席，自由民主党则从57席骤减到8席。随后，保守党组建多数派政府，而海伦·帕克也知道，只剩下辞职一条路了。

当她重新成为后座议员后，一家小报用“她以为她是铁娘子”报道帕克领导下自由民主党四年来的失败。结果，帕克得到了“山寨铁娘子”或者“自封铁娘子”的绰号——虽然说实话，她可不像执政末期的撒切尔夫人一样决策失当、天怒人怨。观察者认为自由民主党可能从此一蹶不振。某种意义上，确实是这样的——2017、2019年大选中，自由民主党的选情都极其令人失望。

不过，这已经和帕克没关系了——2019年，她宣布不再谋求连任，结束政治生涯。退休后的帕克很少露面，也背负了“山寨铁娘子”这个实在不怎么好听的绰号。许多自由民主党党员不喜欢她，因为她先是放弃了竞选纲领，又领导了一场简直自取其辱的公投，任内也没什么成绩可言。一些人更是把自由民主党此后长期毫无起色的锅都全盘扣给她。一直到2024年，自由民主党重回议会第三大党，人们对她的口诛笔伐才少了一点。

她又能怎么办呢？只能扛下一切……



触发结局：
//(text-colour: red)[&#39;&#39;坏结局：“山寨铁娘子”（变体）&#39;&#39;]
&#39;&#39;海伦·A·帕克（1952.7.20-），自由民主党党魁（2007-2014），英国副首相（2010-2014）。2010-2014年间，因一连串不合理的决策或纯粹不走运，她成为了自由民主党由盛转衰的关键人物——真的吗？难道一切都是她的错吗？&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="120" name="12.8" tags="" position="4675,1950" size="100,100">2011年5月5日，帕克早早在自己的议会选区投了票，随后回到自由民主党党部。起初传来的消息并不乐观——在苏格兰和英格兰北部的许多选区，排序复选制的支持率只有40-45%。然而随后，英格兰中部和大伦敦地区的选举结果出炉，帕克自己也惊到了——在这些地区，许多选区录得了超过50%的支持率，大伦敦的几个选区甚至超过60%。许多去投票的年轻人称，自己厌倦了简单多数制，更厌倦了保守党和工党在民选得票并不超过50%的情况下，却连年占据过半议席，压制小党的生存空间，阻碍普通英国人表达自己的政治诉求。
(set: $special1 to &quot;election&quot;)
到这天晚上，公投结果基本出炉，帕克差点吓出了心脏病——这场政治豪赌竟然成功了。公投的投票率为58.5%，远超过预期；赞成者50.3%，反对者49.7%。当结果正式出炉时，她激动得和身边的幕僚紧紧相拥，并开了一瓶香槟庆祝。


2012年8月，议会通过《2012年议会投票和选区边界法》，正式在下次大选中引入排序复选制，重新划定选区边界，将下议院席位数量从650席降低到600席。

虽然2014年苏格兰独立公投后，支持独立的苏格兰民族党支持率大增，预计将把自由民主党挤出苏格兰绝大多数选区，同时英国是否脱离欧盟的问题也困扰着自由民主党，但帕克相信在新的选举制度下他们将取得更好的成果；民调显示，自由民主党的支持率达到创纪录的25%，在一些民调中甚至领先于工党。2015年3月30日，首相卡梅伦宣布解散议会并在5月7日举行大选。帕克相信，是时候证明她已经让英国实现真正变革了。

[[我对过去八年的领导满怀信心。上吧！-&gt;13.5]]</tw-passagedata><tw-passagedata pid="121" name="13.5" tags="end" position="4675,2075" size="100,100">在5月7日的大选中，近3500万英国选民投下了自己的一票，投票率高达75.6%。最终，保守党获得294席，工党171席，自由民主党80席，苏格兰民族党39席，其他政党16席。由于保守党未能达到绝对多数，帕克也拒绝再次支持保守党，因此卡梅伦不得不组建少数派政府。对于自由民主党，这毫无疑问是一次大胜。

在2017、2019年，自由民主党的选举结果有所起伏，但席位没有跌破60席。2019年议会选举前，年事已高的帕克宣布不再谋求连任自由民主党党魁，将这个职务让给了艾德·戴维。2024年，面对颜面尽失的保守党和满嘴空话的工党，许多英国选民决定把票投给自由民主党。结果，在全世界震惊的目光中，自由民主党一口气拿下131个议席，超过保守党的128席，直接成为了官方反对党。自此，英国政坛的两党优势制彻底被颠覆了。

作为自由民主党历史上任期最长的党魁（整整12年），海伦·帕克几乎可以说是该党最受欢迎的人物。她虽然不曾进入内阁，但她推动的英国选举制度大改革却从根本上改变了英国古老，或者说僵化的威斯敏斯特制，缔造了英国政治的里程碑。在许多英国人心中，她是一位相当受人欢迎、极具魅力的政治家，甚至被爱称为“帕克奶奶”。


或许，几代人以后的政治学人会把她的经历挑出来，单列一章讲述？



触发结局：
//&#39;&#39;(text-colour: yellow)[隐藏结局：“破局者”]
非常尊敬的海伦·A·帕克女爵士（1952.7.20-），自由民主党党魁（2007-2019）。英国政坛“第三势力”的代言人……以及古老的威斯敏斯特制的破局者。&#39;&#39;//

[[先别重开——恭喜你发现了劲爆彩蛋！]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="122" name="8.10" tags="" position="3100,1450" size="100,100">后来，帕克才知道当天晚上沙博夫斯基失言了，东德政府根本没打算马上开放边境，而是准备次日通知所有单位，然而刚刚度假回来的沙博夫斯基把假设的开放边境方案直接读了出来。但那已经不重要了。

1989年12月，帕克作为参赞被派驻英国驻苏联大使馆，并在那里见证了苏维埃国家从改革走向瓦解的历程。1990年11月7日，她观摩了苏联历史上最后一次十月革命阅兵式，并按照军情六处的指示，默默记下了阅兵式上出现的T-80UD坦克，准备汇报给十字路的总部——她肯定不会想到，不到一年后自己在莫斯科的街头又看到了那些坦克。


1991年12月25日晚，她和使馆的其余人庆祝圣诞节，但因为喝多了香槟而提前退场，微醺着回到了住处。时间是晚上7时35分。她擦了把脸，坐回桌前，看到大使馆对面的大克里姆林宫上空依旧飘扬着一面苏联国旗。她静静地坐了一会儿，看着那面红旗缓缓降下。7时45分，俄罗斯联邦三色旗在大克里姆林宫上空升起。

她见证了历史。

[[别了，这个不怎么可爱的国家。-&gt;9.12]]</tw-passagedata><tw-passagedata pid="123" name="9.12" tags="" position="3100,1575" size="100,100">冷战结束后，帕克先后被派驻到许多欧洲国家，几乎走遍了整个欧洲，并且仍然在为军情六处效力。1998年，她出任英国驻南非高级专员，2001年又被调回英国本土，任外交和联邦事务部经济和全球事务局长。2004年，她得到了一份出乎意料的任命——英国驻俄罗斯大使。

在俄罗斯的四年时光算是波澜不惊。曾经的英国大使馆如今变成了大使官邸，她每次从那间熟悉的房间望向克里姆林宫上空飘扬的俄罗斯国旗，都会不由得感叹这个世界的确是天翻地覆了。2007年，她被授予女爵士称号。

2008年，在她的大使任期结束前不久，她开始思考自己的下一步应该是什么。她一直希望继续为军情六处效力，也知道凭她的资历，成为秘密情报局局长是完全可能的。不过，她也完全可以选择进入上议院，同时担任外交事务顾问，辅佐未来的首相，或者外交和联邦事务大臣。

[[我已经等这个位置二十多年了！（军情六处）-&gt;10.15]]

[[每个首相都需要一位谋士。（顾问）-&gt;10.16]]</tw-passagedata><tw-passagedata pid="124" name="10.15" tags="end" position="3050,1700" size="100,100">2008年11月1日，海伦·帕克被外交和联邦事务大臣戴维·米利班德任命为秘密情报局局长，成为历史上第一位担任该职务的女性。2009年10月，在“伊拉克战争调查”中，她就英国政府在伊拉克战争中扮演的角色接受枢密院质询。叙利亚战争爆发后，她拟定了一项为反政府武装提供资金，建立一支5万人规模的部队以推翻巴沙尔·阿萨德的方案，但毫无悬念地被否决了。

2013年11月1日，帕克卸任秘密情报局局长一职，同时也离开了外交部。不久后，她获封(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]，进入上议院。在从军情六处退休后，她先后担任伦敦国王学院战争研究院客座教授、战略与国际研究中心（CSIS）研究员和BP（原英国石油公司）非常任董事。她同时还担任过特蕾莎·梅首相的外交和国家安全顾问，不过据说她并不喜欢和后者共事。

时至今日，她仍在为女王和国家服务。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“为了女王和国家”]
非常尊敬的(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]海伦·A·帕克（1952.7.20-），军情六处特工(if:$entrance is 1972)[（1972-2014）](if:$entrance is 1976)[（1976-2014）]，秘密情报局局长（2008-2013），英国上议院议员。一位凭运气和能力攀登到顶峰，迄今仍在为女王和国家服务的成功人士。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="125" name="10.16" tags="end" position="3175,1700" size="100,100">2009年，在从外务官队伍退休一年后，帕克成为影子外交和联邦事务大臣威廉·黑格的外交事务顾问，正式进入保守党核心圈。2010年大选后，保守党上台组阁，帕克也随之转正。2014年黑格卸任后，她继续为新任外相菲利普·哈蒙德担任顾问，直到2016年卡梅伦内阁因为脱欧公投决定脱离欧盟而总辞职。此后，帕克由于就脱欧问题与新任首相特蕾莎·梅产生分歧，离开了顾问岗位，转而回到大学和研究机构，开展讲座或撰写文章。

在七年的顾问生涯中，帕克先后经历了利比亚危机、叙利亚内战、克里米亚危机、英国脱离欧盟问题等各种外交事件，在很大程度上辅佐了黑格和哈蒙德。虽然在这期间保守党政府在外交事务上也不是一帆风顺，但至少帕克尽力了。一些人甚至认为，她实际上已经对保守党的外交政策产生了不小影响，并用《是，大臣》系列的汉弗莱和她作比较，称她才是真正掌控保守党政府外交事务的幕后人物。对于这种近乎捧杀的言论，帕克当然不会作答。

那么她又会怎么评价这七年的顾问生涯呢？或许《是，大臣》刻画的哈克与汉弗莱的关系的确相当准确——她许多时候的确扮演了类似汉弗莱的角色，只不过比汉弗莱弱势一些。或许用《是，外相》来概述这七年更合适些？



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“是，外相”]
海伦·A·帕克（1952.7.20-），英国驻俄罗斯大使（2004-2008），两任外交和联邦事务大臣的外交事务顾问。一位卓越的外交官，一位杰出的谋士与幕僚。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="126" name="结局名称是不是有点怪？先来看彩蛋" tags="" position="1650,1950" size="100,100">由于其领导风格严苛、强硬，又有一副强烈的贵族气派，而且在任内多次指挥开展高难度、高风险的特种行动，早在帕克担任秘密情报局情报处长时，就有许多人用“没有情感的女人”称呼她。

2009年她成为秘密情报局局长后，一些同时对情报界和《星球大战》文化有了解的爱好者忽然发现，《星球大战》衍生宇宙小说中有一位角色似乎和帕克有些相似——伊莎恩·艾萨德（Ysanne Isard）。艾萨德在杀害了自己的父亲后成为帝国情报局局长，并在帕尔帕廷皇帝死后成为帝国事实上的统治者。在和帝国崩溃后的军阀，以及新共和国斗争了许多年后，艾萨德最终败下阵来，在尝试夺回自己的超级歼星舰“卢桑基亚”号时被击毙。

根据设定，艾萨德因帝国情报局局长的职位和冷酷无情的性格而获得了&quot;Iceheart&quot;（“冷心”）的称号。一些产生了无端联想的爱好者遂将这个绰号移植给了海伦·帕克。这起初只是极少数geek之间的笑谈，然而在2014年帕克卸任没多久后，一篇回顾她生平的文章赫然使用了“冷心”这个绰号。结果，这个小圈子自娱自乐的绰号就这样传开了，不少人真的就管帕克叫海伦·A·“冷心”·帕克。

（注1：出现这个彩蛋，是因为本游戏的作者是个资历不算浅的星战爱好者，并且翻译过以艾萨德为反派的《X翼》系列小说《艾萨德的复仇》，遂发挥想象力无端联想了一下。）

（注2：本游戏作者对于译名这种东西非常纠结，&quot;Iceheart&quot;按照国内星战圈通行译法是”冰心“，但作者认为这种译法不太合适，遂使用”冷心“这个词。）
(set: $extra to $extra +1)
[[~~重开吧~~-&gt;Start]]</tw-passagedata><tw-passagedata pid="127" name="先别重开——恭喜你发现了劲爆彩蛋！" tags="" position="4800,2075" size="100,100">如果各位玩家玩到了其他结局，或是还记得这个结局的开端，会发现文本内容一直没有提帕克有没有结婚。是的，作者并非无意为之！

很长一段时间里，帕克都是单身。起初，绝大多数人都以为，这只是因为她是个对自己的事业极其投入的女强人，因此没怎么在意。然而，当她进入议会后，开始有人质疑她的性取向——她没有结婚，虽然在议会支持同性婚姻，但那似乎更多是因为这是自由民主党竞选纲领的一部分。而被问及这个问题时，她始终保持缄默，并要求记者不要对她的私生活说三道四。当然，这并不能止住各种流言蜚语，包括但不限于一些八卦小报称她是同性恋。

然而，2015年7月，刚刚连任议员的帕克公布了一个惊人的消息——&#39;&#39;她的确是女同性恋&#39;&#39;，并且已经和自己的伴侣（一位大学同窗）正式结婚。在《太阳报》开始以此为题炒作舆论后，她表示此前闭口不提此事是因为不想把私生活带到公共场域讨论，并且她认为在同性婚姻尚未合法化之前公开此事”无论如何都不合适“。这一事件对自由民主党的支持率并无太大影响，不过的确让不少英国民众有了茶余饭后的谈资。

无论如何，她能把这件事瞒这么久，倒也说明她确实有两把刷子。
(set: $extra to $extra +1)
[[~~请放心，无论您重玩这游戏几遍，这个彩蛋只会在这里出现。其他结局里她一定不是女同。~~-&gt;Start]]</tw-passagedata><tw-passagedata pid="128" name=" 7.2A" tags="" position="2775,1325" size="100,100">1979年，年仅27岁的帕克决定竞选下议院议员。虽然卡拉汉的工党政府因“不满的冬天”而受到巨大冲击，工党的支持率也被保守党拉开，但帕克相信她能在(if: $birth is 1)[南爱丁堡](if: $brith is 2)[哈默史密斯]取得胜利。作为一位当地的新起之秀，帕克已经参与了两年多的政治活动，并成为了地方议会议员，前途似乎一片大好，她年轻的特质预计也会让选民对充斥着“老头子”的工党耳目一新。
(set: $vocation to &quot;poli&quot;)
(if: $birth is 1)[然而，帕克最终扑了个空——她以34%的民选得票败于得票率39%的保守党候选人，未能当选。在蒙受了一次失败后，她回到本职工作，同时兼任当地工党支部的产业政策研究顾问。1983年大选中，帕克在一场相当艰难的选战中击败四年前的同一位保守党候选人，顺利当选下议院议员。](if: $birth is 2)[经过一场悬念不算太大的选战，帕克最终当选下议院议员。然而，1979年大选标志着保守党的长期执政岁月开始，玛格丽特·撒切尔成为了英国首相。1983年大选中，由于工党竞选纲领的失误，以及马岛战争胜利和经济复苏对保守党政府带来的巨大增益，保守党毫无悬念地获得绝对多数，帕克则在一场相当艰难的选战后才保住了自己的席位。选举结果出炉后，工党党魁迈克尔·富特引咎辞职，尼尔·基诺克（Neil Kinnock）接替了党魁一职。]

1983年大选后，帕克开始反思党魁迈克尔·富特领导下工党的政策究竟意味着什么。富特主张英国退出北约、单方面核裁军、废除上议院、维持工党党章第四条关于公有制的条文，这些政见完全不能吸引中间派，甚至吓跑了许多选民，导致他们在1983年支持温和左翼的自由党-社会民主党联盟。接受过良好教育，某种意义上也和工人阶级疏远的帕克深知，富特的领导会摧毁工党，这个老党必须采取更加温和的立场。

更关键的是，在这年大选中，两位和她年龄相仿的工党政客也进入了议会——托尼·布莱尔和戈登·布朗。
(set: $preevent to &quot;7.2A&quot;)
[[如果能让工党革新一下就好了……-&gt;8.9]]</tw-passagedata><tw-passagedata pid="129" name="8.2" tags="" position="3975,1450" size="100,100">1992年大选前，帕克最终接受了保守党的提议，(if: $party is &quot;neutral&quot;)[加入保守党，]竞选下议员并顺利当选。此后五年中，她在(if: $entrancetopolitics is &quot;thinktank&quot;)[保守党研究部](if: $entrancetopolitics is &quot;null&quot;)[下议院财政和内政事务特别委员会]工作。
(set: $party to &quot;con&quot;)
然而，帕克日后对加入保守党的决定有些后悔——因为在1997年大选中，托尼·布莱尔带领工党获得大胜，开启了一个“新工党”的时代，也意味着她在很长一段时间中和内阁职务无缘了。保守党在大选中失利后，新任党魁威廉·黑格破格任命几乎没有行政岗位任职经验的她为影子就业大臣，成为影子内阁最年轻的成员之一。出乎意料的是，帕克在这个岗位上做得很好，也因此在2001年大选后成为影子环境、食品和郊野大臣。2005年大选后，党魁迈克尔·霍华德辞职，而她被认为完全有潜力和另一位潜在党魁——戴维·卡梅伦掰掰手腕。

在党魁选举前两个月，卡梅伦找上她，向她开出价码：如果她选择不竞选党魁，那么他将任命她担任影子财政大臣一职。显然，卡梅伦希望利用他年富力强的特质吸引选民，而帕克做不到这一点。

帕克知道这个决定足以影响她的政治生涯。
(set: $luck to (random:1,100))
(if: $luck is &gt;= 66)[[[卡梅伦有多少经验？他比得上我吗？（竞选）-&gt;9.13]]](if: $luck is &lt; 66)[[[卡梅伦有多少经验？他比得上我吗？（竞选）-&gt;9.13A]]]

[[妥协是为了更大的胜利。（不竞选）-&gt;9.14]]</tw-passagedata><tw-passagedata pid="130" name="9.14" tags="" position="3975,1575" size="100,100">帕克思前想后，接受了卡梅伦的提议，没有参加党魁选举。卡梅伦当选保守党党魁后，信守承诺，任命她为影子财政大臣——她在这个岗位上一待就是近五年。

2010年5月6日的大选中，保守党取得306席，工党取得258席，均没有达到绝对多数。经过五天的拉锯式谈判，保守党最终笑到最后——他们将与自由民主党组建联合政府。5月12日，卡梅伦入主唐宁街10号，成为英国首相，而帕克也随之成为英国第一位女性财政大臣。

[[唐宁街12号……也不错。-&gt;10.19]]</tw-passagedata><tw-passagedata pid="131" name="9.13" tags="" position="4100,1575" size="100,100">最终，帕克没有接受卡梅伦的提议，决心竞选党魁。经过两轮投票，帕克最终在12月6日以微弱优势击败卡梅伦，当选保守党党魁。在当选后，她随即大规模调整影子内阁人事任命，出乎意料地将影子外交和联邦事务大臣这一重要职务交给了卡梅伦。

2007年布莱尔辞去首相职务前，帕克曾呼吁提前大选，但工党最终没有解散议会提前选举。时间来到2010年，工党已经因全球金融危机和连续的丑闻而陷入困境，然而民调显示其支持率并不低，大选很有可能会产生悬峙议会。

2010年5月6日的大选中，保守党取得306席，工党取得258席，均没有达到绝对多数。经过五天的拉锯式谈判，保守党最终笑到最后——他们将与自由民主党组建联合政府。5月12日，海伦·帕克入主唐宁街10号，成为英国首相。

[[开始工作吧，先生们。-&gt;10.17]]
</tw-passagedata><tw-passagedata pid="132" name="9.13A" tags="" position="3850,1575" size="100,100">最终，帕克没有接受卡梅伦的提议，决心竞选党魁。然而，虽然她成功晋级第二轮投票，但她也止步于此，卡梅伦最终成为了新任保守党党魁。在选举结果出炉后，帕克显然失去了进入影子内阁的机会，被任命为保守党主席，负责党的行政并监督保守党竞选总部。

2007年，她设法卷土重来，不过仍然没能走到台前——她被任命为保守党研究部总监。虽然历史上许多首相都曾担任过这个职务，(if: $entrancetopolitics is &quot;thinktank&quot;)[她十五年前也在这里工作过，]但帕克却认为这只是在安慰她罢了。2010年5月6日的大选中，保守党取得306席，工党取得258席，均没有达到绝对多数。经过五天的拉锯式谈判，保守党最终笑到最后——他们将与自由民主党组建联合政府。5月12日，卡梅伦入主唐宁街10号，成为英国首相。同一天，卡梅伦出乎意料地任命她为第一任英国国家安全顾问，即新成立的国家安全委员会的秘书。

[[不是最想要的职务，不过也不错……-&gt;10.18]]</tw-passagedata><tw-passagedata pid="133" name="10.17" tags="" position="4100,1700" size="100,100">上任之后，帕克面临严重的预算赤字，又要推动提高大学学费、选举制度改革公投，同时苏格兰前途问题和英国去留欧盟问题也都浮出水面。尽管其余问题在内阁成员的辛苦工作下得到缓解，但最终，她还是不得不面对英国去留欧盟问题这个烫手山芋。

在不少保守党议员的施压下，帕克在2013年1月发表演讲，承诺只要保守党在2015年大选中获胜，政府就会在2017年底前举行关于英国是否应退出欧盟的全民公投。帕克和她的内阁基本都支持留在欧盟，但保守党内存在不小的支持脱离欧盟的声音——稍有不慎她就可能跌个粉身碎骨。

2015年大选后，帕克政府信守诺言，开始推动以全民公投形式决定英国是否脱离欧盟。2015年12月17日，《2015年欧盟公投法案》获得御准，该法案规定将在2016年6月23日举行公投。此时，保守党内部出现了分裂——以帕克为代表的建制派支持留在欧盟一方，但刚刚进入下议院的前大伦敦市长鲍里斯·约翰逊却支持脱欧。更糟糕的是，约翰逊的出场导致保守党内部的矛盾公开化，脱欧阵营实力大幅增强。

帕克当然支持留在欧盟，但她希望通过谈判为英国争取更多自主权和利益。然而，随着脱欧阵营的支持率越来越高，她开始感到担忧。她知道脱离欧盟意味着对英欧关系的重构，其造成的潜在影响不可小觑——而且，她要为此承担政治责任，如果公投决定脱欧，她肯定要宣布辞职。

但是，她也可以赌一把——玩点阴招。
(set: $luck to (random:1,100))
[[还能怎么办呢？我们必须遵从公投结果。-&gt;12.11]]

(if: $luck is &lt;= 66 )[[[不行。我要靠自己的力量阻止愚蠢的民粹主义得逞。-&gt;12.12A]]](if: $luck is &gt; 66 )[[[不行。我要靠自己的力量阻止愚蠢的民粹主义得逞。-&gt;12.12]]]</tw-passagedata><tw-passagedata pid="134" name="10.18" tags="" position="3850,1700" size="100,100">虽然顾问职务起初并不艰难，但当更多外交问题浮出水面后，帕克和卡梅伦内阁的高官之间的矛盾就愈发显著了。2012年，“英国是否应退出欧盟”逐渐成为英国政治的一个重大议题。在不少保守党议员的施压下，卡梅伦在2013年1月发表演讲，承诺只要保守党在2015年大选中获胜，政府就会在2017年底前举行关于英国是否应退出欧盟的全民公投。

然而，出身上流社会的帕克坚决反对任何形式的脱欧或脱欧尝试，尤其是全民公决，因为在她眼里这是一种民粹主义，是将英国的命运交到容易被蒙蔽和蛊惑的民众手中。然而，如果完全由议会决定是否脱欧，保守党内部就会首先发生分裂。另一方面，她自己也倾向于留在欧盟，一方面是英国在欧盟中可以获得更多利益，另一方面也认为维持不完美的现状相比大动干戈更加合适。

这种两难境地一直持续到2015年大选后，《2015年欧盟公投法案》即将提交议会表决前夕。此时，内阁已经有不少人对她不满意了。她意识到自己的立场是两头不讨好——虽然卡梅伦支持留在欧盟，但他也支持以公投形式决定这个问题，至于以鲍里斯·约翰逊为代表的保守党另一派势力则干脆支持脱欧。

她知道这部法案会毫无悬念地通过——因此她也只剩一条路了。

[[还能怎么办？回家看戏吧！-&gt;11.14]]</tw-passagedata><tw-passagedata pid="135" name="11.14" tags="end" position="3850,1825" size="100,100">2015年12月17日，《2015年欧盟公投法案》获得御准的同一天，帕克辞去了顾问职务，称自己“无法干下去了”。在沉寂了一段时间后，她重新站出来支持留欧一方，但这显然对于大局没什么影响——2016年6月23日，51.9%的英国选民支持英国脱离欧盟。

在离开政坛后，帕克(if: $entrancetopolitics is &quot;thinktank&quot;)[除了回到智库，还]成了一位专栏作家，经常给《每日电讯报》和《泰晤士报》撰稿。她自称经过这么多年，自己已经不习惯站在聚光灯下了，因此更愿意从事一些幕后工作，继续运用一生中积攒的思想成果影响这个世界。这或许是某种对她政治生涯的盖棺定论——她(if: $entrancetopolitics is &quot;thinktank&quot;)[从独立智库而非保守党内开始政治生涯，]从未担任过大臣，在影子内阁和顾问岗位上流转，自己也从未掌握过权力，在一生最重要的权力斗争中则败于年轻的对手。

但既然她泰然处之，那也没什么好惋惜的……吧？



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“如影随形”]
海伦·A·帕克（1952.7.20-），影子就业大臣（1997-2001），影子环境、食品和郊野大臣（2001-2005），国家安全顾问（2010-2015）。(if: $entrancetopolitics is &quot;thinktank&quot;)[从智库走出的]她就像一个影子，始终潜伏在政坛的水面之下，或是渴望权力而不得，或是默默履行自己的责任。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="136" name="10.19" tags="" position="3975,1700" size="100,100">作为财政大臣，帕克上任后面临极高的预算赤字，因此必须尽快削减政府支出。她上任后立即采取的行动有两个，即设立预算责任办公室和进行政府范围的支出审查。2011年初，她声称要对英国的预算赤字进行“撒切尔式”的削减。

然而，不久后帕克就开始遭到舆论和反对党的连番炮轰。首先，她将高收入者的所得税率从50%削减到45%，随后又在2012年提出要对热食品（比如肉派）额外征税，结果这种税得到了“肉派税”的称呼。此举导致中下层民众强烈反弹，而她当年提交的政府预算案被反对党领袖艾德·米利班德斥责为“一片混乱”。“肉派税”很快成为了她政治生涯中不光彩的一笔(if: $birth is 2)[——不少民众抨击她作为一个富家出身的女子，“肯定从来没亲自去Greggs（一家连锁饼店）买过肉派”]。

2013年年中，英国经济开始回升，这提振了帕克的公众认可度；到2015年3月，年度赤字减少到最初目标的一半左右，但国债与GDP的比率仍在上升。然而，帕克使用的降低赤字的方式几乎是饮鸠止渴——在新的预算案下，警方获得的资金遭到削减，造成英国警察总人数下降，国内恐怖主义威胁大幅增加。同时，社会保障体系、英国军队都受到不同程度的预算削减。

幸运的是，帕克的政治生涯似乎没有受到太大影响——2015年大选前，卡梅伦计划让她继续担任财政大臣。但真正的挑战还没有到来。

[[什么？还有高手？-&gt;11.15]]</tw-passagedata><tw-passagedata pid="137" name="11.15" tags="" position="3975,1825" size="100,100">2015年大选后，卡梅伦政府开始推动以全民公投形式决定英国是否脱离欧盟。2015年12月17日，《2015年欧盟公投法案》获得御准，确认了英国将会以全民公投形式决定是否留在欧盟。到次年2月，政府宣布将在2016年6月23日举行公投。此时，保守党内部出现了分裂——以卡梅伦为代表的建制派支持留在欧盟一方，但刚刚进入下议院的前大伦敦市长鲍里斯·约翰逊却支持脱欧。更糟糕的是，约翰逊的出场导致保守党内部的矛盾公开化，脱欧阵营实力大幅增强。

帕克当然支持留在欧盟，但她希望通过谈判为英国争取更多自主权和利益。然而，随着脱欧阵营的支持率越来越高，她和首相卡梅伦都开始感到担忧。不过，出于自己的利益考虑，她一直没有站出来支持留欧。

2016年初，卡梅伦私下见了帕克，希望她站出来公开支持留欧，并认为如果不让英国民众充分明白脱欧可能造成的巨大风险，否则脱欧阵营有较大概率胜出——这样一来，他不仅要辞职，英国也要为通过谈判脱离欧盟而陷入经年累月的拉锯战，到时候对英国经济的负面影响只会更大。

然而，帕克转念一想：如果她不站出来，故意保持态度模糊，那岂不是……自己就能在卡梅伦走后竞争首相的宝座了？

[[你疯了？为什么你会想背叛你的首相？-&gt;12.9]]

[[抱歉，戴维。人人为己。-&gt;12.10]]</tw-passagedata><tw-passagedata pid="138" name="12.9" tags="end" position="3850,1950" size="100,100">帕克最终乖乖按照卡梅伦的指示，为留在欧盟摇旗呐喊。然而，事实证明脱欧派最终借着后真相政治的东风击败了留欧派——2016年6月23日，51.9%的英国选民支持英国脱离欧盟。

在公投结果出炉后的第二天，卡梅伦决定为公投失败承担全部责任，并宣布将辞去党魁和首相职务。许多人对帕克感到惋惜——作为一位评价还算中规中矩的财政大臣，如果她没有站出来支持留欧，她很有可能竞争下一任保守党党魁，并成为首相。然而，她公开支持留在欧盟，就决定了她要和卡梅伦一道承担政治责任。最终，没有明确表态的内政大臣特蕾莎·梅成为新一任首相。

7月13日特蕾莎·梅就职前，帕克被解除了财政大臣的职务，重新当起了后座议员。2019年大选后，帕克结束议员生涯，回到企业界，同时也开始为《泰晤士报》撰写文章。她从未对支持留欧一事表示后悔，称她做了自己应该做的事。不过，她对特蕾莎·梅之后的所有保守党首相评价都不高，2022年末更是公开称莉兹·特拉斯是个“笑话”，引发了保守党内不少人的反弹。



虽然时至今日帕克在英国已经没什么名气，但许多保守党支持者和留欧派仍然认为她是一位称职的财政大臣。她的六年任期虽然充满了危机，但她基本都应付得来。当然，中下层百姓对这位出身上流社会的“切尔西小姐”一直没什么好感，对她明显对富人有利的财政政策颇有微词。

不过，以上两种观点和她卸任时得到的绰号并不冲突：“唐宁街12号的女主人”。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“唐宁街12号”]
海伦·A·帕克（1952.7.20-），影子财政大臣（2005-2010），财政大臣（2010-2016）。或许比不上戈登·布朗，但至少中规中矩，并能在时代洪流中全身而退。单这一点就比不少政客强到不知道哪里去了。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)

</tw-passagedata><tw-passagedata pid="139" name="12.10" tags="" position="3975,1950" size="100,100">经过慎重考虑，帕克决定保持沉默，从未公开支持留欧，只是表示自己“尊重英国民众的抉择”。她渴望权力的一面告诉她，事实证明，她哪怕在公开场合支持留欧，可能也没什么影响——2016年6月23日，51.9%的英国选民支持英国脱离欧盟。

在公投结果出炉后的第二天，卡梅伦决定为公投失败承担全部责任，并宣布将辞去党魁和首相职务。舆论很快关注起谁有可能成为下一任首相，并很快将目光锁定在特蕾莎·梅和海伦·帕克身上。两人都是内阁重臣，帕克的年资略高一些，至于政绩和争议则大抵相同。因此，这场党魁选举没什么悬念——7月13日，帕克当选保守党党魁和新一任英国首相。

[[从12号搬到10号，感觉会如何？-&gt;13.6]]</tw-passagedata><tw-passagedata pid="140" name="13.6" tags="" position="3975,2075" size="100,100">事实证明，帕克面临的是脱欧导致的十足的烂摊子。10月2日，她在伯明翰出席保守党党大会前接受英国广播公司专访，首度确认英国将于2017年3月底前启动脱欧程序。2017年3月28日，她向欧盟理事会主席图斯克去信，决定按照《里斯本条约》第50条启动脱欧程序，将在2019年3月29日前脱离欧盟。然而，脱欧谈判中北爱尔兰边界问题和直布罗陀问题两项最严重的问题很快浮出水面。

2017年6月8日，英国举行议会提前选举。帕克原本希望通过这次选举扩大保守党在议会的优势，结果保守党却反而未能获得绝对多数，不得不在民主统一党信任供给下执政。帕克坚持“协议脱欧”，并且认为只有她能带领英国政府和欧盟达成协议，但2018年11月公布的协议草案在北爱边界问题上却极其模糊，并要求英国在2019年3月29日至2020年12月31日间留在欧洲关税同盟，导致保守党内无协议脱欧派，甚至部分内阁成员都对她的支持产生动摇。同时，民主统一党反对她对北爱边界的处理方式。

2019年1月15日，下议院以极其悬殊的202票赞成、432票反对，否决了英国脱欧协议草案。次日，工党领袖科尔宾提出对帕克的不信任动议，但以306票赞成、325票反对被否决。

经历此次失败后，帕克被迫向欧盟提出延迟脱欧限期至同年6月30日。然而在3月12日，英国下议院投票再次以391票反对、242票支持的投票结果否决了英国政府与欧盟达成的修改后的脱欧协议。第二天，下议院投票表决，最终宣布英国将完全排除无协议脱欧，以防英国在3月29日没有任何协议的情况下退出欧盟。

面对这种情况，帕克知道自己的政治生涯快要结束了——她无法达成一份下议院可以接受的脱欧协议，并且面临着失去议会支持的现实风险。5月23日，她召集全部内阁成员，感谢他们过去三年来的服务，也表示自己已经无法继续担任首相一职。

[[把烂摊子交给其他人吧。-&gt;14.5]]</tw-passagedata><tw-passagedata pid="141" name="14.5" tags="end" position="4100,2200" size="100,100">5月24日，海伦·帕克宣布因无法与下议院就英国脱欧协议达成一致，她将辞去保守党党魁职务，并担任看守政府首相直到新一任党魁选出。7月23日，保守党最终选出脱欧派鲍里斯·约翰逊担任党魁。约翰逊不久后便提前举行议会选举，最终在赢得大选后，于2020年1月24日通过脱欧协议，并于1月31日使英国正式退出欧盟。

结束首相任期后，帕克继续担任了五年的后座议员。她并不喜欢约翰逊，尤其是在2021年末，约翰逊被曝光在新冠疫情时期违反防疫规定开派对，并且故意误导议会后，她抨击约翰逊“不诚实、不可信”，后来更是称莉兹·特拉斯“是个笑话”，以至于一度徘徊在被保守党开除的边缘。2024年，她宣布不再谋求连任下议员，也谢绝了女爵士头衔，宣布退隐。

时至今日，帕克在英国人心中已经没多少名气，她的三年首相任期被认为相当碌碌无为，甚至没什么值得说道的亮点。虽然她对当初不支持卡梅伦并不感到遗憾——说实话，支不支持，脱欧公投结果可能都一样——但她确实对当初谋求成为首相感到有些遗憾。某种意义上，她从来都没有准备好在当时临危受命。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“过渡选项”]
海伦·A·帕克（1952.7.20-），影子财政大臣（2005-2010），财政大臣（2010-2016），英国首相（2016-2019）。作为财政大臣，她中规中矩；作为首相，就没这么幸运了。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="142" name="12.11" tags="end" position="4350,1950" size="100,100">虽然帕克多次站出来为留欧摇旗呐喊，但脱欧派最终借着后真相政治的东风击败了留欧派——2016年6月23日，51.9%的英国选民支持英国脱离欧盟。在公投结果出炉后的第二天，帕克决定为公投失败承担全部责任，并宣布将辞去党魁和首相职务。经过并不漫长的等待，最终，从未明确表态支持留欧的内政大臣特蕾莎·梅成为新一任首相。

在结束首相任期后，帕克获封(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]爵位，进入上议院。虽然帕克任内没有特别多的功绩，支持率也始终不算太高，但这并不妨碍她获得“蓝女士”（Blue Lady）的绰号——这指的是她的蓝眼眸、标志性的蓝黑色西装外套，以及代表保守党的蓝色。

虽然帕克任内没有什么值得称道的成绩，在脱欧一事上也以失败告终，但某种意义上，和为了脱欧僵持三年而一事无成的特蕾莎·梅、大搞民粹主义还欺骗议会的鲍里斯·约翰逊、完全是个笑话的莉兹·特拉斯相比，帕克已经算是个幸运儿了。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“蓝女士”]
非常尊敬的(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]海伦·A·帕克（1952.7.20-），影子财政大臣（2005-2010），英国首相（2010-2016）。虽然缺少政绩、没能使英国留在欧盟，但至少她触及了权力巅峰，公众形象也比她之后的保守党首相好不少。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="143" name="12.12" tags="" position="4225,1950" size="100,100">由于按照英国法律，负责国内安全的军情五处（英国安全局）是内政部下属的机构，军情六处（秘密情报局）则是外交部的下属机构，因此帕克只能通过自己的人脉开展这场“黑色行动”。

在苦思冥想了很长时间后，她开始求助于自己的心腹幕僚，后者建议她达成某种“魔鬼的交易”。于是，她将目光投向自己的外交和联邦事务大臣，已经在她内阁中任职近六年的戴维·卡梅伦。卡梅伦某种意义上是她的推定接班人，和她立场最为一致，并且年富力强。

2016年2月，在正式宣布脱欧公投的时间前不久，她和卡梅伦在牛津秘密会面。她抛出了一个相当惊人的方案——要求卡梅伦和她一道压制保守党内的脱欧派，确保脱欧公投以留欧告终，同时还要避免保守党内部分裂。在公投后，她将宣布举行提前大选，并且不会寻求连任党魁，但她会在幕后支持他。同时，她要求卡梅伦动用军情六处的资源，帮助他们实现这个目标。

卡梅伦最终同意了。但他和她都知道，这个方案危险重重。稍有不慎，他们就会被暴露在光天化日之下，引发一场英国版的水门事件。但为了确保一个稳定的联合王国，这么做或许是必须的。

卡梅伦还决定尽自己所能向她提供意见——她告诉帕克，他感觉得到司法大臣迈克尔·戈夫已经从留欧派转向脱欧派。为了确保内阁的意志一致，他应当被踢出去。帕克也同意了。

[[上帝保佑我们。-&gt;13.8]]</tw-passagedata><tw-passagedata pid="144" name="12.12A" tags="" position="4100,1950" size="100,100">由于按照英国法律，负责国内安全的军情五处（英国安全局）是内政部下属的机构，军情六处（秘密情报局）则是外交部的下属机构，因此帕克只能通过自己的人脉开展这场“黑色行动”。

帕克起初从BBC下手——2014年苏格兰独立公投前，有不少舆论称BBC偏袒留在英国一方并进行了有偏见的报道。然而这次，BBC并没有如她所愿倒向留欧一方。虽然BBC指出移民问题并不会随着脱欧自动解决，脱欧也并不一定能通过减少欧盟的官僚主义对英国的影响，增加英国人的工作岗位，但这些宣传似乎并不如保守党内部强大的支持脱欧的声音来得有效。

到2016年4月，民调结果显示脱欧派和留欧派没有明显差距，且不同民调经常产生差别很大的结果。此时，帕克终于意识到了真正的大麻烦是什么——在英国主要政党中，明确支持脱欧的实际上只有极右翼的英国独立党，而保守党是唯一一个保持中立的政党。但是，正是这一点导致保守党内部的留欧派和脱欧派拼命互相争夺领导权，导致保守党陷入内斗。

而最致命的是，此时再下场已经晚了，而且她也没有能力冒着导致保守党分裂的风险，宣布这个党支持留欧。

[[好吧，我们走着瞧……-&gt;13.7]]
</tw-passagedata><tw-passagedata pid="145" name="13.7" tags="end" position="4100,2075" size="100,100">2016年6月23日，51.9%的英国选民支持英国脱离欧盟。在公投结果出炉后的第二天，帕克决定为公投失败承担全部责任，并宣布将辞去党魁和首相职务。经过并不漫长的等待，最终，从未明确表态支持留欧的内政大臣特蕾莎·梅成为新一任首相。

在结束首相任期后，帕克获封(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]，进入上议院。虽然帕克任内没有特别多的功绩，支持率也始终不算太高，但这并不妨碍她获得“蓝女士”（Blue Lady）的绰号——这指的是她的蓝眼眸、标志性的蓝黑色西装外套，以及代表保守党的蓝色。

虽然帕克任内没有什么值得称道的成绩，在脱欧一事上也以失败告终，但某种意义上，和为了正式脱欧僵持三年而一事无成的特蕾莎·梅、大搞民粹主义还欺骗议会的鲍里斯·约翰逊、完全是个笑话的莉兹·特拉斯相比，帕克已经算是个幸运儿了。

再怎么说，帕克能把自己干过的脏活全都藏在幕后，其他人做得到这一点吗？



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“蓝女士”（变体）]
非常尊敬的(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]海伦·A·帕克（1952.7.20-），影子财政大臣（2005-2010），英国首相（2010-2016）。虽然缺少政绩、没能使英国留在欧盟，但至少她触及了权力巅峰，公众形象也比在他之后的保守党首相好不少——当然，这是因为她成功把自己干过的脏活压住了。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="146" name="13.8" tags="" position="4225,2075" size="100,100">2016年3月4日，在司法大臣迈克尔·戈夫一份批评内阁“举棋不定”的演讲稿遭到泄露后，帕克马上将他开除出了内阁。虽然戈夫马上站到了脱欧阵营，然而随之而来的舆论攻势——包括但不限于抨击他早些年担任教育大臣时的各种错误决策，以及担任下议院党鞭长时的各种出丑——仍然导致这位脱欧阵营的关键人物在政坛上影响力大减。

4月，在为《太阳报》撰写的一篇文章中，鲍里斯·约翰逊回应了奥巴马总统认为英国应该留在欧盟的评论，称奥巴马为“半个肯尼亚人”并且对英国有“源自祖先的厌恶感”。文章发布后很快引发轩然大波，一些保守党议员称这种言论是“愚蠢”和“极具冒犯性的”。帕克虽然从未对此公开表态，但不久后便称“有一些人正意图通过煽动恐慌、诉诸仇恨来促使英国民众做出不理性的决定。我们希望英国民众谨慎地考虑去留欧盟的问题，并意识到，如果我们脱离欧盟，对现状的改动将比选择留在欧盟但进行法律改革更加困难”。

2016年5月，帕克和卡梅伦先后碰上了两项利好：其一是军情六处自3月开始的行动产生了效果，争取到了一批欧洲议会议员反对英国脱离欧盟的表态，在英国国内也产生了影响；其二便是，帕克推动内阁，基于当年2月19日欧盟理事会一致通过的英国重新谈判欧盟会籍方案，提出了一份新方案。这份更加完善的方案重申，只要英国民众投票留在欧盟，英国就能完全具备欧盟各项法律规定的选择退出权。这样一来帕克就有能力表示，英国即使在欧盟框架下，也能获得“充分且全面的主权”，进而遏制了疑欧派对英国国家主权在欧盟框架下遭削弱和剥夺的质疑。

到2016年6月，长期支持脱欧的保守党议员雅各布·里斯-莫格（Jacob Rees-Mogg）被爆出丑闻，进一步导致脱欧阵营受到挫败。此时，绝大多数民调显示留欧派相对脱欧派有3-5%的优势——然而，如果考虑到尚未表态的中间选民，可以说公投究竟会产生什么结果，仍然是绝对的未知数。

6月23日的第一缕阳光出现在伦敦的地平线上。

[[来吧，朋友们。不成功便成仁。-&gt;14.6]]</tw-passagedata><tw-passagedata pid="147" name="14.6" tags="" position="4225,2200" size="100,100">在6月23日晚计票结果全部出炉的一刻，帕克终于知道，自己的豪赌成功了。51.1%选民支持留在欧盟，48.9%反对，因此，英国将留在欧盟。尽管对于要怎么解决英国与欧盟关系问题并没有多少头绪，保守党会不会出现后座议员叛变也没有定数，但帕克知道，至少她能给英国人民留下一个坚强、无畏的女强人形象。
(set: $special1 to &quot;brexit&quot;)
2016年12月21日，欧洲议会通过英国重新谈判欧盟会籍得出的新条款，引入“红牌”机制，即欧盟理事会可以以55%多数，提醒欧洲议会对某一事项的立法存在争议并应当加以修改。这一机制的目的是使某些争议事项并不由欧盟立法决定，而是交给各成员国的立法机关加以处理。新条款同时还包括“急刹车”机制，允许欧洲理事会授权“移民流入量过大”的国家限制新移民可享有的社会福利，最长为期四年；增加各成员国驱逐有欧盟国籍的罪犯的权力；允许非欧元区国家自愿加入或执行欧元区国家通过的财政政策，并避免欧元区国家将由他们通过，但与非欧元区国家不相干的欧盟政策加诸于后者之上。

虽然欧盟在英国脱欧公投后迈出了新的一步，但帕克的政治生涯也基本到此为止了。由于保守党内部脱欧派的不满，帕克开始面临后座议员叛变的危机。2017年2月，在对一项法案的表决中，以雅各布·里斯-莫格为首的17名保守党议员反对政府提出的法案。虽然法案本身得以通过，然而这也意味着保守党失去了议会绝对多数（313席，多数需322席）。随后，迈克尔·戈夫更是发表一份公开信，称帕克“领导无方”，怂恿保守党籍下议员在信上签名以逼迫帕克辞去党魁一职。因此帕克不得不尽快解散议会提前大选。

这时，卡梅伦找上她，重提一年前的许诺——帕克知道，既然她已经无法团结保守党，她也只能遵从计划了。

[[我向女王陛下提请解散本届联合王国议会……-&gt;15.6]]</tw-passagedata><tw-passagedata pid="148" name="15.6" tags="" position="4225,2325" size="100,100">2017年3月4日，海伦·帕克宣布因党内关于脱欧问题的分歧，她辞去党魁一职，并将在4月8日举行大选。3月13日，戴维·卡梅伦在党内无反对的情况下自动当选新一任保守党党魁。

2017年4月8日举行的大选中，保守党的民调数据虽然不错，但最终仅获得319席，没有达到绝对多数；工党则从229席上升到263席。由于未能获得绝对多数，保守党最终不得不与民主统一党签署信任供给协议。不过，卡梅伦经过七年等待，终于实现了入主唐宁街10号的野望。

帕克在卸任前不久获得了“蓝女士”（Blue Lady）的绰号——这指的是她的蓝眼眸、标志性的蓝黑色西装外套，以及代表保守党的蓝色。某种意义上，这也是对她七年跌宕起伏的首相生涯的一种肯定——她经历了三场全民公投，每一场都足以永远改变联合王国的前途。虽然她不像撒切尔夫人或托尼·布莱尔那样对英国造成了深远的改变，也没有极其出众的政绩，但执政长达七年的她仍然成为了那段时光中联合王国的一个象征。

触发结局：

[[——不，等等！她的幕后操作后来怎样了？-&gt;16.3]]</tw-passagedata><tw-passagedata pid="149" name="16.3" tags="" position="4225,2450" size="100,100">你以为帕克可以全身而退吗？她是打算跌得粉碎的——而且不巧的是，墨菲定律最后凑效了。2022年，在保守党内先后因鲍里斯·约翰逊的“派对门”和莉兹·特拉斯仅仅50天的统治而陷入一片混乱前，一位匿名线人向《卫报》称，自己曾被军情六处派去，通过游说欧洲议会议员间接干涉英国脱欧公投。虽然这一事件起初没引发什么波澜，但随着《卫报》收到一份文件，这个问题正式浮上了水面。文件声称，在脱欧公投前四个月，时任外交和联邦事务大臣卡梅伦指示军情六处通过各种秘密活动支持留欧一方，甚至派人监视部分被怀疑为不忠诚的内阁成员——对此，时任首相帕克是知情的。

[[山雨欲来……-&gt;16.3续]]</tw-passagedata><tw-passagedata pid="150" name="这儿有个小彩蛋" tags="" position="4675,1575" size="100,100">2008年12月19日，帕克作为自由民主党党魁，以嘉宾身份上了一趟BBC一台的著名新闻喜剧节目《我有新闻给你吗？》（Have I Got News For You）。本期节目的主持人是著名汽车节目《最高档》（Top Gear）的主持人、记者杰里米·克拉克森（Jeremy Clarkson）。在节目中，帕克展现出了精湛的口才，不过她略微浓重的苏格兰口音也遭到克拉克森嘲讽，他称“听不懂苏格兰语”；帕克则说“你调侃了苏格兰和爱尔兰，那就在威尔士适可而止吧”。总的来说，这次上镜经历为帕克赚了一波名气。

（注：现实世界线中，这一集的嘉宾是自由民主党前党魁查尔斯·肯尼迪）
(set: $extra to $extra +1)
[[回到主线-&gt;9.11A]]</tw-passagedata><tw-passagedata pid="151" name="8.13" tags="" position="2500,1450" size="100,100">1983-1987年，帕克先后在贸易部、内政部、外交和联邦事务部任职，逐渐积攒政治资本和人脉。1984-1985年的煤矿工人大罢工中，帕克一直对工会未经充分商议就擅自宣布罢工感到不满，在欧格里夫战役（Battle of Orgreave）后更是抨击矿工是“破坏法律与秩序的暴徒”，引发舆论关注。

1987年大选后，年仅35岁的她被任命为外交和联邦事务部政务次官，积极推行对苏联的遏制政策，在欧共体问题上则顶着党内不少人的反对，推行反对欧洲经济及货币联盟、反对欧洲单一货币的政策。然而此时，帕克逐渐发现她和撒切尔夫人并不是完全的同路人——她尤其不能忍受撒切尔夫人愈发刚愎自用的决策风格。然而，转念一想，她也知道跟着撒切尔夫人和她的接班人，自己会获得巨大的政治资本。

[[忍一忍吧，海伦。比她烂的人多得是。-&gt;9.15]]</tw-passagedata><tw-passagedata pid="152" name="9.15" tags="" position="2500,1575" size="100,100">1989年，撒切尔夫人的支持率开始下滑，理由是高涨的利率使经济由繁荣步入衰退期。为此，玛格丽特·撒切尔责难她的财相奈杰尔·劳森，称他的经济政策一直是为加入货币同盟作准备。劳森与外相杰弗里·豪对撒切尔夫人施加压力，要求她同意英国加入欧洲汇率机制，以便日后加入货币同盟。然而，撒切尔夫人将杰弗里·豪调离外交大臣的宝座，并安慰性地将其提升为副首相；劳森后来感到自己的地位受到削弱，遂于同年10月宣布辞职。

到1990年，撒切尔夫人在地方推行的新税制（人头税）使她愈发不得民心，错误的经济政策使她失去来自中产、企业和商界的核心支持。至于在保守党党内，又因欧共体问题而出现日益严重的分歧，使保守党陷入危机。当年6月，撒切尔夫人出乎意料地将年仅38岁的帕克提拔为外交和联邦事务国务大臣（副大臣）——言下之意是，她打算把帕克当成自己的潜在接班人了。

11月1日，外交大臣杰弗里·豪因与撒切尔夫人无法弥合的矛盾而请辞。他责难撒切尔夫人对欧洲共同体的政策严重损害英国利益，并公开鼓励“其他保守党党员对首相的支持作重新考虑”。结果，前国防大臣赫塞尔廷（Michael Heseltine）宣布挑战撒切尔夫人的党魁和首相地位。

在党魁选举前夕，撒切尔夫人选择财政大臣约翰·梅杰为接班人，梅杰随后尝试拉拢帕克，许诺日后将外交和联邦事务大臣一职交给她。而与此同时，赫塞尔廷拉拢帕克，并开出了更难以想象的价码——在他的内阁中让她马上担任外交和联邦事务大臣。

要怎么做？

[[赫塞尔廷是老政治家了，跟着他会有成果的。-&gt;8.6]]

[[当变色龙不会有好下场。-&gt;10.20]]</tw-passagedata><tw-passagedata pid="153" name="10.20" tags="" position="2500,1700" size="100,100">在11月的党魁选举上，约翰·梅杰笑到了最后，他按照许诺，让帕克继续留任外交和联邦事务国务大臣。1992年大选后，帕克被任命为(if: $birth is 1)[苏格兰事务大臣](if: $birth is 2)[教育大臣]。

1995年，梅杰因自己在党内的地位不断受挑战和威胁，决定辞去党魁一职，并宣布重新参选党魁。结果在迈克尔·赫塞尔廷的支持下，约翰·梅杰以微弱优势当选。其后，梅杰为报答赫塞尔廷，委任他为英国副首相，而帕克则升任外交和联邦事务大臣。这位年轻的外交大臣上任后开始积极推动英国与欧盟的合作，在其他领域也有建树，逐渐积累了作为大臣的政治资本。

不幸的是，到1997年大选前夕，保守党对选民已经毫无吸引力可言。在这年的大选中，托尼·布莱尔打出“新工党，英国新生”的口号以压倒性优势赢得选举，入主唐宁街。在经历此次挫败后，梅杰辞去党魁一职。帕克原本计划竞选党魁一职，然而经过两轮投票，她决定退选并支持更加年轻的威廉·黑格（William Hague）。随后，她被任命为影子外交和联邦事务大臣。

2001年大选中，保守党再次惨败于工党，黑格也引咎辞职。帕克意识到，以自己的年龄，这可能是她最后一个谋求成为保守党党魁的机会——如果不抓住这个机会，她可能就要在影子内阁坐个十年八年了。至于在下一届大选中击败工党的概率，没人知道——但不尝试就一定不会有什么结果，不是吗？

[[再拼一把。我还有机会领导这个国家！-&gt;11.16]]</tw-passagedata><tw-passagedata pid="154" name="11.16" tags="" position="2500,1825" size="100,100">2001年9月13日，经过激烈的选战，海伦·帕克当选新一任保守党党魁。上任后的帕克致力于重塑保守党的公众形象，走更加中间派的路线。在她领导下，保守党支持英国参加阿富汗和伊拉克战争，反对就《欧盟宪法条约》草案举行公投，并逐渐扩大了选民基本盘。

然而当2005年大选即将到来时，帕克仍然忧心忡忡。民调数据仍然显示保守党落后于工党，赢得大选的概率渺茫。另一方面，保守党内也有许多人认为，应该用更年轻的政治新秀取代年龄和布莱尔相仿的帕克——他们中意的人选是戴维·卡梅伦。

2005年大选最终宣告了帕克政治生涯的终结——工党的支持率虽然大幅下降，但仍然稳稳获得355个议席，超过绝对多数；保守党只得到198席。帕克自然难辞其咎，她很快宣布辞去党魁一职，卡梅伦按照预想的那样成为新一任党魁。

在结束保守党党魁生涯后，帕克开始积极为查塔姆研究所、布鲁金斯学会、战略与国际研究中心等国际知名智库撰稿，出席各种学术研讨会。在这段时间中，她没有退出公众生活，而是积极著书立说，研究领域涵盖欧俄关系、经济全球化、国内安全与应对恐怖主义等各种国内国际政治的重大问题。

2010年大选前，卡梅伦再次找到帕克，邀请她出任他的外交和联邦事务大臣。帕克对此有些犹豫——过去五年来她一直与政坛保持距离，而今英国正面临苏格兰独立问题，与欧盟的关系也愈发紧张。如果回到外交部，她能获得权力，但肯定要承担一大堆烂摊子。况且，以她的年龄和精力，这大概是她政治生涯的最后一段历程了。

[[既然有这个机会，为什么不争取？-&gt;12.13]]

[[抱歉，戴维，我累了。交给其他更适合的人吧。-&gt;12.14]]</tw-passagedata><tw-passagedata pid="155" name="12.13" tags="" position="2500,1950" size="100,100">2010年5月6日的大选中，保守党取得306席，工党取得258席，均没有达到绝对多数。经过五天的拉锯式谈判，保守党最终笑到最后——他们将与自由民主党组建联合政府。5月12日，卡梅伦入主唐宁街10号，成为英国首相，而帕克也随之成为外交和联邦事务大臣。

帕克入主外交部后，马上面临利比亚战争、叙利亚内战，同时还要处理英国与欧盟愈发紧张的关系。尽管在其他外交事务上帕克的立场和卡梅伦一致，但在英国与欧盟关系问题上，二人却一直意见不合——帕克希望英国通过全民公决决定是否留在欧盟，她个人倾向于脱离欧盟，维护英国的主权和安全；卡梅伦虽然从2012年开始便一直称会考虑举办全民公决，但他坚定支持留在欧盟。

到2014年，帕克和卡梅伦的矛盾已经公开化。帕克在内阁工作的四年中，一直感到自己受孤立——卡梅伦似乎更加依赖他自己的幕僚和顾问做出决定。保守党内许多人对她感到相当惋惜，认为她在工党执政的13年中白白消耗了政治的黄金年华，如今已经不再具有竞争力。因为这一点，也因为其他许多原因，她决定在2015年大选中不再谋求连任下议员，并开始考虑退出政坛，再次回到学术界。

但是，她是否真的要远离政治场域永恒的敌我关系，不再站队，转而做一个超然的中立研究者呢？这个问题困扰了她许久。

[[超然物外、与思想为伍更适合我。-&gt;13.9]]

[[思想也要为政治目标服务。-&gt;13.10]]

</tw-passagedata><tw-passagedata pid="156" name="12.14" tags="end" position="2625,1950" size="100,100">2010年4月，帕克宣布自己不会参与5月的议会选举，并且将退出政坛。在彻底结束30年的政治生涯后，帕克回到学术界，先后担任伦敦国王学院战争研究院客座教授、战略与国际研究中心（CSIS）研究员、查塔姆研究所三位主席之一，以及BP（原英国石油公司）非常任董事。在这段时光中，她几乎没再参与政治生活，以至于被称作“最低调的保守党党魁”。她平静地旁观苏格兰独立公投、脱欧公投、脱欧谈判、新冠疫情、生活成本危机，作为一个中立的第三者洞察世事。她觉得这个归宿也不错，至少在躲开了权力场的恶斗同时，又从未丧失对这个国家和世界的影响力。


在这期间，唯一值得一提的插曲可能是2022年10月的英国政府危机——刚刚上任首相没多久且经历了伊丽莎白二世驾崩的利兹·特拉斯因草率地提出减税和大规模借款方案，导致保守党内陷入混乱。10月24日，特拉斯宣布辞职，结束了仅仅50天的首相任期。

帕克只是一个旁观者，但她想起了1995年的那场党魁选举。当时保守党的境地和2022年10月也差不多——内忧外患，内有严重的内斗，外有“新工党”的巨大压力。脑海中闪过一个奇怪的念头：如果那时她参加竞选会怎么样？不，不，这不可能，她告诉自己。那时候谁会支持这么年轻的一个女子呢？布莱尔可是搞出了“新工党”，但她可没有那么多政治资本。

所以，要是她莫名其妙登上党魁宝座，或许结局也不会比特拉斯好到哪里去吧？



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“旋转门”（变体）]
非常尊敬的海伦·A·帕克女爵士（1952.7.20-），(if: $birth is 1)[苏格兰事务大臣](if: $birth is 2)[教育大臣]（1992-1995），外交和联邦事务大臣（1995-1997），影子外交和联邦事务大臣（1997-2001），保守党党魁（2001-2005）。借助“旋转门”制度，她得以在政治和学术两个领域之间游走，争得一个自己满意的结局。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="157" name="13.9" tags="end" position="2375,2075" size="100,100">2015年4月，帕克宣布自己不会参与5月的议会选举，并且将退出政坛。在当年大选后，帕克辞去外交和联邦事务大臣一职，彻底结束35年的政治生涯。

此后，她回到学术界，先后担任伦敦国王学院战争研究院客座教授、战略与国际研究中心（CSIS）研究员、查塔姆研究所三位主席之一，以及BP（原英国石油公司）非常任董事。在这段时光中，她几乎没再参与政治生活，以至于被称作“最低调的保守党党魁”。她平静地旁观苏格兰独立公投、脱欧公投、脱欧谈判、新冠疫情、生活成本危机，作为一个中立的第三者洞察世事。她觉得这个归宿也不错，至少在躲开了权力场的恶斗同时，又从未丧失对这个国家和世界的影响力。


在这期间，唯一值得一提的插曲可能是2022年10月的英国政府危机——刚刚上任首相没多久且经历了伊丽莎白二世驾崩的利兹·特拉斯因草率地提出减税和大规模借款方案，导致保守党内陷入混乱。10月24日，特拉斯宣布辞职，结束了仅仅50天的首相任期。

帕克只是一个旁观者，但她想起了1995年的那场党魁选举。当时保守党的境地和2022年10月也差不多——内忧外患，内有严重的内斗，外有“新工党”的巨大压力。脑海中闪过一个奇怪的念头：如果那时她参加竞选会怎么样？不，不，这不可能，她告诉自己。那时候谁会支持这么年轻的一个女子呢？布莱尔可是搞出了“新工党”，但她可没有那么多政治资本。

所以，要是她莫名其妙登上党魁宝座，或许结局也不会比特拉斯好到哪里去吧？



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“旋转门”（变体）]
非常尊敬的海伦·A·帕克女爵士（1952.7.20-），(if: $birth is 1)[苏格兰事务大臣](if: $birth is 2)[教育大臣]（1992-1995），外交和联邦事务大臣（1995-1997），影子外交和联邦事务大臣（1997-2001），保守党党魁（2001-2005），外交和联邦事务大臣（2010-2015）。借助“旋转门”制度，她得以在政治和学术两个领域之间游走，争得一个自己满意的结局。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="158" name="13.10" tags="end" position="2500,2075" size="100,100">2015年4月，帕克宣布自己不会参与5月的议会选举，并且将退出政坛。在当年大选后，帕克辞去外交和联邦事务大臣一职，结束35年的政治生涯——但可不是“彻底”结束。

此后，她回到学术界，先后担任伦敦国王学院战争研究院客座教授、战略与国际研究中心（CSIS）研究员、查塔姆研究所三位主席之一，以及BP（原英国石油公司）非常任董事。不过，这并不意味着她没有放弃立场——恰恰相反，她公开站到支持脱欧一边，甚至在脱欧公投后一度支持无协议脱欧。同时，她还支持加大对叙利亚政府军的打击力度，支持沙特阿拉伯对也门的武装干涉，并且在2019年支持鲍里斯·约翰逊竞选党魁。这些因素都导致一些保守党成员愈发不喜欢她，认为她“赖着不走”，虽然早已不是保守党党魁并且离开了内阁，却还要用自己的方式对这个党施加影响。也有一些人诟病帕克的研究成果显示出很强的游说集团色彩，是冒用学术的名义。最终，2022年9月约翰逊辞去首相职务后，帕克选择完全退出政坛。


时至今日，帕克在英国仍然是个很受争议的政治人物。她虽然陆陆续续在政坛活动超过40年，却并没有太多拿得出手的政治资本；在“留在政坛”和“退出政坛”之间反复横跳的模糊不清状态使她受到英国国内不少人的抨击，认为她的真正意图是“垂帘听政”。当然，也有不少人惋惜她时运不济——如果她在撒切尔内阁升职快一点，或者干脆横下心参加1995年的党魁选举，她就有机会和布莱尔竞争首相宝座。当然，这一切都是“如果”，“新工党”连续赢得三届大选的事实也说明，问题出在保守党总体上的衰弱和固步自封。

帕克又会怎么评价自己呢？大概也会说自己时运不济吧。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“时运不济”]
非常尊敬的海伦·A·帕克女爵士（1952.7.20-），(if: $birth is 1)[苏格兰事务大臣](if: $birth is 2)[教育大臣]（1992-1995），外交和联邦事务大臣（1995-1997），影子外交和联邦事务大臣（1997-2001），保守党党魁（2001-2005），外交和联邦事务大臣（2010-2015）。虽然是英国政坛的常青树，但因为时运不济，从未攀登到权力的顶峰；无论她究竟只是不想告别政坛，还是想“垂帘听政”，她在21世纪第二个十年给英国民众留下了极其复杂的名声。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="159" name="16.4" tags="" position="2025,2450" size="100,100">阿德勒先从安抚她开始，告诉她外面的世界已经大不相同。他很清楚帕克需要找回她热爱的事业——如果没什么好寄托的，那么她什么都做得出来。所以，他决定大胆地给帕克指一条路：智库。在他眼里，参与智库的工作，用思想和笔杆子影响政策选择，是唯一一条能让帕克渡过当前难关，回到情报界而不至于被军情六处盯上，又能实现复仇愿望的道路。她也同意了。这时，她轻轻笑了一下，阿德勒很高兴她终于笑了。

“但首先你需要慢慢恢复。等你出院之后，我们会给你写信，告诉你除了大众媒体的报道之外，还有哪些值得关注的事情。慢慢恢复，慢慢了解世界的变化，跳出常人的思维范式去思考。我们会动用手头一切可用的资源帮你度过难关的。你有什么需要就随时开口。”

“谢谢你，罗斯。”她点点头，目光中又多了一丝往日的坚毅。

“游骑兵说‘不把任何一个弟兄抛在身后’。在我们这里也一样。”

[[“我们有事情要做了，帕克。”-&gt;17.3]]</tw-passagedata><tw-passagedata pid="160" name="17.3" tags="" position="2025,2575" size="100,100">从1989年下旬起，帕克在友人的帮助下开始以笔名为兰德公司、美国外交关系协会、英国查塔姆研究所等智库撰稿，题材主要涵盖准军事组织与恐怖主义、私人军事服务公司的发展状况与前景、有组织犯罪势力在情报工作中的价值等。

1989年11月9日，她在哈默史密斯的公寓得知了柏林墙的倒塌；1989年12月31日，她终于得以在六年后和拉扎尔重聚，在已经倒塌的柏林墙边听大卫·哈塞尔霍夫（David Hasselhof）高唱《寻觅自由》（Looking for Freedom）。

时间进入1990年，帕克在一笔贷款和一封信的支持下逐渐回到了正轨，完全恢复了元气和希望。而当阿德勒在当年3月来拜访她，告诉她这一切的来龙去脉时，她才知道，她的生命进入了一个新阶段，她的世界已经天翻地覆。


1989年11月，阿德勒实在走投无路，决定借助老朋友法兰德的人脉帮一把帕克。他找到法兰德在美国空军中的朋友理查德·克拉文上将，托他把一封信转交给他的兄长——电子数据系统公司首席执行官赫伯特·克拉文。在这封信中，阿德勒概述了她的情况，并请求了一笔无息贷款。

他知道赫伯特是个尊重军人、很有责任感的企业家——1979年，他和电子数据系统公司主席罗斯·佩罗（Ross Perot）组织人力进入正处在伊斯兰革命高潮的伊朗，将两名被伊朗政府逮捕的公司雇员救出伊朗，带回美国。赫伯特是他最后一个能找的人了——而他同意了，给了阿德勒一笔一万美元的两年期无息贷款，附上一封亲笔信，祝帕克一切都好。


然而帕克却听出了一个问题——法兰德是空军特种部队出身，而阿德勒所说的克拉文上将却是战斗机部队出身。如果纯粹因为他们都在越南战斗过就成了朋友，听起来也不对劲。她马上把这个问题说出口。

[[你真想知道吗，帕克？这个故事可够烧脑的……-&gt;18.3]]</tw-passagedata><tw-passagedata pid="161" name="18.3" tags="" position="2150,2700" size="100,100">于是，阿德勒把这个故事娓娓道来——1968年1月，他和法兰德作为研究观察团成员参加了岘港战役，法兰德在那场战役中荣获荣誉勋章，他们也成了一辈子的朋友。1980年代中期，法兰德上校加入了一个由理查德·克拉文为领袖的秘密集团——“战隼帮”（the Fighting Falcon Gang）在主导。“战隼帮”源自20世纪60年代约翰·博伊德（John Boyd）创立的“战斗机黑手党”，后来由克拉文接班，并发展成美军和北约国家军队内部一个强大的改革派系。帕克从1989年下旬开始获得的许多帮助，背后都有”战隼帮“的一份力。

帕克惊呆了。这种像共济会一样的阴谋，竟然真的存在吗？阿德勒笑了笑，没有正面回答。不过，照这个意思，“战隼帮”和电子数据系统公司显然联系紧密，而赫伯特可是她的救命恩人；再说了，她知道军人之间可以有很紧密的袍泽，就像十多年前她在“铃”计划时那样。所以，或许宁可信其有，不可信其无？

[[以后肯定还会跟他们打交道。-&gt;19.2]]</tw-passagedata><tw-passagedata pid="162" name="19.2" tags="" position="2150,2825" size="100,100">1992年初，阿德勒再次拜访她，带来了一些有趣的新消息：

1991年5月，退役南非国防军中校伊本·巴洛（Eeben Barlow）在伦敦组建了一家名为索尔兹伯里安保集团（Sailsbury Security Corporation, SSC）的私人军事服务公司（PMC），主要业务是军事训练、军事行动、设施保卫、信息安全、情报工作、后勤保障、人身保镖等。这家公司的一个特点是，前南非国防军和罗得西亚安全部队的退役军人占比很高——他们自称是“受害者”，通过共同的对军事职业和技能的骄傲，联系在一起，并吸纳了冷战结束后不少北约和华约成员国的退役军人。

索尔兹伯里的成立，背后是“战隼帮”在主导。冷战结束后，“战隼帮”意识到私人军事服务领域的蓝海，决定施加影响。而阿德勒是从法兰德那里得知这一切的。阿德勒过去一年中一直在参与这家公司的业务，只不过一直没有全身心投入其中。

阿德勒的意思相当明确：他建议帕克加入仍处于初创期的索尔兹伯里，担任情报官。在这个岗位上，她除了履行职责，还可以带教新人，也不会因为工作压力太大而没时间去思考，去写作。并且，她可以把过去学到的所有老本行知识全都发挥出来。

[[好啊，我接受 。-&gt;20.1]]</tw-passagedata><tw-passagedata pid="163" name="20.1" tags="" position="2150,2950" size="100,100">1992年末，帕克加入索尔兹伯里安保集团，先后经历了集团在安哥拉、卢旺达和塞拉利昂的三次大规模行动，在集团中也步步高升。在很长一段时间中，她是集团唯一一位女性成员——巴洛是个老派的英裔白人，不希望女人参与到战争中，但帕克却令他折服。
(set: $vocation2 to &quot;PMC&quot;)
时间来到1996年，帕克已经做到了索尔兹伯里安保集团情报处副处长，而美英政府因为索尔兹伯里在非洲多次开展雇佣兵性质的业务（包括但不限于参与安哥拉内战、在卢旺达种族灭绝中作为安保力量保卫比利时航空的千丘酒店等等）而开始对其打压。更关键的是，军情五处也加强了对索尔兹伯里和帕克本人的监视。

此时，“战隼帮”在法国和德国的势力开始联系帕克和三年前退役、回到以色列的阿佐莱，希望将他和她撮合起来组建一家欧洲国家的私人军事服务公司，作为欧洲国家日后发展对外影响力和干涉能力的重要力量。在他们的计划中，索尔兹伯里和这家新公司将会划分势力范围，彼此互不干涉——毕竟，英美的“战隼帮”和欧洲大陆的“战隼帮”是从1980年开始，在一根藤上结出的两个果。

1996年11月，她和阿佐莱重聚，两人除了谈感情，还谈到了私人军事服务公司的事情。阿佐莱的意思很明确：留在索尔兹伯里意味着她的发展空间受限，而且巴洛和“战隼帮”的矛盾也在暗中滋长，这把火迟早要烧到她头上。所以，从头开始，是对她最好的选择。

[[离开索尔兹伯里很遗憾，但或许这样最好。-&gt;21.1]]</tw-passagedata><tw-passagedata pid="164" name="21.1" tags="" position="2150,3075" size="100,100">1997年初，帕克因“健康原因”辞去了索尔兹伯里安保集团的大部分职务，又在同年8月正式辞职，带着一个十多人的小团队离开了集团。很快，团队转移到直布罗陀，阿佐莱也前往那里，开始筹备新私人军事服务公司的成立。她在那里购置了一幢可以俯瞰地中海的小别墅，并把它当作自己的第二个家。1998年3月1日，帕克和阿佐莱防务公司（Park &amp; Azoulay Defense Company, PADEC）正式成立。

然而随后，公司内部马上产生了分歧——不少人认为，不应该让帕克掌管实务工作。被军情六处背刺后艰难求生的经历，以及许多年的病痛，导致帕克的性情大变——在落入珀修斯之手前，她相当开朗温和，(if: $birth is 2)[虽然有时有点贵族做派，但]只要跟她有共同语言，就很好打交道。然而，现在的帕克不仅健康状况不佳（她的烟酒习惯一直没戒掉），而且性情易怒，不会完全信任那些无法进入她核心圈的人，并且坚定认为世界应该按照自己的蓝图运转——她热爱故土、家人与和平，甘愿为值得追求的生活方式而死。但是，这种血性和热情在实务工作中稍有不慎可能就会招致麻烦。

阿佐莱也知道这一点。次年，科索沃战争全面爆发前不久，他向帕克提了这个问题。帕克不是很高兴，但她也知道自己的性格并非完美无缺。她也知道，这个决定日后会有很深远的影响。

[[好吧，拉扎尔，我不干了。也许安心休养更合适些。-&gt;22.1]]

[[这是什么话，拉扎尔？我没问题的！-&gt;22.2]]</tw-passagedata><tw-passagedata pid="165" name="22.1" tags="" position="2150,3200" size="100,100">帕克最终被说服了，她从一线岗位上退下来，作为帕克和阿佐莱防务公司的“教母”隐居在直布罗陀，不过许多时候仍然会在(if: $birth is 1)[直布罗陀、伦敦和爱丁堡三地](if: $birth is 2)[直布罗陀和伦敦两地]之间奔波。

时间飞速流逝，帕克和阿佐莱防务公司也快速做大。公司抓住机会，先后在以色列、阿富汗和伊拉克开展业务，并与法国、德国、意大利等欧陆各国的国防力量建立了合作关系。到2005年，公司雇员达到30,000多人。

2005年9月，电影《战争之王》上映后，尼古拉斯·凯奇饰演的军火商人尤里·奥洛夫一度成为了公众热议的形象。2005年11月，《镜报》刊载了一篇题为《我们也有“战争女王”》的文章，用“战争女王”这个绰号称呼海伦·帕克，称她主导了帕克阿佐莱在阿富汗的行动，将私人军事服务公司这种“曾经把非洲搅个天翻地覆的企业”带到了欧洲，“实际上和《战争之王》中的奥洛夫吃的是同一口饭……靠制造动荡来发财”。

帕克看到这篇文章后马上怒不可遏——文章里没一个字是真的。她知道要做点什么给这种无良媒体一记还击，不过，到底要说点什么呢？她很想把他们骂个狗血喷头，但她也知道这样恐怕只会让她在世人心目中留下一个“怪老太婆”的形象。

[[还是温和一点吧，媒体有多难缠你知道的。-&gt;23.1]]

[[见鬼！跟他们爆了！-&gt;23.2]]</tw-passagedata><tw-passagedata pid="166" name="22.2" tags="" position="2275,3200" size="100,100">由于帕克坚持要求担任首席执行官，因此公司不得不围绕她组建一个强大的决策和顾问团队，为她提供各种必要的信息并辅助她决策，以免她脑袋一热真的做些什么出格的事。但无论如何，公司还是顺利起步了，先后在以色列、阿富汗和伊拉克开展业务，并与法国、德国、意大利等欧陆各国的国防力量建立了合作关系。到2005年，公司雇员达到30,000多人。帕克的领导可以说功不可没——至少，如果没有她推动，公司肯定不会去阿富汗和伊拉克的。

2005年9月，电影《战争之王》上映后，尼古拉斯·凯奇饰演的军火商人尤里·奥洛夫一度成为了公众热议的形象。2005年11月，《镜报》刊载了一篇题为《我们也有“战争女王”》的文章，用“战争女王”这个绰号称呼海伦·帕克，称她主导了帕克阿佐莱在阿富汗的行动，将私人军事服务公司这种“曾经把非洲搅个天翻地覆的企业”带到了欧洲，“实际上和《战争之王》中的奥洛夫吃的是同一口饭……靠制造动荡来发财”。

帕克看到文章后自然是怒不可遏，但她转念一想也知道，《镜报》说的一切并非空穴来风。公司原本打算为那些不能回到公民社会的军人缔造一个避风港，结果在阿富汗和伊拉克的行动却在不断增加罹患PTSD的人员的数目——这或许在商业上可持续，但在道义上不可接受。公司上下承受着巨大压力，许多人说帕克把公司带入了一场错误的战争，背叛了初心，并且要她承担责任。他们都和帕克从1998年一路走来，并不希望和她闹掰，但也不愿意放任她刚愎自用地领导这家公司，以至于搞得天怒人怨，甚至自内而外瓦解。

最后，她还是在阿佐莱劝说下回心转意了。她不想落得一个和亲密战友决裂的结局。某种意义上，她已经当够了“战争女王”，现在是时候趁着还体面，退入幕后了。

[[让我和全世界说点心里话吧。-&gt;23.3]]</tw-passagedata><tw-passagedata pid="167" name="23.1" tags="" position="2150,3325" size="100,100">最终，她选择了沉默，只是让公关团队发了一份声明，表示《镜报》的报道存在不实。“战争女王”这个绰号最终传开了，帕克一点都不喜欢，也不希望身边人用这个绰号称呼她。然而，在公众场域，每当有人提起她，这个绰号总还是会浮现在众人的脑海里。

十三年弹指一挥间过去。2018年末，在例行的健康检查中，帕克被查出长期吸烟导致的肺癌。医生表示，帕克活过五年的概率非常渺茫。帕克虽然早已经退休，在直布罗陀的家中隐居，但她仍然希望为帕克阿佐莱和自己当年的战友再做一点事情。同时，她还希望在自己逝世前完成一个数十年来未了的愿望——再亲眼见一见珀修斯的领导人，如果他们还在世的话。

[[相逢一笑泯恩仇，不是吗？-&gt;24.1]]</tw-passagedata><tw-passagedata pid="168" name="23.2" tags="" position="2275,3325" size="100,100">帕克越想越气，她决定召开一场新闻发布会，斥责《镜报》这些无良媒体对她的抹黑。11月，在新闻发布会上，她强调自己曾为英国流过血，现在只是私人军事领域的从业者。她说：

“我曾经是军情六处的干员，我为这个国家奋斗一生。我退休后加入私人军事服务公司，不是因为我没有杀够人。我没有把战火带到任何地方，我也没有倒卖过哪怕一把枪、一个弹匣。我们的职责不是散播混乱、制造动荡，而是为那些需要维持和平的人提供支持。

&#39;&#39;“对于那些称我是‘战争女王’的人，首先，我讨厌这个称呼，其次，你们是一群信口开河的傻*。” (For those who called me &#39;queen of war&#39;, first, I hate this name, and second, you are a bunch of nonsense-talking twats.  )&#39;&#39;

这番发言引发了轩然大波，并且实际上也没怎么改善她的公众形象。当然，圈内人赞扬她的豪爽无畏，但也有不少外人认为这次新闻发布会只暴露出她经不起媒体调侃的敏感性格。帕克一点都不喜欢，也不希望身边人用这个绰号称呼她。然而，在公众场域，每当有人提起她，这个绰号总还是会浮现在众人的脑海里。
(set: $preevent to 23.2)
无论如何，既然她选择了退隐，这就不算什么大事。


十三年弹指一挥间过去。2018年末，在例行的健康检查中，帕克被查出长期吸烟导致的肺癌。医生表示，帕克活过五年的概率非常渺茫。帕克虽然早已经退休，在直布罗陀的家中隐居，但她仍然希望为帕克阿佐莱和自己当年的战友再做一点事情。同时，她还希望在自己逝世前完成一个数十年来未了的愿望——再亲眼见一见珀修斯的领导人，如果他们还在世的话。

[[相逢一笑泯恩仇，不是吗？-&gt;24.1]]</tw-passagedata><tw-passagedata pid="169" name="24.1" tags="end" position="2150,3450" size="100,100">2023年7月20日，帕克的生日。

有人敲了敲病房门，陪伴着她的阿德勒应了一声“来了”。打开门后，他看到两位老太太。其中一位年长些的女士大约九十岁，安坐在轮椅上，穿着打理得一尘不染的克格勃少将制服，左胸前除了许多排勋略，还有一枚苏联英雄的金星勋章，而稍微年轻些的那位也至少六十岁了。

”我是伊琳娜·马克西莫夫娜·波特诺娃，“年轻些的女士说，她看向帕克，露出了神秘的微笑。“生日快乐，海伦·帕克。”

…………

波特诺娃握住帕克的手。“你还记得我吗，帕克？”

帕克思索片刻，但似乎从一开始就知道她记不起来的。“不记得了。你那时在卢比扬卡？”

“不，列福尔托沃监狱。84年3月17日。但我没和你说几句话，我只记得觉得你非常顽强。当然，我们认为那叫死硬。”

帕克用全身力气轻笑了两下。“是啊，是啊。”


2023年8月5日，在新冠病毒和癌细胞的双重打击下，海伦·帕克在阿德勒、拉扎尔、法兰德和克拉文兄弟的陪伴下告别了人世，享年71岁。

(if:$birth is 1)[苏格兰低地](if: $birth is 2)[伦敦]的太阳照常升起。



触发结局：
//&#39;&#39;元世界线结局：“太阳照常升起”
海伦·A·帕克（1952.7.20-2023.8.5），军情六处干员(if:$entrance is 1972)[（1972-1987）](if:$entrance is 1976)[（1976-1987）]，帕克和阿佐莱防务公司联合创始人和“教母”。她见证了冷战最高峰，经历了超乎想象的苦难和绝望，最终死而复生，在铁幕倒下三十多年后，与曾经的敌人再聚首。她在每个领域都留下了自己的足迹，并深远地影响了这个世界。

（注：如果玩家选择帕克出生于苏格兰、上牛津、在1972年加入军情六处、怒斥《镜报》，则这就和《与命运相会》系列小说的元世界线结局完全一致了）&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="170" name="23.3" tags="" position="2400,3325" size="100,100">2005年11月，帕克和阿佐莱防务公司召开新闻发布会。海伦·帕克本人出席，她首相强调自己曾为英国流过血，现在只是私人军事领域的从业者。她说：

“我曾经是军情六处的干员，我为这个国家奋斗一生。我退休后加入私人军事服务公司，不是因为我没有杀够人。我们希望为这个世界带去和平，保护在战乱地区艰难求生的平民，并为那些习惯了军旅生活而无法回到公民社会的战友们提供一个港湾。有太多军人退役之后无法和普通人相处，而我们希望为他们提供一处可以延续过去生活方式的地方，让他们能和经历相似的战友继续捍卫和平的我们在科索沃、阿富汗和伊拉克所做的一切都是为了实现这个目标。

“一些人说我是‘战争女王’。毫无疑问，我不喜欢这个称呼，因为我不是战争贩子，我手下的战士更不会犯下任何战争罪。我希望听到这番话的朋友们都能知道我们的信念、我们的愿望和我们的价值观。”


12月，帕克最终做出了辞去首席执行官的决定，自此退隐。尽管如此，但”战争女王“这个绰号还是传开了。帕克一点都不喜欢，也不希望身边人用这个绰号称呼她。然而，在公众场域，每当有人提起她，这个绰号总还是会浮现在众人的脑海里。


十三年弹指一挥间过去。2018年末，在例行的健康检查中，帕克被查出长期吸烟导致的肺癌。医生表示，帕克活过五年的概率非常渺茫。帕克虽然早已经退休，在直布罗陀的家中隐居，但她仍然希望为帕克阿佐莱和自己当年的战友再做一点事情。同时，她还希望在自己逝世前完成一个数十年来未了的愿望——再亲眼见一见珀修斯的领导人，如果他们还在世的话。

[[相逢一笑泯恩仇，不是吗？-&gt;24.2]]</tw-passagedata><tw-passagedata pid="171" name="24.2" tags="end" position="2400,3450" size="100,100">2023年7月20日，帕克的生日。

有人敲了敲病房门，陪伴着她的阿德勒应了一声“来了”。打开门后，他看到两位老太太。其中一位年长些的女士大约九十岁，安坐在轮椅上，穿着打理得一尘不染的克格勃少将制服，左胸前除了许多排勋略，还有一枚苏联英雄的金星勋章，而稍微年轻些的那位也至少六十岁了。

”我是伊琳娜·马克西莫夫娜·波特诺娃，“年轻些的女士说，她看向帕克，露出了神秘的微笑。“生日快乐，海伦·帕克。”

…………

波特诺娃握住帕克的手。“你还记得我吗，帕克？”

帕克思索片刻，但似乎从一开始就知道她记不起来的。“不记得了。你那时在卢比扬卡？”

“不，列福尔托沃监狱。84年3月17日。但我没和你说几句话，我只记得觉得你非常顽强。当然，我们认为那叫死硬。”

帕克用全身力气轻笑了两下。“是啊，是啊。”


2023年8月5日，在新冠病毒和癌细胞的双重打击下，海伦·帕克在阿德勒、拉扎尔、法兰德等老朋友的陪伴下告别了人世，享年71岁。她的葬礼在(if: $birth is 1)[爱丁堡](if: $birth is 2)[伦敦]举行，帕克和阿佐莱防务公司的数千位雇员前来为她送行，就连伊本·巴洛也远道而来。克拉文兄弟也出席了——赫伯特在葬礼上老泪纵横。

她的骨灰一半被安葬在家乡，另一半则从直布罗陀海角撒入地中海——过去25年来，她一直在那幢俯瞰地中海的小别墅中，将自己的一切都奉献给她的事业和理想。



触发结局：
//&#39;&#39;(text-colour:blue)[好结局：“战争女王”]
海伦·A·帕克（1952.7.20-2023.8.5），军情六处干员(if:$entrance is 1972)[（1972-1987）](if:$entrance is 1976)[（1976-1987）]，帕克和阿佐莱防务公司首席执行官（1998-2005）。她见证了冷战最高峰，经历了超乎想象的苦难和绝望，最终死而复生，创建了自己的私人军事服务公司，并在铁幕倒下三十多年后，与曾经的敌人再聚首。或许她不喜欢这个称呼，但她是当之无愧的“战争女王”。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="172" name="12.15" tags="" position="1500,1950" size="100,100">从1990年开始，爱尔兰共和军改换策略，开始以狙击手袭击前往其根据地巡逻的英军士兵和警官。为应对这一新威胁，特种空勤团增加了在北爱尔兰的部署规模，帕克也被借调过去，主要负责心理战、研究和观察等任务。1992年，皇家陆军女子军团解散，帕克因其特殊服役经历而直接被调入北爱尔兰英军司令部，担任作战参谋。遗憾的是，在这个岗位上她难以再用报告影响上级的决策了。

经过数年的暴力事件以及1993-1994年的一连串杀戮，1994年8月31日，爱尔兰共和军宣布停火，亲英国的阿尔斯特防卫协会在六周后也相继宣布停火。这年末，她晋升中校，也第一次感觉贝尔法斯特的新年多了一点和平的气息。

此后的日子逐渐平静下来，虽然炸弹袭击不曾停歇，但她的确感受得到和平的气息越来越浓了。1995年11月28日，英国和爱尔兰政府发表联合公报，宣布两国将开始旨在使北爱尔兰问题各方解除武装、实现多党谈判的“双轨进程”。30日，美国总统克林顿访问北爱尔兰，并称恐怖分子已经是“昨日黄花”。

[[和平真的在地平线上了吗？-&gt;13.11]]</tw-passagedata><tw-passagedata pid="173" name="13.11" tags="" position="1500,2075" size="100,100">看来帕克和许多人一样还是操之过急了。1996年2月9日，爱尔兰共和军在伦敦码头区引爆了一枚炸弹，造成2死40伤，财产损失达1.5亿英镑。这次袭击标志着持续17个月的停火宣告终结。爱尔兰共和军称“梅杰先生和联合主义者毫无诚意，浪费了这次前所未有的解决冲突的机会”——这指的是英国政府拒绝允许新芬党参与和谈，除非爱尔兰共和军放下武器。

6月15日，爱尔兰共和军在曼彻斯特市中心引爆一枚大型炸弹，造成212人伤亡。20日，由于爱尔兰警察破获一处共和军炸弹工厂，爱尔兰政府马上断绝了一切与新芬党的联系。这一事件导致北爱尔兰英军再次回到高度戒备状态，帕克也神经紧绷地度过了接下来的一年多时光。

幸运的是，协商与和谈最终击败了暴力。1997年布莱尔政府上台后，北爱尔兰和平进程大幅加快。7月19日，爱尔兰共和军宣布实施停火，这次停火最终得以维持下去。1998年4月10日，耶稣受难日，英国和爱尔兰政府代表签署《贝尔法斯特协议》，这份获得北爱尔兰大多数政党支持的协议最终在5月23日，由北爱尔兰和爱尔兰共和国的选民经全民公决认可。尽管爱尔兰共和军尚未解除武装，反对协议的北爱尔兰民主统一党也对协议确保的和平表示高度怀疑，但至少，和平的曙光真正照在了整个爱尔兰。

7月中旬，晋升上校不久的帕克请了几天假，回家过生日。在休息之余，她和爸爸妈妈一道，去了安葬着哥哥的墓园，将两支虞美人放在他的墓碑前。

(align:&quot;=&gt;&lt;=&quot;)[爱德华·詹姆斯·帕克
1950.9.1-1972.3.23]

她许多年来第一次哭了——经过整整22年的军人生涯，她最终带着他的眼睛，看到了一线曙光。

[[哥哥，万事已竟。-&gt;14.7]]</tw-passagedata><tw-passagedata pid="174" name="14.7" tags="" position="1500,2200" size="100,100">1999年，随着北爱尔兰议会成立、局势逐渐稳定下来，英国陆军在北爱尔兰的驻军大幅削减。帕克被短暂派驻到科索沃，但在回国后，她开始考虑是要退役，还是继续为女王陛下效力——退役之后，她可以尝试任何想做的事情；如果留下来，她甚至可以争取一把，成为英国军队第一位女性将军。她听说现在世界上兴起了一种新东西，叫做“私人军事服务公司”——据说，这样的公司在克罗地亚独立战争中已经发挥了一把作用。

[[先退役吧。我已经为女王和国家服务够久了。-&gt;15.7]]

[[谁不想名垂青史一次，成为第一位女将军呢？-&gt;15.8]]</tw-passagedata><tw-passagedata pid="175" name="15.7" tags="" position="1500,2325" size="100,100">2000年，帕克以英国陆军上校军衔退役，转入预备役。虽然已经退休，但她并未减少对军事领域的关注，尤其关注私人军事服务公司的新动向。2003年，当一家名为索尔兹伯里安保集团的私人军事服务公司伴随美军、英军进入伊拉克时，她感到这或许是个好机会。

话虽如此，但她也知道这行的门道——美国人选择把私人军事服务公司当承包商，很大程度上是因为不想出钱多派美军。私人军事服务公司的业务水平不会太高，出了事则总是要第一个背锅。不过，她逐渐发现，这家公司似乎不是一般的私人军事服务公司——美英两军与它的合作似乎更加紧密，外包的业务也更多。

所以，要不要转变赛道呢？

[[算了，我没兴趣。安心过退休生活不好吗？-&gt;16.5]]

[[何不尝试一把呢？或许会有额外收获。-&gt;16.6]]</tw-passagedata><tw-passagedata pid="176" name="15.8" tags="end" position="1625,2325" size="100,100">2001年，帕克自告奋勇前往阿富汗，先后参加国际安全援助部队（ISAF）和美国主导的“持久自由行动”。在这段服役经历中，她充分发扬在北爱尔兰积攒的反叛乱作战经验，以安定民心、赢得阿富汗人民支持为要务。2003年，她晋升准将，随后被调往伊拉克。

在伊拉克的岁月中，她认识了美国陆军第101空降师指挥官大卫·彼得雷乌斯（David Petraeus）少将。她和彼得雷乌斯都是反叛乱战争的老手，都知道维持社会秩序、建立信任、修建公共工程是赢得当地人支持的不二法宝。遗憾的是，彼得雷乌斯走后，101空降师原本负责的摩苏尔马上从伊拉克最安全的地区变成了最动荡的地区。

帕克的情况也差不多，不过这某种意义上和她已经没关系了。2006年1月，海伦·帕克晋升英国陆军少将，成为英国军事史上第一位女性将军（准将在英军不算严格意义上的将军）。她在陆军参谋部的各个岗位上流转了四年后，于2010年被任命为陆军副参谋长助理，并最终在2012年荣誉退役。

在退役后，帕克成了英国陆军的红人之一。她获封女爵士头衔后，许多人劝她参政，不过她对这个主意一直没什么兴趣——军人应该无涉政党政治，退役后也一样如此。最终，她选择利用自己的知识，参与到智库和研究机构的工作中，就世界防务领域的前沿问题发表自己的看法。她先后担任伦敦国王学院战争研究院客座教授、战略与国际研究中心（CSIS）研究员、国防大臣本·华莱士的军事顾问；2021年美军撤离阿富汗后，她在查塔姆研究所发表演讲，称美军在阿富汗的反叛乱作战因为“政治和心理战的失败”而最后走向不可逆的失败，引发了不少人的关注。


时至今日，知道帕克的人越来越少，但她在曾在北爱尔兰、科索沃、阿富汗、伊拉克服役过的军人之间仍然相当有名。某种意义上，她的服役史就是一部冷战至今英国陆军的征战史——唯一的遗憾，或许是她从未踏上西德的冷战最前沿。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“巾帼将军”]
海伦·A·帕克女爵士（1952.7.20-），英国陆军少将。她曾在英国陆军服役35年，脚步从贝尔法斯特到普里什蒂纳，再到喀布尔和巴格达。或许当她回忆起自己的戎马一生时，仍然会想起驱动自己参军的，那股为哥哥复仇的决心吧？//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="177" name="16.5" tags="end" position="1500,2450" size="100,100">帕克最终放弃了这个主意，过起了退休生活——不过她可不会闲下来。她组建了皇家陆军女子军团北爱尔兰老兵联谊会，自任会长，在家乡与贝尔法斯特之间奔波，与不少曾在那片土地上服役过的战友再次相聚。由于她和特种空勤团共事的经历，因此她也和曾在北爱尔兰服役的特种空勤团成员相当熟悉。二十多年来，她一直四处游说奔走，为曾在北爱尔兰服役和牺牲的英军士兵树立纪念碑。因为她在北爱尔兰服役长达22年的经历，以及退役后有目共睹的付出，她在战友之间得到了“贝尔法斯特甜心”的绰号。

时至今日，除了少数曾在北爱尔兰服役的军人，已经很少有人记得海伦·帕克。某种意义上，她不过是曾在那里服役过的30多万名英军军人之一——秉持宏观视角的军事历史研究者会得出这样的结论。不过，对于那些和她相处过的战士而言，她可不止于此。在她看似人畜无害的“贝尔法斯特甜心”昵称下，隐藏着一颗坚忍、顽强、无畏甚至冷酷的心。要想屹立在一个动荡不安的时代，这样的一颗心必不可少。

触发结局：
//&#39;&#39;(text-colour: green)[普通结局：“贝尔法斯特甜心”]
海伦·A·帕克（1952.7.20-），英国陆军上校，曾在北爱尔兰服役22年。她为捍卫联合王国与北爱尔兰的安全屹立在第一线，为惨死于炸弹下的哥哥报了一箭之仇。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="178" name="16.6" tags="end" position="1625,2450" size="100,100">2003年，帕克加入索尔兹伯里安保集团，初期主要负责情报工作。两年后，因为她积攒的丰富经验，并且与集团的绝大部分高层都相处融洽，她被调往伊拉克，火速升职为分管情报的伊拉克业务副总监。在这个岗位上，她得以深度参与伊拉克战争，尤其是应对各反政府武装发动的游击战。
(set: $vocation2 to &quot;PMC&quot;)
说实话，她对自己要承担如此责任感到相当惊讶。她原本以为索尔兹伯里安保集团不过是一家负责要人安保、军事训练之类低烈度任务的公司，结果没想到，这家公司俨然就是多国联军的影子。巴格达、费卢杰、摩苏尔、巴士拉……索尔兹伯里安保集团的2万多名雇员在这些地方四处行动，许多时候是负责安保、治安，但更多时候则直接参与到快速反应、反叛乱之中。公司拥有数百辆“悍马”和二十多架UH-60“黑鹰”，可以在24小时内组织一支一百多人的快反部队到伊拉克境内的任何地点。


2007年9月16日，索尔兹伯里安保集团的保安分队在一次意外事件中杀害了17名伊拉克平民，打伤24人。这次事件严重损害了集团的声誉，但却没怎么阻碍集团的业务。2011年多国联军撤军后，索尔兹伯里安保集团顶着民意的强烈反对，整建制留了下来，受命训练伊拉克军队并协助维持国内安全。

不过对帕克而言，那都是别人的事了。2012年8月，帕克退休，开始了赋闲生活。遗憾的是，因为索尔兹伯里安保集团恶劣的风评，她很难回到公众场域——别人只会说她是“那家雇佣兵公司的女魔头”。于是，她安心隐居，开始撰写回忆录。2021年，她的回忆录《大漠红花》出版，她为英军和索尔兹伯里安保集团服役的经历各占一半。这部回忆录成为了畅销书，也为她最后争取了一波声望。除此之外，她的退休生活掀不起一丝波澜。

但或许这样也好。



触发结局：
//&#39;&#39;(text-colour: green)[普通结局：“大漠红花”]
海伦·A·帕克（1952.7.20-），英国陆军上校，曾在北爱尔兰服役22年，又为索尔兹伯里安保集团服务9年，在两个战场上留下自己的足迹。或许当她回忆起自己的戎马一生时，仍然会想起驱动自己参军的，那股为哥哥复仇的决心吧？&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="179" name="4.3" tags="" position="675,950" size="100,100">帕克最终没有继续求学。她首先加入了家乡的律师事务所，担任了两年的初级工作，同时加入了工党。1973年的石油危机重创了英国经济，迫使爱德华·希思的保守党政府实施三天工作周，以节省能源。然而，全国矿工工会（NUM）对此并不满意，并在1974年1月24日发动了煤矿工人罢工。2月的大选后，希思未能成功组阁，工党的哈罗德·威尔逊组建了少数派政府。许多媒体反对全国矿工工会组织的罢工，但帕克却大胆地站出来撰写文章抨击他们，坚定支持工会，使年仅22岁的她一战成名。
(set: $vocation to &quot;lawyer&quot;)
1976年，帕克通过司法考试成了一位事务律师，同年结了婚。她主要经手劳资纠纷等直接和工人相关的案件，积攒了大量经验，被许多人称作“工人之友”。到1979年，她已经在南约克郡地区小有名气，并且升职成了大律师。

然而，1978-1979年的“不满的冬天”重创了工党的名声。由于政府规定自1978年8月1日起基层职工加薪幅度不得高于5%，引发工会强烈反对，导致工党与工会的矛盾彻底爆发。到1979年2月，“不满的冬天”虽然临近尾声，但工会和工党的离心已成现实，工党赢得即将到来的大选的可能性则趋近于零。

帕克也面临一个艰难抉择——她知道“不满的冬天”某种意义上是因为工会权力过大，但过去三十多年来，工党的绝大部分政策却又基于与工会大会的紧密合作。这是一个要支持工会还是工党的问题。她有种预感，日后工党和工会将爆发更大的矛盾；她也知道，如果日后她要参政，这次抉择就会影响她一生。

[[工会是工人阶级的直接代表，并且捍卫他们的合理利益。这没什么不对的。-&gt;5.3]]

[[工党是全体工人阶级的党，工会则不能代表所有人。-&gt;5.4]]

[[非得选边站队吗？-&gt;5.5]]</tw-passagedata><tw-passagedata pid="180" name="4.4" tags="" position="1200,900" size="100,100">在她男朋友的影响下，帕克最终去了曼彻斯特大学修读现代语言，并在1972年毕业。她在从事法律工作和媒体工作之间犹豫不决了一阵——这两条道路看上去都很不错，而且都能实现她为工人阶级谋利益的初心。她的男朋友还是一贯地支持她，不过看上去似乎更希望她做个媒体人。(set: $university to &quot;man&quot;)

[[还是法律更适合我。-&gt;4.3A]]

[[媒体有它不可取代的力量。何不尝试一下呢？-&gt;4.5]]

</tw-passagedata><tw-passagedata pid="181" name="5.3" tags="" position="625,1075" size="100,100">帕克坚定了自己支持工会的立场，但也深知这会影响她作为法律从业者，维持价值中立的能力。1979年大选最终以保守党大获全胜告终，她也回去继续当律师，不时参与工党和全国矿工工会约克郡分会的活动。1983年大选中，工党在迈克尔·富特（Michael Foot）的领导下走了激进左翼路线，导致在大选中与保守党的差距被进一步拉开。但尽管如此，帕克也没怎么改变立场。

1984年初，国家煤炭局宣布达成一项协议，为了合理配置政府对煤矿业的补贴，国家煤炭局将关闭20个煤矿。两万矿工将因此失业，英格兰北部和威尔士的许多社区将会失去其主要的就业来源。各地煤矿的矿工当即开始罢工行动。1984年3月12日，全国矿工工会的主席阿瑟·斯卡吉尔（Arthur Scargill）宣布各矿区的罢工将成为全国总罢工，并呼吁全国矿工工会在所有矿区工作的会员罢工。

帕克和斯卡吉尔很熟，她也一直支持后者，但对这次罢工尝试她仍然心怀疑虑，因为斯卡吉尔拒绝以全国投票的形式决定是否举行全国总罢工。随着罢工局势愈演愈烈，工人纠察队和警察处于爆发冲突的边缘，她决定……

[[既然罢工已经开始，就没有回头路了。前进！-&gt;6.4]]

[[保持沉默，静观其变。-&gt;6.5]]</tw-passagedata><tw-passagedata pid="182" name="5.4" tags="" position="750,1075" size="100,100">帕克坚定了自己支持工党的立场，并开始和工会疏远。她愈发觉得斯卡吉尔是个危险分子，他会绑架工会运动，甚至导致工人阶级陷入内斗。1979年大选最终以保守党大获全胜告终，她也回去继续当律师，不时参与工党的活动。此后，工党在迈克尔·富特（Michael Foot）的领导下走了激进左翼路线，导致其在民调中与保守党的差距被进一步拉开。但尽管如此，帕克也没怎么改变立场。

1983年大选前不久，开始有许多人劝帕克竞选下议院议员。她觉得这个主意不错——她发现许多时候进入政治体制内并获得民众信任，比起纯粹打官司更能促进社会变革。尽管当年工党的支持率并不高，但帕克还是决定赌一把。

[[南约克郡的乡亲会支持我的！-&gt;6.6]]</tw-passagedata><tw-passagedata pid="183" name="5.5" tags="" position="875,1075" size="100,100">虽然帕克心底坚信工党是代表工人阶级和广大人民群众利益的党，但她不想公开站队，因为在她眼里那样做没什么实际意义，还会反过来约束她。不过，她的确和工会疏远了。她愈发觉得斯卡吉尔是个危险分子，他会绑架工会运动，甚至导致工人阶级陷入内斗。1979年大选最终以保守党大获全胜告终，她也回去继续当律师，不时参与工党的活动。此后，工党在迈克尔·富特（Michael Foot）的领导下走了激进左翼路线，导致其在民调中与保守党的差距被进一步拉开。但尽管如此，帕克也没怎么改变立场。

1983年大选前不久，开始有许多人劝帕克竞选下议院议员。她觉得这个主意不错——她发现许多时候进入政治体制内并获得民众信任，比起纯粹打官司更能促进社会变革。尽管当年工党的支持率并不高，但帕克还是决定赌一把。

[[南约克郡的乡亲会支持我的！-&gt;6.6A]]</tw-passagedata><tw-passagedata pid="184" name="4.3A" tags="" position="825,950" size="100,100">帕克首先加入了家乡的律师事务所，担任了两年的初级工作，同时加入了工党。1973年的石油危机重创了英国经济，迫使爱德华·希思的保守党政府实施三天工作周，以节省能源。然而，全国矿工工会（NUM）对此并不满意，并在1974年1月24日发动了煤矿工人罢工。2月的大选后，希思未能成功组阁，工党的哈罗德·威尔逊组建了少数派政府。许多媒体反对全国矿工工会组织的罢工，而帕克虽然支持罢工，但对工会藐视部分工人意愿强行推动罢工感到不满。
(set: $vocation to &quot;lawyer&quot;)
1976年，帕克通过司法考试成了一位事务律师，同年结了婚。她主要经手劳资纠纷等直接和工人相关的案件，积攒了大量经验，被许多人称作”工人之友“，同时还担任当地工党机构的法律顾问。到1979年，她已经在南约克郡地区小有名气，并且升职成了大律师。

然而，1978-1979年的”不满的冬天“重创了工党的名声。由于政府规定自1978年8月1日起基层职工加薪幅度不得高于5%，引发工会强烈反对，导致工党与工会的矛盾彻底爆发。到1979年2月，”不满的冬天“虽然临近尾声，但工会和工党的离心已成现实，工党赢得即将到来的大选的可能性则趋近于零。

帕克也面临一个艰难抉择——她知道”不满的冬天“某种意义上是因为工会权力过大，但过去三十多年来，工党的绝大部分政策却又基于与工会大会的紧密合作。这是一个要支持工会还是工党的问题——虽然她不太可能大张旗鼓支持工会。她有种预感，日后工党和工会将爆发更大的矛盾；她也知道，如果日后她要参政，这次抉择就会影响她一生。

[[工党是全体工人阶级的党，工会则不能代表所有人。-&gt;5.4]]

[[非得选边站队吗？-&gt;5.5]]</tw-passagedata><tw-passagedata pid="185" name="4.5" tags="" position="1050,950" size="100,100">1973年，帕克加入《每日镜报》的编辑部，开始了媒体人生涯。当年的石油危机重创了英国经济，迫使爱德华·希思的保守党政府实施三天工作周，以节省能源。然而，全国矿工工会（NUM）对此并不满意，并在1974年1月24日发动了煤矿工人罢工。许多报章反对全国矿工工会未经充分协商发动罢工，而《每日镜报》虽然支持工人通过罢工争取权利，但并不支持全国矿工工会贸然发动罢工——这也是帕克的个人立场。2月的大选后，希思未能成功组阁，工党的哈罗德·威尔逊组建了少数派政府。
(set: $vocation to &quot;media&quot;)(set: $vocation2 to &quot;media&quot;)
1978-1979年的”不满的冬天“重创了工党的名声。由于政府规定自1978年8月1日起基层职工加薪幅度不得高于5%，引发工会强烈反对，导致工党与工会的矛盾彻底爆发。到1979年2月，”不满的冬天“虽然临近尾声，但工会和工党的离心已成现实，工党赢得即将到来的大选的可能性则趋近于零。尽管这段时间中《每日镜报》和帕克都坚定支持工党，但帕克自己也知道，按照英国政治的规律，一个不属于工党的时代可能要来了。

她是时候摆明立场了。

[[工党是全体工人阶级的党，工会则不能代表所有人。-&gt;5.4A]]

[[非得选边站队吗？-&gt;5.5A]]</tw-passagedata><tw-passagedata pid="186" name="6.4" tags="" position="375,1200" size="100,100">1984年初夏，全英许多煤矿都发生了罢工，但罢工的效果远不如斯卡吉尔等人预测的那样有力。到5月初，全国矿工工会把目光投向了南约克郡的欧格里夫（Orgreave）焦化厂——这座工厂生产的焦化煤是钢铁工业的重要燃料，工会认为阻止这座工厂开工将可以迫使政府同意他们的要求。

5月中旬，工会在欧格里夫焦化厂集结了5000多名纠察队员，警方则从全英调来6000多名警察，以及42名骑警。帕克有些担心会爆发暴力冲突，但斯卡吉尔本人却满不在乎。5月29日，矿工尝试阻拦进入焦化厂的卡车，并与警方爆发了第一次冲突，双方各有几十人受伤。6月15日，帕克决定就罢工的事态，尤其是欧格里夫的情况起草一份声明。

她决定……

[[矿工不能屈服于警察！应该使用一切手段获得胜利！-&gt;7.9]]

[[我还能说什么？难不成让矿工大吼一声扑向防暴警察？-&gt;7.10]]</tw-passagedata><tw-passagedata pid="187" name="6.5" tags="" position="500,1200" size="100,100">1984年初夏，全英许多煤矿都发生了罢工，但罢工的效果远不如斯卡吉尔等人预测的那样有力。到5月初，全国矿工工会把目光投向了南约克郡的欧格里夫（Orgreave）焦化厂——这座工厂生产的焦化煤是钢铁工业的重要燃料，工会认为阻止这座工厂开工将可以迫使政府同意他们的要求。

5月中旬，工会在欧格里夫焦化厂集结了5000多名纠察队员，警方则从全英调来6000多名警察，以及42名骑警。帕克有些担心会爆发暴力冲突，但斯卡吉尔本人却满不在乎。5月29日，矿工尝试阻拦进入焦化厂的卡车，并与警方爆发了第一次冲突，双方各有几十人受伤。6月15日，帕克决定就罢工的事态，尤其是欧格里夫的情况起草一份声明。斯卡吉尔暗示她应该按照他的意愿来写，号召矿工采取一切必要行动，但她心底不愿意——她知道这会惹麻烦的。

她决定……

[[总不能鼓动矿工们袭警吧？-&gt;7.10]]</tw-passagedata><tw-passagedata pid="188" name="5.4A" tags="" position="1000,1075" size="100,100">帕克坚定了自己支持工党的立场，并开始和工会疏远。她愈发觉得斯卡吉尔是个危险分子，他会绑架工会运动，甚至导致工人阶级陷入内斗。1979年大选最终以保守党大获全胜告终，她也回去继续当记者，不时参与工党的活动，或者写文章抨击撒切尔夫人削减社会福利的行为。此后，工党在迈克尔·富特（Michael Foot）的领导下走了激进左翼路线，导致其在民调中与保守党的差距被进一步拉开。但尽管如此，帕克也没怎么改变立场。

1983年大选前不久，开始有人劝帕克竞选下议院议员。她觉得这个主意不错——她发现许多时候进入政治体制内并获得民众信任，比起纯粹做个传声筒更能促进社会变革。不过，当地的《每日镜报》编辑部总监不想放走这位前途无量的女士。

[[也许进入政坛会是个好主意？-&gt;6.6]]

[[“第四权”有它自己的力量，何不善用呢？-&gt;6.7]]</tw-passagedata><tw-passagedata pid="189" name="5.5A" tags="" position="1125,1075" size="100,100">虽然帕克心底坚信工党是代表工人阶级和广大人民群众利益的党，但她不想公开站队，因为在她眼里那样做没什么实际意义，还会反过来约束她。不过，她的确和工会疏远了。她愈发觉得斯卡吉尔是个危险分子，他会绑架工会运动，甚至导致工人阶级陷入内斗。她也回去继续当记者，不时参与工党的活动，或者写文章抨击撒切尔夫人削减社会福利的行为。此后，工党在迈克尔·富特（Michael Foot）的领导下走了激进左翼路线，导致其在民调中与保守党的差距被进一步拉开。但尽管如此，帕克也没怎么改变立场。

1983年大选前不久，开始有人劝帕克竞选下议院议员。她觉得这个主意不错——她发现许多时候进入政治体制内并获得民众信任，比起纯粹做个传声筒更能促进社会变革。不过，当地的《每日镜报》编辑部总监不想放走这位前途无量的女士。

[[也许进入政坛会是个好主意？-&gt;6.6A]]

[[“第四权”有它自己的力量，何不善用呢？-&gt;6.8]]</tw-passagedata><tw-passagedata pid="190" name="7.9" tags="" position="375,1325" size="100,100">最终，帕克撰写了一份声明，谴责29日警方滥用骑警冲撞矿工的行为，呼吁欧格里夫的工人纠察队“用一切手段保护他们的权利、抵挡保守党政府堪比拉美国家的暴行”。这份声明发布后获得了斯卡吉尔和全国矿工工会的支持。结果，两天后，欧格里夫的工人纠察队马上用棍棒、石块甚至燃烧瓶武装了起来。

6月18号早晨，大约5000名矿工和相同数量的警察聚集在焦化厂附近。起初，双方没有爆发冲突，但当卡车车队准备进入焦化厂时，矿工开始向警方投掷石块，警方随即动用了第一批骑警驱散矿工。然而，此时矿工中有人向防暴警察投掷燃烧瓶，造成两名警察被烧成重伤。骑警随即发动冲击，配合催泪瓦斯强行驱散了绝大部分矿工。随后，双方爆发流血冲突，警方将矿工逼入附近的城镇，用警棍大打出手；矿工则点燃路障，阻止警车和救护车进入焦化厂。这天结束时，有3名矿工死亡，200多名矿工和100多名警察受伤，300多人被逮捕。

第二天早晨，”欧格里夫战役“的报道震惊了全英国。帕克和斯卡吉尔知道，这下麻烦大了——无论究竟是谁首先开了第一枪（他们声称是警方首先发射了催泪瓦斯），三条人命造成的影响肯定不是能轻易解决的。到7月上旬，虽然全国矿工工会以微弱优势否决了结束罢工的提案，但显然这场全国罢工已经七零八落。斯卡吉尔严词谴责此次暴力冲突的原因是警察滥用暴力，但民调显示，同情矿工的民众比例已经不到三分之一，绝对多数的受访者同情他们的雇主。

帕克知道自己难辞其咎——如果没有她的那份声明，怎么会这样呢？

[[所以他们会怎么做？传唤我？-&gt;8.14]]</tw-passagedata><tw-passagedata pid="191" name="7.10" tags="" position="500,1325" size="100,100">最终，帕克撰写了一份声明，谴责29日警方滥用骑警冲撞矿工的行为，呼吁欧格里夫的工人纠察队“坚守岗位”，但没有更加激烈的措辞。这份声明发布后获得了斯卡吉尔和全国矿工工会的支持。

6月18号早晨，大约5000名矿工和相同数量的警察聚集在焦化厂附近。起初，双方没有爆发冲突，但当卡车车队准备进入焦化厂时，矿工开始向警方投掷石块，警方随即动用了第一批骑警驱散矿工。随后，双方爆发激烈冲突，警方将矿工逼入附近的城镇，用警棍大打出手；矿工则点燃路障，阻止警车和救护车进入焦化厂。这天结束时，有51名矿工和72名警察受伤，其中一些矿工被警棍打成重伤；还有95人被逮捕。

欧格里夫战役成了这场罢工的转折点之一。到7月上旬，虽然全国矿工工会以微弱优势否决了结束罢工的提案，但显然这场全国罢工已经七零八落。斯卡吉尔严词谴责此次暴力冲突的原因是警察滥用暴力，但民调显示，同情矿工的民众比例已经不到三分之一，绝对多数的受访者同情他们的雇主。而最关键的是，当年8月帕克在接受反对罢工但亲工党的《每日镜报》采访时，最终改变了立场，表示自己对罢工的许多方面持保留态度，并对欧格里夫的暴力冲突表示遗憾。

到1985年3月罢工早早收场时，这场全国大罢工最终被证明是一场失败。全国矿工工会的影响力几乎完全崩溃，其地位被反对此次罢工的民主矿工工会和工会大会（TUC）取代，斯卡吉尔也不再是英国政坛的关键人物。帕克料到了这个结局，也知道自己做出了正确的决定——如果她亦步亦趋，恐怕就和斯卡吉尔一个下场了。

[[这会是一段我不太想回顾的经历……-&gt;8.15]]
</tw-passagedata><tw-passagedata pid="192" name="8.14" tags="" position="75,1450" size="100,100">在余下的罢工中，帕克似乎被雪藏了，她没怎么出来发表过言论。到1985年3月罢工早早收场时，这场全国大罢工最终被证明是一场失败。全国矿工工会的影响力几乎完全崩溃，其地位被反对此次罢工的民主矿工工会和工会大会（TUC）取代，斯卡吉尔也不再是英国政坛的关键人物。

对于帕克，欧格里夫战役的结局几乎毁掉了她的人生。1985年末，经过调查，她因被认定”行为不当“而失去了大律师资格。经过几年等待，1988年，政府组建的独立调查委员会认定欧格里夫战役中的三名死者死于警方暴力，这和斯卡吉尔当初称他们被马踩过、被警棍痛殴是一致的；然而，调查结果显示矿工首先投掷的燃烧瓶才是对峙升级为冲突的直接因素，且当天矿工大多持有武器这一点，严重加剧了在场警员的紧张感。
(set: $vocation to &quot;union&quot;)
在调查报告最后，委员会认定欧格里夫战役中的流血冲突，有部分原因要归咎于媒体报道和全国矿工工会的鼓动——这几乎就是不点名批评帕克。报告出炉没多久，《太阳报》就以“她让矿工去流血”为标题，起底帕克在当时的所作所为。很快，舆论风暴一股脑地袭来，意味着她必须尽快决定要怎么做。

[[好吧，我做错了许多事情，为此要承担责任。-&gt;9.18]]

[[欲加之罪何患无辞？我不会因为这种小报的诋毁而上套！-&gt;9.19]]


</tw-passagedata><tw-passagedata pid="193" name="8.15" tags="" position="375,1450" size="100,100">大罢工结束后，帕克回到老本行，继续当律师。20世纪80年代末90年代初的时光飞逝，南约克郡的矿业迅速衰落，她也开始经手其他类型的诉讼。当然，她没有忘记自己的出身，也没有忘记为工人阶级和其他弱势群体打抱不平。尽管在大罢工前期坚定支持斯卡吉尔的过去招来了一些争议，但在1993年，帕克仍然成为了御用大律师，并担任工党影子内阁负责劳资关系的法律顾问。
(set: $vocation2 to &quot;union&quot;)
1994年托尼·布莱尔成为工党党魁后，开始将这个党改造为一个民主社会主义政党——这也就是日后“新工党”的先声。帕克此时面临这样的选择——一方面，她发现许多时候进入政治体制内并获得民众信任，比起纯粹打官司更能促进社会变革；但另一方面，她从卡拉汉和富特的时代一路走来，不是很能接受许多弱化工党社会主义色彩的改革。但相当关键的是，她支持布莱尔促进社会正义、调和劳资关系的理念，并将其作为自己的人生目标。

1996年下旬，布莱尔本人找上帕克，邀请她竞选下议院议员。经过慎重考虑，她决定……

[[很好，布莱尔先生。我接受。-&gt;9.16]]

[[抱歉，布莱尔先生。再多给我一点时间吧。-&gt;9.17]]</tw-passagedata><tw-passagedata pid="194" name="9.16" tags="" position="400,1575" size="100,100">1997年大选中，帕克被选入下议院。然而，帕克很快感到自己和“新工党”似乎格格不入——虽然她认同其中的不少理念，但身边的同僚却因为她的过去，始终无法完全信任她。党内一直有传言称，她能进入下议院纯粹是因为布莱尔希望实现从“老工党”到“新工党”的平滑过渡，因此不能操之过急地将老一派人全部驱逐出去。某种意义上，她也接受了这一判断，故意不完全跟随布莱尔。

2001年大选后，帕克终于得到第一个内阁职务——就业和养老金大臣。2005年大选后，她转任环境、食品和乡村事务大臣。在这两个岗位上，她都不改左翼本色，因此获得了相当两极分化的评价。2007年布朗接替布莱尔后，前者出乎意料地没有给帕克任何内阁职务，导致她直接变回了后座议员。至此，她和布莱尔、布朗的矛盾才算是公之于众。

[[反正这六年过得浑身不自在。不如做真正的我。-&gt;9.16续]]</tw-passagedata><tw-passagedata pid="195" name="9.17" tags="end" position="275,1575" size="100,100">帕克最终谢绝了这个机会，她预感到自己可能放弃了一次天赐良机。事实也的确如此——此后，工党高层再也没有找过她。

不过，能留在法律界感觉仍然不错。1998年，在帕克推动下，英国议会通过法案，废除和平时期所有的死刑；1999年，帕克被任命为皇家检察院检察长，五年后又成为英格兰和威尔士最高法院法官。最终，在2009年，她成为新成立的联合王国最高法院大法官。时至今日，她仍在这一岗位上任职，以法律的剑与盾捍卫联合王国臣民的权利。尽管她过去和现在都是左翼意识形态的支持者，但作为大法官，她必须尽可能做到中立，超脱派系之争。

尽管如此，但帕克一直是个比较毁誉参半的人物。她最大的争议点莫过于早年支持斯卡吉尔和极左翼的全国矿工工会，这一点可以说影响了她一生。虽然她在欧格里夫战役后马上改变立场，回到了传统的左翼路线，后来更是偏向多元文化主义和进步主义，但这时，她又反而受到传统左翼人士和许多右翼人士的抨击，一些南约克郡乡亲也对这种转变感到遗憾。

不过，无论如何，她是个法律与秩序的良好化身，不是吗？



触发结局：
&#39;&#39;//(text-colour:blue)[好结局：“法律与秩序”]
海伦·A·帕克女勋爵（1952.7.20-），律师兼曾经的左翼工会活动家，联合王国最高法院大法官（2009-）。虽然一生毁誉参半，但毫无疑问，她是一位成功的法律人，也是南约克郡的骄傲……至少对绝大部分人而言。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="196" name="9.18" tags="end" position="0,1575" size="100,100">《太阳报》的报道发布后四个月，帕克发表了一份声明，部分承担了责任，并对当时的暴力事件表示遗憾。此后，她处于半隐居状态，不问政事，也没有加入斯卡吉尔自己组建的社会主义劳工党。尽管她名义上仍是工党党员，但显然，她已经不在乎这个身份了。

时至今日，已经很少有人记得海伦·帕克，即使记得，也不会记得她曾是个远近闻名的律师，只会说她是个激进左翼活动家——好一点的说法是，她因为煽动暴力，把美好年华全都葬送了；坏一点的说法是，她是个支持无政府主义、破坏法律与秩序的女人。

或许当有人想到她时，也会一并想到《我要在你坟头蹦迪，撒切尔夫人》这首小曲吧？



触发结局：
//&#39;&#39;(text-colour: red)[坏结局：“我要在你坟头蹦迪”]
海伦·A·帕克（1952.7.20-），（前）律师兼著名左翼工会活动家，因在1984-1985年英国矿业工人大罢工中鼓动工人袭击警察、间接导致欧格里夫战役中3名矿工死亡，自此颜面尽失，背负骂名。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="197" name="9.19" tags="" position="125,1575" size="100,100">与众人期待的结局不同，帕克一直没有表态；据称，在私底下里，她不仅没有道歉，反而称《太阳报》是在诋毁自己。或许是因为这个原因，1990年初，她被工党开除。
(set: $party to &quot;NCP&quot;)
在等候舆论风波渐渐过去时，帕克开始潜心研读马列主义著作，并出乎众人意料地在东欧共产主义政权瓦解、苏联走向解体之际成为了一个正统马列主义者，甚至加入了不列颠新共产党（NCP）。除此之外，她还和不少抱持相近观点的同志们互相联络，在一个共产主义看似已经失败的时代思考究竟要做什么，才能捍卫社会主义理想。

1993年初的一天，她从一次研讨会上回来，透过家门边邮筒的缝隙看到了一封信。她心想……
(set: $luck to (random:1,100))
[[垃圾邮件罢了，没什么好看的。-&gt;10.21]]

(if: $luck &gt;= 50)[[[嗯？还是看看吧。-&gt;10.22]]]</tw-passagedata><tw-passagedata pid="198" name="10.21" tags="end" position="0,1700" size="100,100">她没管那封邮件，打开门回了家。她永远都不会知道，那封信或许能改变她的生活，甚至改变这个世界的走向。

此后的帕克成为了冷战结束后仍然默默坚持正统社会主义理想的“老左派”之一。她在欧洲各主要共产主义政党之间穿梭，见证了一次又一次的内斗、瓦解和分裂，看着世界共产主义运动走向衰弱，欧洲共产主义政党与人民日趋疏远。对她而言，冷战结束后的世界没有变得更好，因为曾经的左翼和右翼、共产主义和资本主义的实力平衡已被打破，新自由主义成了唯一的道路——但许多人则说，这只是因为她沉湎于过去而适应不了新世界。

今天，已经没有多少人知道海伦·帕克了，而绝大部分知道的人只觉得她是个疯狂的左派，脑子里还是“激烈的阶级斗争”那一套。或许她仍在为自己的信仰奔走，或许她也已经沉寂下来。

只有在身边的那一小群人之间，她才是这个国家“最后的红星”。



触发结局：
//&#39;&#39;(text-colour: red)[坏结局：“最后的红星”]
海伦·A·帕克（1952.7.20-），前律师和著名左翼工会活动家，不列颠新共产党党员。因在1984-1985年英国矿业工人大罢工中鼓动工人袭击警察、间接导致欧格里夫战役中3名矿工死亡，自此颜面尽失，背负骂名。时至今日，她仍在坚持社会主义理想，横眉冷对千夫指，默默前行。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="199" name="10.22" tags="" position="125,1700" size="100,100">她拿出那封邮件，看到寄信地址似乎是——莫斯科？她赶忙进屋坐下，拆开信封。接下来她读到的一切，可能将永远改变她的一生。


//尊敬的海伦·帕克：

我们是一个仍然抱持马列主义理想的组织。您可能有所耳闻克格勃第十九总局——一个在冷战时期令西方情报机构闻风丧胆的名字。//


[[等等，我好像想起来了——-&gt;10.2.2]]</tw-passagedata><tw-passagedata pid="200" name="10.2.2" tags="" position="0,1825" size="100,100">她想起了这个名字——绰号“珀修斯”的克格勃第十九总局。她从同志口中耳闻过他们的故事——他们由曾窥探过“曼哈顿计划”的，代号“珀修斯”的原子间谍创立，在大半个冷战中作为华约组织最强大的情报力量活跃在对抗的前沿。

但这还不是事情的原貌。


//我们诞生于最原始、最激进的共产主义理想——通过革命建立一个社会主义和共产主义的世界，通过自动化实现生产力的质变，通过先锋党肃清一切官僚、贪污犯和反革命分子。勃列日涅夫“发达社会主义”的迷梦使我们放弃了对苏联国家机器的幻想，全国自动化系统的失败让苏维埃国家的经济和社会陷入停滞，而萨布林事件让我们坚信，只有我们可以捍卫社会主义免遭帝国主义腐蚀和颠覆。我们在阴影下活动，等待着让人民重新成为苏维埃国家主人的那一天。

尽管我们在冷战的最前线斗争了二十五年，但如今，苏维埃国家已经不复存在，克格勃第十九总局已遭到寡头和资本家颠覆，我们被迫转入地下。我们欢迎所有认同我们理想、愿意蛰伏下去，直到共产主义理想实现的那一天的同志。共产主义与世界革命将在我们的后代手中实现——哪怕一百年。

我们等候您的回复。//


帕克读完信，惊呆了。一股强烈的本能呼唤她抓起笔，写回信，告诉远在俄罗斯的“珀修斯”，她愿意加入。她甚至不需要多想，就知道“珀修斯”是她的同路人——即使她对他们的了解只有这一封信。

[[哪怕一百年！-&gt;10.2.3]]</tw-passagedata><tw-passagedata pid="201" name="10.2.3" tags="end" position="0,1950" size="100,100">那封信不久后就有了回复。她拆开回信的信封，拿出一本小册子，以及一封信。信是这样写的：


//尊敬的海伦·帕克：

很高兴您加入“珀修斯”。在这样一个艰难险阻的时期，能有新同志加入，对我们所有人都是及时雨式的好消息。

您需要知道的一切都在小册子里。请您严格遵循组织的纪律、执行组织的命令——稍有不慎，我们就将毁灭，世界上最后的共产主义堡垒也将随之自内而外瓦解。

最后，我们再次欢迎您的加入，并将通过安全方式持续联系您。&#39;&#39;革命才刚刚开始。&#39;&#39;//
(set: $special1 to &quot;perseus&quot;)
(align:&quot;==&gt;&quot;)+(box:&quot;=X&quot;)[&#39;&#39;乔治·布莱克（签名）&#39;&#39;]



触发结局：
//&#39;&#39;(text-colour: yellow)[隐藏结局：“珀修斯”]
海伦·A·帕克（1952.7.20-），前律师和著名左翼工会活动家，不列颠新共产党党员，“珀修斯”成员。共产主义理想没有死，革命的钢枪仍握在她和“珀修斯”的同志们手中——哪怕，直到他们离开这个世界，第一发子弹也不会打出。&#39;&#39;//

（作者注：如果各位玩到了默认结局，或是读过《与命运相会》小说，就会知道这个结局是多么倒反天罡了）

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="202" name="在重生前先看一个小彩蛋" tags="" position="2900,2575" size="100,100">作者在制作本条工党线时发现了一些很有趣的细节：

如果玩家选择帕克生于爱丁堡，那么布朗、帕克和布莱尔就都是苏格兰人（甚至帕克和布莱尔都是生于爱丁堡）；

如果帕克上了爱丁堡大学，那么她就是布朗的学妹（而且，很巧合的是，按照设定帕克是神童，而布朗在现实世界线中也是个神童，他15岁就进入了爱丁堡大学）；

无论玩家选择的出生地点为何，布朗、帕克和布莱尔三人都没多少年龄差距（分别生于1951、1952和1953年）。

~~人杰地灵苏格兰了属于是~~
(set: $extra to $extra +1)
[[再开一把！-&gt;Start]]
</tw-passagedata><tw-passagedata pid="203" name="9.6.1" tags="" position="2300,1700" size="100,100">5月7日早晨，海伦·帕克最后一次站在唐宁街10号门前，宣布解散本届议会，同时自己也将辞去首相一职，但担任看守政府首相直到新一届议会选出。而这天的《卫报》只用了三个词报道这件事——

&#39;&#39;//The lettuce won
“生菜赢了”//&#39;&#39;

在6月1日举行的议会大选中，工党取得压倒性胜利，获得659席中的438席，保守党只得到悲惨的145席。自此，布莱尔开启了一个“新工党”时代，而这个时代持续了整整13年。

[[你以为这就完了吗？-&gt;9.6续]]</tw-passagedata><tw-passagedata pid="204" name="9.16续" tags="end" position="275,1700" size="100,100">离开内阁后的帕克一不做二不休，干脆回到了进入政坛之前的“老左派”立场。她重新拾起了阶级政治，反对英国参与利比亚内战和叙利亚战争，反对工党淡化党歌《红旗》的尝试，并和以反叛作风而闻名的丹尼斯·斯金纳（Dennis Skinner）坐在同一排。2015年，她公开纪念30多年的矿业工人大罢工，并对当时自己扮演的角色感到相当骄傲。同年，她支持杰里米·科尔宾参选工党党魁。

时至今日，帕克仍然是下议院议员之一——斯金纳已经离开下议院，而她却像一块远古的活化石一样，安坐在威斯敏斯特宫。经过二十多年的岁月，许多人早已经忘记她在矿业工人大罢工中扮演的角色，也忘了她在两届内阁任职的经历，而将她视作一位可敬的、忠于信仰的女士。


(align:&quot;=&gt;&lt;=&quot;)[//人民旗帜最最红
常年覆盖烈士心胸
四肢未僵尚暖和
心中血染红道道线缝

升旗帜鲜红高又高
哪管它旗下我存亡
懦夫退缩叛徒冷笑
我们要红旗高高飘//](align:&quot;==&gt;&quot;)+(box:&quot;=X&quot;)[——《红旗》]

触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“人民旗帜最最红”]
海伦·A·帕克（1952.7.20-），下议院议员（1997-），就业和养老金大臣（2001-2005），环境、食品和乡村事务大臣（2005-2007）。若要说当今的英国还有哪些议员坚持“老左派”的阶级政治，真正做到正直、可敬，那非她莫属。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="205" name="15.5续" tags="end" position="2900,2450" size="100,100">事实证明，帕克在合适的时机卸下了职务——布朗上台后支持率一度很高，但随着2008年全球金融危机爆发，布朗政府使出浑身解数仍然无法遏制经济下行，工党的支持率大跌，并在2009年欧洲议会和地方议会选举中大败。2009年6月，两名内阁大臣陷入财政丑闻，更使评论认为布朗开始失去对局面的掌控。2010年5月6日的议会大选中，工党席位从349席下降到258席，不得不寻求与自由民主党谈判组建联合政府。然而，布朗在5月11日宣布谈判失败，次日辞职，戴维·卡梅伦成为新任首相。

卸任后的帕克谢绝了女男爵爵位，而只是受封了爵士。她逐渐沉寂下来，虽然仍偶尔参与公众活动，但把更多时间用于撰写自己的回忆录。2018年，她的回忆录《生活与时代》出版，并很快成为畅销书。在回忆录中，她认为参与入侵伊拉克是她一生中最差的决定。


2021年，利兹大学研究团队制作的1885年以来的英国首相排名中，帕克排在第三位，仅次于克莱门特·艾德礼和撒切尔夫人。由她付诸实践的“新工党”理念使英国享受了十多年的经济繁荣，社会矛盾也得到缓解。当然，她没能完全实现夙愿，“新工党”作为一种政治哲学日后也饱受质疑，从根本上困扰英国社会的矛盾（尤其是移民和恐怖主义问题）也未曾得到化解；但最关键的是，入侵伊拉克的决定被认为严重影响了她的首相生涯。

不过，无论如何，她仍然为英国带去了一次新生。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“英国新生”]
非常尊敬的海伦·A·帕克女爵士（1952.7.20-），英国首相（1997-2007）。尽管因参与入侵伊拉克而蒙受口诛笔伐，但总体上，她仍然是英国最被人爱戴和怀念的首相之一。//&#39;&#39;

[[在重生前先看一个小彩蛋]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="206" name="9.5B" tags="end" position="2175,1700" size="100,100">离开政坛后的帕克过起了赋闲生活，读书消磨时间，很少再参与政治活动。许多人说她是因为怀才不遇、错失良机，才对政治失去兴趣的——这话或许没错。她在最年富力强的时候因跟错了人而痛失成为大臣的良机，随后又因为“新工党”而在野长达十三年。当她离开政坛时，已经是满头银发。她的朋友对她的经历感到痛惜，说她本有可能成为保守党的布莱尔。另一些人则说，她的高光时刻是90年代初，那时她的政治生涯就像一颗蓝色流星一样耀眼——遗憾的是，也一样短暂。

帕克从没有对后一种说法表过态——不过，她的朋友认为，她会不情愿地赞同的。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“蓝色流星”]
海伦·A·帕克（1952.7.20-），商务与贸易部国务大臣（1992-1995），外交和联邦事务部国务大臣（1995-1997），影子外交和联邦事务大臣（2001-2005），影子内政大臣（2005-2010）。她的政治生涯似一颗流星划过90年代的天空，在燃尽了光亮后便陷入冷寂。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="207" name="6.6" tags="" position="625,1200" size="100,100">1983年6月9日的大选中，虽然保守党获得397席并轻易地获得胜利，工党则仅得209席，但帕克却成功成为了中谢菲尔德选区议会议员。
(set: $vocation to &quot;poli&quot;)
当选后的帕克成为工党内“老左派”的支持者之一，虽然新任党魁基诺克（Neil Kinnock）开始推动工党回到更加温和的左翼立场，但帕克不以为然。她和作风同样反叛、发言同样尖锐的博尔索佛选区议员丹尼斯·斯金纳（Dennis Skinner）成了好友，共同支持参与1984-1985年矿业工人大罢工的矿工（尽管他们都对领导罢工的斯卡吉尔本人表示反对）。

1987年大选前夕，基诺克尝试拉拢她，建议这位“年轻的左翼女士”和她合作，以争取更多政治资本。她心想……

[[我不会放弃立场，尼尔。你还是另请高明吧！-&gt;7.11]]

[[可以观望一下，合作则未必。-&gt;7.12]]</tw-passagedata><tw-passagedata pid="208" name="7.11" tags="" position="625,1325" size="100,100">帕克回绝了这个请求，也坚定了她作为“老左派”的立场——坚持阶级政治的路线，与工人阶级站在一起，并维护他们的权利。

十年时光过去，帕克也从一位普通的议员逐渐成为英国政坛的公众人物。在14年的议员生涯中，她多次因为用毫不留情的语言抨击对手而被驱逐出下议院议事厅，并且每年都不参加议会开幕大典——因为她是个坚定的反君主主义者。一些人干脆称她是“谢菲尔德魔女”，就像斯金纳得到了“博尔索佛怪物”的绰号一样。当然，也有不少人称她“食古不化”，或者干脆说她是个毒妇。

1997年大选前夕，布莱尔再次找上了她，像十年前的基诺克一样开出了条件。此时的工党已经通过“新工党”而脱胎换骨，正式成为了一个自称的“民主社会主义政党”，拥抱了阶级调和、社会正义这些和老左翼价值观背离的东西。帕克一点都不喜欢这些东西，相信这意味着工党和保守党合流。

[[抱歉，布莱尔先生，这有违我的原则。-&gt;8.16]]</tw-passagedata><tw-passagedata pid="209" name="7.12" tags="" position="750,1325" size="100,100">帕克没有回绝基诺克，但也没有明确同意。基诺克似乎也没太重视这次接触，在他接下来的五年党魁生涯中，帕克没有得到重用，但也没有遭到工党主流的排挤。1992年大选后，帕克仍然维持了工党中间派的立场，但也因此而愈发籍籍无名——当年大选中，她差点败于保守党候选人，这为她的政治生涯敲响了警钟。

她愈发意识到，自己要么需要有点特色，要么就拥抱权力的逻辑，选择跟随能当上工党党魁的人。维持中间派的代价就是，被一些人说过于温和，而另一些人说过于古板，结果里外不是人。

1997年大选前夕，布莱尔再次找上了她，像十年前的基诺克一样开出了条件。此时的工党已经通过“新工党”而脱胎换骨，正式成为了一个自称的“民主社会主义政党”，拥抱了阶级调和、社会正义这些和老左翼价值观背离的东西。帕克虽然担心“新工党”和保守党合流，但并不抵触变化——只要她能利用变化实现自己的野心，或者在变化中坚持原则，成为特立独行而受人爱戴的政治人物。很难说在这之间有什么中间地带，除非她甘愿籍籍无名——但她又怎么会这样呢？

她最终决定……

[[“新工党”，新开始。听起来不错。 -&gt;8.17]]

[[“新工党”有违我的原则。抱歉，我不会加入。-&gt;8.16]]</tw-passagedata><tw-passagedata pid="210" name="8.16" tags="end" position="500,1450" size="100,100">帕克毫不犹豫地谢绝了布莱尔。在连任议员后，帕克干脆放开手脚——不是有些人说我太古板了吗？那就照你们的意思来！在在她接下来的议员任期中，她不仅坚持立场，而且当自己的立场与工党相违背时，也毫不客气——2003年，她率领不少工党议员反对英国入侵伊拉克，而布莱尔拿她一点办法都没有，最终在保守党支持下才通过出兵决定。

她不但捍卫阶级政治，而且也更激进地站在了人民一边。她反对英国参与利比亚内战和叙利亚战争，反对工党淡化党歌《红旗》的尝试，2015年，她出乎意料地公开纪念30多年的矿业工人大罢工，并对当时自己扮演的角色感到相当骄傲。同年，她支持科尔宾参选工党党魁。

尽管2019年大选前帕克因疾病无法亲自拉票，但最终她仍以微弱优势击败保守党候选人——而斯金纳就没这么幸运了，他因为患病而几乎没有参加竞选，最后失去了议席，在49年的议员生涯后离开了下议院。这次大选后，帕克接过斯金纳的衣钵——2022年鲍里斯·约翰逊辞职前夕，她在辩论中称他是“火腿成精”并要他就“派对门”给个答复。尽管因为拒绝撤回“火腿成精”这个词而被驱逐出了议事厅，但不久后，约翰逊便决定辞职。帕克也瞬间成为网络红人，她过去40年中的妙语成章还被做成了油管视频。

2024年大选后，帕克成为下议院任职时间最长的议员——不过，她谢绝了相应的“下议院之母”称号。尽管许多人不赞同她的政治立场，但都相当尊敬这位威斯敏斯特宫的元老，认为她在过去41年中，从未背离自己的原则和信仰。在互联网上，许多年轻人也对这位一直坐在前排、穿着灰色或红色风衣，永远用深蓝色眼眸盯着反对党（或执政党）前座议员团队的女士有很深刻的印象。

“谢菲尔德魔女”的故事仍未完结。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“谢菲尔德魔女”]
海伦·A·帕克（1952.7.20-），中谢菲尔德选区议会议员（1983-）。作风反叛，坚持原则，直言不讳，被一些人称作旧时代最伟大的遗存。历史或许会告诉我们，威斯敏斯特宫中曾有这样一位女士，是英国人民的幸运。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="211" name="8.17" tags="" position="625,1450" size="100,100">帕克向布莱尔表明了自己加入内阁的意愿——当然，这也意味着她选择了妥协，部分放弃了立场。1997年大选以工党大获全胜告终，帕克也随之得到第一个内阁职务——就业和养老金大臣。2001年大选后，她转任环境、食品和乡村事务大臣。不过在这两个岗位上，她没有完全放弃老左翼本色，非常强调人民（尤其是中下阶层）的利益，因此获得了相当两极分化的评价。

到了2005年大选前夕，帕克作为布莱尔内阁中最“左”的成员之一已经招致了不少争议，并导致布莱尔和财政大臣戈登·布朗看她越来越不顺眼。她身边的许多同僚因为她的过去，始终无法完全信任她。许多人认为她的政策与新工党实现社会正义、阶级调和的主基调不匹配，“老左派”则认为她背叛了自己的原则。因此，在大选前，布莱尔再次找上她，告诉她要么走更加温和的路线，要么就离开内阁。

帕克最终决定……

[[虽然很不情愿，但我接受。-&gt;9.21]]

[[不要得寸进尺，托尼！你想把我撤职就撤吧！-&gt;9.20]]</tw-passagedata><tw-passagedata pid="212" name="9.21" tags="" position="525,1575" size="100,100">2005年大选后，许多人开始猜测帕克的下一个岗位。大部分人认为帕克精于妥协，也经常这么做，因此她大概率仍能留下来任职。结果也确实如此——帕克留了下来，担任教育大臣。在这个岗位上，她的态度显著软化了，不再坚持许多“老左派”的立场，但仍然坚持称自己是一个“社会主义者”。不过，这一转变也招致了不少人的抨击。

2007年布朗接替布莱尔后，帕克出乎意料地被提拔为内政大臣。在她的的内政大臣任期中，她进一步向中间派靠拢，也因此受到了更多的口诛笔伐。幸运的是，她在没有经历任何重大丑闻的情况下坚持到了2010年大选。

但工党就没这么幸运了——2008年经济衰退后，工党受欢迎度开始下滑，2009年在地方和欧洲议会选举中连续受挫。在2010年大选中，保守党和工党均未取得过半多数，导致两党都开始与自由民主党谈判组建联合政府。然而，5月11日，布朗承认与自由民主党的谈判失败，保守党和后者将组建联合政府。为此，他辞去首相一职。

几个星期时光过去，帕克知道工党党魁选举已经不远了。出乎意料的是，工党党内有不少声音呼吁她竞选党魁——绝大部分人都是老左派或者民主社会主义价值观的支持者，他们不希望艾德·米利班德（Ed Miliband）这种“形左实右”的年轻人当选。当然，也有许多人认为帕克在政治生涯中多次改变立场，从老左派变成了中间派，不值得信任。

她知道自己可以赌一把，也可以选择静观其变。不过，以她的年龄，或许还是抓住这次机会为妙。

[[是时候努力一把了。-&gt;10.23]]

[[不，我不会参选。-&gt;10.24]]</tw-passagedata><tw-passagedata pid="213" name="9.20" tags="" position="650,1575" size="100,100">2005年大选后，许多人开始猜测帕克的下一个岗位。只有少数人预料到了最终的结果——她直接离开了内阁。在离开内阁后不久，她发表一份声明，抨击过去八年中工党对外不断进行毫无意义的海外干涉（主要是入侵伊拉克），对内过度依赖市场机制导致其无法实现真正的社会正义，未能遏制收入差距的恶化，并且把国民医疗保障系统（NHS）、社会保障体系和许多公共工程“搞得一团糟”。结果，她马上被工党开除。

面对某些人称她是“极左疯子”的论调，帕克一不做二不休，干脆全盘回到了进入政坛之前的“老左派”立场。她重新拾起了阶级政治，反对英国参与利比亚内战和叙利亚战争，反对工党淡化党歌《红旗》的尝试，并和以反叛作风而闻名的丹尼斯·斯金纳坐在同一排。2015年，她公开纪念30多年的矿业工人大罢工，并对当时自己扮演的角色感到相当骄傲。同年，她还支持杰里米·科尔宾竞选工党党魁。在当年大选中，她以微弱优势保住了自己的议席。

2024年大选后，她和同样被开除出工党的科尔宾一道，在激烈的选战后留在了下议院。当她再次走进议事厅时，许多工党议员起立向她致敬，保守党、自由民主党和改革党议员则对她报以嘘声。

这就是帕克——一个评价无比两极分化，一些人爱戴，另一些人则痛恨的人物。但她的名气还不止于此。

[[全世界都会知道她。-&gt;9.20续]]

</tw-passagedata><tw-passagedata pid="214" name="9.20续" tags="end" position="650,1700" size="100,100">回到下议院后，帕克正式得到了“谢菲尔德魔女”的绰号——这是因为她自2005年后，作为独立议员展现出了最反叛、最顽强的一面。早在20世纪80年代，她就曾用直言不讳但又直击要害的发言，让议事厅另一边的议员，以及内阁成员们颜面无光。为此，她甚至不惜被赶出议事厅。这样的行动让她重获“老左派”的信任——以及其他许多人的敌视。

而在2019年斯金纳落选后，帕克干脆接过他的衣钵——2022年鲍里斯·约翰逊辞职前夕，她在辩论中称他是“火腿成精”并要他就“派对门”给个答复。尽管因为拒绝撤回“火腿成精”这个词而被驱逐出了议事厅，但不久后，约翰逊便决定辞职。帕克也瞬间成为网络红人，她过去40年中的妙语成章还被做成了油管视频。通过这部视频，互联网上的许多年轻人也对这位一直坐在前排、穿着灰色或红色风衣，永远用深蓝色眼眸盯着反对党（或执政党）前座议员团队的女士留下了深刻印象。

”谢菲尔德魔女“的故事仍未完结。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“谢菲尔德魔女”（变体）]
海伦·A·帕克（1952.7.20-），中谢菲尔德选区议会议员（1983-）。尽管她也曾进入内阁，但她从未放弃反叛作风，未曾背弃原则，始终直言不讳。因此，她被一些人称作旧时代最伟大的遗存。历史或许会告诉我们，威斯敏斯特宫中曾有这样一位女士，是英国人民的幸运。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="215" name="10.23" tags="" position="400,1700" size="100,100">2010年9月的工党党魁选举开始前，帕克决定参选。然而，在第一轮选举中她名列第三，以微弱劣势次于戴维·米利班德，结果被淘汰。在输掉这次选举后，帕克放弃了继续争夺权力，甚至谢绝了进入影子内阁的机会。

此后的五年中，她一直在思考为何自己会在那次选举中失败。她认为，问题还是出在她没有坚持自己的信仰——她从80年代的老左派一点一点向中间挪动，改变立场，不仅失去了特色进而泯然众人，也失去了不少人的信任。老左派不喜欢她接受了右翼价值观这一点，布莱尔和布朗之流则认为她非自己族类。当然，她还是倾向老左派的，只是在内阁的最后五年中，她无法展现这一点，也正因此失去了许多人的信任。

2015年大选前，她回顾了一下自己的政治历程。考虑到她已经竞选过一次工党党魁，哪怕工党在大选中落败，再次竞选也显然一点都不现实。而继续留在下议院，看起来也没什么意义。

于是，她决定……

[[我累了，干不动这行了。回家吧！-&gt;11.17]]</tw-passagedata><tw-passagedata pid="216" name="10.24" tags="" position="525,1700" size="100,100">2010年9月的工党党魁选举开始前，帕克宣布自己不会参选，但也没有明确支持任何人。在艾德·米利班德当选党魁后，帕克放弃了继续争夺权力，甚至谢绝了进入影子内阁的机会。

此后的五年中，她一直在思考自己以后要往何处去。她认为，问题还是出在她没有坚持自己的信仰——她从80年代的老左派一点一点向中间挪动，改变立场，不仅失去了特色进而泯然众人，也失去了不少人的信任。老左派不喜欢她接受了右翼价值观这一点，布莱尔和布朗之流则认为她非自己族类。当然，她还是倾向老左派的，只是在内阁的最后五年中，她无法展现这一点，也正因此失去了许多人的信任。

2015年大选前，她回顾了一下自己的政治历程。当然，她可以选择退休，但她还是想留下来，继续干。或许，她还能再一次谋求成为党魁——但这样做的前提是，她要回到传统的左派立场，并在当前的工党和传统的、社会主义的工党之间寻求平衡。

于是，她决定……

[[我累了，干不动这行了。回家吧！-&gt;11.17]]

[[是时候再度出山了。-&gt;11.18]]</tw-passagedata><tw-passagedata pid="217" name="11.17" tags="end" position="275,1825" size="100,100">2015年大选后，帕克结束议员生涯，退出政坛。尽管她在南约克郡仍受不少人爱戴，但她在全英国的名声却很快消逝了。许多人想到帕克时，竟没什么印象——除了她的整个政治立场似乎一直是在往中间走这一点，许多人都记得。

帕克也知道过去30多年中自己做了些什么。说实话，她对没能坚定立场和原则感到有些遗憾——如果她能30年如一日做一个骄傲的社会主义者，那么，哪怕未能得到权力，她也不会自责，因为她知道自己做了正确的事。如果她一开始就说自己是温和派并按这条道路走，那也就算了——但她却没能如此专一，正是这一点让她感到抱憾终身。

她从来没有真正背叛过谁，或者真正违背过什么价值观——但她总感觉，自己疏远了进入政坛时那颗为工人阶级谋福利的初心，也因此承受了良心的谴责。她不喜欢别人称自己没有信仰，但她却在不知不觉中一点一点远离了过去的深红的信念。

或许她的遗憾之处就在于此吧。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“信仰捍卫者？”]
海伦·A·帕克（1952.7.20-），下议院议员（1983-2015），教育大臣（2005-2007），内政大臣（2007-2010）。尽管曾成为女王陛下的大臣，但她仍为自己未能捍卫信仰，成为一个真正的社会主义者而抱憾终身。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="218" name="11.18" tags="" position="400,1825" size="100,100">2015年大选最终以保守党以微弱优势获胜告终，艾德·米利班德随即辞去党魁一职。帕克抓住时机，宣布参加党魁选举，并明确了自己的政见——介于米利班德的中间派和杰里米·科尔宾的”老左派“立场之间。

出乎意料的是，帕克宣布参选后获得了布朗、布莱尔、米利班德兄弟等工党元老的一致支持，他们担心“极左”的科尔宾会直接葬送工党赢得议会选举的机会。由于只有科尔宾和帕克有竞争力，而且声誉都不太高，都有各自的软肋，这次党魁选举被亲保守党的媒体讽刺为“一个左派和一条变色龙较劲”。

最终，经过两轮投票，帕克以极其微弱的优势当选工党党魁。事实证明，她仍然很有实力——在2017年大选中，保守党因脱欧谈判问题失去了不少选票，未能获得过半选票，不得不组建少数派政府；但在2019年大选中，由于她始终没有就脱欧明确表态，导致工党失去了不少席位，保守党得以单独执政。

2019年大选最终还是压垮了帕克——她的年龄问题成为许多人怀疑的对象，她领导下的工党也迟迟无法就政治议题给出切实可行的行动方案，吸引足够多的选民。2020年4月，她宣布因健康原因辞去工党党魁职务，并在2024年大选后退出政坛。

[[现在一切都结束了。-&gt;11.18续]]</tw-passagedata><tw-passagedata pid="219" name="11.18续" tags="end" position="400,1950" size="100,100">和仍然活跃在政坛的科尔宾、2024年大选后重回内阁的艾德·米利班德相比，帕克相对比较籍籍无名。在她担任工党党魁的岁月中，她一方面不想像科尔宾那样推动国有化和扩大社会福利，另一方面也不想做没有特色的中间派——但以她的能力和威望，她找不到平衡点，最终仍然落得一个平庸的结局。许多人说，这是因为她从未找准自己的定位，从80年代的“老左派”开始，却始终在向中间派靠拢。她就像花展上的一朵红玫瑰，虽然美丽，但却说不出什么特色。

帕克又会怎么评价这段经历呢？不好说，因为她似乎也选择了沉默。或许她只是累了吧？


触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“红玫瑰”]
海伦·A·帕克（1952.7.20-），下议院议员（1983-2024），教育大臣（2005-2007），内政大臣（2007-2010），工党党魁（2015-2020）。虽然是一位老资历的政治家，但说不上一位成功的工党党魁。可惜了。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="220" name="6.6A" tags="" position="750,1200" size="100,100">1983年6月9日的大选中，虽然保守党获得397席并轻易地获得胜利，工党则仅得209席，但帕克却成功成为了中谢菲尔德选区议会议员。
(set: $vocation to &quot;poli&quot;)(set: $vocation2 to &quot;lawyer&quot;)
当选后的帕克基本随工党大流而动，默默观察着新任党魁基诺克（Neil Kinnock）开始推动工党回到更加温和的左翼立场。虽然她曾在议会发言，支持参与1984-1985年矿业工人大罢工的工人，但她对领导罢工的斯卡吉尔本人表示反对，更是严词批评工会未经充分谈判就发动罢工的行为。

1987年大选前夕，基诺克尝试拉拢她，建议她和自己合作，以争取更多政治资本。她心想……

[[可以观望一下，合作则未必。-&gt;7.12]]

[[好啊，我接受。-&gt;7.13]]</tw-passagedata><tw-passagedata pid="221" name="7.13" tags="" position="875,1325" size="100,100">1987年大选后，年仅35岁的帕克出乎意料地进入影子内阁，被任命为影子环境大臣。10月，英国发生黑色星期五股灾。事后，她批评一些伦敦商人“软弱无能”，以及伦敦证券交易所未有为小股民提供合理的服务，这些言论使她受到了相当的重视。当时便有人预测，帕克、布莱尔和布朗日后会成为工党的重要人物。

1992年大选前，备受基诺克本人青睐的帕克多次公开发表演讲，获得不少好评。然而，本届选举中工党虽然获得了比上届大选更多的席位，但仍然无法执政。与此同时，东欧剧变、苏联解体意味着传统的“真实存在的社会主义”已经失败，工党很有可能需要实施大刀阔斧的改革才能入主唐宁街。

帕克只是影子教育大臣，可能没法自己拟订一套改革方案，但她也知道，是否支持这次改革会成为她政治生涯的又一个分水岭。她心想……

[[我一直欢迎变革，这次也不例外。-&gt;8.18]]

[[静观其变吧。可别被某些人带着节奏跑。-&gt;8.19]]</tw-passagedata><tw-passagedata pid="222" name="8.18" tags="" position="875,1450" size="100,100">帕克很快开始关注工党改革的前沿动向——虽然，因为她的出身和过去经历，她仍然坚持废除上议院、实施单方面核裁军等立场，并且反对把工党的基本盘扩大到中产阶级，也反对减弱工会对工党的影响力，但她有种预感，这一切最终都会不情愿地化作现实。
(set: $preevent to 8.18)
1994年初，她开始收到风声，称布莱尔和布朗已经开始推动工党的改革方案，初步代号是“新工党”。1994年5月12日，工党党魁约翰·史密斯突发心脏病逝世。很快，党魁选举被定在7月21日。她不打算参加选举，但有种预感，布莱尔会在党魁选举和其后的代表大会上提到“新工党”——并且，他会因此一战成名。

[[看看布莱尔有什么好说的？-&gt;9.22]]</tw-passagedata><tw-passagedata pid="223" name="8.19" tags="" position="750,1450" size="100,100">帕克没有太多关注改革——虽然她的确意识到工党应当实施大改革，也支持英国与欧共体深化合作，反对英国退出北约，但她仍然坚持废除上议院、实施单方面核裁军等立场，并且反对把工党的基本盘扩大到中产阶级，也反对减弱工会对工党的影响力。
(set: $preevent to 8.19)
1994年初，她开始收到风声，称布莱尔和布朗已经开始推动工党的改革方案，初步代号是“新工党”。1994年5月12日，工党党魁约翰·史密斯突发心脏病逝世。很快，党魁选举被定在7月21日。她不打算参加选举，但有种预感，布莱尔会在党魁选举和其后的代表大会上提到“新工党”——并且，他会因此一战成名。

[[看看布莱尔有什么好说的？-&gt;9.22]]</tw-passagedata><tw-passagedata pid="224" name="9.22" tags="" position="775,1575" size="100,100">1994年7月21日，托尼·布莱尔击败玛格丽特·贝克特和约翰·普雷斯科特，成为工党党魁。在10月的工党大会上，布莱尔公布了名为“新工党，英国新生”的工党改革方案，列出以下要点：

在1995年修改工党党章第四条并明确工党的民主社会主义性质；

强调实现社会公正（而非平等）是工党的最高目标；

强调机会平等；

认为市场经济可用来实现工党的目标，并依靠公私合作和企业筹集资金；

认为工党是一个不分阶级的政党，并认为建设良好的劳资关系是工党的要务；

强调教育、福利、遏制犯罪在建立公正社会中的作用；

加税并设置累进税，同时提升社会保障水平。

“新工党”成为了工党的转折点——本来，保守党就因为经济衰退、失业率高涨而逐渐失去民心，如今“新工党”的提出无疑为这个老党打了一剂强心针，使工党的面貌焕然一新。1995年4月，虽然遭到一些传统左派的反对，但工党党章第四条仍然被修改。

帕克此时面临一个抉择——她要如何看待”新工党“？

(if: $preevent is 8.19)[[这是对社会主义价值的背离。我不能坐视不管！-&gt;11.19]]

[[保持开放和乐观的态度就行了。-&gt;11.20]]

(if: $preevent is 8.18)[[早该这样了，托尼！我会支持你的。-&gt;11.21]]</tw-passagedata><tw-passagedata pid="225" name="11.19" tags="end" position="650,1825" size="100,100">1997年大选中，布莱尔虽然成为首相，但出乎意料的是，工党的“明日新星”，影子就业和养老金大臣海伦·帕克却没有进入内阁——她在大选前两个月离开了影子内阁。她很清楚这么做的原因——她不能接受“新工党”，认为这是对阶级政治传统的背叛，更是工党和保守党合流的第一步。哪怕时光过去了许久，南约克郡已经变了样，产业工人队伍早已不如当初强大，但她仍然坚持保守的左翼价值观——许多人不以为意，但她乐在其中。

在她接下来的议员任期中，她出乎意料地保持了“老左派”的立场，而且当自己的立场与工党相违背时，也毫不客气——2003年，她率领不少工党议员反对英国入侵伊拉克，而布莱尔拿她一点办法都没有，最终在保守党支持下才通过出兵决定。

她不但捍卫阶级政治，而且也更激进地站在了人民一边。她反对英国参与利比亚内战和叙利亚战争，反对工党淡化党歌《红旗》的尝试，2015年，她出乎意料地公开纪念30多年的矿业工人大罢工，并对当时自己扮演的角色感到相当骄傲。同年，她支持科尔宾参选工党党魁。

时至今日，帕克仍然是下议院议员之一——她已历经41年的议员生涯，是下议院任期最长的议员；不过，她谢绝了相应的“下议院之母”称号。尽管许多人不赞同她的政治立场，但都相当尊敬这位威斯敏斯特宫的元老，认为她在过去40多年中，从未背离自己的原则和信仰。在互联网上，许多年轻人也对这位过去25年来，一直坐在前排、穿着灰色或红色风衣，永远用深蓝色眼眸盯着反对党（或执政党）前座议员团队的女士有很深刻的印象。


(align:&quot;=&gt;&lt;=&quot;)[//人民旗帜最最红
常年覆盖烈士心胸
四肢未僵尚暖和
心中血染红道道线缝

升旗帜鲜红高又高
哪管它旗下我存亡
懦夫退缩叛徒冷笑
我们要红旗高高飘//](align:&quot;==&gt;&quot;)+(box:&quot;=X&quot;)[——《红旗》]

触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“人民旗帜最最红”（变体）]
海伦·A·帕克（1952.7.20-），下议院议员（1983-），影子教育大臣（1992-1994），影子就业和养老金大臣（1994-1997）。若要说当今的英国还有哪些议员坚持“老左派”的阶级政治，几十年如一日捍卫旧日的政治生活，真正做到正直、可敬，那非她莫属。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="226" name="11.20" tags="" position="775,1825" size="100,100">1997年大选后，工党的“明日新星”，影子就业和养老金大臣海伦·帕克顺利转正。虽然她对”新工党“的一些改革措施还是心怀疑虑，但能进入内阁感觉总还算不错。2001年，她升任卫生大臣。布莱尔似乎没怎么怀疑过她的忠诚，而她也将自己对”新工党“的怀疑掩藏在了心底。尽管当年关于阿富汗战争的争论闹得沸沸扬扬，但帕克也没怎么参与——只不过，她心底里种下了一颗反战的种子。

然而，2003年初，关于英国是否应随美国一道入侵伊拉克的大争论，揭开了她和布莱尔的矛盾。布莱尔支持出兵推翻萨达姆政权，但帕克坚决反对，认为根本没有出兵所需的证据，理由也不够充分。更关键的是，她知道这场战争将成为美国霸权的标志，而她不希望自己默许这种罪行发生。

思索许久后，她决定……

[[告诉布莱尔，我不能接受。他想干什么随意。-&gt;12.16]]

[[保持沉默。如果日后要站出来反对他，那还有机会。-&gt;12.17]]</tw-passagedata><tw-passagedata pid="227" name="11.21" tags="" position="900,1825" size="100,100">1997年大选后，工党的“明日新星”，影子就业和养老金大臣海伦·帕克顺利转正。她对”新工党”基本已经放下所有疑虑，并且成功进入了布莱尔的核心圈。2001年，她升任卫生大臣。尽管当年关于阿富汗战争的争论闹得沸沸扬扬，但帕克也没怎么参与。

2003年，帕克火速升任内政大臣，又在2005年大选后成为外交和联邦事务大臣。许多民众对她火箭般的升迁速度感到相当惊讶，甚至认为工党内已经形成了布莱尔、布朗和帕克的“铁三角”。她在这两个岗位上的政绩都可圈可点，这使她有了竞争工党党魁一职的资本。

2007年布莱尔辞去首相一职后，新任首相布朗任命帕克为财政大臣，并表示他看好她，认为她完全有能力竞争工党党魁一职。然而，一场正在酝酿的金融风暴，或许将彻底葬送她的美梦。

[[山雨欲来……-&gt;12.18]]

</tw-passagedata><tw-passagedata pid="228" name="12.16" tags="end" position="650,1950" size="100,100">2003年4月，海伦·帕克突然宣布自己因就伊拉克战争问题与首相布莱尔产生争执，将辞去卫生大臣一职。她在声明中称，伊拉克战争“在道德上是不正当的”，并表示自己“必须坚持她认为正确的原则”。念在帕克资历很老，而且在其他议题上仍然和工党保持一致，所以工党没有把她开除。

此后，她不但捍卫阶级政治，而且也更激进地站在了人民与和平一边。她反对英国参与利比亚内战和叙利亚战争，反对工党淡化党歌《红旗》的尝试。2015年，她支持杰里米·科尔宾参选工党党魁。2022年，她反对英国向乌克兰提供军援，并称自己是“骄傲的反对帝国主义战争的和平主义者”；2023年，她则严厉谴责以色列在加沙的军事行动，呼吁立即停火，甚至亲自去了一趟加沙城。结果，不出意料，她被扣了“反犹主义”的帽子并被工党开除——但她却在2024年的大选中以巨大优势保住了自己的议席。

时至今日，帕克仍然是下议院议员之一——她已历经41年的议员生涯，是下议院任期最长的议员；不过，她谢绝了相应的”下议院之母“称号。尽管许多人不赞同她的政治立场，但都相当尊敬这位威斯敏斯特宫的元老，认为她在过去40多年中，从未背离自己的原则和信仰，并且始终毫不含糊地站在和平一边。当然，也有不少人说她对反恐和“捍卫民主国家”毫不上心、不负责任。这就见仁见智了。

不过，真的有人会无视她捍卫和平的声音吗？不会吧不会吧？



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“和平捍卫者”]
海伦·A·帕克（1952.7.20-），下议院议员（1983-），就业和养老金大臣（1997-2001），卫生大臣（2001-2003）。虽然仍是广义上的“新工党人”，疏远了阶级政治，但她也以自己曾捍卫和平而自豪。这一点总没什么好挑刺了吧？//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)
</tw-passagedata><tw-passagedata pid="229" name="12.17" tags="" position="775,1950" size="100,100">虽然许多英国民众反对参加伊拉克战争，但布莱尔最终在保守党的支持下通过了出兵决议。帕克作为他的内阁成员，选择了对此事保持沉默。事实证明，这也成为她完全接受“新工党”价值观的里程碑事件。

2005年大选后，帕克被提拔为内政大臣；2007年布朗接替布莱尔后，她进一步升职为外交和联邦事务大臣。到2010年大选前夕，帕克已经被认为有能力竞争党魁一职。结果，当年大选真的给了她这个机会——5月6日的议会大选中，工党席位从349席下降到258席，不得不寻求与自由民主党谈判组建联合政府。然而，布朗在5月11日宣布谈判失败，次日辞职，戴维·卡梅伦成为新任首相。

几天后，布朗再次找上她，并直接向她提出了一个惊人的要求——他希望她竞选工党党魁，而她最大的对手将会是能源与气候变化大臣艾德·米利班德（Ed Miliband）。
(set: $preeevent to 12.17)
[[看来必须临危受命一回了。-&gt;13.12]]</tw-passagedata><tw-passagedata pid="230" name="16.3续" tags="end" position="4225,2575" size="100,100">2022年11月，特拉斯辞职后不久，《卫报》以“唐宁门丑闻”（Downinggate Scandal）为题报道了整个事件，瞬间引发全世界媒体的关注。在猛烈的舆论抨击下，2019年卸任首相的卡梅伦首先承认了此事的存在，随后，2023年3月，帕克也不得不承认，自己完全知情卡梅伦的行为，但她强调自己是为英国的利益行事。她说：“我在公职生涯中做出的每一个决定都是为了国家的利益。如果我们决定脱离欧盟，我们可能将陷入五年甚至十年的谈判和法律战中。我们需要解决北爱尔兰边界问题。直布罗陀的主权问题——尽管我们反复重申没什么好谈的——也会浮现。我们的市场信心会受到破坏，国家会陷入混乱。”

尽管如此，这番发言并不怎么受人待见。根据民调，只有27%受访者认为帕克的行为是可以接受的，70%的受访者认为不可接受，65%的受访者要求帕克道歉，还有56%受访者要求举行二次脱欧公投。最终，她在2023年3月31日发表了一封道歉声明，宣布对“唐宁门事件”负责，并永久退出政坛，自此隐居，也随之逃过了被起诉的命运，远离了这场持续至今的政治风暴的中心。


时至今日，帕克可能是英国近现代历史上评价最撕裂的人物，或许只有撒切尔夫人或以诺奇·鲍威尔（Enoch Powell）才能和她相比。她的争议之处不在于像撒切尔夫人那样用新自由主义击垮了战后共识，而在于她为了政治目的——虽然名义上不是为了个人权力，而是为了国家利益——而破坏了英国的宪政体制。问题不在于留欧或脱欧，而是能否遵循古老的宪政制度——在这个问题上，帕克显然不是一位合格的首相，甚至不是一个合格的公民。但是，也有不少人赞扬她，称至少和水门事件中的尼克松比起来，帕克追寻的是国家利益，她用例外状态下的决断取代了法律，以事实上的主权者身份阻止英国滑向可能的危机。

对于穿越时空，洞察历史的另一种可能的诸位，她的经历或许会唤起各位的同情心吧？



触发结局：
//&#39;&#39;(text-colour: yellow)[隐藏结局：“唐宁门事件”]
非常尊敬的(if: $birth is 1)[达尔基斯的帕克女男爵](if: $birth is 2)[富勒姆的帕克女男爵]海伦·A·帕克（1952.7.20-），保守党党魁（2005-2017），英国首相（2010-2017）。为了捍卫她认为的国家利益，不惜违反英国古老的宪政制度——最终落得一个极具争议的结局。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="231" name="也可以先看看上一把结算" tags="" position="2300,200" size="100,100">[[返回介绍-&gt;Start]]


&#39;&#39;人物：&#39;&#39;
海伦·A·帕克


&#39;&#39;出生日期：&#39;&#39;
1952年7月20日


&#39;&#39;出生地点：&#39;&#39;
(if: $birth is 1)[爱丁堡，苏格兰](if: $birth is 2)[切尔西，伦敦](if: $birth is 3)[谢菲尔德，南约克郡]


&#39;&#39;受教育经历：&#39;&#39;
(if: $university is &quot;edin&quot; and $degree is &quot;BA&quot;)[爱丁堡大学国际关系硕士](if: $university is &quot;edin&quot; and $degree is &quot;PhD&quot;)[爱丁堡大学国际关系博士](if: $university is &quot;ox&quot; and $degree is &quot;BA&quot;)[牛津大学哲学、政治学与经济学学士](if: $university is &quot;ox&quot; and $degree is &quot;PhD&quot; )[牛津大学政治学博士](if: $university is &quot;shef&quot;)[谢菲尔德大学法学学士](if: $university is &quot;man&quot;)[曼彻斯特大学现代语言硕士]


&#39;&#39;职业：&#39;&#39;
(if: $vocation is &quot;poli&quot;)[政治家](if: $vocation is &quot;media&quot;)[记者](if: $vocation is &quot;army&quot;)[军人](if: $vocation is &quot;mi6&quot;)[军情六处特工](if: $vocation is &quot;lawyer&quot;)[律师](if: $vocation is &quot;entre&quot;)[企业家](if: $vocation is &quot;union&quot;)[工会活动家](if: $vocation is &quot;civil&quot;)[公务员（外交官）]


&#39;&#39;第二职业：&#39;&#39;
(if: $entrancetopolitics is &quot;thinktank&quot;)[智库研究员](if: $vocation2 is &quot;EDS&quot;)[电子数据系统公司董事](if: $vocation2 is &quot;PMC&quot;)[私人军事服务领域从业者](if: $vocation2 is &quot;media&quot; and $vocation is not &quot;media&quot;)[记者](if:$vocation2 is &quot;lawyer&quot; and $vocation is not &quot;lawyer&quot;)[律师]


&#39;&#39;党籍：&#39;&#39;
(if: $party is &quot;neutral&quot;)[无党籍](if: $party is &quot;lab&quot;)[工党](if: $party is &quot;con&quot;)[保守党](if: $party is &quot;lib&quot;)[自由民主党](if: $party is &quot;scot&quot;)[苏格兰民族党](if: $party is &quot;NCP&quot;)[不列颠新共产党]


&#39;&#39;特殊成就：&#39;&#39;
(if: $special1 is &quot;brexit&quot;)[英国没有脱离欧盟](if: $special1 is &quot;election&quot;)[选择投票制公投胜利](if: $special1 is &quot;iraq&quot;)[英国没有参与伊拉克战争](if: $special1 is &quot;scot&quot;)[苏格兰自联合王国独立](if: $special1 is &quot;perseus&quot;)[……“珀修斯”成员？]
(if: $university is &quot;ox&quot; and $degree is &quot;BA&quot; and $birth is 1 and $vocation is &quot;mi6&quot; and $entrance is 1972 and $preevent is 23.2)[(size: 1.1)[&#39;&#39;最为罕见的特殊成就——与《与命运相会》设定完全一致！&#39;&#39;]]</tw-passagedata><tw-passagedata pid="232" name="12.18" tags="" position="900,1950" size="100,100">随着2008年全球金融危机爆发，布朗政府使出浑身解数仍然无法遏制经济下行。尽管她执行布朗的政策，对英国银行业进行资本重组，以及实施临时财政刺激，但英国经济仍然陷入困难，使布朗与工党支持率不断下降，甚至多次有资深党员要求他辞职。工党的支持率随之大跌，并在2009年欧洲议会和地方议会选举中大败。

于是，帕克在巨大争议中迎来了2010年大选。5月6日的议会大选中，工党席位从349席下降到258席，不得不寻求与自由民主党谈判组建联合政府。然而，布朗在5月11日宣布谈判失败，次日辞职，戴维·卡梅伦成为新任首相。

几天后，布朗再次找上她，并直接向她提出了一个惊人的要求——他希望她竞选工党党魁，而她最大的对手将会是能源与气候变化大臣艾德·米利班德（Ed Miliband）。
(set: $preeevent to 12.18)
[[看来必须临危受命一回了。-&gt;13.12]]</tw-passagedata><tw-passagedata pid="233" name="13.12" tags="" position="825,2075" size="100,100">2010年9月的工党党魁选举开始前，帕克决定参选。在第一轮选举中她名列第二，而在第二轮选举中，她凭着丰富经验和良好的公众形象击败了艾德·米利班德并当选党魁。

当选党魁后，帕克采取相对偏左的立场，反对卡梅伦政府削减公共预算，没有明确就2011年的选择投票制公投表达意见，反对苏格兰独立，同时也支持英国留在欧盟。帕克提出多项政纲，包括削减政府赤字、提高生活水平、改善国民医疗服务体系（NHS），控制移民、削减大学学费、降低住房成本，并表示这一政纲并不要求加税。这一政纲很受欢迎，帕克本人也四处巡回拉票，大幅提高了工党的支持率。

尽管如此，不少民调仍然显示保守党的支持率略高于工党，也有一些显示出相反的结果；观察家认为2015年大选的选情将相当焦灼。帕克知道这是她争取政治权力的最后一搏，如果失败，她只有辞职一条路。
(set: $luck to (random:1,100))
(if: $luck is &gt;= 50)[[[5月7号，一切都将尘埃落定。-&gt;14.8A]]]

(if: $luck is &lt; 50)[[[5月7号，一切都将尘埃落定。-&gt;14.8B]]]


</tw-passagedata><tw-passagedata pid="234" name="14.8A" tags="" position="775,2200" size="100,100">5月7日早上，帕克早早在伦敦投了票，随后回到工党党部。当天早些时候，开票结果对工党比较不利，但随着时间流逝，工党逐渐逆转了选情，赢得了许多城市选区。最终，5月8日上午，一切尘埃落定——工党315席，保守党311席，均没有达到绝对多数。除此之外，支持苏格兰独立的苏格兰民族党得到56席，自由民主党12席。

帕克知道，唯一让她当上首相的方法就是尽快组建联合政府或者签订信任供给协议，但和谁谈判却是个问题。尽管苏格兰民族党表示会和工党合作，但帕克知道这样大概率会导致二次苏格兰独立公投；自由民主党的席位很少，很容易导致政府失去过半议员支持进而倒台。

她没有多少时间思考了——必须开始行动。

[[先和苏格兰民族党接触。但是二次公投就别想了。-&gt;15.9A]]

[[我们和苏格兰民族党没什么不能谈的。再说了，公投又不会成功。-&gt;15.9C]]

[[试试自由民主党。反正他们再这么当马前卒，下届选举就没份了。-&gt;15.9B]]</tw-passagedata><tw-passagedata pid="235" name="14.8B" tags="end" position="900,2200" size="100,100">5月7日早上，帕克早早在伦敦投了票，随后回到工党党部。当天早些时候，开票结果对工党比较不利，遗憾的是，这个趋势一直没有逆转过来。最终，当选举结果公布时，帕克知道自己失败了——保守党取得过半多数，工党则仅取得232席，相比上次选举还下降了。

5月9日，帕克宣布为这次失败负责，辞去工党党魁一职。卸任后的帕克起初保留了下议院议员身份，但在2017年没有谋求连任；此后，她仍然保留了一些职务，比如智库外交政策中心（FPC）的顾问委员会成员、战略与国际研究中心（CSIS）的客座研究员，但基本与政党政治无涉了。2024年大选以工党大获全胜后，新任首相斯塔默原本希望请她重回内阁，但被她谢绝了——她说自己想要“安静一下”。

时至今日，帕克在英国政坛不算很有名气，但评价并不低。许多工党党员认为，她是一位临危受命的领袖——尽管没能带领工党赢得大选，但至少她已经尽了全力，在一个没有布莱尔和布朗的“新工党”时代领导这个老党负重前行。她也认为，她尽到了职责。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“临危受命”]
海伦·A·帕克（1952.7.20-），下议院议员（1983-2017），(if: $preevent is 12.17)[内政大臣（2005-2007），外交和联邦事务大臣（2007-2010）](if: $preevent is 12.18)[外交和联邦事务大臣（2005-2007），财政大臣（2007-2010）]，工党党魁（2010-2015）。一位受命于危难之际的工党领袖，虽说不上一位功成名就的政治家，但至少也在履行了职责后全身而退。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="236" name="15.9A" tags="end" position="650,2325" size="100,100">由于在信任供给协议谈判中明确反对就苏格兰独立举行二次公投，称这只有英国下议院才有资格决定，也不允许进一步将权力下放给苏格兰，被寄予很大希望的工党和苏格兰民族党合作最终以双方不欢而散告终。与此同时，保守党则和自由民主党谈妥了信任供给方案。5月14日，帕克宣布组阁谈判破裂，而卡梅伦则宣布他将连任首相。

此后的一切也众所周知了——脱欧公投最终以脱欧方的微弱优势胜出，此后英国陷入了旷日持久的脱欧谈判拉锯战。保守党内部则在长期执政后逐渐发生分裂，最终一发不可收拾，在2022年的一连串政府危机后名誉尽失。一直到2024年大选后，工党才重回内阁。

当然，这和帕克没什么关系了——她在组阁谈判破裂后就宣布辞去工党党魁职务，在继续担任了两年议员后结束了政治生涯。此后，她仍然保留了一些职务，比如智库外交政策中心（FPC）的顾问委员会成员、战略与国际研究中心（CSIS）的客座研究员，但基本与政党政治无涉了。2024年大选以工党大获全胜后，新任首相斯塔默原本希望请她重回内阁，但被她谢绝了——她说自己想要“安静一下”。


时至今日，帕克在英国政坛不算很有名气，但评价并不低（在苏格兰除外）。许多工党党员认为，她是一位临危受命的领袖——尽管没能带领工党执政，但至少她已经尽了全力，在一个没有布莱尔和布朗的“新工党”时代领导这个老党负重前行。至于和苏格兰民族党谈判破裂，某种意义上也是一个可以预料到的结局。最关键的是，她也认为，她尽到了职责。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“临危受命”（变体）]
海伦·A·帕克（1952.7.20-），下议院议员（1983-2017），(if: $preevent is 12.17)[内政大臣（2005-2007），外交和联邦事务大臣（2007-2010）](if: $preevent is 12.18)[外交和联邦事务大臣（2005-2007），财政大臣（2007-2010）]，工党党魁（2010-2015）。一位受命于危难之际的工党领袖，虽说不上一位功成名就的政治家，但至少也在履行了职责后全身而退。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="237" name="15.9B" tags="" position="900,2325" size="100,100">由于自由民主党势单力薄，在许多社会问题上也和工党立场相近，所以双方很快谈妥了信任供给协议。5月14日，帕克宣布与自由民主党的信任供给谈判成功，并随之入主唐宁街10号。

新的工党政府在内政和外交方面很快取得了成果。在帕克领导下，英国大幅减少海外干涉，几乎完全从叙利亚撤出，也减少了对沙特阿拉伯的支持，还和俄罗斯、中国有限改善了关系。在内政方面，英国经济恢复增长，GDP增长率从2015年的2.6%提升到了2016年的3%，公共服务也有所改善——当然，代价是加税。

尽管如此，英国与欧盟关系问题仍然成为了政府绕不过去的坎。她的政府坚定支持留在欧盟，而保守党则从最初的摇摆不定很快转向支持脱欧。在巨大的民意压力下，帕克不得不在2016年1月宣布，将在2018年底前举行脱欧公投。

2017年初，议会通过法案，决定在当年6月23日举行公投。帕克知道这次公投将决定她的政治生涯——结果似乎还比较乐观，留欧派在绝大多数民调中均有微弱优势，自由民主党也全力支持他们。然而，公投结果的不确定性还是令人心焦。

6月23日早晨，她在一夜未眠后醒来，准备迎接未知的命运。

[[会赢吗？会赢吗？-&gt;16.8]]</tw-passagedata><tw-passagedata pid="238" name="15.9C" tags="" position="775,2325" size="100,100">在信任供给协议中，帕克摆出了相对比较温和的立场，最终获得了苏格兰民族党将信将疑的支持——不过至少足够组阁了。5月14日，帕克宣布与苏格兰民族党的信任供给谈判成功，并随之入主唐宁街10号。

然而，这届英国历史上前所未有的政府自一开始就受到巨大争议。保守党抨击工党和苏格兰民族党结盟将“导致二次公投，并威胁到联合王国的统一”，政府的支持率也开始下跌。同时，英国国内支持脱欧的民众对这届政府感到极其忧虑，因为两个党都极其反对脱欧。另外，也有许多人对工党选择和苏格兰民族党这个地区性政党结盟感到担忧，并认为这会加剧苏格兰和英国其余地区的矛盾。这也严重阻碍了工党的施政。另外，政府迟迟不就英国与欧盟关系问题表态，也导致了支持率的下降。

在巨大的民意压力下，帕克不得不在2016年1月宣布，将在2018年底前举行脱欧公投。她的政府坚定支持留在欧盟，而保守党则从最初的摇摆不定很快转向支持脱欧。2017年初，议会通过法案，决定在当年6月23日举行公投。帕克知道这次公投将决定她的政治生涯——而且，结果并不乐观。由于工党政府的执政并不受欢迎，留欧派也受到连带影响，在绝大多数民调中均处于劣势。更致命的是，信任供给协议已经摇摇欲坠，政府在议会的多数岌岌可危。

6月23日早晨，她在一夜未眠后醒来，准备迎接必然的命运。

[[历史会站在我们这一边。-&gt;16.7]]</tw-passagedata><tw-passagedata pid="239" name="16.7" tags="end" position="775,2450" size="100,100">2017年6月23日，51.9%的英国选民支持英国脱离欧盟。在公投结果出炉后的第二天，帕克决定为公投失败承担全部责任，并宣布将解散议会提前选举。在六周后举行的大选中，工党以巨大劣势败于保守党，结束了仅仅两年多的执政。

此后的一切众所周知，但又不完全一致——在旷日持久的脱欧谈判中，保守党也没占到多少好处。2019年，特蕾莎·梅辞去首相一职，鲍里斯·约翰逊接替了她，并使英国在2020年1月31日退出欧盟。然而，约翰逊很快面临新冠疫情、生活成本危机，又因为“派对门”等许多原因，导致政府陷入危机。在随后的混乱中，约翰逊辞职、女王伊丽莎白二世驾崩、特拉斯上任后马上在一片骂声中辞职……保守党在众目睽睽下变成了一个笑话。

当然，这和帕克没什么关系了——她在大选落败后宣布辞去工党党魁职务，在继续担任了两年议员后结束了政治生涯。此后，她仍然保留了一些职务，比如智库外交政策中心（FPC）的顾问委员会成员、战略与国际研究中心（CSIS）的客座研究员，但基本与政党政治无涉了。2024年大选以工党大获全胜后，新任首相斯塔默原本希望请她重回内阁，但被她谢绝了——她说自己想要“安静一下”。

这也是有道理的。许多民调显示，帕克是英国近现代史上评价最中庸的首相之一。在她短暂的两年任期中，她没有什么拿得出手的政绩，内政和外交都难有建树，并且输掉了脱欧公投的豪赌。作为布莱尔和布朗的同辈，她原本被寄予厚望，但最终却平平无奇——不得不说是一大遗憾。

或许，一两代以后的年轻人听说曾有一位英国首相名叫海伦·帕克时，会惊讶地问：”帕克？那是谁？“



触发结局：
//&#39;&#39;(text-colour: red)[坏结局：“帕克？那是谁？”]
海伦·A·帕克（1952.7.20-），下议院议员（1983-2017），工党党魁（2010-2017），英国首相（2015-2017）。可能是撒切尔夫人以来最没有存在感也最平庸的英国首相了。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)

（作者注：说实话，这可能是坏结局里最不坏的那个……）</tw-passagedata><tw-passagedata pid="240" name="16.8" tags="" position="900,2450" size="100,100">帕克的豪赌成功了——2017年6月23日，51.1%的英国选民支持英国留在欧盟。尽管对于要怎么解决英国与欧盟关系问题并没有多少头绪，保守党会不会出现后座议员叛变也没有定数，但帕克知道，至少她能给英国人民留下一个坚强、无畏的女强人形象。
(set: $special1 to &quot;brexit&quot;)
2017年12月21日，欧洲议会通过英国重新谈判欧盟会籍得出的新条款，引入“红牌”机制，即欧盟理事会可以以55%多数，提醒欧洲议会对某一事项的立法存在争议并应当加以修改。这一机制的目的是使某些争议事项并不由欧盟立法决定，而是交给各成员国的立法机关加以处理。新条款同时还包括“急刹车”机制，允许欧洲理事会授权“移民流入量过大”的国家限制新移民可享有的社会福利，最长为期四年；增加各成员国驱逐有欧盟国籍的罪犯的权力；允许非欧元区国家自愿加入或执行欧元区国家通过的财政政策，并避免欧元区国家将由他们通过，但与非欧元区国家不相干的欧盟政策加诸于后者之上。

在获得这次大胜后，工党的凝聚力进一步加强，帕克也坐稳了首相的宝座。2019年大选中，工党轻易获得过半席位，得以单独执政。尽管此时以杰里米·科尔宾为代表的左翼分子开始和帕克领导下的内阁产生分歧，但总体而言工党的前途是光明的。


时间来到2020年3月。新冠疫情已经肆虐了好一阵，不少英国人已经感染了病毒，甚至病死。帕克和她的内阁尽了一切努力控制疫情，但情况似乎还是不见好转，政府的支持率也一路走低。她本人的名望还不错，但科尔宾正带领那批传统的左翼分子对她发起挑战。

3月27日，她第一次咳嗽了几下，并且开始发烧。新冠病毒抗原检测呈阳性，意味着她也中招了。内阁成员并不确定该怎么做，而她自己也拿捏不定。医生当然建议她马上就医，但她可是首相，怎么能就这样离开岗位呢？
(set: $luck to (random:1,100))
她心想……

(if: $luck is &gt;=50)[[[不会有事的，这只是重感冒而已。-&gt;17.4]]](if: $luck is &gt;=50)[[[不会有事的，这只是重感冒而已。-&gt;17.4A]]]

[[继续观察吧，如果有问题就赶紧治疗。你年纪大了，不要硬撑。-&gt;17.5]]

</tw-passagedata><tw-passagedata pid="241" name="17.4" tags="end" position="900,2575" size="100,100">她没怎么在意，继续工作，但到4月2号，她起来时感到头疼欲裂，喉咙像火烧一样。在医生的强烈要求下，她才入院治疗；但到4月6号，她由于病情恶化被送进ICU，需要靠呼吸机维生，甚至一度濒临死亡。4月12日，她转入普通病房，一直到三周后才完全康复并恢复工作。

尽管如此，她的健康和精力已经大受打击。在康复后，她仍然经常感到疲倦，或是身体虚弱。6月，她在一次公开演讲中出虚汗的画面被记者拍到后，引发不少英国民众对她健康的质疑。党内开始有声音呼吁她因为健康原因而辞职——最终，她认为这是最好的保全她过去五年来声望的方式。

2020年7月8日，海伦·帕克宣布因健康原因辞去工党党魁和英国首相职务。在她宣布辞职的当天，支持工党的《卫报》用”甜心帕克走了“（Park The Sweetheart Has Left）这个头版头条报道了此事，并表达了对她过去五年首相生涯的赞许。许多英国民众也在网上表达了对她的惋惜和赞誉——当然，也有不少诋毁和攻击。

今天，帕克在英国仍然很有名，也相当受欢迎。她是英国历史上唯二担任过四大内阁重臣（首相、财政大臣、外交大臣、内政大臣）的政治人物——另一位是詹姆斯·卡拉汉。虽然2024年大选以工党落败告终，但帕克对这个党的影响仍然不可小觑。在她任内，英国度过了脱欧公投后、新冠疫情前最后一段”美好时光“——或许也是因此，她才被无数人怀念吧。



触发结局：
//&#39;&#39;(text-colour: blue)[好结局：“甜心帕克”（变体）]
海伦·A·帕克（1952.7.20-），下议院议员（1983-2024），工党党魁（2010-2020），英国首相（2015-2020）。她带领英国留在欧盟，经历了新冠疫情前最后的美好时光，并在许多人的欢送中离开政坛，安然退隐。对于当今的政客而言，这已经算是一个很不错的结局了。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="242" name="17.4A" tags="end" position="1025,2575" size="100,100">她没怎么在意，继续工作，但到4月2号，她起来时感到头疼欲裂，喉咙像火烧一样。在医生的强烈要求下，她才入院治疗；4月6号，她由于病情恶化被送进ICU，需要靠呼吸机维生。由于情况不见好转，她委托副首相基尔·斯塔默代理首相职责。8号，由于她的健康状况持续恶化，政府开始启动应急预案。

尽管整个英国都在为她的康复而祈祷，但最终，一切都白费了。4月12日晚，英国首相海伦·A·帕克在圣托马斯医院因新冠肺炎逝世，享年67岁。她也成为了160多年后，第一位在任上逝世的英国首相。依照她不举行国葬、疫情时期一切从简的遗愿，她的葬礼于4月19日在伦敦圣保罗大教堂举行。由于新冠疫情导致的“封锁令”，只有300多人出席了她的葬礼。一直到她逝世后，她的家人和密友才承认，帕克自青年时期就一直没戒掉烟瘾，且五年首相生涯也让她身心俱疲。


时至今日，帕克在英国仍然很有名，也相当受欢迎。她是英国历史上唯二担任过四大内阁重臣（首相、财政大臣、外交大臣、内政大臣）的政治人物——另一位是詹姆斯·卡拉汉。令人唏嘘的是，她在疫情时期的悲剧性结局使英国人民更多将她视作一个悲剧人物，而非一位老成的政治家。人们会首先想起她是23万因新冠疫情死亡的英国人之一，其次才想起她的五年首相生平，并说她干得不错。当然，也有不少人虽然会对她的遗憾退场说几句客套话，但随后就抨击她作为首相无才也无德。

无论如何，历史最终会给她一个公正的评价。



触发结局：
//&#39;&#39;(text-colour: yellow)[隐藏结局：“世界线收束”]
海伦·A·帕克（1952.7.20-2020.4.12），下议院议员（1983-2020），工党党魁（2010-2020），英国首相（2015-2020）。她的政治生涯因新冠疫情而戛然而止，她也很不幸地成了因新冠疫情而逝世的行政首脑中，地位最高、权力最大的一位。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)

（作者注：如果您不知道为何这个结局叫“世界线收束”，那就体验一下默认结局吧。）</tw-passagedata><tw-passagedata pid="243" name="17.5" tags="end" position="775,2575" size="100,100">她咨询了自己的医生，后者建议她尽快寻求治疗。于是，3月30日，她请副首相基尔·斯塔默代理首相职责，开始接受治疗。幸运的是，她的病情没有严重恶化，在10天后她便出院了。4月15日，她回到工作岗位。

不过，她的健康和精力的确因此大受打击。在康复后，她仍然经常感到疲倦，或是身体虚弱。6月，她在一次公开演讲中出虚汗的画面被记者拍到后，引发不少英国民众对她健康的质疑。党内开始有声音呼吁她因为健康原因而辞职——最终，她认为这是最好的保全她过去五年来声望的方式。

2020年7月8日，海伦·帕克宣布因健康原因辞去工党党魁和英国首相职务。在她宣布辞职的当天，支持工党的《卫报》用”甜心帕克走了“（Park The Sweetheart Has Left）这个头版头条报道了此事，并表达了对她过去五年首相生涯的赞许。许多英国民众也在网上表达了对她的惋惜和赞誉——当然，也有不少诋毁和攻击。

今天，帕克在英国仍然很有名，也相当受欢迎。她是英国历史上唯二担任过四大内阁重臣（首相、财政大臣、外交大臣、内政大臣）的政治人物——另一位是詹姆斯·卡拉汉。虽然2024年大选以工党落败告终，但帕克对这个党的影响仍然不可小觑。在她任内，英国度过了脱欧公投后、新冠疫情前最后一段”美好时光“——或许也是因此，她才被无数人怀念吧。



触发结局：
//&#39;&#39;(text-colour: blue)[好结局：“甜心帕克”]
海伦·A·帕克（1952.7.20-），下议院议员（1983-2024），工党党魁（2010-2020），英国首相（2015-2020）。她带领英国留在欧盟，经历了新冠疫情前最后的美好时光，并在许多人的欢送中离开政坛，安然退隐。对于当今的政客而言，这已经算是一个很不错的结局了。&#39;&#39;//

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="244" name="6.7" tags="" position="875,1200" size="100,100">帕克没有进入政坛，而是留在了《每日镜报》继续担任编辑。事实证明，没有傻乎乎参加大选是个很正确的决定——1983年6月9日的大选中保守党获得397席并轻易地获得胜利，工党则仅得209席。

四年时光过去，帕克也成为《每日镜报》最有名的编辑之一。虽然她支持参与1984-1985年矿业工人大罢工的工人，但她对领导罢工的斯卡吉尔本人表示反对，更是严词批评工会未经充分谈判就发动罢工的行为。这种和工党基本相近的立场使她在《每日镜报》混得风生水起，还结识了负责政治版的同事，记者阿拉斯泰尔·坎贝尔（Alastair Campbell）。帕克知道坎贝尔是个人脉广泛的媒体人，曾在许多报社供职，写过诸多题材各异的文章。

1990年，帕克成了《每日镜报》的政治版主编，并和工党党魁基诺克成了好友。此时，她已经无心竞选议员——她知道自己不需要进入威斯敏斯特宫，也能影响这个国家。此时，《卫报》用巨额年薪招揽她，请她加入编辑部，但代价是五年内不能转业。帕克有点拿捏不定——这似乎是个挺不错的主意，但她不喜欢被绑定在一家报社。
(set: $preevent to 6.7)
所以，应该怎么办呢？

[[《每日镜报》挺适合我的，没必要跳槽。-&gt;7.14]]

[[总不能给小报打一辈子工。是时候改换门庭了。-&gt;7.15]]</tw-passagedata><tw-passagedata pid="245" name="6.8" tags="" position="1000,1200" size="100,100">帕克没有进入政坛，而是留在了《每日镜报》继续担任编辑。事实证明，没有傻乎乎参加大选是个很正确的决定——1983年6月9日的大选中保守党获得397席并轻易地获得胜利，工党则仅得209席。

四年时光过去，帕克也成为《每日镜报》最有名的编辑之一。她同情参与1984-1985年矿业工人大罢工的工人，但她不支持他们走上街去罢工，对领导罢工的斯卡吉尔本人表示反对，更是严词批评工会未经充分谈判就发动罢工的行为。这种中间派的立场使她在《每日镜报》受到了一些人的非议。不过，她结识了负责政治版的同事，记者阿拉斯泰尔·坎贝尔（Alastair Campbell）。帕克知道坎贝尔是个人脉广泛的媒体人，曾在许多报社供职，写过诸多题材各异的文章，虽然年龄比她小，但前途也绝对比她好。

1990年，帕克成了《每日镜报》的政治版主编，并和工党党魁基诺克成了好友。此时，她已经无心竞选议员——她知道自己不需要进入威斯敏斯特宫，也能影响这个国家。此时，《卫报》用巨额年薪招揽她，请她加入编辑部，但代价是五年内不能转业。帕克有点拿捏不定——这似乎是个挺不错的岗位，但她不喜欢被绑定在一家报社。
(set: $preevent to 6.8)
所以，应该怎么办呢？

[[《每日镜报》挺适合我的，没必要跳槽。-&gt;7.14]]

[[总不能给小报打一辈子工。是时候改换门庭了。-&gt;7.15]]

[[有没有一种可能，应该去更高级一些的平台了？-&gt;7.16]]</tw-passagedata><tw-passagedata pid="246" name="7.14" tags="" position="1000,1325" size="100,100">帕克选择留在《每日镜报》，继续担任政治版主编。在这个岗位上，她积攒了大量应对媒体的策略和经验，也因此成为英国报业的一颗新星。

1994年5月12日，工党党魁约翰·史密斯突发心脏病逝世。1994年7月21日，托尼·布莱尔击败玛格丽特·贝克特和约翰·普雷斯科特，成为工党党魁。在10月的工党大会上，布莱尔公布了名为“新工党，英国新生”的工党改革方案，宣布将修改党章第四条使工党成为一个“民主社会主义政党”，以社会公正为党的最高目标，并认为市场经济可用来实现工党的目标。与此同时，她得知布莱尔正在招募一位新闻秘书，担任他在新闻、媒体、公关等事务上的首席顾问。

帕克脑海深处那些关于政治生活的回忆，全部被唤醒了。当然，她已经远离政治生活有一段时间了，但现在这个“新工党”却着实让她有了重回政坛的想法。

(if: $preevent is 6.7)[[[好机会，何不尝试一下？-&gt;8.19A]]](if: $preevent is 6.8)[[[好机会，何不尝试一下？-&gt;8.19B]]]

[[三思之后，我觉得还是算了吧。-&gt;8.20]]</tw-passagedata><tw-passagedata pid="247" name="7.15" tags="" position="1125,1325" size="100,100">1991年，帕克跳槽到了《卫报》，担任政治版主编。三年时光过去，1994年，年富力强的托尼·布莱尔成为了工党党魁。上任后不久，布莱尔便公布了名为“新工党，英国新生”的工党改革方案，宣布将修改党章第四条使工党成为一个“民主社会主义政党”，以社会公正为党的最高目标，并认为市场经济可用来实现工党的目标。1995年初，曾经和帕克共事过的阿拉斯泰尔·坎贝尔成为了布莱尔的新闻秘书，担任他在新闻、媒体、公关等事务上的首席顾问。

这时，帕克才得知，因为她选择去《卫报》，所以布莱尔直接选择了坎贝尔，对她看都没看一眼。

[[好吧，这是我自己选择的……-&gt;8.21]]</tw-passagedata><tw-passagedata pid="248" name="7.16" tags="end" position="1250,1325" size="100,100">1991年，帕克跳槽到了《新政治家》（New Statesman）杂志，她的政治立场也更加偏向中间派。在这家更加严肃、更加高级的杂志社，帕克转变了风格，开始真正就国际政治经济的前沿问题和热点事件撰写文章。在为《新政治家》工作十多年后，她在2001年成为杂志总编辑。

在她的领导下，《新政治家》确立了偏自由主义、进步主义的立场，同时高度支持布莱尔的工党政府。然而，当布莱尔决定入侵伊拉克时，帕克不顾报社许多人反对，让编辑撰写文章，抨击这一决定。不过除了这一小插曲，《新政治家》一直支持工党，哪怕是在2008年的全球金融危机之后也一样如此。

2010年，帕克选择退休，随后成为著名媒体人和名嘴。她总体上保持了和工党一致的中左翼立场，经常上电视，参加BBC的政论节目《提问时间》（Question Time）和新闻娱乐节目《我有新闻给你吗？》（Have I Got News For You?）。时至今日，她仍然在英国政坛活动，不时上一下曾经的同事阿拉斯泰尔·坎贝尔的播客节目。

虽然帕克并不算太出名的媒体人，但她获得了相当高的评价。虽然她的身边人称她作风严肃、甚至有些不近人情，但她愿意倾听来自不同领域、不同立场的意见，并且对供稿严格把关，维护了《新政治家》一贯以来的名声。她自己也对这个结局很满意——她既能贯彻自己的左翼价值观，又不至于沦落到靠黄色新闻和耸人听闻的言论博眼球的地步。能够不脱离社会高谈阔论，但又超越粗浅的、表面的矛盾冲突而直击社会议题的真相，正是她加入这行时的夙愿。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“高冷新闻”]
海伦·A·帕克（1952.7.20-），记者，《新政治家》总编（2001-2010）。这年头真正的高冷新闻从业者不多了，虽然严格意义上她也不能算入其中，但至少她还是与更加“喜闻乐见”的小报和黄色新闻划清了界限。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)



</tw-passagedata><tw-passagedata pid="249" name="8.19A" tags="end" position="1000,1450" size="100,100">遗憾的是，帕克最终没能得到新闻秘书的岗位——据说这是因为布莱尔认为她在过去太“左”了。而她曾经的同事和朋友，年轻气盛的阿拉斯泰尔·坎贝尔获得了这个机会。她于是留在了《每日镜报》并放弃了跳槽的想法，在2001年升任总编辑，成为该报近百年历史上第一位女性总编辑。

在这个位置上，帕克决心要做英国报业的红人——为此，可以不惜一切手段。2003年，她不顾报社许多人反对，撰写文章抨击布莱尔政府入侵伊拉克的决定，给《每日镜报》的销售打了一针强心针。2004年，在她推动下，《每日镜报》以”怎么会有59,054,087人这么蠢啊？“为头版头条，报道小布什的连任，并用一张上色地图声称所有布什胜出的州，其居民平均智商都低于全美平均水平。显然，这是纯粹的黄色新闻，而且是造谣（数据后来被证明是臆造的），但帕克和报社都从未道歉。

2007年，帕克早早从《每日镜报》退休，随后成为著名媒体人和名嘴。她总体上保持了和工党一致的中左翼立场，经常上电视，参加BBC的政论节目《提问时间》（Question Time）和新闻娱乐节目《我有新闻给你吗？》（Have I Got News For You?）。她在公众场合以夸张且夺人眼球的发言著称——2014年工党党魁艾德·米利班德被拍到在吃培根三明治时露出怪异吃相后，《太阳报》以“救救我们的培根”为标题报道此事；帕克则干脆在私人博客上写道“只有猪写得出这东西”，结果被告上法庭，后来靠私下和解解决了此事。她在公众场域的活动一直持续到2020年英国正式脱欧，随后便趋于沉寂。

帕克在英国报业和公众生活中，评价非常两极分化。支持者说她风趣幽默，敢想敢做，而反对者说她是个对自己言论不负责任，靠无中生有炮制社会热点、发表危险言论博眼球的女人。在政治场域，她的拥趸说她是“左翼价值观的坚定拥护者”，反对者则说她是个“疯狂的左派”。

不过，说真的，如果把她当一个乐子人看，一切争论大概就迎刃而解了。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“也就图一乐”]
海伦·A·帕克（1952.7.20-），记者，《每日镜报》总编（2001-2007）。《是，首相》有云“《每日镜报》是给那些自以为在治国的人读的”——对于“乐子人”海伦·帕克而言，恐怕这话还真没说错！//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="250" name="8.19B" tags="" position="1125,1450" size="100,100">1995年初，帕克顺利成为了布莱尔的新闻秘书，担任他在新闻、媒体、公关等事务上的首席顾问。不仅如此，她还为他撰写演讲稿，1995年工党大会上布莱尔正式宣布修改党章第四条的演讲就是她写的。
(set: $vocation to &quot;poli&quot;)(set: $vocation2 to &quot;media&quot;)
除此之外，布莱尔还指派她运用在新闻界积攒的经验，改善工党的公众形象，赢得媒体的信任。没过多久，帕克就成了布莱尔的首席幕僚，除了当初的职务，还在很多事务上直接为布莱尔提供意见。到1997年大选前夕，在帕克的不懈努力下，即使是《太阳报》这些曾经坚定支持撒切尔夫人的报刊，如今也开始支持工党。保守党则不得不承认，他们找不到一个可以匹敌帕克的专业人士，因此只能一边看着媒体倒向工党，一边打出“新工党，新危险”这种没什么创意的口号。帕克很快和“新工党”这个品牌形象联系了起来，并成为英国政坛的知名人物之一。

1997年5月1日，工党以压倒性优势赢得大选，帕克也随之成为首相托尼·布莱尔的首席新闻秘书。她知道，在这个岗位上，她可以实现任何想做的事情了。

[[20年前，我肯定不会设想到有这样一天……-&gt;9.23]]</tw-passagedata><tw-passagedata pid="251" name="8.20" tags="end" position="1250,1450" size="100,100">她曾经的同事和朋友，年轻气盛的阿拉斯泰尔·坎贝尔最终获得了辅佐布莱尔的机会，而她留在了《每日镜报》并放弃了跳槽的想法，并在2001年升任总编辑，成为该报近百年历史上第一位女性总编辑。

在这个位置上，帕克决心要做英国报业的红人——为此，可以不惜一切手段。2003年，她不顾报社许多人反对，撰写文章抨击布莱尔政府入侵伊拉克的决定，给《每日镜报》的销售打了一针强心针。2004年，在她推动下，《每日镜报》以”怎么会有59,054,087人这么蠢啊？“为头版头条，报道小布什的连任，并用一张上色地图声称所有布什胜出的州，其居民平均智商都低于全美平均水平。显然，这是纯粹的黄色新闻，而且是造谣（数据后来被证明是臆造的），但帕克和报社都从未道歉。

2007年，帕克早早从《每日镜报》退休，随后成为著名媒体人和名嘴。她总体上保持了和工党一致的中左翼立场，经常上电视，参加BBC的政论节目《提问时间》（Question Time）和新闻娱乐节目《我有新闻给你吗？》（Have I Got News For You?）。她在公众场合以夸张且夺人眼球的发言著称——2014年工党党魁艾德·米利班德被拍到在吃培根三明治时露出怪异吃相后，《太阳报》以“救救我们的培根”为标题报道此事；帕克则干脆在私人博客上写道“只有猪写得出这东西”，结果被告上法庭，后来靠私下和解解决了此事。她在公众场域的活动一直持续到2020年英国正式脱欧，随后便趋于沉寂。

帕克在英国报业和公众生活中，评价非常两极分化。支持者说她风趣幽默，敢想敢做，而反对者说她是个对自己言论不负责任，靠无中生有炮制社会热点、发表危险言论博眼球的女人。在政治场域，她的拥趸说她是“左翼价值观的坚定拥护者”，反对者则说她是个“疯狂的左派”。

不过，说真的，如果把她当一个乐子人看，一切争论大概就迎刃而解了。



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“也就图一乐”]
海伦·A·帕克（1952.7.20-），记者，《每日镜报》总编（2001-2007）。《是，首相》有云“《每日镜报》是给那些自以为在治国的人读的”——对于“乐子人”海伦·帕克而言，恐怕这话还真没说错！//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="252" name="8.21" tags="end" position="1375,1450" size="100,100">在失去了又一个进入政坛的机会后，帕克索性放弃了这个主意，留在《卫报》，而且一并放弃了跳槽的想法。她在2003年升任《卫报》政治版总编辑，在这个位置上，她决心要在英国报业留下自己的名字。

帕克首先摆出了支持巴勒斯坦、反以色列的立场，以至于部分编辑因为声称《卫报》”反以、反犹“而辞职。在21世纪第一个10年中，《卫报》的影响力稳步增长——而从2010年开始，她决定突破新闻伦理，干一些出格但能让他们被永远铭记的事情。

2010年11月28日，维基解密和《卫报》一道公布251,287份来自美国在全球的大使馆发给美国国务院的外交电报。这一事件瞬间在全世界引发轩然大波，也使得《卫报》在遭到猛烈抨击的同时销量大增。2013年4月，《卫报》收到匿名人士（后来证明就是爱德华·斯诺登）发来的文件，帕克毫不犹豫地决定善用这个机会，抢在最前面报道了世人众所周知的“棱镜门事件”。6月，报社收到英国情报机构的国家安全禁制令，要求他们不得继续报道此事；7月，在内阁的压力下，《卫报》销毁了所有存储关于“棱镜门事件”资料的硬盘，但随着事件的更多信息流传到国外，帕克没有屈服于政府，反而让《卫报》美国版和《纽约时报》合作，继续报道此事。

在“棱镜门事件”后，帕克开始得到”舰队街的女掌柜“的绰号——舰队街（Fleet Street）是旧时英国许多报社总部的所在地，现代仍经常被用于指代英国传统纸媒。这是说，她在英国报业乃至公众生活中的影响力已经不可忽视。不过，或许是因为年事已高，或许是因为赚足了名声，或许是因为被英国政府盯上了，2015年，帕克和《卫报》总编一道选择了退休，并在随后逐渐淡出了公众生活。


所以，该怎么评价帕克呢？她的身边人称她作风严肃、不近人情，经常有很多好坏不一的点子，而她会全部付诸实践，或是为了自己的信念，或是为了自己和报社的利益与名声——而她也做好了遭受口诛笔伐的准备。她的反对者则强烈抨击她的反以色列立场，以及和阿桑奇、斯诺登这两位危险人物合作，甚至干脆说她是个“道德沦丧”的家伙。

如果说其他的评判都不能做到价值中立，那么，或许还是“舰队街的女掌柜”这个词最能概括她精彩纷呈的一生？



触发结局：
&#39;&#39;//(text-colour: green)[普通结局：“舰队街的女掌柜”]
海伦·A·帕克（1952.7.20-），记者，《卫报》政治版总编（2003-2015）。一位敢想敢做但也毁誉参半的记者，在一个纸媒渐渐没落的时代，在英国报业的历史上留下了浓墨重彩的一笔。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="253" name="9.23" tags="" position="1125,1575" size="100,100">布莱尔上任后，帕克第一件处理的重大事务是戴安娜王妃之死。据说，正是帕克提出了后来广泛流传的“人民的王妃”这个称呼，并劝说女王伊丽莎白二世以更加平易近人的方式就此事对全国发表讲话，一定程度上挽救了王室的声誉。

在新闻秘书任内，帕克主要负责改善内阁和各政府部门的通讯和信息交互，提高信息事务的现代化程度和效率。她亲自主持新闻发布会，回答世界各国记者的问题，同时还就各种国内外议题发表看法，以至于很快获得了“实权副首相”的绰号。除此之外，帕克还参与了北爱尔兰问题谈判、科索沃战争期间的公关事务，并在2001年协助布莱尔以巨大优势赢得大选。这次大选后，帕克真正声名大噪。

然而，到2002年末，极具争议的伊拉克问题逐渐浮出水面。帕克受命准备政府报告书，基于军情六处的情报研究伊拉克的大规模杀伤性武器情况。布莱尔本人希望帕克按自己的指示办事，他希望英国加入多国联军入侵伊拉克，找到大规模杀伤性武器并推翻萨达姆政权，维护伊拉克的人权。但她本人却反对武装干涉伊拉克，心里知道悍然发起一场没有授权的战争是不义的，而拿着假情报蛊惑英国人民更是不可接受。而且，她和布莱尔的矛盾也在逐渐增长。

她思考许久，不太确定该怎么做——因为情报并不确凿，如果她不加粉饰，报告书肯定说服不了英国人民。但是，时间在流逝，她必须做决定了。

[[托尼，很抱歉，但我不能说假话啊。-&gt;10.25]]

[[无论如何，跟着托尼会有好处。战争中真相是可以牺牲的。-&gt;10.27]]</tw-passagedata><tw-passagedata pid="254" name="10.25" tags="end" position="1050,1700" size="100,100">2002年9月，英国政府发表第一份报告书，称“没有充足证据证明伊拉克已经或即将掌握大规模杀伤性武器”，引发舆论哗然。美国政府对此尤其不满，因为他们相信英方报告的内容会和自己的说法一致。这份争议很大的报告导致下议院就伊拉克问题看法高度分裂，也导致许多观察者认为，英国武装干涉伊拉克的概率大幅下降。布莱尔对此怒不可遏，威胁要把帕克开除，但她不为所动——当然，她也知道，布莱尔不是虚张声势。
(set: $special1 to &quot;iraq&quot;)
2003年1月，帕克再次拒绝服从布莱尔的命令——布莱尔要求她准备一份报告并公布给主要媒体平台的记者，这次必须证明英国武装干涉伊拉克是有道理的。然而，帕克还是拒绝从命。忍无可忍的布莱尔遂要求她辞职，而她这次欣然从命了。2月3日，海伦·帕克宣布辞去首席新闻秘书一职，没有说明原因。而最终，由于帕克主导的两份报告措辞不够强硬、“证据”不够确凿，出兵伊拉克的决议被下议院否决。然而，事实证明，这个操作最后很大程度上保住了布莱尔的名声。

离开内阁后，帕克仍然活跃在政坛，不过没有在2005年大选中帮助布莱尔。2007年，帕克的日记节选以《布莱尔年代》为标题出版。此时，她已经有胆量称，反对伊拉克战争是她一生中最正确的决定，而且，布莱尔应该感谢她。实际上，帕克这么说有些道理，因为布莱尔的政治生涯基本没留下太大的污点，但如果他选择入侵伊拉克，那就不会如此了。

2010、2015年，帕克两次在大选中协助工党，不过遗憾的是这两次选举中工党都落败了。2015年后，她又回到媒体界，为《金融时报》和《经济学人》撰稿，同时还支持二次脱欧公投。2022年，她和曾经的同事阿拉斯泰尔·坎贝尔一同开设了一档名为《其余的都是政治》（The Rest Is Politics）的播客节目，采访布莱尔、布朗、科尔宾等政要，共同讨论国内和国际政治的热点话题。不过，她明确说自己不想再当政治顾问了。


早在帕克辞去新闻秘书职务时，她便得到了”不屈的智囊“这一绰号。许多人认为，她是世纪之交英国政坛一位重要幕后人物；她在媒体、公关、信息交流等方面做出了巨大贡献，缔造了”新工党“的品牌形象，却遗憾地因为坚持立场和原则而与布莱尔分道扬镳。至今，仍有许多人赞扬她的不屈，为她的远见而折服。



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“不屈的智囊”]
海伦·A·帕克（1952.7.20-），记者和政治顾问，首相首席新闻秘书（1997-2003）。”新工党“的奠基者之一，媒体和公关天才，在新闻和政治两个领域游走了许多年。//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)</tw-passagedata><tw-passagedata pid="255" name="10.27" tags="" position="1200,1700" size="100,100">2002年9月，英国政府发表第一份报告书，称“有充足证据证明，伊拉克已经或即将掌握大规模杀伤性武器”，引发舆论哗然。这份报告导致许多观察者认为，英国武装干涉伊拉克的概率大幅上升，只要下议院通过决议，一切就会水到渠成。帕克仍然对自己扭曲了情报原意这件事感到遗憾——没有情报可以直接证明大规模杀伤性武器的存在，报告的许多内容也夸大或闪烁其词。

2003年2月，帕克代表政府向全世界媒体公布第二份报告书，其中再次强调伊拉克的大规模杀伤性武器，并指出萨达姆运用其秘密警察机构“对他国使馆开展间谍活动”、“资助他国恐怖主义团体”。这两份报告扫清了出兵的绝大部分障碍。2003年3月20日，多国联军开始入侵伊拉克，英国也派出了45,000名军人。尽管国内有许多民众反对参加伊拉克战争，伦敦也爆发了有10万多人参加的反战游行，但布莱尔和帕克不为所动。

然而，帕克最后果然背了黑锅。早在2002年底，就有不少媒体指责报告书涉嫌歪曲英国情报机构获得的原始情报，夸大了伊拉克的威胁——比如说，“伊拉克可以在45分钟内使用大规模杀伤性武器”。2003年中，BBC报道了报告的不实之处，并说“45分钟”是帕克本人在毫无证据的情况下强行加上的。尽管政府矢口否认，但这一说法很快传开，并导致帕克本人陷入一场公关危机。

帕克心想……

[[经过这六年，我也累了。或许是时候开始新生活了？-&gt;11.22]]</tw-passagedata><tw-passagedata pid="256" name="11.22" tags="end" position="1200,1825" size="100,100">2003年8月31日，帕克宣布辞去首相首席新闻秘书一职。此时，她开始相信大规模杀伤性武器是真实存在的，当年晚些时候还在采访中说“得了吧，怎么可能啥都找不到呢”。幸运的是，此后的议会调查和调查组调查都显示，她不需要为报告的失实内容承担责任。

2005年，帕克回来帮助布莱尔操办当年大选，并帮助工党再次获胜。2007年，帕克的日记节选以《布莱尔年代》为标题出版。2010、2015年，帕克两次在大选中协助工党，不过遗憾的是这两次选举中工党都落败了。2016年脱欧公投后，她支持二次公投，并主办了《新欧洲人》（New European）周刊，支持英国留在欧盟或与欧盟发展经贸关系。同时，帕克还是英国大学和智库的常客，曾在牛剑、伦敦政经学院、查塔姆研究所等地发表演讲，演讲内容大多是关于“新工党”的，也有关于传媒领域、热点话题的。

2022年，她和曾经的同事阿拉斯泰尔·坎贝尔一同开设了一档名为《其余的都是政治》（The Rest Is Politics）的播客节目，采访布莱尔、布朗、科尔宾等政要，共同讨论国内和国际政治的热点话题。在这一节目的第一集，帕克便请来了布莱尔，而后者也开门见山地肯定了帕克在世纪之交对“新工党”和他自己的，不可磨灭的贡献。



所以，该怎么评价帕克呢？她是布莱尔的心腹，也是他最重要的谋士之一。当一些人半开玩笑地说她是“实权副首相”时，历史证明了他们的正确性。通过塑造强大的品牌与良好的公众形象，争取传媒的信任和支持，她在幕后奠定了“新工党”时代的舆论基础。或许，日后的政治学人在回顾这段政治史时，会说：


&#39;&#39;//“ ‘新工党’的台前人物是托尼·布莱尔……

但幕后人物是海伦·A·帕克。”//&#39;&#39;



触发结局：
&#39;&#39;//(text-colour: blue)[好结局：“心腹谋士”]
海伦·A·帕克（1952.7.20-），记者和政治顾问，首相首席新闻秘书（1997-2003）。她不仅是”新工党“的奠基者之一，更是一位能在幕后主导英国政治的人物。“深层政府”就图一乐，真整活还是看海伦·帕克！//&#39;&#39;

[[重生-&gt;Start]](set: $achieved to $achieved +1)

(text-size: 0.5)[（小小彩蛋：这是本游戏作者最后一个做出来的结局。~~完结撒花！~~）]</tw-passagedata><tw-passagedata pid="257" name=" 7.1C" tags="" position="4425,1325" size="100,100">1977年，帕克加入政策研究中心（Centre for Policy Studies），虽然这是一家偏右翼的智库，但她尽可能做到政治中立。她的主要研究领域是英国与欧共体和东欧集团的关系，同时也涉及过不少英国内政议题。虽然她相当喜欢运用自己的聪明才智协助制定政策并开展前瞻性研究，但她并不想做纯学术，仍然想参与到政治之中。1981年，她结了婚，并在伦敦定居下来。
(set: $vocation to &quot;poli&quot;)
1988年，自由党和社会民主党合并为自由民主党，大有继续维持英国议会第三大党并进一步扩大规模的势头。她嗅到了机会——从现在开始为竞选议员做准备，1992年她或许就有机会进入议会。在那之后，她就可以在政治舞台上大展拳脚。

不过，她的一些同事和朋友并不建议她这么做。他们认为，过去十多年从事高度学术性的研究工作，已经让她失掉了不少政治素养；如果她投身政坛，就可能被权力斗争吞噬，或是因为缺少行政岗位经验而面临巨大挑战。再说了，自由民主党是要在夹缝中求生存的，这个开局未免太难了些。

但她知道，政治实践和政治科学终究是不分家的，空有知识而没有权力，不会产生什么真正的结果。
(set: $entrancetopolitics to &quot;thinktank&quot;)
[[知道如何使用权力，那总得实践一下，哪怕不喜欢。-&gt;8.3A]]</tw-passagedata><tw-passagedata pid="258" name="8.3A" tags="" position="4425,1450" size="100,100">1992年大选中，帕克惊险地当选下议院议员。1997年大选后，她成为自由民主党的教育事务发言人，并在1999年支持查尔斯·肯尼迪竞选自由民主党党魁。2001年大选后，她又晋升为欧洲事务发言人，辅佐外交事务发言人孟席斯·坎贝尔。
(set: $vocation to &quot;poli&quot;)
2005年大选后，自由民主党内部呈现三头鼎立局势——由于肯尼迪健康状况不佳，他有意在2006年辞去党魁一职。此时，财政事务发言人帕克、外交事务发言人坎贝尔和欧洲事务发言人尼克·克莱格（Nick Clegg）是公认的自由民主党三大领袖。

2006年肯尼迪辞职后，坎贝尔继任党魁。然而，坎贝尔并不是一个受人欢迎的人物，在议会的“首相答问时间”环节经常出丑。到2007年下旬，自由民主党内部决定必须换掉坎贝尔。

在这一情况下，帕克意识到一个事实——如果她不能和克莱格谈妥条件，否则她就必须和他竞争党魁职务；但是在这场斗争中，她的资历更丰富，似乎处于优势。因此，她出乎意料地没有和克莱格谈判，而是直接宣布自己将竞选党魁。
(set: $luck to (random:1,100))
(if: $luck is &lt; 33)[[应该不会出岔子吧？-&gt;9.11]](if: $luck is &gt;= 33)[[应该不会出岔子吧？-&gt;9.11A]]</tw-passagedata></tw-storydata>
<script title="Twine engine code" data-main="harlowe">(function(){"use strict";
var require,define;!function(){var e={},r={};require=function(i){var n=e[i];return n&&(r[i]=n[1].apply(void 0,n[0].map(require)),e[i]=void 0),r[i]},(define=function(r,i,n){if("function"==typeof r)return r();e[r]=[i,n]}).amd=!0}();/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.3/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.join);var A=Function.call.bind(Array.prototype.shift);var R=Math.max;var _=Math.min;var k=Math.floor;var L=Math.abs;var F=Math.exp;var D=Math.log;var z=Math.sqrt;var q=Function.call.bind(Object.prototype.hasOwnProperty);var W;var G=function(){};var H=S.Map;var V=H&&H.prototype["delete"];var B=H&&H.prototype.get;var U=H&&H.prototype.has;var $=H&&H.prototype.set;var J=S.Symbol||{};var X=J.species||"@@species";var K=Number.isNaN||function isNaN(e){return e!==e};var Z=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Y=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(K(t)){return t}return t<0?-1:1};var Q=function log1p(e){var t=Number(e);if(t<-1||K(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(D(1+t)/(1+t-1))};var ee=function isArguments(e){return g(e)==="[object Arguments]"};var te=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var re=ee(arguments)?ee:te;var ne={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var oe=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var ie=typeof J==="function"&&typeof J["for"]==="function"&&ne.symbol(J());var ae=ne.symbol(J.iterator)?J.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ae="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ue=S.Reflect;var fe=String;var se=typeof document==="undefined"||!document?null:document.all;var ce=se==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==se};var le={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!le.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(ce(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===se},ToObject:function(e,t){return Object(le.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return le.IsCallable(e)},ToInt32:function(e){return le.ToNumber(e)>>0},ToUint32:function(e){return le.ToNumber(e)>>>0},ToNumber:function(e){if(ie&&g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=le.ToNumber(e);if(K(t)){return 0}if(t===0||!Z(t)){return t}return(t>0?1:-1)*k(L(t))},ToLength:function(e){var t=le.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return K(e)&&K(t)},SameValueZero:function(e,t){return e===t||K(e)&&K(t)},GetIterator:function(e){if(re(e)){return new W(e,"value")}var t=le.GetMethod(e,ae);if(!le.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=le.Call(t,e);if(!le.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=le.ToObject(e)[t];if(ce(r)){return void 0}if(!le.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=le.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=le.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!le.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!le.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=le.IteratorNext(e);var r=le.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ue.construct){return ue.construct(e,t,o)}var i=o.prototype;if(!le.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=le.Call(e,a,t);return le.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!le.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[X];if(ce(n)){return t}if(!le.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=le.ToString(e);var i="<"+t;if(r!==""){var a=le.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!le.TypeIsObject(e)){return false}var t=e[J.match];if(typeof t!=="undefined"){return!!t}return ne.regex(e)},ToString:function ToString(e){if(ie&&g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return fe(e)}};if(s&&ie){var pe=function defineWellKnownSymbol(e){if(ne.symbol(J[e])){return J[e]}var t=J["for"]("Symbol."+e);Object.defineProperty(J,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!ne.symbol(J.search)){var ve=pe("search");var ye=String.prototype.search;h(RegExp.prototype,ve,function search(e){return le.Call(ye,e,[this])});var he=function search(e){var t=le.RequireObjectCoercible(this);if(!ce(e)){var r=le.GetMethod(e,ve);if(typeof r!=="undefined"){return le.Call(r,e,[t])}}return le.Call(ye,t,[le.ToString(e)])};oe(String.prototype,"search",he)}if(!ne.symbol(J.replace)){var be=pe("replace");var ge=String.prototype.replace;h(RegExp.prototype,be,function replace(e,t){return le.Call(ge,e,[this,t])});var de=function replace(e,t){var r=le.RequireObjectCoercible(this);if(!ce(e)){var n=le.GetMethod(e,be);if(typeof n!=="undefined"){return le.Call(n,e,[r,t])}}return le.Call(ge,r,[le.ToString(e),t])};oe(String.prototype,"replace",de)}if(!ne.symbol(J.split)){var me=pe("split");var Oe=String.prototype.split;h(RegExp.prototype,me,function split(e,t){return le.Call(Oe,e,[this,t])});var we=function split(e,t){var r=le.RequireObjectCoercible(this);if(!ce(e)){var n=le.GetMethod(e,me);if(typeof n!=="undefined"){return le.Call(n,e,[r,t])}}return le.Call(Oe,r,[le.ToString(e),t])};oe(String.prototype,"split",we)}var je=ne.symbol(J.match);var Se=je&&function(){var e={};e[J.match]=function(){return 42};return"a".match(e)!==42}();if(!je||Se){var Te=pe("match");var Ie=String.prototype.match;h(RegExp.prototype,Te,function match(e){return le.Call(Ie,e,[this])});var Ee=function match(e){var t=le.RequireObjectCoercible(this);if(!ce(e)){var r=le.GetMethod(e,Te);if(typeof r!=="undefined"){return le.Call(r,e,[t])}}return le.Call(Ie,t,[le.ToString(e)])};oe(String.prototype,"match",Ee)}}var Pe=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in G||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in G||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Ce=function(){return this};var Me=function(e){if(s&&!q(e,X)){m.getter(e,X,Ce)}};var xe=function(e,t){var r=t||function iterator(){return this};h(e,ae,r);if(!e[ae]&&ne.symbol(ae)){e[ae]=r}};var Ne=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ae=function createDataPropertyOrThrow(e,t,r){Ne(e,t,r);if(!le.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Re=function(e,t,r,n){if(!le.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!le.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(q(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var _e=String.fromCodePoint;oe(String,"fromCodePoint",function fromCodePoint(e){return le.Call(_e,this,arguments)})}var ke={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!le.SameValue(r,le.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return N(t,"")},raw:function raw(e){var t=arguments.length-1;var r=le.ToObject(e,"bad template");var raw=le.ToObject(r.raw,"bad raw value");var n=raw.length;var o=le.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=le.ToString(a);s=le.ToString(raw[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=le.ToString(f);M(i,c);a+=1}return N(i,"")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){oe(String,"raw",ke.raw)}b(String,ke);var Le=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Fe=Infinity;var De={repeat:function repeat(e){var t=le.ToString(le.RequireObjectCoercible(this));var r=le.ToInteger(e);if(r<0||r>=Fe){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return Le(t,r)},startsWith:function startsWith(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=le.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=R(le.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=le.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:le.ToInteger(o);var a=_(R(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(le.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=le.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=le.ToString(le.RequireObjectCoercible(this));var r=le.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){oe(String.prototype,"includes",De.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var ze=i(function(){return"/a/".startsWith(/a/)});var qe=a(function(){return"abc".startsWith("a",Infinity)===false});if(!ze||!qe){oe(String.prototype,"startsWith",De.startsWith);oe(String.prototype,"endsWith",De.endsWith)}}if(ie){var We=a(function(){var e=/a/;e[J.match]=false;return"/a/".startsWith(e)});if(!We){oe(String.prototype,"startsWith",De.startsWith)}var Ge=a(function(){var e=/a/;e[J.match]=false;return"/a/".endsWith(e)});if(!Ge){oe(String.prototype,"endsWith",De.endsWith)}var He=a(function(){var e=/a/;e[J.match]=false;return"/a/".includes(e)});if(!He){oe(String.prototype,"includes",De.includes)}}b(String.prototype,De);var Ve=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Be=new RegExp("(^["+Ve+"]+)|(["+Ve+"]+$)","g");var Ue=function trim(){return le.ToString(le.RequireObjectCoercible(this)).replace(Be,"")};var $e=["\x85","\u200b","\ufffe"].join("");var Je=new RegExp("["+$e+"]","g");var Xe=/^[-+]0x[0-9a-f]+$/i;var Ke=$e.trim().length!==$e.length;h(String.prototype,"trim",Ue,Ke);var Ze=function(e){return{value:e,done:arguments.length===0}};var Ye=function(e){le.RequireObjectCoercible(e);h(this,"_s",le.ToString(e));h(this,"_i",0)};Ye.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ze()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ze(e.substr(t,o))};xe(Ye.prototype);xe(String.prototype,function(){return new Ye(this)});var Qe={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!le.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(re(e)||le.GetMethod(e,ae))!=="undefined";var u,f,s;if(a){f=le.IsConstructor(r)?Object(new r):[];var c=le.GetIterator(e);var l,p;s=0;while(true){l=le.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){le.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=le.ToObject(e);u=le.ToLength(y.length);f=le.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ae(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!le.IsCallable(t)?new Array(e):le.Construct(t,[e]);for(var o=0;o<e;++o){Ae(n,o,arguments[o])}n.length=e;return n}};b(Array,Qe);Me(Array);W=function(e,t){h(this,"i",0);h(this,"array",e);h(this,"kind",t)};b(W.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof W)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=le.ToLength(t.length);if(e<r){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ze(o)}}this.array=void 0;return Ze()}});xe(W.prototype);var et=Array.of===Qe.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!et){oe(Array,"of",Qe.of)}var tt={copyWithin:function copyWithin(e,t){var r=le.ToObject(this);var n=le.ToLength(r.length);var o=le.ToInteger(e);var i=le.ToInteger(t);var a=o<0?R(n+o,0):_(o,n);var u=i<0?R(n+i,0):_(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:le.ToInteger(f);var c=s<0?R(n+s,0):_(s,n);var l=_(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=le.ToObject(this);var o=le.ToLength(n.length);t=le.ToInteger(typeof t==="undefined"?0:t);r=le.ToInteger(typeof r==="undefined"?o:r);var i=t<0?R(o+t,0):_(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=le.ToObject(this);var n=le.ToLength(r.length);if(!le.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=le.ToObject(this);var n=le.ToLength(r.length);if(!le.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new W(this,"key")},values:function values(){return new W(this,"value")},entries:function entries(){return new W(this,"entry")}};if(Array.prototype.keys&&!le.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!le.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ae]){b(Array.prototype,{values:Array.prototype[ae]});if(ne.symbol(J.unscopables)){Array.prototype[J.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var rt=Array.prototype.values;oe(Array.prototype,"values",function values(){return le.Call(rt,this,arguments)});h(Array.prototype,ae,Array.prototype.values,true)}b(Array.prototype,tt);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}xe(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){var nt=Object.getPrototypeOf([].values());if(nt){xe(nt)}}var ot=function(){return a(function(){return Array.from({length:-1}).length===0})}();var it=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!ot||!it){oe(Array,"from",Qe.from)}var at=function(){return a(function(){return Array.from([0],void 0)})}();if(!at){var ut=Array.from;oe(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return le.Call(ut,this,arguments)}return t(ut,this,e)})}var ft=-(Math.pow(2,32)-1);var st=function(e,r){var n={length:ft};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!st(Array.prototype.forEach)){var ct=Array.prototype.forEach;oe(Array.prototype,"forEach",function forEach(e){return le.Call(ct,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.map)){var lt=Array.prototype.map;oe(Array.prototype,"map",function map(e){return le.Call(lt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.filter)){var pt=Array.prototype.filter;oe(Array.prototype,"filter",function filter(e){return le.Call(pt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.some)){var vt=Array.prototype.some;oe(Array.prototype,"some",function some(e){return le.Call(vt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.every)){var yt=Array.prototype.every;oe(Array.prototype,"every",function every(e){return le.Call(yt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.reduce)){var ht=Array.prototype.reduce;oe(Array.prototype,"reduce",function reduce(e){return le.Call(ht,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.reduceRight,true)){var bt=Array.prototype.reduceRight;oe(Array.prototype,"reduceRight",function reduceRight(e){return le.Call(bt,this.length>=0?this:[],arguments)})}var gt=Number("0o10")!==8;var dt=Number("0b10")!==2;var mt=y($e,function(e){return Number(e+0+e)===0});if(gt||dt||mt){var Ot=Number;var wt=/^0b[01]+$/i;var jt=/^0o[0-7]+$/i;var St=wt.test.bind(wt);var Tt=jt.test.bind(jt);var It=function(e,t){var r;if(typeof e.valueOf==="function"){r=e.valueOf();if(ne.primitive(r)){return r}}if(typeof e.toString==="function"){r=e.toString();if(ne.primitive(r)){return r}}throw new TypeError("No default value")};var Et=Je.test.bind(Je);var Pt=Xe.test.bind(Xe);var Ct=function(){var e=function Number(t){var r;if(arguments.length>0){r=ne.primitive(t)?t:It(t,"number")}else{r=0}if(typeof r==="string"){r=le.Call(Ue,r);if(St(r)){r=parseInt(C(r,2),2)}else if(Tt(r)){r=parseInt(C(r,2),8)}else if(Et(r)||Pt(r)){r=NaN}}var n=this;var o=a(function(){Ot.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new Ot(r)}return Ot(r)};return e}();Pe(Ot,Ct,{});b(Ct,{NaN:Ot.NaN,MAX_VALUE:Ot.MAX_VALUE,MIN_VALUE:Ot.MIN_VALUE,NEGATIVE_INFINITY:Ot.NEGATIVE_INFINITY,POSITIVE_INFINITY:Ot.POSITIVE_INFINITY});Number=Ct;m.redefine(S,"Number",Ct)}var Mt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Mt,MIN_SAFE_INTEGER:-Mt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:Z,isInteger:function isInteger(e){return Z(e)&&le.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&L(e)<=Number.MAX_SAFE_INTEGER},isNaN:K});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){oe(Array.prototype,"find",tt.find)}if([,1].findIndex(function(){return true})!==0){oe(Array.prototype,"findIndex",tt.findIndex)}var xt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Nt=function ensureEnumerable(e,t){if(s&&xt(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var At=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var Rt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var _t=function(e,t){var r=n(Object(t));var o;if(le.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),xt(t))}return p(P(r,o||[]),Rt(t),e)};var kt={assign:function(e,t){var r=le.ToObject(e,"Cannot convert undefined or null to object");return p(le.Call(At,1,arguments),_t,r)},is:function is(e,t){return le.SameValue(e,t)}};var Lt=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(Lt){oe(Object,"assign",kt.assign)}b(Object,kt);if(s){var Ft={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!le.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||le.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,Ft)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Dt=!i(function(){return Object.keys("foo")});if(!Dt){var zt=Object.keys;oe(Object,"keys",function keys(e){return zt(le.ToObject(e))});n=Object.keys}var qt=i(function(){return Object.keys(/a/g)});if(qt){var Wt=Object.keys;oe(Object,"keys",function keys(e){if(ne.regex(e)){var t=[];for(var r in e){if(q(e,r)){M(t,r)}}return t}return Wt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var Gt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!Gt){var Ht=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Vt=Object.getOwnPropertyNames;oe(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=le.ToObject(e);if(g(t)==="[object Window]"){try{return Vt(t)}catch(r){return P([],Ht)}}return Vt(t)})}}if(Object.getOwnPropertyDescriptor){var Bt=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Bt){var Ut=Object.getOwnPropertyDescriptor;oe(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Ut(le.ToObject(e),t)})}}if(Object.seal){var $t=!i(function(){return Object.seal("foo")});if(!$t){var Jt=Object.seal;oe(Object,"seal",function seal(e){if(!le.TypeIsObject(e)){return e}return Jt(e)})}}if(Object.isSealed){var Xt=!i(function(){return Object.isSealed("foo")});if(!Xt){var Kt=Object.isSealed;oe(Object,"isSealed",function isSealed(e){if(!le.TypeIsObject(e)){return true}return Kt(e)})}}if(Object.freeze){var Zt=!i(function(){return Object.freeze("foo")});if(!Zt){var Yt=Object.freeze;oe(Object,"freeze",function freeze(e){if(!le.TypeIsObject(e)){return e}return Yt(e)})}}if(Object.isFrozen){var Qt=!i(function(){return Object.isFrozen("foo")});if(!Qt){var er=Object.isFrozen;oe(Object,"isFrozen",function isFrozen(e){if(!le.TypeIsObject(e)){return true}return er(e)})}}if(Object.preventExtensions){var tr=!i(function(){return Object.preventExtensions("foo")});if(!tr){var rr=Object.preventExtensions;oe(Object,"preventExtensions",function preventExtensions(e){if(!le.TypeIsObject(e)){return e}return rr(e)})}}if(Object.isExtensible){var nr=!i(function(){return Object.isExtensible("foo")});if(!nr){var or=Object.isExtensible;oe(Object,"isExtensible",function isExtensible(e){if(!le.TypeIsObject(e)){return false}return or(e)})}}if(Object.getPrototypeOf){var ir=!i(function(){return Object.getPrototypeOf("foo")});if(!ir){var ar=Object.getPrototypeOf;oe(Object,"getPrototypeOf",function getPrototypeOf(e){return ar(le.ToObject(e))})}}var ur=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&le.IsCallable(e.get)}();if(s&&!ur){var fr=function flags(){if(!le.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",fr)}var sr=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var cr=ie&&s&&function(){var e=/./;e[J.match]=false;return RegExp(e)===e}();var lr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var pr=lr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!lr||!pr){var vr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=le.RequireObjectCoercible(this);if(ne.regex(e)){return t(vr,e)}var r=fe(e.source);var n=fe(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,vr)}if(s&&(!sr||cr)){var yr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var hr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var br=function(){return this.source};var gr=le.IsCallable(hr.get)?hr.get:br;var dr=RegExp;var mr=function(){return function RegExp(e,t){var r=le.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(ne.regex(e)){o=le.Call(gr,e);i=typeof t==="undefined"?le.Call(yr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new dr(e,t)}}();Pe(dr,mr,{$input:true});RegExp=mr;m.redefine(S,"RegExp",mr)}if(s){var Or={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(Or),function(e){if(e in RegExp&&!(Or[e]in RegExp)){m.getter(RegExp,Or[e],function get(){return RegExp[e]})}})}Me(RegExp);var wr=1/Number.EPSILON;var jr=function roundTiesToEven(e){return e+wr-wr};var Sr=Math.pow(2,-23);var Tr=Math.pow(2,127)*(2-Sr);var Ir=Math.pow(2,-126);var Er=Math.E;var Pr=Math.LOG2E;var Cr=Math.LOG10E;var Mr=Number.prototype.clz;delete Number.prototype.clz;var xr={acosh:function acosh(e){var t=Number(e);if(K(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Q(t-1+z(1-r)*t)}var n=t/2;return Q(n+z(1-r)*n-1)+1/Pr},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=L(t);var n=r*r;var o=Y(t);if(r<1){return o*Q(r+n/(z(n+1)+1))}return o*(Q(r/2+z(1+1/n)*r/2-1)+1/Pr)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(K(t)||t<-1||t>1){return NaN}var r=L(t);return Y(t)*Q(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=F(D(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=le.ToUint32(t);if(r===0){return 32}return Mr?le.Call(Mr,r):31-k(D(r+.5)*Pr)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(K(t)){return NaN}if(!T(t)){return Infinity}var r=F(L(t)-1);return(r+1/(r*Er*Er))*(Er/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(L(t)>.5){return F(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=L(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*z(r)},log2:function log2(e){return D(e)*Pr},log10:function log10(e){return D(e)*Cr},log1p:Q,sign:Y,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=L(t);if(r<1){var n=Math.expm1(r);return Y(t)*n*(1+1/(n+1))/2}var o=F(r-1);return Y(t)*(o-1/(o*Er*Er))*(Er/2)},tanh:function tanh(e){var t=Number(e);if(K(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(F(t)+F(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-k(-t):k(t)},imul:function imul(e,t){var r=le.ToUint32(e);var n=le.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||K(t)){return t}var r=Y(t);var n=L(t);if(n<Ir){return r*jr(n/Ir/Sr)*Ir*Sr}var o=(1+Sr/Number.EPSILON)*n;var i=o-(o-n);if(i>Tr||K(i)){return r*Infinity}return r*i}};var Nr=function withinULPDistance(e,t,r){return L(1-e/t)/Number.EPSILON<(r||8)};b(Math,xr);h(Math,"sinh",xr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",xr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",xr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",xr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,"asinh",xr.asinh,Math.asinh(1e300)===Infinity);
h(Math,"atanh",xr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",xr.tanh,Math.tanh(-2e-17)!==-2e-17);h(Math,"acosh",xr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",xr.acosh,!Nr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",xr.cbrt,!Nr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",xr.sinh,Math.sinh(-2e-17)!==-2e-17);var Ar=Math.expm1(10);h(Math,"expm1",xr.expm1,Ar>22025.465794806718||Ar<22025.465794806718);h(Math,"hypot",xr.hypot,Math.hypot(Infinity,NaN)!==Infinity);var Rr=Math.round;var _r=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var kr=wr+1;var Lr=2*wr-1;var Fr=[kr,Lr].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=k(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!_r||!Fr);m.preserveToString(Math.round,Rr);var Dr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=xr.imul;m.preserveToString(Math.imul,Dr)}if(Math.imul.length!==2){oe(Math,"imul",function imul(e,t){return le.Call(Dr,Math,arguments)})}var zr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}le.IsPromise=function(e){if(!le.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!le.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(le.IsCallable(t.resolve)&&le.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&le.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=A(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=le.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(le.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!le.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!le.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!le.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Re(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=le.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=le.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=le.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{le.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=le.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{le.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(le.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!le.IsPromise(n)){throw new TypeError("not a promise")}var o=le.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=le.IsCallable(e)?e:a;var d=le.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof zr==="function"){b(S,{Promise:zr});var qr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var Wr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,G)});var Gr=i(function(){return S.Promise.call(3,G)});var Hr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,G).then(null,G)}catch(n){return true}return t===r}(S.Promise);var Vr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Br=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Br.prototype=Promise.prototype;Br.all=Promise.all;var Ur=a(function(){return!!Br.all([1,2])});if(!qr||!Wr||!Gr||Hr||!Vr||Ur){Promise=zr;oe(S,"Promise",zr)}if(Promise.all.length!==1){var $r=Promise.all;oe(Promise,"all",function all(e){return le.Call($r,this,arguments)})}if(Promise.race.length!==1){var Jr=Promise.race;oe(Promise,"race",function race(e){return le.Call(Jr,this,arguments)})}if(Promise.resolve.length!==1){var Xr=Promise.resolve;oe(Promise,"resolve",function resolve(e){return le.Call(Xr,this,arguments)})}if(Promise.reject.length!==1){var Kr=Promise.reject;oe(Promise,"reject",function reject(e){return le.Call(Kr,this,arguments)})}Nt(Promise,"all");Nt(Promise,"race");Nt(Promise,"resolve");Nt(Promise,"reject");Me(Promise)}var Zr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Yr=Zr(["z","a","bb"]);var Qr=Zr(["z",1,"a","3",2]);if(s){var en=function fastkey(e,t){if(!t&&!Yr){return null}if(ce(e)){return"^"+le.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Qr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var tn=function emptyObject(){return Object.create?Object.create(null):{}};var rn=function addIterableToMap(e,n,o){if(r(o)||ne.string(o)){l(o,function(e){if(!le.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!ce(o)){a=n.set;if(!le.IsCallable(a)){throw new TypeError("bad map")}i=le.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=le.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!le.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){le.IteratorClose(i,true);throw s}}}}};var nn=function addIterableToSet(e,n,o){if(r(o)||ne.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!ce(o)){a=n.add;if(!le.IsCallable(a)){throw new TypeError("bad set")}i=le.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=le.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){le.IteratorClose(i,true);throw s}}}}};var on={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!le.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+le.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");h(this,"head",e._head);h(this,"i",this.head);h(this,"kind",t)};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ze()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ze(n)}}this.i=void 0;return Ze()}};xe(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Re(this,Map,a,{_es6map:true,_head:null,_map:H?new H:null,_size:0,_storage:tn()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){rn(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=en(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}return}if(this._map){t=B.call(this._map,e);if(t){return t.value}return}var n=this._head;var i=n;while((i=i.next)!==n){if(le.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=en(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return U.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(le.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=en(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}a=this._storage[u]=new r(e,t);i=n.prev}else if(this._map){if(U.call(this._map,e)){B.call(this._map,e).value=t}else{a=new r(e,t);$.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(le.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(le.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=en(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!U.call(this._map,t)){return false}n=B.call(this._map,t).prev;V.call(this._map,t)}while((n=n.next)!==r){if(le.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=H?new H:null;this._size=0;this._storage=tn();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});xe(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!le.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+le.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Re(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:tn()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){nn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new on.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=en(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=en(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=en(e))!==null){var n=q(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=tn()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);xe(i.prototype,i.prototype.values);var f=function SetIterator(e){h(this,"it",e)};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};xe(f.prototype);return i}()};var an=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(an){S.Set=on.Set}if(S.Map||S.Set){var un=a(function(){return new Map([[1,2]]).get(1)===2});if(!un){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new H;if(arguments.length>0){rn(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(H.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,H)}var fn=new Map;var sn=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var cn=fn.set(1,2)===fn;if(!sn||!cn){oe(Map.prototype,"set",function set(e,r){t($,this,e===0?0:e,r);return this})}if(!sn){b(Map.prototype,{get:function get(e){return t(B,this,e===0?0:e)},has:function has(e){return t(U,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,B);m.preserveToString(Map.prototype.has,U)}var ln=new Set;var pn=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(ln);var vn=ln.add(1)===ln;if(!pn||!vn){var yn=Set.prototype.add;Set.prototype.add=function add(e){t(yn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,yn)}if(!pn){var hn=Set.prototype.has;Set.prototype.has=function has(e){return t(hn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,hn);var bn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(bn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],bn)}var gn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var dn=Object.setPrototypeOf&&!gn;var mn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||dn||!mn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new H;if(arguments.length>0){rn(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=H.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,H)}var On=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var wn=Object.setPrototypeOf&&!On;var jn=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||wn||!jn){var Sn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new Sn;if(arguments.length>0){nn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=Sn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,Sn)}var Tn=new S.Map;var In=!a(function(){return Tn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||Tn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof Tn.keys().next!=="function"||In||!gn){b(S,{Map:on.Map,Set:on.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}xe(Object.getPrototypeOf((new S.Map).keys()));xe(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var En=S.Set.prototype.has;oe(S.Set.prototype,"has",function has(e){return t(En,this,e)})}}b(S,on);Me(S.Map);Me(S.Set)}var Pn=function throwUnlessTargetIsObject(e){if(!le.TypeIsObject(e)){throw new TypeError("target must be an object")}};var Cn={apply:function apply(){return le.Call(le.Call,null,arguments)},construct:function construct(e,t){if(!le.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!le.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return le.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){Pn(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){Pn(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(Cn,{ownKeys:function ownKeys(e){Pn(e);var t=Object.getOwnPropertyNames(e);if(le.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Mn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(Cn,{isExtensible:function isExtensible(e){Pn(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){Pn(e);return Mn(function(){return Object.preventExtensions(e)})}})}if(s){var xn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return xn(o,t,r)}if("value"in n){return n.value}if(n.get){return le.Call(n.get,r)}return void 0};var Nn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Nn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!le.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ue.defineProperty(o,r,{value:n})}return ue.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}if(i.set){t(i.set,o,n);return true}return false};Object.assign(Cn,{defineProperty:function defineProperty(e,t,r){Pn(e);return Mn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){Pn(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){Pn(e);var r=arguments.length>2?arguments[2]:e;return xn(e,t,r)},set:function set(e,t,r){Pn(e);var n=arguments.length>3?arguments[3]:e;return Nn(e,t,r,n)}})}if(Object.getPrototypeOf){var An=Object.getPrototypeOf;Cn.getPrototypeOf=function getPrototypeOf(e){Pn(e);return An(e)}}if(Object.setPrototypeOf&&Cn.getPrototypeOf){var Rn=function(e,t){var r=t;while(r){if(e===r){return true}r=Cn.getPrototypeOf(r)}return false};Object.assign(Cn,{setPrototypeOf:function setPrototypeOf(e,t){Pn(e);if(t!==null&&!le.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ue.getPrototypeOf(e)){return true}if(ue.isExtensible&&!ue.isExtensible(e)){return false}if(Rn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var _n=function(e,t){if(!le.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){oe(S.Reflect,e,t)}}};Object.keys(Cn).forEach(function(e){_n(e,Cn[e])});var kn=S.Reflect.getPrototypeOf;if(c&&kn&&kn.name!=="getPrototypeOf"){oe(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(kn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){oe(S.Reflect,"setPrototypeOf",Cn.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){oe(S.Reflect,"defineProperty",Cn.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){oe(S.Reflect,"construct",Cn.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var Ln=Date.prototype.toString;var Fn=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return le.Call(Ln,this)};oe(Date.prototype,"toString",Fn)}var Dn={anchor:function anchor(e){return le.CreateHTML(this,"a","name",e)},big:function big(){return le.CreateHTML(this,"big","","")},blink:function blink(){return le.CreateHTML(this,"blink","","")},bold:function bold(){return le.CreateHTML(this,"b","","")},fixed:function fixed(){return le.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return le.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return le.CreateHTML(this,"font","size",e)},italics:function italics(){return le.CreateHTML(this,"i","","")},link:function link(e){return le.CreateHTML(this,"a","href",e)},small:function small(){return le.CreateHTML(this,"small","","")},strike:function strike(){return le.CreateHTML(this,"strike","","")},sub:function sub(){return le.CreateHTML(this,"sub","","")},sup:function sub(){return le.CreateHTML(this,"sup","","")}};l(Object.keys(Dn),function(e){var r=String.prototype[e];var n=false;if(le.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){oe(String.prototype,e,Dn[e])}});var zn=function(){if(!ie){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e(J())!=="undefined"){return true}if(e([J()])!=="[null]"){return true}var t={a:J()};t[J()]=true;if(e(t)!=="{}"){return true}return false}();var qn=a(function(){if(!ie){return true}return JSON.stringify(Object(J()))==="{}"&&JSON.stringify([Object(J())])==="[{}]"});if(zn||!qn){var Wn=JSON.stringify;oe(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=le.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(ne.symbol(n)){return Rt({})(n)}return n}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return Wn.apply(this,o)})}return S});
//# sourceMappingURL=es6-shim.map
/*! jQuery v3.6.3 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,y=n.hasOwnProperty,a=y.toString,l=a.call(Object),v={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},S=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||S).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.3",E=function(e,t){return new E.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}E.fn=E.prototype={jquery:f,constructor:E,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=E.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return E.each(this,e)},map:function(n){return this.pushStack(E.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(E.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(E.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},E.extend=E.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(E.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||E.isPlainObject(n)?n:{},i=!1,a[t]=E.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},E.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=y.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?E.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:v}),"function"==typeof Symbol&&(E.fn[Symbol.iterator]=t[Symbol.iterator]),E.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,S,y,s,c,v,E="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",$=new RegExp(M+"+","g"),B=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,S)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&v(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!y||!y.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ve(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=E)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{if(d.cssSupportsSelector&&!CSS.supports("selector(:is("+c+"))"))throw new Error;return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===E&&e.removeAttribute("id")}}}return g(t.replace(B,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[E]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ye(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ve(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,S=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.cssSupportsSelector=ce(function(){return CSS.supports("selector(*)")&&C.querySelectorAll(":is(:jqfake)")&&!CSS.supports("selector(:is(*,:jqfake))")}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=E,!C.getElementsByName||!C.getElementsByName(E).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&S){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&S){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&S)return t.getElementsByClassName(e)},s=[],y=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+E+"'></a><select id='"+E+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||y.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+E+"-]").length||y.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||y.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||y.push(":checked"),e.querySelectorAll("a#"+E+"+*").length||y.push(".#.+[+~]"),e.querySelectorAll("\\\f"),y.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&y.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&y.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&y.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),y.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),d.cssSupportsSelector||y.push(":has"),y=y.length&&new RegExp(y.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),v=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType&&e.documentElement||e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&v(p,e)?-1:t==C||t.ownerDocument==p&&v(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&S&&!N[t+" "]&&(!s||!s.test(t))&&(!y||!y.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),v(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!S):void 0;return void 0!==r?r:d.attributes||!S?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace($," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,y){var v="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===y?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=v!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(v){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[E]||(a[E]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[E]||(a[E]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[E]||(a[E]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=y)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[E]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace(B,"$1"));return s[E]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=S?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ye(function(){return[0]}),last:ye(function(e,t){return[t-1]}),eq:ye(function(e,t,n){return[n<0?n+t:n]}),even:ye(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ye(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ye(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ye(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[E]||(e[E]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,y,v,e){return y&&!y[E]&&(y=Ce(y)),v&&!v[E]&&(v=Ce(v,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?v||(e?d:l||y)?[]:t:f;if(g&&g(f,p,n,r),y){i=Te(p,u),y(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(v||d){if(v){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);v(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=v?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),v?v(null,t,p,r):H.apply(t,p)})}function Se(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[E]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(B,"$1"),t,s<n&&Se(e.slice(s,n)),n<r&&Se(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(B," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,y,v,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Se(t[n]))[E]?i.push(a):o.push(a);(a=A(e,(y=o,m=0<(v=i).length,x=0<y.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!S);while(s=y[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=v[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+v.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&S&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ve(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!S,n,!t||ee.test(e)&&ve(t.parentNode)||t),n},d.sortStable=E.split("").sort(j).join("")===E,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);E.find=d,E.expr=d.selectors,E.expr[":"]=E.expr.pseudos,E.uniqueSort=E.unique=d.uniqueSort,E.text=d.getText,E.isXMLDoc=d.isXML,E.contains=d.contains,E.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&E(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=E.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?E.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?E.grep(e,function(e){return e===n!==r}):"string"!=typeof n?E.grep(e,function(e){return-1<i.call(n,e)!==r}):E.filter(n,e,r)}E.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?E.find.matchesSelector(r,e)?[r]:[]:E.find.matches(e,E.grep(t,function(e){return 1===e.nodeType}))},E.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(E(e).filter(function(){for(t=0;t<r;t++)if(E.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)E.find(e,i[t],n);return 1<r?E.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?E(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(E.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof E?t[0]:t,E.merge(this,E.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:S,!0)),N.test(r[1])&&E.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=S.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(E):E.makeArray(e,this)}).prototype=E.fn,D=E(S);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}E.fn.extend({has:function(e){var t=E(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(E.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&E(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&E.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?E.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(E(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(E.uniqueSort(E.merge(this.get(),E(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),E.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),E.merge([],e.childNodes))}},function(r,i){E.fn[r]=function(e,t){var n=E.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=E.filter(t,n)),1<this.length&&(H[r]||E.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}E.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},E.each(e.match(P)||[],function(e,t){n[t]=!0}),n):E.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){E.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return E.each(arguments,function(e,t){var n;while(-1<(n=E.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<E.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},E.extend({Deferred:function(e){var o=[["notify","progress",E.Callbacks("memory"),E.Callbacks("memory"),2],["resolve","done",E.Callbacks("once memory"),E.Callbacks("once memory"),0,"resolved"],["reject","fail",E.Callbacks("once memory"),E.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return E.Deferred(function(r){E.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){E.Deferred.exceptionHook&&E.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(E.Deferred.getStackHook&&(t.stackTrace=E.Deferred.getStackHook()),C.setTimeout(t))}}return E.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?E.extend(e,a):a}},s={};return E.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=E.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;E.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},E.readyException=function(e){C.setTimeout(function(){throw e})};var F=E.Deferred();function $(){S.removeEventListener("DOMContentLoaded",$),C.removeEventListener("load",$),E.ready()}E.fn.ready=function(e){return F.then(e)["catch"](function(e){E.readyException(e)}),this},E.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--E.readyWait:E.isReady)||(E.isReady=!0)!==e&&0<--E.readyWait||F.resolveWith(S,[E])}}),E.ready.then=F.then,"complete"===S.readyState||"loading"!==S.readyState&&!S.documentElement.doScroll?C.setTimeout(E.ready):(S.addEventListener("DOMContentLoaded",$),C.addEventListener("load",$));var B=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)B(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(E(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=E.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||E.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!E.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}E.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),E.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):B(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),E.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,E.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=E.queue(e,t),r=n.length,i=n.shift(),o=E._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){E.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:E.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),E.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?E.queue(this[0],t):void 0===n?this:this.each(function(){var e=E.queue(this,t,n);E._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&E.dequeue(this,t)})},dequeue:function(e){return this.each(function(){E.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=E.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=S.documentElement,ie=function(e){return E.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return E.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===E.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return E.css(e,t,"")},u=s(),l=n&&n[3]||(E.cssNumber[t]?"":"px"),c=e.nodeType&&(E.cssNumber[t]||"px"!==l&&+u)&&te.exec(E.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)E.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,E.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=E.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}E.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?E(this).show():E(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=S.createDocumentFragment().appendChild(S.createElement("div")),(fe=S.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),v.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",v.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",v.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ye(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?E.merge([e],n):n}function ve(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,v.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))E.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+E.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;E.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<E.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ye(f.appendChild(o),"script"),l&&ve(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return S.activeElement}catch(e){}}()==("focus"===t)}function Se(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Se(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return E().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=E.guid++)),e.each(function(){E.event.add(this,t,i,r,n)})}function Ee(e,i,o){o?(Y.set(e,i,!1),E.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(E.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:E.event.trigger(E.extend(r[0],E.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&E.event.add(e,i,we)}E.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&E.find.matchesSelector(re,i),n.guid||(n.guid=E.guid++),(u=y.events)||(u=y.events=Object.create(null)),(a=y.handle)||(a=y.handle=function(e){return"undefined"!=typeof E&&E.event.triggered!==e.type?E.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=E.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=E.event.special[d]||{},c=E.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&E.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),E.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=Y.hasData(e)&&Y.get(e);if(y&&(u=y.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=E.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,y.handle)||E.removeEvent(e,d,y.handle),delete u[d])}else for(d in u)E.event.remove(e,d+t[l],n,r,!0);E.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=E.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=E.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=E.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((E.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<E(i,this).index(l):E.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(E.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[E.expando]?e:new E.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Ee(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Ee(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},E.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},E.Event=function(e,t){if(!(this instanceof E.Event))return new E.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&E.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[E.expando]=!0},E.Event.prototype={constructor:E.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},E.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},E.event.addProp),E.each({focus:"focusin",blur:"focusout"},function(t,e){E.event.special[t]={setup:function(){return Ee(this,t,Ce),!1},trigger:function(){return Ee(this,t),!0},_default:function(e){return Y.get(e.target,t)},delegateType:e}}),E.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){E.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||E.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),E.fn.extend({on:function(e,t,n,r){return Se(this,e,t,n,r)},one:function(e,t,n,r){return Se(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,E(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){E.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&E(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)E.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=E.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!v.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=E.map(ye(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=E.clone(u,!0,!0),s&&E.merge(a,ye(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,E.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&E.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?E._evalUrl&&!u.noModule&&E._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?E.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||E.cleanData(ye(r)),r.parentNode&&(n&&ie(r)&&ve(ye(r,"script")),r.parentNode.removeChild(r));return e}E.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(v.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||E.isXMLDoc(e)))for(a=ye(c),r=0,i=(o=ye(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ye(e),a=a||ye(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ye(c,"script")).length&&ve(a,!f&&ye(e,"script")),c},cleanData:function(e){for(var t,n,r,i=E.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?E.event.remove(n,r):E.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),E.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return B(this,function(e){return void 0===e?E.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(E.cleanData(ye(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return E.clone(this,e,t)})},html:function(e){return B(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=E.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(E.cleanData(ye(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;E.inArray(this,n)<0&&(E.cleanData(ye(this)),t&&t.replaceChild(e,this))},n)}}),E.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){E.fn[e]=function(e){for(var t,n=[],r=E(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),E(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=/^--/,Me=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Ie=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},We=new RegExp(ne.join("|"),"i"),Fe="[\\x20\\t\\r\\n\\f]",$e=new RegExp("^"+Fe+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Fe+"+$","g");function Be(e,t,n){var r,i,o,a,s=Re.test(t),u=e.style;return(n=n||Me(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace($e,"$1")||void 0),""!==a||ie(e)||(a=E.style(e,t)),!v.pixelBoxStyles()&&Pe.test(a)&&We.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+"":a}function _e(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=S.createElement("div"),l=S.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",v.clearCloneStyle="content-box"===l.style.backgroundClip,E.extend(v,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=S.createElement("table"),t=S.createElement("tr"),n=S.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var ze=["Webkit","Moz","ms"],Ue=S.createElement("div").style,Xe={};function Ve(e){var t=E.cssProps[e]||Xe[e];return t||(e in Ue?e:Xe[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=ze.length;while(n--)if((e=ze[n]+t)in Ue)return e}(e)||e)}var Ge=/^(none|table(?!-c[ea]).+)/,Ye={position:"absolute",visibility:"hidden",display:"block"},Qe={letterSpacing:"0",fontWeight:"400"};function Je(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ke(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=E.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=E.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=E.css(e,"border"+ne[a]+"Width",!0,i))):(u+=E.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=E.css(e,"border"+ne[a]+"Width",!0,i):s+=E.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Ze(e,t,n){var r=Me(e),i=(!v.boxSizingReliable()||n)&&"border-box"===E.css(e,"boxSizing",!1,r),o=i,a=Be(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!v.boxSizingReliable()&&i||!v.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===E.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===E.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Ke(e,t,n||(i?"border":"content"),o,r,a)+"px"}function et(e,t,n,r,i){return new et.prototype.init(e,t,n,r,i)}E.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Be(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Re.test(t),l=e.style;if(u||(t=Ve(s)),a=E.cssHooks[t]||E.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(E.cssNumber[s]?"":"px")),v.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Re.test(t)||(t=Ve(s)),(a=E.cssHooks[t]||E.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Be(e,t,r)),"normal"===i&&t in Qe&&(i=Qe[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),E.each(["height","width"],function(e,u){E.cssHooks[u]={get:function(e,t,n){if(t)return!Ge.test(E.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Ze(e,u,n):Ie(e,Ye,function(){return Ze(e,u,n)})},set:function(e,t,n){var r,i=Me(e),o=!v.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===E.css(e,"boxSizing",!1,i),s=n?Ke(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Ke(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=E.css(e,u)),Je(0,t,s)}}}),E.cssHooks.marginLeft=_e(v.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Be(e,"marginLeft"))||e.getBoundingClientRect().left-Ie(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),E.each({margin:"",padding:"",border:"Width"},function(i,o){E.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(E.cssHooks[i+o].set=Je)}),E.fn.extend({css:function(e,t){return B(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Me(e),i=t.length;a<i;a++)o[t[a]]=E.css(e,t[a],!1,r);return o}return void 0!==n?E.style(e,t,n):E.css(e,t)},e,t,1<arguments.length)}}),((E.Tween=et).prototype={constructor:et,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||E.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(E.cssNumber[n]?"":"px")},cur:function(){var e=et.propHooks[this.prop];return e&&e.get?e.get(this):et.propHooks._default.get(this)},run:function(e){var t,n=et.propHooks[this.prop];return this.options.duration?this.pos=t=E.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):et.propHooks._default.set(this),this}}).init.prototype=et.prototype,(et.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=E.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){E.fx.step[e.prop]?E.fx.step[e.prop](e):1!==e.elem.nodeType||!E.cssHooks[e.prop]&&null==e.elem.style[Ve(e.prop)]?e.elem[e.prop]=e.now:E.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=et.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},E.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},E.fx=et.prototype.init,E.fx.step={};var tt,nt,rt,it,ot=/^(?:toggle|show|hide)$/,at=/queueHooks$/;function st(){nt&&(!1===S.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(st):C.setTimeout(st,E.fx.interval),E.fx.tick())}function ut(){return C.setTimeout(function(){tt=void 0}),tt=Date.now()}function lt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ct(e,t,n){for(var r,i=(ft.tweeners[t]||[]).concat(ft.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function ft(o,e,t){var n,a,r=0,i=ft.prefilters.length,s=E.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=tt||ut(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:E.extend({},e),opts:E.extend(!0,{specialEasing:{},easing:E.easing._default},t),originalProperties:e,originalOptions:t,startTime:tt||ut(),duration:t.duration,tweens:[],createTween:function(e,t){var n=E.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=E.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=ft.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(E._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return E.map(c,ct,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),E.fx.timer(E.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}E.Animation=E.extend(ft,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],ft.tweeners[n]=ft.tweeners[n]||[],ft.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),y=Y.get(e,"fxshow");for(r in n.queue||(null==(a=E._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,E.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],ot.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!y||void 0===y[r])continue;g=!0}d[r]=y&&y[r]||E.style(e,r)}if((u=!E.isEmptyObject(t))||!E.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=y&&y.display)&&(l=Y.get(e,"display")),"none"===(c=E.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=E.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===E.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(y?"hidden"in y&&(g=y.hidden):y=Y.access(e,"fxshow",{display:l}),o&&(y.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)E.style(e,r,d[r])})),u=ct(g?y[r]:0,r,p),r in y||(y[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?ft.prefilters.unshift(e):ft.prefilters.push(e)}}),E.speed=function(e,t,n){var r=e&&"object"==typeof e?E.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return E.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in E.fx.speeds?r.duration=E.fx.speeds[r.duration]:r.duration=E.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&E.dequeue(this,r.queue)},r},E.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=E.isEmptyObject(t),o=E.speed(e,n,r),a=function(){var e=ft(this,E.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=E.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&at.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||E.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=E.timers,o=n?n.length:0;for(t.finish=!0,E.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),E.each(["toggle","show","hide"],function(e,r){var i=E.fn[r];E.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(lt(r,!0),e,t,n)}}),E.each({slideDown:lt("show"),slideUp:lt("hide"),slideToggle:lt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){E.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),E.timers=[],E.fx.tick=function(){var e,t=0,n=E.timers;for(tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||E.fx.stop(),tt=void 0},E.fx.timer=function(e){E.timers.push(e),E.fx.start()},E.fx.interval=13,E.fx.start=function(){nt||(nt=!0,st())},E.fx.stop=function(){nt=null},E.fx.speeds={slow:600,fast:200,_default:400},E.fn.delay=function(r,e){return r=E.fx&&E.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},rt=S.createElement("input"),it=S.createElement("select").appendChild(S.createElement("option")),rt.type="checkbox",v.checkOn=""!==rt.value,v.optSelected=it.selected,(rt=S.createElement("input")).value="t",rt.type="radio",v.radioValue="t"===rt.value;var pt,dt=E.expr.attrHandle;E.fn.extend({attr:function(e,t){return B(this,E.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){E.removeAttr(this,e)})}}),E.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?E.prop(e,t,n):(1===o&&E.isXMLDoc(e)||(i=E.attrHooks[t.toLowerCase()]||(E.expr.match.bool.test(t)?pt:void 0)),void 0!==n?null===n?void E.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=E.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!v.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),pt={set:function(e,t,n){return!1===t?E.removeAttr(e,n):e.setAttribute(n,n),n}},E.each(E.expr.match.bool.source.match(/\w+/g),function(e,t){var a=dt[t]||E.find.attr;dt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=dt[o],dt[o]=r,r=null!=a(e,t,n)?o:null,dt[o]=i),r}});var ht=/^(?:input|select|textarea|button)$/i,gt=/^(?:a|area)$/i;function yt(e){return(e.match(P)||[]).join(" ")}function vt(e){return e.getAttribute&&e.getAttribute("class")||""}function mt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}E.fn.extend({prop:function(e,t){return B(this,E.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[E.propFix[e]||e]})}}),E.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&E.isXMLDoc(e)||(t=E.propFix[t]||t,i=E.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=E.find.attr(e,"tabindex");return t?parseInt(t,10):ht.test(e.nodeName)||gt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),v.optSelected||(E.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),E.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){E.propFix[this.toLowerCase()]=this}),E.fn.extend({addClass:function(t){var e,n,r,i,o,a;return m(t)?this.each(function(e){E(this).addClass(t.call(this,e,vt(this)))}):(e=mt(t)).length?this.each(function(){if(r=vt(this),n=1===this.nodeType&&" "+yt(r)+" "){for(o=0;o<e.length;o++)i=e[o],n.indexOf(" "+i+" ")<0&&(n+=i+" ");a=yt(n),r!==a&&this.setAttribute("class",a)}}):this},removeClass:function(t){var e,n,r,i,o,a;return m(t)?this.each(function(e){E(this).removeClass(t.call(this,e,vt(this)))}):arguments.length?(e=mt(t)).length?this.each(function(){if(r=vt(this),n=1===this.nodeType&&" "+yt(r)+" "){for(o=0;o<e.length;o++){i=e[o];while(-1<n.indexOf(" "+i+" "))n=n.replace(" "+i+" "," ")}a=yt(n),r!==a&&this.setAttribute("class",a)}}):this:this.attr("class","")},toggleClass:function(t,n){var e,r,i,o,a=typeof t,s="string"===a||Array.isArray(t);return m(t)?this.each(function(e){E(this).toggleClass(t.call(this,e,vt(this),n),n)}):"boolean"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=mt(t),this.each(function(){if(s)for(o=E(this),i=0;i<e.length;i++)r=e[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&"boolean"!==a||((r=vt(this))&&Y.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===t?"":Y.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+yt(vt(n))+" ").indexOf(t))return!0;return!1}});var xt=/\r/g;E.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,E(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=E.map(t,function(e){return null==e?"":e+""})),(r=E.valHooks[this.type]||E.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=E.valHooks[t.type]||E.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(xt,""):null==e?"":e:void 0}}),E.extend({valHooks:{option:{get:function(e){var t=E.find.attr(e,"value");return null!=t?t:yt(E.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=E(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=E.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<E.inArray(E.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),E.each(["radio","checkbox"],function(){E.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<E.inArray(E(e).val(),t)}},v.checkOn||(E.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),v.focusin="onfocusin"in C;var bt=/^(?:focusinfocus|focusoutblur)$/,wt=function(e){e.stopPropagation()};E.extend(E.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||S],d=y.call(e,"type")?e.type:e,h=y.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||S,3!==n.nodeType&&8!==n.nodeType&&!bt.test(d+E.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[E.expando]?e:new E.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:E.makeArray(t,[e]),c=E.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,bt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||S)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),E.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,wt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,wt),E.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=E.extend(new E.Event,n,{type:e,isSimulated:!0});E.event.trigger(r,null,t)}}),E.fn.extend({trigger:function(e,t){return this.each(function(){E.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return E.event.trigger(e,t,n,!0)}}),v.focusin||E.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){E.event.simulate(r,e.target,E.event.fix(e))};E.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var Tt=C.location,Ct={guid:Date.now()},St=/\?/;E.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||E.error("Invalid XML: "+(n?E.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Et=/\[\]$/,kt=/\r?\n/g,At=/^(?:submit|button|image|reset|file)$/i,Nt=/^(?:input|select|textarea|keygen)/i;function jt(n,e,r,i){var t;if(Array.isArray(e))E.each(e,function(e,t){r||Et.test(n)?i(n,t):jt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)jt(n+"["+t+"]",e[t],r,i)}E.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!E.isPlainObject(e))E.each(e,function(){i(this.name,this.value)});else for(n in e)jt(n,e[n],t,i);return r.join("&")},E.fn.extend({serialize:function(){return E.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=E.prop(this,"elements");return e?E.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!E(this).is(":disabled")&&Nt.test(this.nodeName)&&!At.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=E(this).val();return null==n?null:Array.isArray(n)?E.map(n,function(e){return{name:t.name,value:e.replace(kt,"\r\n")}}):{name:t.name,value:n.replace(kt,"\r\n")}}).get()}});var Dt=/%20/g,qt=/#.*$/,Lt=/([?&])_=[^&]*/,Ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ot=/^(?:GET|HEAD)$/,Pt=/^\/\//,Rt={},Mt={},It="*/".concat("*"),Wt=S.createElement("a");function Ft(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function $t(t,i,o,a){var s={},u=t===Mt;function l(e){var r;return s[e]=!0,E.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Bt(e,t){var n,r,i=E.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&E.extend(!0,e,r),e}Wt.href=Tt.href,E.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Tt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Tt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":It,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":E.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Bt(Bt(e,E.ajaxSettings),t):Bt(E.ajaxSettings,e)},ajaxPrefilter:Ft(Rt),ajaxTransport:Ft(Mt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,y=E.ajaxSetup({},t),v=y.context||y,m=y.context&&(v.nodeType||v.jquery)?E(v):E.event,x=E.Deferred(),b=E.Callbacks("once memory"),w=y.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Ht.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(y.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),y.url=((e||y.url||Tt.href)+"").replace(Pt,Tt.protocol+"//"),y.type=t.method||t.type||y.method||y.type,y.dataTypes=(y.dataType||"*").toLowerCase().match(P)||[""],null==y.crossDomain){r=S.createElement("a");try{r.href=y.url,r.href=r.href,y.crossDomain=Wt.protocol+"//"+Wt.host!=r.protocol+"//"+r.host}catch(e){y.crossDomain=!0}}if(y.data&&y.processData&&"string"!=typeof y.data&&(y.data=E.param(y.data,y.traditional)),$t(Rt,y,t,T),h)return T;for(i in(g=E.event&&y.global)&&0==E.active++&&E.event.trigger("ajaxStart"),y.type=y.type.toUpperCase(),y.hasContent=!Ot.test(y.type),f=y.url.replace(qt,""),y.hasContent?y.data&&y.processData&&0===(y.contentType||"").indexOf("application/x-www-form-urlencoded")&&(y.data=y.data.replace(Dt,"+")):(o=y.url.slice(f.length),y.data&&(y.processData||"string"==typeof y.data)&&(f+=(St.test(f)?"&":"?")+y.data,delete y.data),!1===y.cache&&(f=f.replace(Lt,"$1"),o=(St.test(f)?"&":"?")+"_="+Ct.guid+++o),y.url=f+o),y.ifModified&&(E.lastModified[f]&&T.setRequestHeader("If-Modified-Since",E.lastModified[f]),E.etag[f]&&T.setRequestHeader("If-None-Match",E.etag[f])),(y.data&&y.hasContent&&!1!==y.contentType||t.contentType)&&T.setRequestHeader("Content-Type",y.contentType),T.setRequestHeader("Accept",y.dataTypes[0]&&y.accepts[y.dataTypes[0]]?y.accepts[y.dataTypes[0]]+("*"!==y.dataTypes[0]?", "+It+"; q=0.01":""):y.accepts["*"]),y.headers)T.setRequestHeader(i,y.headers[i]);if(y.beforeSend&&(!1===y.beforeSend.call(v,T,y)||h))return T.abort();if(u="abort",b.add(y.complete),T.done(y.success),T.fail(y.error),c=$t(Mt,y,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,y]),h)return T;y.async&&0<y.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},y.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(y,T,n)),!i&&-1<E.inArray("script",y.dataTypes)&&E.inArray("json",y.dataTypes)<0&&(y.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(y,s,T,i),i?(y.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(E.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(E.etag[f]=u)),204===e||"HEAD"===y.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(v,[o,l,T]):x.rejectWith(v,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,y,i?o:a]),b.fireWith(v,[T,l]),g&&(m.trigger("ajaxComplete",[T,y]),--E.active||E.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return E.get(e,t,n,"json")},getScript:function(e,t){return E.get(e,void 0,t,"script")}}),E.each(["get","post"],function(e,i){E[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),E.ajax(E.extend({url:e,type:i,dataType:r,data:t,success:n},E.isPlainObject(e)&&e))}}),E.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),E._evalUrl=function(e,t,n){return E.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){E.globalEval(e,t,n)}})},E.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=E(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){E(this).wrapInner(n.call(this,e))}):this.each(function(){var e=E(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){E(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){E(this).replaceWith(this.childNodes)}),this}}),E.expr.pseudos.hidden=function(e){return!E.expr.pseudos.visible(e)},E.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},E.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var _t={0:200,1223:204},zt=E.ajaxSettings.xhr();v.cors=!!zt&&"withCredentials"in zt,v.ajax=zt=!!zt,E.ajaxTransport(function(i){var o,a;if(v.cors||zt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(_t[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),E.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),E.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return E.globalEval(e),e}}}),E.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),E.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=E("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),S.head.appendChild(r[0])},abort:function(){i&&i()}}});var Ut,Xt=[],Vt=/(=)\?(?=&|$)|\?\?/;E.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Xt.pop()||E.expando+"_"+Ct.guid++;return this[e]=!0,e}}),E.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Vt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Vt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Vt,"$1"+r):!1!==e.jsonp&&(e.url+=(St.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||E.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?E(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Xt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),v.createHTMLDocument=((Ut=S.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Ut.childNodes.length),E.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(v.createHTMLDocument?((r=(t=S.implementation.createHTMLDocument("")).createElement("base")).href=S.location.href,t.head.appendChild(r)):t=S),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&E(o).remove(),E.merge([],i.childNodes)));var r,i,o},E.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=yt(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&E.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?E("<div>").append(E.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},E.expr.pseudos.animated=function(t){return E.grep(E.timers,function(e){return t===e.elem}).length},E.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=E.css(e,"position"),c=E(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=E.css(e,"top"),u=E.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,E.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},E.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){E.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===E.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===E.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=E(e).offset()).top+=E.css(e,"borderTopWidth",!0),i.left+=E.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-E.css(r,"marginTop",!0),left:t.left-i.left-E.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===E.css(e,"position"))e=e.offsetParent;return e||re})}}),E.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;E.fn[t]=function(e){return B(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),E.each(["top","left"],function(e,n){E.cssHooks[n]=_e(v.pixelPosition,function(e,t){if(t)return t=Be(e,n),Pe.test(t)?E(e).position()[n]+"px":t})}),E.each({Height:"height",Width:"width"},function(a,s){E.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){E.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return B(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?E.css(e,t,i):E.style(e,t,n,i)},s,n?e:void 0,n)}})}),E.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){E.fn[t]=function(e){return this.on(t,e)}}),E.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),E.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){E.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Gt=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;E.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||E.guid++,i},E.holdReady=function(e){e?E.readyWait++:E.ready(!0)},E.isArray=Array.isArray,E.parseJSON=JSON.parse,E.nodeName=A,E.isFunction=m,E.isWindow=x,E.camelCase=X,E.type=w,E.now=Date.now,E.isNumeric=function(e){var t=E.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},E.trim=function(e){return null==e?"":(e+"").replace(Gt,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return E});var Yt=C.jQuery,Qt=C.$;return E.noConflict=function(e){return C.$===E&&(C.$=Qt),e&&C.jQuery===E&&(C.jQuery=Yt),E},"undefined"==typeof e&&(C.jQuery=C.$=E),E});
"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,a=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n,r,a,o,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return r=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){r=!0,a=e},f:function(){try{n||null==i.return||i.return()}finally{if(r)throw a}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}define("engine",["jquery","utils","state","section","passages"],function(N,j,P,R,I){var t,V=j.impossible,M=j.passageSelector,D=j.transitionOut,F=j.options;function L(e,t,n){var r,a,o;if(n?(n=n.get("name"),(a=I.getTree(n)).children.length&&(r={type:"include",tag:t,name:n,children:a.children,text:a.text})):r=I.getTree(t),r){for(;(o=e[e.length-1])&&("root"===o.type||"include"===o.type)&&o.children.some(function(e){return e.type.startsWith("unclosed")});)e[e.length-1]=Object.create(o),e=e[e.length-1].children=o.children.slice();e.push(r)}}function n(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.loadedGame,a=I.get(e),o=j.storyElement,i=o.parent(),s=n.stretch,n=n.transition,n=void 0===n?{}:n,c=n.depart,c=void 0===c?"instant":c,l=n.arrive,l=void 0===l?"dissolve":l,u=n.departOrigin,p=n.arriveOrigin,n=n.time,d=(i.findAndFilter("tw-enchantment").each(function(e,t){var n=(t=N(t)).data("enchantedProperties");n&&o.css(n.reduce(function(e,t){return e[t]="",e},{})),t[0]===i[0]&&(i=o.unwrap().parent())}),I.hasValid(e)||V("Engine.showPassage","There's no passage with the name \""+e+'"!'),o.children(M).not(".transition-out, .transition-out *")),a=(a.get("tags")||[]).join(" "),f=(t=N("<tw-passage><tw-sidebar>"),f=t.children("tw-sidebar"),h=N('<tw-icon tabindex=0 alt="Undo" title="Undo">&#8630;</tw-icon>'),g=N('<tw-icon tabindex=0 alt="Redo" title="Redo">&#8631;</tw-icon>'),P.pastLength<=0&&h.css("visibility","hidden"),P.futureLength<=0&&g.css("visibility","hidden"),f.append(h,g),t),h=("function"==typeof u&&(u=u.call(d)),"function"==typeof p&&(p=p.call(f)),!s&&c),m=h&&d.css("width"),g=(j.detachStoryElement(),f.appendTo(o).attr({tags:a}),h&&(D(d,c,n,0,0,0,u),d.css({position:"absolute",width:function(){return"0px"!==m?m:"100%"}})),o.attr({tags:a}),R.create(f)),y=(r&&(g.loadedGame=!0),[]);if(P.pastLength<=0&&1===P.turns){var b,v=_createForOfIteratorHelper(I.getTagged("startup"));try{for(v.s();!(b=v.n()).done;)L(y,"startup",b.value)}catch(e){v.e(e)}finally{v.f()}if(F.debug){var w,k=_createForOfIteratorHelper(I.getTagged("debug-startup"));try{for(k.s();!(w=k.n()).done;)L(y,"debug-startup",w.value)}catch(e){k.e(e)}finally{k.f()}}}var S,T=_createForOfIteratorHelper(I.getTagged("header"));try{for(T.s();!(S=T.n()).done;)L(y,"header",S.value)}catch(e){T.e(e)}finally{T.f()}if(F.debug){var _,x=_createForOfIteratorHelper(I.getTagged("debug-header"));try{for(x.s();!(_=x.n()).done;)L(y,"debug-header",_.value)}catch(e){x.e(e)}finally{x.f()}}L(y,e);var O,A=_createForOfIteratorHelper(I.getTagged("footer"));try{for(A.s();!(O=A.n()).done;)L(y,"footer",O.value)}catch(e){A.e(e)}finally{A.f()}if(F.debug){var C,E=_createForOfIteratorHelper(I.getTagged("debug-footer"));try{for(E.s();!(C=E.n()).done;)L(y,"debug-footer",C.value)}catch(e){E.e(e)}finally{E.f()}}g.renderInto(y,f,{transition:l,transitionTime:n,transitionOrigin:p}),g.loadedGame=!1,j.reattachStoryElement(),scroll(0,s?f.offset().top-.05*N(window).height():o[0].getBoundingClientRect().top+document.body.scrollTop)}return Object.freeze({goBack:function(e){P.rewind()&&n(P.passage,e)},goForward:function(e){P.fastForward()&&n(P.passage,e)},goToPassage:function(e,t){P.play(e),n(e,t)},redirect:function(e,t){P.redirect(e),n(e,t)},toggleFullscreen:function(){var e=document.documentElement;document.fullscreenElement?document.exitFullscreen():document.msFullscreenElement?document.msExitFullscreen():(e.msRequestFullscreen||e.requestFullscreen).call(e)},showPassage:n,enableDebugMode:function(){t&&t()},registerDebugMode:function(e){t=t||e}})}),define("harlowe",["jquery","debugmode/mode","renderer","state","section","engine","passages","utils","utils/renderutils","internaltypes/varscope","internaltypes/twineerror","macros","macrolib/values","macrolib/commands","macrolib/datastructures","macrolib/stylechangers","macrolib/enchantments","macrolib/metadata","macrolib/patterns","macrolib/links","macrolib/custommacros","utils/jqueryplugins","repl"],function($,DebugMode,Renderer,State,Section,Engine,Passages,Utils,_ref,VarScope){var dialog=_ref.dialog;function __HarloweEval(text){eval(text+"")}function printJSError(e){var t,n="".concat(e.name,": ").concat(e.message);return e.stack&&(t=(e=e.stack.split("\n")).findIndex(function(e){return e.includes("__HarloweEval")}),n+="\n".concat(e.slice(0,t).join("\n").replace(/\([^)]+\)/g,""))),"<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>```"+n+"```</div>"}!function(o){window.onerror=function(e,t,n,r,a){window.onerror=o,Utils.storyElement.parent().append(dialog({message:"Sorry to interrupt, but this page's code has got itself in a mess.\n\n".concat(printJSError(a),"\n(This is probably due to a bug in the Harlowe game engine.)")}).addClass("harlowe-crash")),"function"==typeof o&&o.apply(void 0,arguments)}}(window.onerror),Utils.onStartup(function(){var n,e,t,r,a=$("tw-storydata");0!==a.length&&(Utils.options.ifid=a.attr("ifid"),(a.attr("tags")||"").split(/\s/).forEach(function(e){"uncompressed-pure-values"!==e&&"uncompressed-saves"!==e||(Utils.options.uncompressedPureValues=!0),"uncompressed-structures"!==e&&"uncompressed-saves"!==e||(Utils.options.uncompressedStructures=!0)}),(a.attr("options")||"").split(/\s/).forEach(function(e){e&&(Utils.options[e]=!0),"debug"===e&&DebugMode()}),a=(a=a.attr("startnode"))||[].reduce.call($("tw-passagedata"),function(e,t){t=t.getAttribute("pid");return t<e?t:e},1/0),a=$("tw-passagedata[pid='"+a+"']").attr("name"),$(document.documentElement).on("keydown",function(e){13===e.which&&"0"===e.target.getAttribute("tabindex")&&$(e.target).trigger("click")}),n=!1,$("[role=script]").each(function(t){try{__HarloweEval($(this).html())}catch(e){n||(n=!0,dialog({parent:Utils.storyElement.parent(),message:"There is a problem with this story's "+Utils.nth(t+1)+" script:\n\n"+printJSError(e)}))}}),$("[role=stylesheet]").each(function(e,t){$(document.head).append("<style data-title=\"Story stylesheet '".concat(e+1,"'\">").concat($(t).html()))}),(e=Section.create()).stack=[{tempVariables:Object.create(VarScope)}],(r=Passages.loadMetadata(e)).length&&(t=dialog({parent:Utils.storyElement.parent(),message:"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>"}),r.forEach(function(e){return t.find("p").append(e.render())})),(r=!Utils.options.debug&&State.hasSessionStorage&&sessionStorage.getItem("Saved Session"))&&!0===State.deserialise(e,r)?Engine.showPassage(State.passage):Engine.goToPassage(a))})}),define("macros",["utils/naturalsort","utils","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/twineerror"],function(g,e,t,o,r,y,b,p,v){var w=e.insensitiveName,k=e.nth,S=e.andList,T=t.objectName,_=t.typeName,d=t.toSource,x=Array.isArray,i={};function O(e){return e===s.TypeSignature.Any||(x(e.innerType)?e.innerType.some(O):!!e.innerType&&O(e.innerType))}function a(e,t,n,r){var a,o,i,s,c,l,u,p,d=t.fn,f=t.typeSignature,h=t.returnType,m=(r=function(e){for(var t,n,r,a=[],o=0;o<e.length;o+=1)o in e&&(!0===(null==(t=e[o])?void 0:t.spreader)?(n=t.value,(r=v.containsError(n))?a.push(r):x(n)||"string"==typeof n?a.push.apply(a,_toConsumableArray(n)):n instanceof Set?a.push.apply(a,_toConsumableArray(Array.from(n).sort(g("en")))):a.push(v.create("operation","I can't spread out "+T(n)+", because it is not a string, dataset, or array."))):a.push(t));return a}(r),"string"!=typeof e&&(a=e,e=""),a?"":"("+(x(e)&&1<e.length?e[0]:e)+":)");for(e=a?a.TwineScript_KnownName?"the custom macro, ".concat(a.TwineScript_KnownName):"an unnamed custom macro":"the ".concat(m," macro"),o=0<f.length?1===f.length&&O(f[0])?1===r.length?"That value can't be given to macros as-is.":"Give only a single value to this macro.":e+" must only be given "+S(f.map(_))+(1<f.length?", in that order":"."):e+" must not be given any data."+(a?"":" Just write "+m),s=0,c=Math.max(r.length,f.length);s<c;s+=1){if(p=f[s],l=r[s],v.containsError(l))return l;if(s>=f.length&&!i)return v.create("datatype",r.length-f.length+" too many values were given to "+e+".",o);if(!(p=p||i).innerType||"rest"!==p.pattern&&"zero or more"!==p.pattern||(i=p.innerType,"rest"===p.pattern&&(p=p.innerType)),!function e(t,n){if(null===n)return void 0===t;var r=_typeof(t);if("function"!=typeof n&&n.pattern){if("optional"===n.pattern||"zero or more"===n.pattern)return void 0===t||e(t,n.innerType);if("either"===n.pattern){for(var a=0;a<n.innerType.length;a+=1)if(e(t,n.innerType[a]))return!0;return!1}if("lambda"===n.pattern&&e(t,n.innerType))return n.clauses.includes("where")===("where"in t||"each"in t)&&n.clauses.includes("making")==="making"in t&&n.clauses.includes("via")==="via"in t&&n.clauses.includes("with")==="with"in t;if("insensitive set"===n.pattern)return n.innerType.includes(w(t));if("range"===n.pattern)return n.range(t);if("wrapped"===n.pattern)return e(t,n.innerType)}return(void 0===n||void 0!==t)&&("anything"===n.TwineScript_TypeName&&void 0!==t&&!t.TwineScript_Unstorable||"everything"===n.TwineScript_TypeName&&void 0!==t||(n===String?"string"===r:n===Boolean?"boolean"===r:n===parseInt?"number"===r&&!Number.isNaN(t)&&!(t+"").includes("."):n===Number?"number"===r&&!Number.isNaN(t):n===Array?x(t):n===Map||n===Set?t instanceof n:Object.isPrototypeOf.call(n,t)))}(l,p))return void 0===l?(u=f.filter(function(e){return!("optional"===e.pattern||"zero or more"===e.pattern)}).length,v.create("datatype","".concat(e," was given ").concat(r.length?S(r.map(T)):"nothing",", but needs ").concat(u-s," more value").concat(1<u-s?"s":"","."),o)):null!=(u=l)&&u.TwineScript_Unstorable&&O(p)?v.create("datatype",e+"'s "+k(s+1)+" value, "+T(l)+", is not valid data for this macro.",o):b.isPrototypeOf(l)&&"Changer"===h?v.create("syntax","Please put this hook outside the parentheses of "+e+", not inside it.","Hooks should appear after a macro"+(a?".":": "+m+"[Some text]")):l&&y.isPrototypeOf(l)&&"lambda"===p.pattern?v.create("datatype",e+"'s "+k(s+1)+" value (a lambda) should have "+S(["where","when","making","via","with"].filter(function(e){return p.clauses.includes(e)}).map(function(e){return"a '"+e+"' clause"}))+", not "+S(["where","when","making","via","with"].filter(function(e){return e in l}).map(function(e){return"a '"+e+"' clause"}))+"."):"insensitive set"===p.pattern?v.create("datatype",T(l)+" is not a valid name string for "+e+".","Only the following names are recognised (capitalisation and hyphens ignored): "+S(p.innerType)+"."):v.create("datatype","".concat(e,"'s ").concat(k(s+1)," value is ").concat(T(l),", but should be ").concat(_(p),"."),p.message||o)}return d.apply(null,[n].concat(r))}function f(e,t,n,r){var a={fn:n,typeSignature:r=[].concat(r||[]),returnType:t};Object.freeze(a),[].concat(e).forEach(function(e){return Object.defineProperty(i,w(e),{value:a})})}var s={has:function(e){return e=w(e),hasOwnProperty.call(i,e)},get:function(e){return e=w(e),hasOwnProperty.call(i,e)&&i[e]},add:function e(t,n,r,a){return f(t,n,r,a),e},addChanger:function e(t,n,r,a){return f(t,"Changer",n,a),o.register(x(t)?t[0]:t,r),e},addCommand:function e(t,n,r,a){var s,c,l,u,o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=[].concat(t)[0];return f(t,"Command",(s=i,c=n,l=r,u=o,function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,o,i=c.apply(void 0,n);return i||(a=p.create(),o=_objectSpread({TwineScript_TypeID:"command",TwineScript_ObjectName:"a (".concat(s,":) command"),TwineScript_TypeName:"a (".concat(s,":) command"),TwineScript_Print:function(){return"`[A (".concat(s,":) command]`")},TwineScript_ToSource:function(){return"(".concat(s,":").concat(n.map(d),")")},TwineScript_is:function(e){return d(this)===d(e)}},u?{TwineScript_Attach:function(e,t){return a.section=e,t.run(a),o},TwineScript_Run:function(e){e=l.apply(void 0,[a,e].concat(n));return a=p.create(),e}}:{TwineScript_Run:function(e){return l.apply(void 0,[e].concat(n))}}))}),a),e},TypeSignature:{optional:function(e){return{pattern:"optional",innerType:e}},zeroOrMore:function(e){return{pattern:"zero or more",innerType:e}},either:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"either",innerType:t}},rest:function(e){return{pattern:"rest",innerType:e}},insensitiveSet:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"insensitive set",innerType:t}},numberRange:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0;return{pattern:"range",min:t,max:n,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&t<=e&&e<=n}}},nonNegativeInteger:{pattern:"range",integer:!0,min:0,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&0<=e&&!(e+"").includes(".")}},positiveInteger:{pattern:"range",integer:!0,min:1,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&1<=e&&!(e+"").includes(".")}},wrapped:function(e,t){return{pattern:"wrapped",innerType:e,message:t}},Any:{TwineScript_TypeName:"anything"},Everything:{TwineScript_TypeName:"everything"}},run:function(e,t,n){return s.has(e)?a(e,s.get(e),t,n):v.create("macrocall","I can't run the macro '"+e+"' because it doesn't exist.","Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.")},runCustom:function(e,t,n){return r.isPrototypeOf(e)?a(e,e,t,n):v.containsError(e)?e:v.create("macrocall","I can't call ".concat(T(e)," because it isn't a custom macro."))}};return Object.assign(s.TypeSignature,{positiveNumber:s.TypeSignature.numberRange(Math.pow(2,-52),1/0),nonNegativeNumber:s.TypeSignature.numberRange(0,1/0),percent:s.TypeSignature.numberRange(0,1)}),Object.freeze(s)}),define("passages",["jquery","utils/naturalsort","utils","markup","internaltypes/twineerror"],function(t,s,e,c,l){var u=e.insensitiveName,p=e.unescape,n=e.onStartup,o=e.impossible,d=Object.assign,f=RegExp(c.Patterns.macroFront+c.Patterns.macroName,"ig");function r(e){var t,r,a,o,n=e.attr("name"),i=p(e.html()),s=(t=n,o=["metadata","storylet","exclusivity","urgency"],((s=i).match(f)||[]).some(function(t){return o.some(function(e){return u(t.slice(1,-1))===e})})?(r=!1,a={},c.lex(s,t).children.forEach(function e(t){if("macro"===t.type){var n=u(t.name);if(o.some(function(e){return n===e})){if(l.isPrototypeOf(a[n]))return;if(r)return void(a[n]=l.create("syntax","The (".concat(t.name,":) macro can't appear after non-metadata macros.")));if(a[n])return void(a[n]=l.create("syntax","There is more than one (".concat(t.name,":) macro.")));a[n]=t}else r=!0;t.children.forEach(function e(t){var n=u(t.name);"macro"===t.type&&o.some(function(e){return n===e})?a[n]=l.create("syntax","The (".concat(t.name,":) macro can't be inside another macro.")):t.children.forEach(e)})}else t.children.forEach(e)}),a):{});return d(new Map([["source",i],["tags",(e.attr("tags")||"").split(/\s/)||[]],["name",n]]),{TwineScript_TypeName:"a passage datamap",TwineScript_ObjectName:"a passage datamap",metadata:s,tree:null})}var a=Object.create(null),i=[],h=null,m=d(new Map,{TwineScript_ObjectName:"the Passages datamap",getTagged:function(n){var e,r;return a[n]||(e=s("en",function(e){return e.get("name")}),r=[],this.forEach(function(e){var t=e instanceof Map&&e.get("tags");Array.isArray(t)&&t.includes(n)&&r.push(e)}),r.sort(e),a[n]=r)},clearTagCache:function(){a=Object.create(null)},clear:function(){Map.prototype.clear.call(this),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},delete:function(){var e;(e=Map.prototype.delete).call.apply(e,[this].concat(Array.prototype.slice.call(arguments))),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},getTree:function(e){if(!this.has(e))return o("Passages.getTree","No passage name?"),[];var t=this.get(e),n=t.get("tags");if(n.includes("header")||n.includes("footer")||n.includes("debug-header")||n.includes("debug-footer"))return t.tree||(t.tree=c.lex(t.get("source"),e)),t.tree;for(var r,a=0;a<i.length;a+=1)if(i[a]&&i[a].place===e)return r=i.splice(a,1)[0],i.unshift(r),r;n=c.lex(t.get("source"),e);return i.unshift(n),16<i.length&&i.pop(),n},clearTreeCache:function(){i=[]},getStorylets:function(r,e){var a,o,i,e=e?e.filter(r,_toConsumableArray(m.values())):_toConsumableArray(m.values());return l.containsError(e)?e:(a=[],o=-1/0,e.reduce(function(e,t){if(e)return e;e=t.get("storylet");if(e){var n=r.speculate(e,t.get("name"),"a (storylet:) macro");if(l.containsError(n))return n.message="There's an error in the storylet passage \""+t.get("name")+'":\n'+n.message,n.source=e.TwineScript_ToSource(),n;n&&(e=t.get("exclusivity"),o=Math.max(o,"number"==typeof e?e:0),a.push(t))}},void 0)||(i=s("en"),a.filter(function(e){e=e.get("exclusivity");return("number"==typeof e?e:0)===o}).sort(function(e,t){var n=e.get("urgency"),r=t.get("urgency");return(n="number"==typeof n?n:0)!==(r="number"==typeof r?r:0)?r-n:i(e.get("name"),t.get("name"))})))},allStorylets:function(){return h=h||_toConsumableArray(m.values()).filter(function(e){return e.get("storylet")})},clearStoryletCache:function(){h=null},loadMetadata:function(i){var s=[];return m.forEach(function(o){o.metadata&&Object.keys(o.metadata).forEach(function(e){var t,n,r;function a(e,t){o.has(e)?s.push(l.create("syntax","This passage's datamap already has a '"+JSON.stringify(e)+"' data name.")):o.set(e,t)}l.containsError(o.metadata[e])?s.push(o.metadata[e]):(t=o.metadata[e],n=i.speculate(t,o.get("name"),"a ("+e+":) macro"),r='In "'+o.get("name")+'":\n',l.containsError(n)?(n.message=r+n.message,n.source=t.text,s.push(n)):n instanceof Map?n.forEach(function(e,t){return a(t,e)}):a(e,n))}),o.metadata=void 0}),s},hasValid:function(e){e=this.get(e);return e&&e instanceof Map&&e.has("source")},create:r});return n(function(){t("tw-storydata > tw-passagedata").get().forEach(function(e){e=t(e),m.set(e.attr("name"),new r(e))})}),m}),define("renderer",["jquery","utils","markup","internaltypes/twineerror"],function(a,e,S,T){var _=e.escape,x=e.insensitiveName,O=e.options;function A(e,t,n){n=2<arguments.length&&void 0!==n?n:"";return"<"+t+(n?" "+n:"")+">"+e+"</"+t+">"}var C="text-align: center; max-width:50%; ";function E(m,g){function y(e,t,n){e=E(e.children,g);return e&&A(e,t,n)}var b="",v=[];if(m)for(var w=(m=Array.isArray(m)?m:[m]).length,k=0;k<w;k+=1){var e=function(e){var n=m[e];switch(n.type){case"include":b+=y(n,"tw-"+n.type,'type="'.concat(n.tag,'" name="').concat(n.name,'"'));break;case"error":b+=T.create("syntax",n.message,n.explanation).render(_(n.text))[0].outerHTML;break;case"numbered":case"bulleted":for(var t="numbered"===n.type?"ol":"ul",r=(b+="<"+t+">",1);e<w&&m[e];){if("br"===m[e].type){if(b+="</li>",!m[e+1]||m[e+1].type!==n.type)break}else m[e].type===n.type?(b=(b+=("<"+t+">").repeat(Math.max(0,m[e].depth-r)))+("</"+t+">").repeat(Math.max(0,r-m[e].depth))+"<li>",r=m[e].depth):b+=E([m[e]],g);e+=1}b+=("</"+t+">").repeat(r+1);break;case"align":for(;n&&"align"===n.type;){var a=n.align,o=e+=1;if("left"===a){--e;break}for(;e<w&&m[e]&&"align"!==m[e].type;)e+=1;var o=E(m.slice(o,e),g),i="";switch(a){case"center":i+=C+"margin-left: auto; margin-right: auto;";break;case"justify":case"right":i+="text-align: "+a+";";break;default:+a&&(i+=C+"margin-left: "+a+"%;")}b+="<tw-align "+(i?'style="'+i+'"':"")+">"+o+"</tw-align>\n",n=m[e]}break;case"column":for(var s,c=[];n&&"column"===n.type;){var l=n.column,u=e+=1;if("none"===l){--e;break}for(;e<w&&m[e]&&"column"!==m[e].type;)e+=1;c.push({text:n.text,type:l,body:E(m.slice(u,e),g),width:n.width,marginLeft:n.marginLeft,marginRight:n.marginRight}),n=m[e]}c.length&&(s=c.reduce(function(e,t){return e+t.width},0),b+="<tw-columns>"+c.map(function(e){return"<tw-column type=".concat(e.type," ",' style="width:').concat(e.width/s*100,"%; margin-left: ").concat(e.marginLeft,"em; margin-right: ").concat(e.marginRight,'em;">').concat(e.body,"</tw-column>\n")}).join("")+"</tw-columns>");break;case"heading":for(b+="<h"+n.depth+">";++e<w&&m[e];){if("br"===m[e].type){b+="</h"+n.depth+">";break}b+=E([m[e]],g)}break;case"br":if(!v.length||/td|th/.test(v[0])){b+="<br>";for(var p=m[e+1];p&&("br"===p.type||"tag"===p.type&&/^<br\b/i.test(p.text));)b+="<tw-consecutive-br"+("tag"===p.type?" data-raw":"")+"></tw-consecutive-br>",p=m[(e+=1)+1]}break;case"hr":b+="<hr>";break;case"escapedLine":case"comment":break;case"inlineUrl":b+='<a class="link" href="'+_(n.text)+'">'+n.text+"</a>";break;case"scriptStyleTag":case"tag":var d=n.text.toLowerCase();/^<\/?(?:table|thead|tbody|tr|tfoot|td|th|svg)\b/.test(d)&&!n.text.endsWith("/>")&&v[n.text.startsWith("</")?"shift":"unshift"](d),b+=n.text.startsWith("</")?n.text:n.text.replace(/(\/)?>$/,function(e,t){return" data-raw".concat(t?"></".concat(n.text.match(/[\w-]+/)):"",">")});break;case"sub":case"sup":case"strong":case"em":b+=y(n,n.type);break;case"strike":b+=y(n,"s");break;case"bold":b+=y(n,"b");break;case"italic":b+=y(n,"i");break;case"twineLink":d=_slicedToArray(S.lex("(link-goto:"+JSON.stringify(n.innerText)+","+JSON.stringify(n.passage)+")").children,1)[0];b+='<tw-expression type="macro" name="link-goto"'+(O.debug?' title="'+_(n.text)+'"':"")+' code="'+g.code.length+'"></tw-expression>',g.code.push(d);break;case"hook":b+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+x(n.name)+'"':"")+(O.debug&&n.name?' title="Hook: ?'+n.name+'"':"")+' source="'+g.source.length+'"></tw-hook>',g.source.push(n.children);break;case"unclosedHook":return b+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+x(n.name)+'"':"")+'source="'+g.source.length+'"></tw-hook>',g.source.push(m.slice(e+1,w)),{v:b};case"verbatim":b+=A(_(n.innerText).replace(/\n/g,"<br>"),"tw-verbatim");break;case"collapsed":b+=y(n,"tw-collapsed");break;case"unclosedCollapsed":return{v:b+="<tw-collapsed>"+E(m.slice(e+1,w),g)+"</tw-collapsed>"};case"variable":case"tempVariable":case"macro":var f=[],h=[];if("macro"===n.type&&!function e(t){"string"!==t.type&&"hook"!==t.type&&t.children.every(e);var n=x(t.name);if("macro"!==t.type||"prompt"!==n&&"confirm"!==n){if("hook"===t.type&&!t.everyLeaf(function(e){return"error"!==e.type||(h.push(e),!1)}))return!1}else f.push(t);return!0}(n),h.length)return{v:T.create("syntax","This code hook's markup contained "+h.length+" error"+(h.length?"s":"")+":<br>\u2014"+h.map(function(e){return e.message}).join("<br>\u2014")).render(_(n.text))[0].outerHTML};d=f.map(function(e){return e.blockerTree=g.blockers.length,g.blockers.push(e),e.blockerTree});b+='<tw-expression type="'+n.type+'" name="'+_(n.name||n.text)+'"'+(O.debug?' title="'+_(n.text)+'"':"")+(d.length?' blockers="'+d+'"':"")+' code="'+g.code.length+'"></tw-expression>',g.code.push(n);break;default:b+=n.children&&n.children.length?E(n.children,g):n.text}k=e}(k);if("object"===_typeof(e))return e.v}return b}return Object.freeze({exec:function(e){var r={code:[],blockers:[],source:[]},e=E(e="string"==typeof e?S.lex(e).children:e,r),e=a(a.parseHTML(e,document,!0));return e.findAndFilter("script:not([src])").each(function(e,t){var n=t.getAttribute("type");n&&"text/javascript"!==n.toLowerCase()||t.setAttribute("type","application/x-harlowe")}),r.blockers=r.blockers.map(function(e){e.blockedValue=!0;e=Object.create(e);return e.blockedValue=!1,e}),e.findAndFilter("tw-expression[code]:not([data-raw]), tw-expression[blockers]:not([data-raw]), tw-hook[source]:not([data-raw])").each(function(e,t){var n;(t=a(t)).attr("blockers")&&(n=t.popAttr("blockers").split(",").map(function(e){return r.blockers[e]}),t.data("blockers",n)),t.attr("source")&&t.data("source",r.source[t.popAttr("source")]),t.attr("code")&&t.data("code",r.code[t.popAttr("code")])}),e}})}),define("repl",["utils","markup","section"],function(e,t,n){e.onStartup(function(){return setTimeout(function(){e.options.debug&&(window.REPL=function(e){e=n.create().eval(t.lex("(print:"+e+")"));return e.TwineScript_Run?e.TwineScript_Run().source:e},window.LEX=function(e){e=t.lex(e);return 1===e.length?e[0]:e})})})}),define("section",["jquery","utils","twinescript/runner","twinescript/operations","state","utils/operationutils","utils/renderutils","utils/scripttag","datatypes/changercommand","datatypes/colour","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(p,f,a,u,r,e,t,i,d,h,o,m,g,y,b,v){var w=e.printBuiltinValue,k=e.objectName,S=e.typeID,T=e.isObject,s=t.collapse,_=Object.assign,x=Object.create,O=Object.keys;function A(e,t,n){if(t&&"object"===_typeof(t)&&d.isPrototypeOf(t)){var r=n.popData("source")||(null==(r=n[0].cachedData)?void 0:r.source),a=(null!=(a=n[0])&&a.cachedData&&(n[0].cachedData.source=void 0),n.data("originalSource",r),g.create({target:n,source:r,section:this,append:"append"})),o=t.run(a);if(b.containsError(o)&&e.replaceWith(o.render(e.attr("title"))),!this.renderInto(r,null,a))return o=f.insensitiveName(e.attr("name")),["if","elseif","unless","else","testfalse"].includes(o)&&(e.addClass("false"),"elseif"!==o)&&(this.stackTop.lastHookShown=!1),n.data("live")&&function(t,n,r){function a(e){p&&(d-=(e-p)*(f.options.debug&&void 0!==f.options.speedMultiplier?f.options.speedMultiplier:1)),p=e,0<d?requestAnimationFrame(a):(d=s,o())}var o,i=this,e=r.data("live"),s=e.delay,c=e.event,l=((n=_objectSpread(_objectSpread({},n),{},{append:"replace",transitionDeferred:!1,enabled:!0})).data=_objectSpread(_objectSpread({},n.data),{},{live:void 0}),r.data("originalSource")||""),u=this.stackTop.tempVariables,p=null,d=s;o=this.whenUnblocked.bind(this,function(){var e;i.inDOM()&&(e=null==c?void 0:c.filter(i,[!0],u),b.containsError(e)?e.render(i,t.attr("title")).replaceAll(t):c&&!e[0]?requestAnimationFrame(a):(i.renderInto(l,r,n,u),e||r.find("tw-expression[name='stop']").length||i.inDOM()&&requestAnimationFrame(a)))}),requestAnimationFrame(a)}.call(this,e,a,n),!0}else{if(!1===t)return o=n.popData("source")||(null==(r=n[0].cachedData)?void 0:r.source),null!=(a=n[0])&&a.cachedData&&(n[0].cachedData.source=void 0),o&&(n.cachedData&&(n.cachedData.source=void 0),n.data("originalSource",o),n.data("hidden",!0)),e.addClass("false"),!(this.stackTop.lastHookShown=!1);if(!0!==t)return!1}return this.stackTop.lastHookShown=!0}function C(e){var t,n,e=(e instanceof p?e[0]:e).nextSibling;return e&&(e instanceof Text&&!e.textContent.trim()||["br","tw-consecutive-br"].includes((e.tagName||"").toLowerCase()))?(t=(n=C(e)).whitespace,n=n.nextElem,{whitespace:p(e).add(t),nextElem:n}):{whitespace:p(),nextElem:p(e)}}function E(e){if(null!=e&&e.length)return p("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",e)}function c(e,t){var n=this.eval(t);e.append(E(this.evalReplay)),e.append(function(e,t){if(/a \((go-to|undo|redirect|restart):\) command/.exec(null==t?void 0:t.TwineScript_TypeName))return p("<tw-open-button goto label='GO'>").data("goto",{section:e,command:t})}(this,n)),this.stackTop.evaluateOnly&&n&&(d.isPrototypeOf(n)||"function"==typeof n.TwineScript_Run)&&(n=b.create("syntax","I can't work out what ".concat(this.stackTop.evaluateOnly," should evaluate to, because it contains a ").concat(d.isPrototypeOf(n)?"changer.":"command."),"Please rewrite this without putting changers or commands here."));var r=p();for(i=e;d.isPrototypeOf(n);){var a=C(i),o=a.whitespace;if((i=a.nextElem)[0]&&i[0].nodeType===Node.TEXT_NODE&&"+"===i[0].textContent.trim()){var i,a=i,s=C(a),c=s.whitespace;if((i=s.nextElem).is("tw-expression")){var s=i.popData("code")||(null==(s=i[0])||null==(s=s.cachedData)?void 0:s.code),l=(null!=(l=i[0])&&l.cachedData&&(i[0].cachedData.code=void 0),this.eval(s));if(b.containsError(l)){n=l;break}s=u["+"](n,l);p(o).add(a).add(c).remove(),n=b.containsError(s)?b.create("operation","I can't combine "+k(n)+" with "+k(l)+".","function"==typeof l.TwineScript_Run?"If you want to attach this changer to ".concat(k(l),", remove the + between them."):"Changers can only be added to other changers."):s;continue}}if(i.is("tw-expression")){l=i.popData("code")||(null==(a=i[0])||null==(c=a.cachedData)?void 0:c.code),a=(null!=(s=i[0])&&s.cachedData&&(i[0].cachedData.code=void 0),this.eval(l));if(i.append(E(this.evalReplay)),b.containsError(a)){n=a;break}if(a&&"object"===_typeof(a)&&"function"==typeof a.TwineScript_Attach){n=a.TwineScript_Attach(this,n);break}return d.isPrototypeOf(a)?void e.replaceWith(b.create("operation","Changers like (".concat(n.macroName,":) need to be combined using + between them."),"Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.").render(e.attr("title"))):void e.replaceWith(b.create("operation","".concat(k(a)," can't have changers like (").concat(n.macroName,":) attached."),"Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.").render(e.attr("title")))}if(i.is("tw-hook")){o.remove(),r=i;break}n.macroName||f.impossible("Section.runExpression","changer has no macroName");a=e.attr("title")||"("+n.macroName+": ...)";return void e.replaceWith(b.create("syntax","The (".concat(n.macroName,":) changer should be stored in a variable or attached to a hook."),"Macros like this should appear before a hook: ".concat(a,"[Some text]")).render(e.attr("title")))}e.attr("return",S(n)),r=r.length?r:C(e).nextElem.filter("tw-hook"),(t=b.containsError(n))?e.replaceWith(t.render(e.attr("title")).append(E(this.evalReplay))):v.isPrototypeOf(n)?e.append(n.render()):n&&"function"==typeof n.TwineScript_Run?(n=n.TwineScript_Run(this),b.containsError(n)?e.replaceWith(n.render(e.attr("title"))):g.isPrototypeOf(n)?null!=(t=n.data)&&t.live?e.replaceWith(b.create("unimplemented","I currently can't attach (live:) or (event:) macros to commands - only hooks.").render(e.attr("title"))):(n.section=this,n.target=i,this.renderInto("",i,n)):T(n)&&n.blocked?(this.stackTop.blocked=n.blocked,e.data("code",{type:"macro",blockedValue:!0,text:e.attr("title")||"",start:0,end:(e.attr("title")||"").length})):n&&f.impossible("Section.runExpression","TwineScript_Run() returned a non-ChangeDescriptor ".concat(_typeof(n),': "').concat(n,'"'))):r.length&&A.call(this,e,n,r)||("string"==typeof n||"number"==typeof n||n instanceof Map||n instanceof Set||Array.isArray(n)||h.isPrototypeOf(n)||m.isPrototypeOf(n)||n&&"function"==typeof n.TwineScript_Print&&!d.isPrototypeOf(n)?(n=w(n),b.containsError(n)?e.replaceWith(n.render(e.attr("title"))):"string"==typeof n||Array.isArray(n)?this.renderInto(n,e):f.impossible("printBuiltinValue() produced a non-string non-array ".concat(_typeof(n)))):d.isPrototypeOf(n)||"boolean"==typeof n||f.impossible("Section.runExpression","The expression evaluated to an unknown value: ".concat(n)))}var l={add:[],remove:[]};return Object.preventExtensions({create:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f.storyElement,n=_(x(this),{timestamp:Date.now(),dom:e,stack:[],enchantments:[],unblockCallbacks:[],freeVariables:null,evalReplay:null,loadedGame:!1,Identifiers:{TwineScript_Identifiers:!0,it:0,get time(){var e;return null!=(e=n.stackTop)&&e.evaluateOnly?b.create("operation","'time' can't be used in ".concat(n.stackTop.evaluateOnly,".")):(Date.now()-n.timestamp)*(f.options.debug&&void 0!==f.options.speedMultiplier?f.options.speedMultiplier:1)},get turns(){return r.turns},get turn(){return r.turns},get visits(){var t=n.stackTop.speculativePassage;return r.history().filter(function(e){return e===(t||r.passage)}).length+(!t||t===r.passage)},get visit(){return n.Identifiers.visits},get exits(){var e;return null!=(e=n.stackTop)&&e.evaluateOnly?b.create("operation","'exit' and 'exits' can't be used in ".concat(n.stackTop.evaluateOnly,".")):n.dom.find("tw-enchantment, tw-link").filter(function(e,t){return(t=p(t)).data("enchantmentEvent")||t.parent().data("linkPassageName")||t.parent().data("clickEvent")}).length},get exit(){return n.Identifiers.exits},get pos(){return n.stackTop&&!n.stackTop.evaluateOnly&&n.stackTop.lambdaPos?+n.stackTop.lambdaPos||1:b.create("operation","'pos' can only be used in lambdas that aren't 'when' lambdas.")}}});return n},eval:function(t){var e,n;f.options.debug&&f.options.evalReplay&&(n=Array.isArray(t)?t.reduce(function(e,t){return e+t.text},""):t.text||"",this.evalReplay=[{code:n,fromCode:n,basis:(Array.isArray(t)?t[0]:t).start,start:0,end:n.length,diff:0}]);try{e=a(this,t)}catch(e){return null!=(n=window.console)&&n.error(e),this.evalReplay=null,b.create("","An internal error occurred while trying to run ".concat([].concat(t).map(function(e){return e.text}).join(""),"."),'The error was "'.concat(e.message,'".\nIf this is the latest version of Harlowe, please consider reporting a bug (see the documentation).'))}return this.evalReplay&&2===this.evalReplay.length&&this.evalReplay.shift(),e},get stackTop(){return this.stack[0]},inDOM:function(){return 0<f.storyElement.find(this.dom).length},evaluateTwineMarkup:function(e,t){var n=p("<p>");return this.stack.unshift({desc:g.create({target:n,source:e,section:this,append:"append"}),tempVariables:this.stackTop.tempVariables,evaluateOnly:t,finalIter:!0}),this.execute(),0<(e=n.find("tw-error")).length?e:n},speculate:function(e,t,n){this.stack.unshift({evaluateOnly:n,finalIter:!0,tempVariables:_(x(y),{TwineScript_VariableStore:{type:"temp",name:n}}),speculativePassage:t});var r,n=this.evalReplay;return this.evalReplay=null,o.isPrototypeOf(e)?r=e.apply(this,{fail:!1,pass:!0}):e&&(r=a(this,e)),this.stack.shift(),this.evalReplay=n,r},renderInto:function(e,a,t){var o=this,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=g.create({target:a,source:e,section:this,append:"append"});if(t)if(d.isPrototypeOf(t)){var e=t.run(i);if(b.containsError(e))return e.render(a.attr("title")).replaceAll(a),!1}else _(i,t);if((a=i.target,50<=this.stack.length)&&50<=this.stack.reduce(function(e,t){return e+!!t.finalIter},0))return b.create("infinite","Printing this expression may have trapped me in an infinite loop.").render(a.attr("title")).replaceAll(a),!1;var s=function(e,t,n){var r=a instanceof p&&a.is("tw-hook")&&0<a.parents("tw-collapsed,[collapsing=true]").length;o.stack.unshift({desc:e,finalIter:n,tempVariables:t,collapses:r,evaluateOnly:o.stackTop&&o.stackTop.evaluateOnly})},r=r||x(this.stack.length?this.stackTop.tempVariables:y),t=(hasOwnProperty.call(r,"TwineScript_VariableStore")||(t=null==(e=a)?void 0:e.tag(),r.TwineScript_VariableStore={type:"temp",name:"tw-hook"===t?a.attr("name")?"?"+a.attr("name"):"an unnamed hook":"tw-expression"===t?"a "+a.attr("type")+" expression":"tw-passage"===t?"this passage":"an unknown scope"}),null==(e=this.stackTop)?void 0:e.blocked);if(O(i.loopVars).length){var c=_objectSpread({},i.loopVars),l=Math.min.apply(Math,_toConsumableArray(O(c).map(function(e){return c[e].length})));if(v.create(l+" loop"+(1!==l?"s":"")).render().prependTo(a),l){for(var n=l-1;0<=n;--n)!function(n){s(i,O(c).reduce(function(e,t){return e[t]=c[t][n],e},x(r),n===l-1))}(n);for(var u=l-1;0<=u&&!this.stackTop.blocked;--u)this.execute()}}else s(i,r,!0),this.execute();return(0===this.stack.length||!t&&null!=(e=this.stackTop)&&e.blocked)&&this.updateEnchantments(),i.enabled},execute:function(){var a=this,e=this.stackTop,t=e.desc,n=e.dom,r=e.collapses,o=e.evaluateOnly;t&&!n&&(n=t.render(),this.stackTop.dom=n,this.stackTop.desc=void 0),n.findAndFilter('tw-hook,tw-expression,script[type="application/x-harlowe"]').each(function(e,t){var n=p(t).data();t.cachedData={blockers:n.blockers,code:n.code,source:n.source}}).each(function(e,t){if(a.stackTop.blocked)return!1;var n=t.cachedData;switch(n&&(t.cachedData=void 0),(t=p(t)).tag()){case"tw-hook":var r=t.popData("source")||(null==n?void 0:n.source);(r&&t.data("originalSource",r),t.data("tempVariables",a.stackTop.tempVariables),t.popAttr("hidden"))?t.data("hidden",!0):r&&a.renderInto(r,t);break;case"tw-expression":var r=t.data("blockers")||(null==n?void 0:n.blockers);if(r){if(o)return void t.removeData("blockers").removeData("code").replaceWith(b.create("syntax","I can't use a macro like (prompt:) or (confirm:) in ".concat(o,"."),"Please rewrite this without putting such macros here.").render(t.attr("title"),t));if(r.length)return a.stackTop.blocked=!0,r=a.eval(r.shift()),b.containsError(r)&&(a.stackTop.blocked=!1,t.removeData("blockers").replaceWith(r.render(t.attr("title"),t))),!1;t.removeData("blockers")}r=t.popData("code")||(null==n?void 0:n.code);r&&c.call(a,t,r);break;case"script":if(f.reattachStoryElement(),t.text())try{i(t.text(),a.stackTop.tempVariables)}catch(e){b.isPrototypeOf(e)?t.replaceWith(e.render(t.text(),t)):(null!=(r=window.console)&&r.error(e),t.replaceWith(b.create("","A Javascript error occurred while running this <script> element.",'The error was "'.concat(e,'". Check the browser console for more details.')).render(t.text(),t)))}}}),this.stackTop.blocked||(n.length&&r&&s(n),n.findAndFilter("tw-collapsed,[collapsing=true]").each(function(){s(p(this))}),setTimeout(function(){return n.find("input, textarea").first().focus()},100),this.stack.shift())},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})},on:function(e,t){return l[e].push(t),this},addEnchantment:function(t){var n=this;this.enchantments.push(t),l.add.forEach(function(e){return e(n,t)})},removeEnchantment:function(t){var n=this,e=this.enchantments.indexOf(t);this.enchantments.splice(e,1),t.disenchant(),l.remove.forEach(function(e){return e(n,t)})},unblock:function(e){for(this.stack.length||f.impossible("Section.unblock","stack is empty"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;0<this.unblockCallbacks.length;){var t;if(this.unblockCallbacks.shift()(),null!=(t=this.stackTop)&&t.blocked)return}},whenUnblocked:function(e,t){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):(t||e)()},blockedValue:function(){var e=this.stackTop;return e?e.blockedValues&&e.blockedValues.length?e.blockedValues.shift():(f.impossible("Section.blockedValue","blockedValues is missing or empty"),0):(f.impossible("Section.blockedValue","stack is empty"),0)}})}),define("state",["jquery","utils","passages","datatypes/customcommand","utils/operationutils","markup"],function(n,y,b,v,e,t){var i,w,C=e.toSource,E=e.is,k=t.lex,o=Object.assign,h=Object.create,e=Object.defineProperty,N=Array.isArray,s=Math.imul,t=(e(Map.prototype,"toJSON",{value:void 0}),e(Set.prototype,"toJSON",{value:void 0}),["localStorage","sessionStorage"].map(function(e){try{return!!window[e]&&(window[e].setItem("test","1"),window[e].removeItem("test"),!0)}catch(e){return!1}}));function S(e,t){var n=0<arguments.length&&void 0!==e?e:String.fromCodePoint(Date.now()%1114112),e=1<arguments.length&&void 0!==t?t:0;i.seedIter=e,i.seed=n;for(var r,a=0,o=2166136261;a<n.length;a+=1)r=s(n.charCodeAt(a),3432918353),o^=s(r<<15|r>>>17,461845907),o=s(o=o<<13|o>>>19,5)+3864292196|0;return o^=n.length,o=s(o^=o>>>16,2246822507),o=s(o^=o>>>13,3266489909),o=((o^=o>>>16)>>>0)+1831565813*e,function(){i.seedIter+=1;var e=o+=1831565813,e=s(e^e>>>15,1|e);return(((e^=e+s(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}function r(e,t){for(var n,r=t.variables,a=h(null),o=e.length-1;0<=o;--o){for(var i,s,c=e[o],l=0,u=["mockVisits","mockTurns","seed","seedIter"];l<u.length;l++){var p=u[l];hasOwnProperty.call(c,p)&&!hasOwnProperty.call(t,p)&&(t[p]=c[p])}for(i in c.forgetVisits&&(t.forgetVisits=Math.max(t.forgetVisits||0,c.forgetVisits)),void 0!==c.turns&&(t.turns=(t.turns||0)+c.turns),t.pastVisits||(t.pastVisits=[]),o!==e.length-1&&(void 0!==e[o+1].visits&&Array.isArray(t.pastVisits[0])?t.pastVisits[0]:t.pastVisits).unshift(c.passage),void 0!==c.pastVisits&&t.pastVisits.unshift(c.pastVisits),void 0!==c.visits&&t.pastVisits.unshift(c.visits),c.variables)if("TwineScript_TypeDefs"===i)for(var d in r[i]||(r[i]=h(null)),c.variables[i])r[i][d]||(r[i][d]=c.variables[i][d]);else i.startsWith("TwineScript_")||i in r||(null===c.variables[i]&&(a[i]=!0),a[i])||(r[i]=c.variables[i],!(s=c.valueRefs[i]))||"via"in s||t.valueRefs[i]||(t.valueRefs[i]=s)}for(n in t.valueRefs){var f=t.valueRefs[n];f&&"via"in f&&delete t.valueRefs[n]}}var a,c={passage:"",variables:h(null),visits:void 0,turns:void 0,seed:void 0,seedIter:void 0,mockVisits:void 0,mockTurns:void 0,forgetVisits:void 0,create:function(e){var t=h(c);return t.passage=e||"",t.variables=h(null),t.valueRefs=h(null),t}},l={forward:[],back:[],load:[],beforeForward:[],beforeBack:[],beforeLoad:[],forgetUndos:[]},u=[],p=-1,d=c.create(),f="";function m(){i.history=i.pastVisits.slice(i.forgetVisits).reduce(function(e,t){return e.concat(t)},[]),i.mockVisits&&(i.history=i.mockVisits.concat(i.history))}function g(){var e=c.create();e.pastVisits=[],o(e.variables,{TwineScript_ObjectName:"this story's variables",TwineScript_TypeDefs:h(null),TwineScript_VariableStore:{type:"global",name:"this story's variables"},TwineScript_Delete:function(e){delete this[e],d.variables[e]=null,delete d.valueRefs[e]},TwineScript_Set:function(e,t,n){if(this[e]=t,d.variables[e]=t,n)d.valueRefs[e]=n;else if((N(t)||t instanceof Map||t instanceof Set||"string"==typeof t)&&!y.options.uncompressedStructures)for(var r=p;0<=r;--r){var a=u[r].variables[e];if(void 0!==a){a=function e(t,n,r){var a="it"===r?"its":r+"'s",o="";if(N(n)&&N(t)&&n.length){for(var i=n.length===t.length,o="(a:",s=0;s<n.length;s+=1){var c,l,u,p=n[s];E(p,t[s])?(c=C(p),l="".concat(a," ").concat(s+1,"th"),o+=(c.length<l.length?c:l)+","):(i=!1,-1<(c=t.indexOf(p))?(l=C(p),u="".concat(a," ").concat(c+1,"th"),o+=(l.length<u.length?l:u)+","):o+=e(t[s],p,"".concat(a," ").concat(s+1,"th"))+",")}o=i?r:o.slice(0,-1)+")"}else if(n instanceof Map&&t instanceof Map&&n.size){var d,f=n.size===t.size,h=(o="(dm:",_createForOfIteratorHelper(n.entries()));try{for(h.s();!(d=h.n()).done;){var m,g,y=_slicedToArray(d.value,2),b=y[0],v=y[1];o+="".concat(C(b),","),E(v,t.get(b))?(m=C(v),g="".concat(a," (").concat(C(b),")"),o+=(m.length<g.length?m:g)+","):(f=!1,o+=e(t.get(b),v,"".concat(a," (").concat(C(b),")"))+",")}}catch(e){h.e(e)}finally{h.f()}o=f?r:o.slice(0,-1)+")"}else if(n instanceof Set&&t instanceof Set&&n.size){var w,k=new Set,S=new Set,T=_createForOfIteratorHelper(t);try{for(T.s();!(w=T.n()).done;){var _=w.value;n.has(_)||k.add(_)}}catch(e){T.e(e)}finally{T.f()}var x,O=_createForOfIteratorHelper(n);try{for(O.s();!(x=O.n()).done;){var A=x.value;t.has(A)||S.add(A)}}catch(e){O.e(e)}finally{O.f()}k.size||S.size||(o=r),o=k.size+S.size>n.size?C(n):r+(S.size?"+"+C(S):"")+(k.size?"-"+C(k):"")}else"string"==typeof n&&"string"==typeof t&&n&&(n.startsWith(t)?o=r+"+"+C(n.slice(t.length)):n.endsWith(t)&&(o=C(n.slice(0,n.length-t.length))+"+"+r));return o?"it"===r?{via:o}:o:"it"===r?void 0:C(n)}(a,t,"it");a&&("it"===a.via?delete d.variables[e]:d.valueRefs[e]=a);break}}},TwineScript_GetProperty:function(e){return this[e]},TwineScript_DefineType:function(e,t){this.TwineScript_TypeDefs[e]=t,hasOwnProperty.call(d.variables,"TwineScript_TypeDefs")||(d.variables.TwineScript_TypeDefs=h(null)),d.variables.TwineScript_TypeDefs[e]=t}}),r(u.slice(0,p+1),e),i=e,m(),w=S(e.seed,e.seedIter)}function T(e){d=c.create(e);e=a.serialise(!0),f=e.past,e=e.pastAndPresent;if(a.hasSessionStorage&&"string"==typeof e)try{sessionStorage.setItem("Saved Session",e)}catch(e){}}function _(e,t,n,r){for(var a in r)if(hasOwnProperty.call(r,a)&&!a.startsWith("TwineScript_"))if("object"===_typeof(r[a]))if(hasOwnProperty.call(r[a],"at")){n.valueRefs[a]=r[a];var o=r[a],i=o.at,s=o.from,c=o.to,l=o.hash,u=o.seed,p=o.seedIter,o=o.blockedValues;if(!b.has(i))throw Error('The data refers to a passage named `"'.concat(n.passage,"\"`, but it isn't in this story."));var d=b.get(i).get("source"),f=d.slice(s,c);if(void 0!==l)for(var h=0,m=c-s;y.hash(f).toString(16)!==l;){if(h+m>=d.length)throw Error("The value (or type) of the variable `$".concat(a,"` couldn't be found in the passage `\"").concat(i,'"`.'));(h+=1)===s&&(h+=1),f=d.slice(h,h+m)}c=k(f,"","macro");void 0!==u&&void 0!==p&&(w=S(u,p)),void 0!==o&&(e.stackTop.blockedValues=o,c.forEach(function e(t){var n;"string"!==t.type&&"hook"!==t.type&&t.children.every(e),"macro"!==t.type||"prompt"!==(n=y.insensitiveName(t.name))&&"confirm"!==n||(t.blockedValue=!0)})),r[a]=e.eval(c)}else if(hasOwnProperty.call(r[a],"via")){for(var g=t.length-1;0<=g;--g)if(hasOwnProperty.call(t[g].variables,a)){e.Identifiers.it=t[g].variables[a];break}r[a]=e.eval(k(r[a].via,"","macro")),e.Identifiers.it=0}else hasOwnProperty.call(r[a],"changer")&&(r[a].changer=e.eval(k(r[a].changer,"","macro")),r[a].hook=e.eval(k(r[a].hook,"","macro")),_(e,t,n,r[a].variables),r[a]=v.create(r[a]));else r[a]=e.eval(k(r[a],"","macro"));else"TwineScript_MockVisits"===a&&(n.mockVisits=r[a])}return g(),d.seed=i.seed,d.seedIter=0,(a={get passage(){return d.passage},get variables(){return i.variables},get pastLength(){return p},get turns(){return p+1+(i.turns||0)+(i.mockTurns||0)},get futureLength(){return u.length-1-p},get mockVisits(){return i.mockVisits||[]},set mockVisits(e){i.mockVisits=e,d.mockVisits=e,m()},get mockTurns(){return i.mockTurns||0},set mockTurns(e){i.mockTurns=e,d.mockTurns=e},history:function(){return i.history},forgetUndos:function(e){e<0&&(e=u.length+e);var t,e=u.splice(0,Math.min(u.length-1,e));e.length&&(p=u.length-1,t=u[0],r(e,t),t.pastVisits.push(e[e.length-1].passage),t.turns=(t.turns||0)+e.length,i.turns=(i.turns||0)+e.length,t.forgetVisits&&(t.pastVisits=t.pastVisits.slice(t.forgetVisits-t.turns),t.forgetVisits-=t.turns),f="",0===p&&n("tw-link[undo], tw-icon[alt='Undo']",y.storyElement).each(function(e,t){(n(t).closest("tw-expression, tw-hook").data("forgetUndosEvent")||Object)(t)}),l.forgetUndos.forEach(function(e){return e()}))},forgetVisits:function(e){(e=e<0?u.length+e:e)>p+i.turns&&(e=p+i.turns),d.forgetVisits=i.forgetVisits=Math.max(i.forgetVisits||0,e),m()},passageNameVisited:function(e){var t=0;if(!b.get(e))return 0;for(var n=0;n<i.history.length;n++)t+=+(e===i.history[n]);return t},get timeline(){return u},play:function(t){var e;d||y.impossible("State.play","present is undefined!"),l.beforeForward.forEach(function(e){return e()}),d.passage&&((null!=(e=d.visits)&&e.length&&Array.isArray(i.pastVisits[i.pastVisits.length-1])?i.pastVisits[i.pastVisits.length-1]:i.pastVisits).push(d.passage),i.history.push(d.passage)),d.passage=t,u=u.slice(0,p+1).concat(d),p+=1,T(t),l.forward.forEach(function(e){return e(t)})},redirect:function(e){var t;d||y.impossible("State.redirect","present is undefined!"),d.passage&&(null!=(t=d.visits)&&t.length&&Array.isArray(i.pastVisits[i.pastVisits.length-1])?i.pastVisits[i.pastVisits.length-1].push(d.passage):i.pastVisits.push([d.passage]),i.history.push(d.passage)),d.visits=(d.visits||[]).concat(e),d.passage=e},rewind:function(e){for(var t=void 0!==e?e:1,n=!1;0<t&&0<p;t--)n=!0,--p;return n&&(l.beforeBack.forEach(function(e){return e()}),f="",T(u[p].passage),g(),l.back.forEach(function(e){return e()})),n},fastForward:function(e){var t=1,n=!1;for("number"==typeof e&&(t=e);0<t&&0<u.length;t--)n=!0,p+=1;return n&&(l.beforeForward.forEach(function(e){return e()}),T(u[p].passage),g(),l.forward.forEach(function(e){return e(u[p].passage,"fastForward")})),n},on:function(e,t){if(e in l)return"function"!=typeof t||l[e].includes(t)||l[e].push(t),a;y.impossible("State.on","invalid event name")},reset:function(){l.beforeLoad.forEach(function(e){return e()}),u=[],p=-1,g(),(d=c.create()).seed=i.seed,d.seedIter=0,f="",w=S(),l.load.forEach(function(e){return e(u)})},hasStorage:t[0],hasSessionStorage:t[1],setSeed:function(e){w=S(e),d.seed=i.seed,d.seedIter=0},get seed(){return i.seed},get seedIter(){return i.seedIter},random:function(){var e=w();return d.seedIter=i.seedIter,e},shuffled:function(){for(var a=this,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce(function(e,t,n){var r=a.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e},[]);return d.seedIter=i.seedIter,r}}).serialise=function(e){function o(e,t){if("TwineScript_TypeDefs"===t){var n,r={};for(n in e[t])r[n]=C(e[t][n]);return r}var a;return null===e[t]?null:e[t]&&hasOwnProperty.call(e[t],"TwineScript_CustomCommand")?(a=e[t].TwineScript_CustomCommand(),{changer:C(a.changer),toSource:a.toSource,hook:C(a.hook),variables:Object.keys(a.variables).reduce(function(e,t){return e[t]=o(a.variables,t),e},{})}):C(e[t])}function t(e,t){if(c.isPrototypeOf(t)&&void 0===t.visits&&void 0===t.turns&&void 0===t.mockVisits&&void 0===t.forgetVisits&&void 0===t.pastVisits&&void 0===t.mockTurns&&void 0===t.seed&&void 0===t.seedIter&&Object.keys(t.variables).every(function(e){return e.startsWith("TwineScript_")}))return t.passage;if(!c.isPrototypeOf(this)||"valueRefs"!==e){if(c.isPrototypeOf(this)&&"variables"===e){var n,r={};for(n in this.variables)this.valueRefs[n]?r[n]=this.valueRefs[n]:r[n]=o(this.variables,n);return r}return t}}var e=u.slice(f?e?p-1:p:0,p+1),n=e.slice(0,-1),r=f;try{return{past:r=n.length?(r?r.slice(0,-1)+",":"[")+JSON.stringify(n,t).slice(1):r,pastAndPresent:r.slice(0,-1)+(r?",":"[")+JSON.stringify(e.slice(-1),t).slice(1)}}catch(e){return{past:!1,pastAndPresent:!1}}},a.deserialise=function(e,t){var n;try{n=JSON.parse(t)}catch(e){return Error("The save data is unintelligible.")}if(!N(n))return Error("The save data isn't a sequence of past turns.");for(var r=0;r<n.length;r+=1){var a=n[r];if("string"==typeof a)a={passage:a,variables:{}};else if("object"!==_typeof(a)||!hasOwnProperty.call(a,"variables")){n.splice(r--,1);continue}if(a.valueRefs=h(null),a.variables=o(h(null),a.variables),!b.hasValid(a.passage))return Error('The data refers to a passage named `"'.concat(a.passage,"\"`, but it isn't in this story."));if(hasOwnProperty.call(a.variables,"TwineScript_TypeDefs"))try{_(e,n.slice(0,r),a,a.variables.TwineScript_TypeDefs)}catch(e){return Error("The variable types on turn ".concat(r+1," couldn't be reconstructed.").concat(e.message?" (".concat(e.message,")"):""))}try{_(e,n.slice(0,r),a,a.variables)}catch(e){return Error("The variables on turn ".concat(r+1," couldn't be reconstructed.").concat(e.message?" (".concat(e.message,")"):""))}n[r]=o(h(c),a)}return p=(u=n).length-1,l.load.forEach(function(e){return e(u)}),f="",g(),T(u[p].passage),!0},Object.seal(c),Object.freeze(a)}),define("utils",["jquery","markup","utils/polyfills"],function(d){var r=String.fromCharCode,n="audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter".split(","),a="a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon".split(","),f=["audio"],e=_slicedToArray([function(e){return r(e)!==r(e).toLowerCase()},function(e){return r(e)!==r(e).toUpperCase()},function(e){return r(e).toLowerCase()!==r(e).toUpperCase()}].map(function(e){return"["+Array.from(Array(57343)).map(function(e,t){return t}).filter(e).map(function(e,t,n){return e===n[t-1]+1&&e===n[t+1]-1?"-":r(e)}).join("").replace(/-+/g,"-")+"]"}),3),t=e[0],o=e[1],e=e[2];function s(e){return"instant"===e?0:800}var i,c,l=[],u={},p=0,h={},m=0,g={};function y(n,r,e,a,o){var i=null,s=0,c=r+e;function l(e){var t;1&n[0].compareDocumentPosition(document)&&(c=0),i&&(c-=t=e-i),i=e,0<a&&0<p+m&&n.data("expediteAnim")(a),c<=r&&(s+=t||0,"paused"===n.css("animation-play-state"))&&n.css({visibility:"","animation-play-state":"running"}),c<=0?(n.removeData("expediteAnim"),o()):requestAnimationFrame(l)}n.data("expediteAnim",function(e){var t;c-=e=void 0===e?s:e,"running"===n.css("animation-play-state")&&n.css("animation-delay",(("ms"===(t=(t=n.css("animation-delay")).toLowerCase()).slice(-2)?+t.slice(0,-2)||0:"s"===t.slice(-1)&&1e3*+t.slice(0,-1)||0)||0)-e+"ms")}),c?requestAnimationFrame(l):l()}d(document.documentElement).on("keydown keyup mousedown mouseup",function(e){var t=e.key,n=e.button,e=e.type.includes("down"),r=t?u:h,n=t&&v.insensitiveName(t)||n;r[n]&&!e?t?p=Math.max(p-1,0):m=Math.max(m-1,0):!r[n]&&e&&(t?p+=1:m+=1),r[n]=e}).on("mousemove",function(e){var t=e.pageX,e=e.pageY;g.x=t,g.y=e});var b=/-|_/g,v={hash:function(e){for(var t=9,n=e.length;0<n;)--n,t=Math.imul(t^e.charCodeAt(n),Math.pow(9,9));return(t^t>>>9)>>>0},permutations:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r,a,o=t.length,i=[[].concat(t)],s=Array(o).fill(0),c=1;c<o;)s[c]<c?(r=c%2&&s[c],a=t[c],t[c]=t[r],t[r]=a,++s[c],c=1,i.push([].concat(t))):(s[c]=0,++c);return i},nth:function(e){var t=+e+"";return e+("1"!==t[t.length-1]||1!==t.length&&"1"===t[t.length-2]?"2"!==t[t.length-1]||1!==t.length&&"1"===t[t.length-2]?"3"!==t[t.length-1]||1!==t.length&&"1"===t[t.length-2]?"th":"rd":"nd":"st")},plural:function(e,t,n){return e+" "+(1!==Math.abs(e)?n||t+"s":t)},andList:function(e){return e.length<=1?e[0]:e.slice(0,-1).join(", ")+" and "+e[e.length-1]},realWhitespace:"[ \\n\\r\\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]",anyRealLetter:"[\\dA-Za-z\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",anyUppercase:t,anyLowercase:o,anyCasedLetter:e,anyNewline:"(?:\\n|\\r|\\r\\n)",unescape:function(e){return e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":String.fromCharCode(160),"&zwnj;":String.fromCharCode(8204)}[e]})},escape:function(e){return e.replace(/[&><"']/g,function(e){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"}[e]})},insensitiveName:function(e){return(e+"").toLowerCase().replace(b,"")},allKeysDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return u[e]})},someKeysDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function(e){return u[e]})},buttonsDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return h[e]})},anyInputDown:function(){return 0<p+m},mouseCoords:g,parentColours:function(e){for(var t,n={colour:null,backgroundColour:null},r=/^\w+a\(.+?,\s*0\s*\)$|^transparent$/;e.length&&e[0]!==document;e=e.parent())if(n.backgroundColour||(t=e.css("background-color")).match(r)||(n.backgroundColour=t),n.colour||(t=e.css("color")).match(r)||(n.colour=t),n.colour&&n.backgroundColour)return n;return{colour:"#fff",backgroundColour:"#000"}},childrenProbablyInline:function(e){var t=[];return[].every.call(e.findAndFilter("*"),function(e){if(!(e.hidden||/none|inline/.test(e.style.display)||/display: (none|inline)/.test(e.getAttribute("style")))){if(n.includes(e.tagName.toLowerCase())||/display: (?!none|inline|inherit|unset)/.test(e.getAttribute("style")))return!1;a.includes(e.tagName.toLowerCase())||t.push(e)}return!0})&&t.every(function(e){return/inline|none/.test(window.getComputedStyle(e).display)})},transitionOut:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,i=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==e.length&&(n=n||s(t),!(1<e.length)&&v.childrenProbablyInline(e)&&["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(e.tag())||(e=e.wrapAll("<tw-transition-container>").parent()),i&&e.css("transform-origin",i),e.attr("data-t8n",t).addClass("transition-out").css({"animation-duration":"".concat(n,"ms"),"animation-delay":"".concat(-o,"ms"),"animation-play-state":"paused"}),requestAnimationFrame(function(){v.childrenProbablyInline(e)?e.css("display","inline"):e.parent().is("tw-backdrop,tw-story")||e[0].setAttribute("style",e[0].getAttribute("style")+"display:block !important;width:100%")}),y(e,n,r-o,a,function(){e.remove()}))},transitionIn:function(u,e,t){var p,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==u.length&&(t=t||s(e),(p=1<u.length||!v.childrenProbablyInline(u)||!["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(u.tag()))&&(u=u.wrapAll("<tw-transition-container>").parent()),o&&u.css("transform-origin",o),u.attr("data-t8n",e).addClass("transition-in").css(_objectSpread({"animation-duration":"".concat(t,"ms"),"animation-delay":"".concat(-a,"ms")},n-a?{visibility:"hidden","animation-play-state":"paused"}:{})),requestAnimationFrame(function(){v.childrenProbablyInline(u)?u.css("display","inline"):u.parent().is("tw-backdrop,tw-story")||u[0].setAttribute("style",u[0].getAttribute("style")+"display:block !important;width:100%")}),y(u,t,n-a,r,function(){var e=0===u.filter(f.join(",")).length;if(p&&e){u.find("tw-transition-container, .transition-in, .transition-out").each(function(e,t){((t=d(t)).data("expediteAnim")||Object)()});for(var t=[],n=u.find("*"),r=0;r<n.length;r+=1){var a=n[r];0===a.scrollTop&&0===a.scrollLeft||t.push([a,a.scrollLeft,a.scrollTop])}e=u.find(document.activeElement);u.contents().unwrap();for(var o=0,i=t;o<i.length;o++){var s=_slicedToArray(i[o],3),c=s[0],l=s[1],s=s[2];c.scrollLeft=l,c.scrollTop=s}e.length&&e[0].focus()}else u.removeClass("transition-in").removeAttr("data-t8n")}))},debounce:function(e){function t(){300<Date.now()-l||s<=u?(u=n=0,p=!i,o?(e(c),c=[]):e.apply(void 0,_toConsumableArray(c)),p=!1):n=requestAnimationFrame(t)}var n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=r.batch,o=void 0!==a&&a,a=r.recur,i=void 0!==a&&a,a=r.maxWait,s=void 0===a?1/0:a,c=[],l=0,u=0,p=!1;return function(){var e;p||(e=Date.now(),u+=e-l,l=e,o?c.push(arguments):c=arguments,n&&cancelAnimationFrame(n),n=requestAnimationFrame(t))}},impossible:function(e,t){window.console&&console.error(e+"(): "+t)},onStartup:function(e){l?l.push(e):e()},get storyElement(){return i},detachStoryElement:function(){document.documentElement.contains(i[0])&&(c=i.parent(),i.detach())},reattachStoryElement:function(){document.documentElement.contains(i[0])||(c||d(document.body)).append(i.parents().length?i.parents().last():i)},options:{speedMultiplier:1}};return d(function(){i=d("tw-story"),l.forEach(function(e){return e()}),l=null}),Object.freeze(v)}),define("datatypes/assignmentrequest",["utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/varref","internaltypes/twineerror"],function(e,y,b,v,w){var k=e.objectName,S=e.matches,t=e.toSource;return Object.freeze({assignmentRequest:!0,TwineScript_TypeName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ObjectName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ToSource:function(){return"into"===this.operator?"".concat(t(this.src)," ").concat(this.operator," ").concat(t(this.dest)):"".concat(t(this.dest)," ").concat(this.operator," ").concat(t(this.src))},TwineScript_Unstorable:!0,set:function(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=[],r=function e(t,n,r){var a=!(2<arguments.length&&void 0!==r)||r,o=[],i=n&&v.isPrototypeOf(n)?n.get():n;if(w.containsError(i))return i;if(Array.isArray(i)&&Array.isArray(t)){for(var s=0,c=0;s<t.length&&c<i.length;){var l=t[s],u=i[c];if(y.isPrototypeOf(l)&&l.datatype.rest||b.isPrototypeOf(l)&&l.rest){for(var p=c;c<i.length&&S(l,u);)u=i[c+=1];y.isPrototypeOf(l)?l.datatype=[l.datatype]:b.isPrototypeOf(l)&&(l=b.create("array")),o=o.concat(e(l,v.isPrototypeOf(n)?v.create(n,{first:p+1,last:c+1}):i.slice(p,c)))}else o=o.concat(e(l,v.isPrototypeOf(n)?v.create(n,c+1):u)),c+=1;s+=1}return s<t.length?a&&w.create("operation","I can't unpack this array because it needs ".concat(t.length-s," more value").concat(0<t.length-s?"s":"",".")):o}if(t instanceof Map&&i instanceof Map){var d,f=_createForOfIteratorHelper(t.entries());try{for(f.s();!(d=f.n()).done;){var h=_slicedToArray(d.value,2),m=h[0],g=h[1];if(!i.has(m))return a&&w.create("operation","I can't unpack this datamap because it needs a '"+m+"' data name.");o=o.concat(e(g,v.isPrototypeOf(n)?v.create(n,m):i.get(m)))}}catch(e){f.e(e)}finally{f.f()}return o}if(y.isPrototypeOf(t)){if("function"==typeof t.datatype.destructure)return[{dest:t,value:i,src:n}].concat(t.datatype.destructure(i));if(!S(i,t.datatype))return a&&w.create("operation","I can't put ".concat(k(i)," into ").concat(t.varRef.TwineScript_ToSource()," because it doesn't match ").concat(t.varRef.TwineScript_ToSource(),"'s datatype, ").concat(k(t.datatype),"."));o=o.concat(e(t.datatype,i))}return v.isPrototypeOf(t)||y.isPrototypeOf(t)?o.concat({dest:t,value:i,src:n}):"function"==typeof t.destructure?o.concat(t.destructure(i)):S(i,t)?o:a&&w.create("operation","I tried to unpack, but "+k(t)+" in the pattern didn't match "+k(i)+".")}(this.dest,this.src);if(e=w.containsError(r))return e;if(!r.length)return w.create("operation","I can't store a new value inside "+k(this.dest)+" that isn't in a variable.","You need a variable, or a data structure containing variables at certain positions, to store the value.");var a,o=_createForOfIteratorHelper(r.reverse());try{for(o.s();!(a=o.n()).done;){var i=a.value,s=i.dest,c=i.value,l=i.src;if(y.isPrototypeOf(s)){if(e=w.containsError(s.defineType()))return e;s=s.varRef}if(e=s.set(c,this.srcRef),w.isPrototypeOf(e))return e;t&&l&&l.delete(),n.shift(k(s)+" is now "+k(c))}}catch(e){o.e(e)}finally{o.f()}return n.join("; ")},create:function(e,t,n,r){return w.containsError(e)?e:w.containsError(t)?t:Object.assign(Object.create(this),{dest:e,src:t,operator:n,srcRef:r})}})}),define("datatypes/changercommand",["utils","utils/operationutils","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r){var i=e.plural,a=e.impossible,o=t.is,s=t.toSource,c={},l={TwineScript_TypeID:"changer",TwineScript_TypeName:"a changer",TwineScript_Print:function(){return"`[A ("+this.macroName+":) changer]`"},TwineScript_ToSource:function(){return"("+this.macroName+":"+("else"===this.name?"":this.params.map(s))+")"+(this.next?"+"+this.next.TwineScript_ToSource():"")},get TwineScript_ObjectName(){1===this.params.length&&36<(e=s(this.params[0])).length&&(e=void 0);for(var e,t="a (".concat(this.macroName,":").concat(e||"",") changer"),n=this.next,r=(n&&(t+=" combined with "),0);n&&t.length<48;){var a="(".concat(n.macroName,":)");t+=(0<r&&!n.next?" and ":"")+a+(n.next?", ":""),n=n.next,r+=1}for(var o=0;n&&o<99;)n=n.next,o+=1;return 0<o&&(t+="".concat(0<r?" and ":"").concat(i(o,"other changer"))),t},summary:function(){var e=n.create();return this.run(e),e.summary()},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return Array.isArray(t)||a("ChangerCommand.create","params was not an array but "+t),Object.assign(Object.create(this),{macroName:e,params:t,next:n,canEnchant:r})},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t.canEnchant=this.canEnchant&&e.canEnchant,t},TwineScript_is:function(e){if(l.isPrototypeOf(e))return this.macroName===e.macroName&&o(this.params,e.params)&&o(this.next,e.next)},TwineScript_Clone:function(){for(var e=l.create(this.macroName,this.params,this.next),t=e;t.next;)t=t.next=t.next.TwineScript_Clone();return e.canEnchant=this.canEnchant,e},run:function(e,t){var n="output"===this.macroName?[t||this]:this.params,n=c[this.macroName].apply(c,[e].concat(_toConsumableArray(n)));if(r.containsError(n))return n;this.next&&this.next.run(e,t||this)},register:function(e,t){c[e]=t}};return Object.freeze(l)}),define("datatypes/codehook",[],function(){var t=Object.freeze({TwineScript_TypeName:"a code hook",TwineScript_ObjectName:"a code hook",TwineScript_ToSource:function(){return this.source},TwineScript_Print:function(){return this.code},TwineScript_toString:function(){return this.source},TwineScript_is:function(e){return t.isPrototypeOf(e)&&this.source===e.source},TwineScript_Clone:function(){return t.create(this.code,this.source)},create:function(e,t){return Object.assign(Object.create(this),{code:e,source:t})}});return t}),define("datatypes/colour",["jquery"],function(c){var l=Math.max,u=Math.min,a=Math.sin,o=Math.cos,i=Math.pow,p=Math.round,d=Math.floor,s=Math.atan2,f=Math.cbrt,h=Math.sqrt,m=Math.PI,g=Object.assign,y=Object.create,b=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,t=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,v=y(null);function w(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(0<r.length)return w.apply(void 0,[w(e,t)].concat(r));if(!t)return e;for(var o=[],i=0;i<e.length;i++){o[i]=[];for(var s=0;s<t[0].length;s++){for(var c=0,l=0;l<e[0].length;l++)c+=e[i][l]*t[l][s];o[i][s]=c}}return o}function n(e){var t,n=e.r,r=e.g,a=e.b,e=e.a,o=l(n/=255,r/=255,a/=255),i=u(n,r,a),s=(o+i)/2,c=o-i;if(o===i)return{h:0,s:0,l:s};switch(o){case n:t=(r-a)/c+(r<a?6:0);break;case r:t=(a-n)/c+2;break;case a:t=(n-r)/c+4}return{h:t=p(60*t),s:.5<s?c/(2-o-i):c/(o+i),l:s,a:e}}var k=[.9642956764295677,1,.8251046025104602],S=24389/27,T=216/24389,_=function(e){return e.map(function(e){return[e]})},x=function(e){return e.map(function(e){return e[0]})};function O(e){var t=e.l,n=e.c,r=e.h,e=e.a,n=[t*=100,n*o(r*m/180),n*a(r*m/180)],r=[];r[1]=(n[0]+16)/116,r[0]=n[1]/500+r[1],r[2]=r[1]-n[2]/200;n=[i(r[0],3)>T?i(r[0],3):(116*r[0]-16)/S,S*T<t?i((16+t)/116,3):t/S,i(r[2],3)>T?i(r[2],3):(116*r[2]-16)/S].map(function(e,t){return e*k[t]}),t=_slicedToArray(x(w([[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],w([[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],_(n)))).map(function(e){return u(255,l(0,255*(.0031308<(e=e)?1.055*i(e,1/2.4)-.055:12.92*e)))}),3);return{r:t[0],g:t[1],b:t[2],a:e}}function e(e){function t(e){return 1e-5<=n[e]&&n[e]<=255-1e-5}var n=O(e);if(Object.keys(n).every(t))return n;var r=(e=_objectSpread({},e)).c,a=0;for(e.c/=2;1e-5<r-a;)n=O(e),Object.keys(n).every(t)?a=e.c:r=e.c,e.c=(r+a)/2;return O(e)}var A=Object.freeze({TwineScript_TypeID:"colour",TwineScript_TypeName:"a colour",TwineScript_ObjectName:"a colour",TwineScript_DebugName:function(){return"a colour "+this.TwineScript_Print()},"TwineScript_+":function(e){var t=this.toRGBA(),e=e.toRGBA();return A.create({r:u(p(.6*(t.r+e.r)),255),g:u(p(.6*(t.g+e.g)),255),b:u(p(.6*(t.b+e.b)),255),a:(t.a+e.a)/2})},TwineScript_Print:function(){var e=this.toRGBA();return"<tw-colour style='background-color:rgba("+[e.r,e.g,e.b,e.a]+");'></tw-colour>"},TwineScript_is:function(e){var t;return!!A.isPrototypeOf(e)&&(e.lcha&&this.lcha?e.lcha.l===this.lcha.l&&e.lcha.c===this.lcha.c&&e.lcha.h===this.lcha.h&&e.a===this.a:(t=this.toRGBA(),(e=e.toRGBA()).r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a))},TwineScript_Clone:function(){return A.create(this)},toRGBAString:function(){var e=this.toRGBA(),t=e.r,n=e.g,r=e.b,e=e.a;return"rgba(".concat(t,", ").concat(n,", ").concat(r,", ").concat(e,")")},toHSLA:function(){return n(this.toRGBA())},toRGBA:function(){return this.lch?e(_objectSpread({a:this.a},this.lch)):this},toLCHA:function(){return this.lch?_objectSpread({a:this.a},this.lch):(t=(e=this).r,n=e.g,r=e.b,e=e.a,n=[116*(t=x(w([[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]],w([[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],_([t/255,n/255,r/255].map(function(e){return e<.04045?e/12.92:i((e+.055)/1.055,2.4)}))))).map(function(e,t){return e/k[t]}).map(function(e){return T<e?f(e):(S*e+16)/116}))[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])],r=180*s(n[2],n[1])/m,{l:n[0]/100,c:h(i(n[1],2)+i(n[2],2)),h:0<=r?r:360+r,a:e});var e,t,n,r},LCHRotate:function(e){e<0&&(e=360+e);var t=this.toLCHA();return t.h=(t.h+e)%360,A.create(t)},TwineScript_GetProperty:function(e){var t;return"lch"===e?(t=this.toLCHA(),new Map([["l",t.l],["c",t.c],["h",t.h]])):(t=this.toRGBA(),"h"===e||"s"===e||"l"===e?n(t)[e]:"r"===e||"g"===e||"b"===e||"a"===e?t[e]:void 0)},TwineScript_Properties:["h","s","l","r","g","b","a","lch"],TwineScript_ToSource:function(){if(0===this.a)return"transparent";var e=!this.lch&&n(this);if(1===e.l&&!e.h&&!e.s)return"white";if(0===e.l&&!e.h&&!e.s)return"black";if(.5<=e.l&&e.l<.5334&&0===e.s)return"gray";if(.5===e.l&&.8<=e.s&&e.s<.804){var t={0:"red",30:"orange",60:"yellow",90:"lime",120:"green",180:"cyan",210:"blue",240:"navy",270:"purple",300:"magenta"}[e.h];if(t)return t}return"(".concat(this.lch?"lch":"hsl",":").concat(this.lch?[this.lch.l,this.lch.c,this.lch.h]:[e.h,e.s,e.l]).concat(1!==this.a?","+this.a:"",")")},create:function(e){var t,n,r,a,o,i;return"string"==typeof e?this.create((A.isHexString(e)?function(e){return"string"!=typeof e?e:(e=(e=e.replace("#","")).replace(b,"$1$1$2$2$3$3"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}:function(e){var t;return e in v?v[e]:(t="transparent"===(t=c("<p>").css("background-color",e).css("background-color"))?{r:0,g:0,b:0,a:0}:t.startsWith("rgb")?t.match(/\d+/g).reduce(function(e,t,n){return e["rgb"[n]]=+t,e},{}):{r:192,g:192,b:192},v[e]=t)})(e)):!("h"in e&&"s"in e&&"l"in e)||"r"in e||"g"in e||"b"in e?("a"in e&&"number"==typeof e.a||(e.a=1),"h"in e&&"c"in e&&!("s"in e)&&"l"in e?g(y(this),{a:e.a,lch:{l:e.l,c:e.c,h:e.h}}):g(y(this),e)):this.create((a=(t=e).h,o=e.s,i=e.l,t=e.a,0===o?{r:e=d(255*i),g:e,b:e}:(r=2*i-(n=i<.5?i*(1+o):i+o-i*o),{r:d(255*s((a/=360)+1/3)),g:d(255*s(a)),b:d(255*s(a-1/3)),a:t})));function s(e){return e<0&&(e+=1),1<e&&--e,e<1/6?r+6*(n-r)*e:e<.5?n:e<2/3?r+(n-r)*(2/3-e)*6:r}},isHexString:function(e){return"string"==typeof e&&"#"===e[0]&&(e.slice(1).match(b)||e.slice(1).match(t))},isCSS3Function:function(e){return"string"==typeof e&&/^(?:rgb|hsl)a?\(\s*\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?%?\s*,\s*\d+(?:\.\d+)?%?(?:,\s*\d+(?:\.\d+)?\s*)?\)$/.test(e)}});return A}),define("datatypes/customcommand",["internaltypes/changedescriptor","internaltypes/twineerror"],function(l,u){var p=Object.assign,d=Object.create;return Object.seal({TwineScript_TypeID:"command",TwineScript_ObjectName:"a custom command",TwineScript_TypeName:"a custom command",TwineScript_Print:function(){return"`[a custom command]`"},create:function(e){var t,n=e.toSource,r=e.changer,a=e.hook,o=e.variables,i={};for(t in o)i[t]=[o[t]];var s,c=l.create({source:a,loopVars:i},r);return u.containsError(c)?c:s=p(d(this),{TwineScript_Attach:function(e,t){c.section=e;e=t.run(c);return u.containsError(e)?e:s},TwineScript_Run:function(e){c.section=e;e=c;return c=l.create({source:a,loopVars:i},r),e},TwineScript_ToSource:function(){return n},TwineScript_CustomCommand:function(){return e}})}})}),define("datatypes/custommacro",["jquery","utils","renderer","utils/operationutils","datatypes/customcommand","internaltypes/varref","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(w,e,k,t,S,T,_,x,O){function n(v){return function(e){v.called+=1;for(var t=v.varNames,n=v.params,r=v.body,a=E(N(_),{TwineScript_VariableStore:{type:"temp",name:v.TwineScript_ObjectName+" call #"+v.called},TwineScript_TypeDefs:N(null)}),o=[],i=0,s=!1,c=arguments.length,l=new Array(1<c?c-1:0),u=1;u<c;u++)l[u-1]=arguments[u];for(var p=0;p<l.length;p+=1){var d=l[p],f=t[i],h=(a.TwineScript_TypeDefs[f]=n[i].datatype.rest?n[i].datatype.create("array"):n[i].datatype,T.create(a,f));if(x.containsError(h))return h;if(n[i].datatype.rest){var s=!0,m=(a[f]||[]).concat([d]);if(p<l.length-1){a[f]=m;continue}h.set(m)}else h.set(d),i+=1;o.push(O.create(A(h)+" is now "+A(a[f])))}if(!s&&null!=(g=n[i])&&g.datatype.rest){var g=T.create(a,t[i]);if(x.containsError(g))return g;g.set([]),a.TwineScript_TypeDefs[name]=n[i].datatype.create("array")}var y,g=w("<p>").append(k.exec(r.code)),b=e.stack.length,r=(e.stack.unshift({tempVariables:a,dom:g,output:function(e){y=e}}),e.evalReplay);for(e.evalReplay=null,e.execute();e.stack.length>b;)e.stack.shift();e.evalReplay=r;r=g.find("tw-error");return r.length?(g.prepend(o.map(function(e){return e.render()}),"<br>"),x.create("propagated","".concat(r.length," error").concat(1<r.length?"s":""," occurred when running ").concat(v.TwineScript_ObjectName,"."),void 0,g)):void 0===y?x.create("custommacro","".concat(v.TwineScript_ObjectName," didn't output any data or hooks using (output:) or (output-data:).")):"object"===_typeof(y)&&"changer"in y?S.create(E(y,{toSource:"(".concat(v.TwineScript_KnownName||"unnamed",":").concat(l.map(C),")")})):y}}var r=e.andList,A=t.objectName,a=t.typeName,o=t.matches,C=t.toSource,E=Object.assign,N=Object.create,i=Object.seal({TwineScript_TypeID:"macro",TwineScript_TypeName:"a custom macro",TwineScript_GetProperty:function(e){if("params"===e)return _toConsumableArray(this.params)},TwineScript_Properties:["params"],TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},TwineScript_Clone:function(){var e=E(N(i),this);return e.fn=n(e),e},TwineScript_ToSource:function(){return"(macro:"+this.params.map(function(e){return e.TwineScript_ToSource()}).concat("")+this.body.TwineScript_ToSource()+")"},createFromFn:function(e,t,n,r){return E(N(i),{params:[],fn:e,typeSignature:r,TwineScript_ObjectName:t,TwineScript_ToSource:n,TwineScript_KnownName:""})},create:function(e,t){t=E(N(i),{params:e,called:0,varNames:e.map(function(e){return e.varRef.propertyChain[0]}),typeSignature:e.map(function(t){var e=t.datatype.toTypeSignatureObject?t.datatype.toTypeSignatureObject({rest:t.rest}):{pattern:"range",range:function(e){return o(t.datatype,e)},name:a(t.datatype)};return t.rest?{pattern:"zero or more",innerType:e}:e}),body:t,TwineScript_KnownName:"",TwineScript_ObjectName:"a custom macro (with ".concat(e.length?r(e.map(C)):"no params",")")});return t.fn=n(t),t}});return i}),define("datatypes/datatype",["utils","utils/operationutils","datatypes/changercommand","datatypes/colour","datatypes/gradient","datatypes/lambda","datatypes/custommacro","datatypes/codehook","internaltypes/twineerror"],function(e,t,n,r,a,o,i,s,c){var l=e.realWhitespace,u=e.anyRealLetter,p=e.anyCasedLetter,d=e.anyNewline,f=t.objectName,e=Object.seal,h=Object.keys,m=Math.floor,g=Math.abs,y={TwineScript_TypeID:"datatype",TwineScript_TypeName:"a datatype",TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},get TwineScript_ObjectName(){return"the "+(this.rest?"...":"")+this.name+" datatype"},TwineScript_is:function(e){return y.isPrototypeOf(e)&&e.name===this.name},TwineScript_Clone:function(){return this.rest?this:Object.create(this)},TwineScript_ToSource:function(){return(this.rest?"...":"")+this.name},TwineScript_IsTypeOf:function(e){var t=this.name,n=this.rest;return!!v[t]&&v[t](e,n)},toTypeSignatureObject:function(){var e=this.name,e={pattern:"range",range:v[e],name:"a "+("dm"===e?"datamap":"ds"===e?"dataset":"num"===e?e+"ber":"str"===e?e+"ing":"color"===e?"colour":"bool"===e?e+"ean":"alnum"===e?"alphanumeric character":"int"===e?e+"eger":"even"===e||"odd"===e?e+" number":e.endsWith("case")||"whitespace"===e?e+" character":"empty"===e?e+" value":e)};return this.rest?{pattern:"zero or more",innerType:e}:e},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=(e="datamap"===e?"dm":"dataset"===e?"ds":"number"===e?"num":"string"===e?"str":"color"===e?"colour":"boolean"===e?"bool":"alphanumeric"===e?"alnum":"integer"===e?"int":"newline"===e?"linebreak":e,Object.create(this));return n.name=e,n.rest=t,n},from:function(t){var e=h(b).find(function(e){return b[e](t)});return e?y.create(e):c.create("datatype",f(t)+" doesn't correspond to a datatype value.")}},b={array:Array.isArray,dm:function(e){return e instanceof Map},ds:function(e){return e instanceof Set},datatype:function(e){return y.isPrototypeOf(e)},changer:function(e){return n.isPrototypeOf(e)},colour:function(e){return r.isPrototypeOf(e)},gradient:function(e){return a.isPrototypeOf(e)},lambda:function(e){return o.isPrototypeOf(e)},macro:function(e){return i.isPrototypeOf(e)},codehook:function(e){return s.isPrototypeOf(e)},command:function(e){return e&&"command"===e.TwineScript_TypeID},str:function(e){return"string"==typeof e},num:function(e){return"number"==typeof e},bool:function(e){return"boolean"==typeof e}},v=_objectSpread(_objectSpread({},b),{},{even:function(e){return!isNaN(e)&&m(g(e))%2==0},odd:function(e){return!isNaN(e)&&m(g(e))%2==1},empty:function(e){return e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&"string"!=typeof e||e.length)},int:function(e){return"number"==typeof e&&e===(0|e)},uppercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toLowerCase()})},lowercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toUpperCase()})},whitespace:function(e){return"string"==typeof e&&!!e.match("^"+l+"$")},digit:function(e){return"string"==typeof e&&!!e.match("^\\d$")},alnum:function(e){return"string"==typeof e&&!!e.match("^"+u+"$")},anycase:function(e){return"string"==typeof e&&!!e.match("^"+p+"$")},linebreak:function(e){return"string"==typeof e&&!!e.match("^"+d+"$")},any:function(){return!0},const:function(){return!0}});return e(y)}),define("datatypes/gradient",["utils/operationutils"],function(e){var t=e.toSource,n=Object.freeze({TwineScript_TypeID:"gradient",TwineScript_TypeName:"a gradient",TwineScript_ObjectName:"a gradient",TwineScript_DebugName:function(){return"a gradient "+this.TwineScript_Print()},TwineScript_GetProperty:function(e){var t=this;return"angle"===e?this.angle:"stops"===e?this.stops.map(function(e){return new Map([[t.repeating?"pixels":"percent",e.stop],["colour",e.colour.TwineScript_Clone()]])}):void 0},TwineScript_Properties:["angle","stops"],TwineScript_ToSource:function(){return"(gradient:"+this.angle+","+this.stops.map(function(e){return t(e.stop)+","+t(e.colour)})+")"},TwineScript_is:function(e){var r=this;return e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every(function(e,t){var n=e.colour,e=e.stop;return r.stops[t].stop===e&&r.stops[t].colour.TwineScript_is(n)})},TwineScript_Clone:function(){return n.create(this.angle,_toConsumableArray(this.stops))},TwineScript_Print:function(){return"<tw-colour style='background:"+this.toLinearGradientString()+"'></tw-colour>"},create:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return Object.assign(Object.create(this),{angle:e,stops:t.sort(function(e,t){return e.stop-t.stop}),repeating:n})},multiply:function(t){return n.create(this.angle,this.stops.map(function(e){return{colour:e.colour,stop:e.stop*t}}))},toLinearGradientString:function(){var r=this;return(this.repeating?"repeating-":"")+"linear-gradient(".concat(this.angle,"deg, ").concat(this.stops.reduce(function(e,t){var n=t.colour,t=t.stop;return e+n.toRGBAString()+" "+t*(r.repeating?1:100)+(r.repeating?"px,":"%,")},"").slice(0,-1),")")}});return n}),define("datatypes/hookset",["jquery","utils","utils/renderutils","utils/operationutils"],function(g,s,e,t){var y=e.textNodeToChars,b=e.realWhitespace,c=e.findTextInNodes,r=t.toSource;function l(e){function t(n,e){if(Array.isArray(e))return e.reduce(function(e,t){return e.add(n.get(t))},g());if(e&&"object"===_typeof(e)&&"first"in e&&"last"in e){for(var t=e.first,r=e.last,a=n.length,o=(t<0&&(t+=a),r<0&&(r+=a),[n.get(t)]);t!==r;)t+=Math.sign(r-t),o.push(n.get(t));return g(o)}if("string"==typeof e){if("chars"===e){var i,s=[],c=_createForOfIteratorHelper(n.textNodes(m));try{for(c.s();!(i=c.n()).done;){var l,u=i.value,p=_createForOfIteratorHelper(y(u));try{for(p.s();!(l=p.n()).done;){var d=l.value;d.textContent.match(b)||s.push(d)}}catch(e){p.e(e)}finally{p.f()}}}catch(e){c.e(e)}finally{c.f()}return g(s)}if("links"===e)return n.findAndFilter("tw-link, .enchantment-link");if("visited"===e)return n.findAndFilter("tw-link.visited");var f,h;if("lines"===e)return f=n.findAndFilter("br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)").get(),h=[[]],n.contents().each(function e(t,n){var r=(n.tagName||"").toLowerCase();if("tw-sidebar"!==r)if("tw-passage"===r||"tw-transition-container"===r)g(n).contents().each(e);else{if(f.length){if(n===f[0])return f.shift(),void h.push([]);if(16&n.compareDocumentPosition(f[0]))return h.push([]),g(n).contents().each(e),void h.push([])}h[h.length-1].push(n)}}),g(h.map(function(e){return!!e.length&&g(e).wrapAll("<tw-pseudo-hook>").parent()[0]}).filter(Boolean))}return g(n.get(e))}var n,r,a=e.dom,m=":not(tw-error, tw-error *)",o=g();this.next&&(o=o.add(l.call(this.next,e)));if(this.selector){if("string"===this.selector.type)i=this.selector.data,n=c((n=a).textNodes(),i),r=g(),n.forEach(function(e){r=r.add(g(e).wrapAll("<tw-pseudo-hook>").parent())}),i=r;else{if("base"===this.selector.type)return o.add(t(l.call(this.selector.data,e),this.property));n=this.selector.data,e='tw-hook[name="'+(n=s.insensitiveName(n).replace(/"/g,"&quot;"))+'"],tw-enchantment[name="'+n+'"]';var e=e+={page:", tw-story",passage:", tw-passage",sidebar:", tw-sidebar",link:", tw-link, .enchantment-link"}[n]||"",i=a.findAndFilter(e).add(a.parentsUntil(s.storyElement.parent())).filter(e)}o=this.property?o.add(t(i,this.property)):o.add(i)}return o=o.get().reduce(function(e,t){return t=g(t),e.add(t.is("tw-enchantment")&&t.contents().length<=1?t.contents():t)},g())}function a(e){var t,n;return e?(t=e.selector,n=e.property,e=e.next,[JSON.stringify(["base"===t.type?a(t.data):s.insensitiveName(t.data),n])].concat(_toConsumableArray(a(e))).sort()):[]}var o=Object.freeze({forEach:function(e,n){var t=l.call(this,e).each(function(e,t){return n(g(t),e)});return e.dom.findAndFilter("tw-pseudo-hook").contents().unwrap(),t},hooks:function(e){return l.call(this,e)},get TwineScript_ObjectName(){return"the hook name ".concat(this.TwineScript_ToSource())},TwineScript_TypeID:"hookName",TwineScript_TypeName:"a hook name (like ?this)",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){var e="",t=this.selector,n=t.type,t=t.data;return"name"===n?t.match(RegExp("^"+s.anyRealLetter+"+$"))?e+="?"+t:e+="(hooks-named:"+JSON.stringify(t)+")":"string"===n?e+=JSON.stringify(t):"base"===n&&(e+=t.TwineScript_ToSource()+"'s "+r(this.property,"property")),this.next&&(e+=" + "+this.next.TwineScript_ToSource()),e},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){return a(this)+""==a(e)+""},TwineScript_GetProperty:function(e){return o.create({type:"base",data:this},e,void 0)},TwineScript_Properties:["chars","links","lines","visited"],TwineScript_Clone:function(){return o.create(this.selector,this.property,this.next)},create:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return Object.assign(Object.create(this||o),{selector:Object.freeze(e),property:t,next:n})},from:function(e){return o.isPrototypeOf(e)||"string"==typeof e||s.impossible("HookSet.from() was given a non-HookSet non-string."),o.isPrototypeOf(e)?e:o.create({type:"string",data:e})}});return o}),define("datatypes/lambda",["utils/operationutils","internaltypes/varscope","internaltypes/varref","internaltypes/twineerror"],function(e,h,s,m){var g=e.objectName;var c=Object.freeze({TwineScript_TypeID:"lambda",TwineScript_TypeName:"a lambda",get TwineScript_ObjectName(){return'a "'+("making"in this?"making ... ":"")+("each"in this?"each ... ":"")+("where"in this?"where ... ":"")+("when"in this?"when ... ":"")+("via"in this?"via ... ":"")+'" lambda'},TwineScript_Print:function(){return"`[A lambda]`"},TwineScript_is:function(e){return e===this},TwineScript_ToSource:function(){return this.source},TypeSignature:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"lambda",innerType:c,clauses:t,typeName:'a "'+t.concat("").join(" ...")+'" lambda'}},TwineScript_Clone:function(){return Object.assign(Object.create(c),this)},create:function(e,t,n,r){var a,o="temp variable, or typed temp variable";function i(e){e=e&&e.varRef?e.varRef:e;return void 0===e||e&&s.isPrototypeOf(e)&&h.isPrototypeOf(e.object)&&1===e.propertyChain.length}if(m.containsError(n))return n;if("making"===t&&!i(n))return m.create("syntax","I need a "+o+", to the right of '"+t+"', not "+g(n)+".");if(m.containsError(e))return e;if(c.isPrototypeOf(e)){if("when"===t||"when"in e)return m.create("syntax","A 'when' lambda cannot have any other clauses, such as '"+t+"'.");if(t in e)return m.create("syntax","This lambda has two '"+t+"' clauses.");a=e}else{if("when"===t&&void 0!==e)return m.create("syntax","A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).");if(!i(e))return m.create("syntax","This lambda needs to start with a single "+o+", not "+g(e)+".");(a=Object.create(this)).loop=e||""}return a.source=r.trim(),a[t]=n,a.making&&a.making.getName()===(a.loop&&a.loop.getName())?m.create("syntax","This lambda has two variables named '"+a.loop.getName()+"'.","Lambdas should have all-unique parameter names."):a},apply:function(e,t){var n=t.loop,r=t.pos,a=t.making,o=t.ignoreVia;function i(e,t){if(e){var n,r;if("datatype"in e&&"varRef"in e)return n=e.varRef.create(s,e.varRef.propertyChain),m.containsError(n)?n:(r=n.defineType(e.datatype),m.containsError(r)||(r=n.set(t),m.containsError(r))?r:void 0);s[e.getName()]=t}}var s=(s=t.tempVariables)||Object.create(e.stack.length?e.stackTop.tempVariables:h),t=i(this.loop,n)||i(this.making,a);if(m.containsError(t))return t;e.stack.unshift(Object.assign(Object.create(e.stackTop||null),{tempVariables:s,lambdaPos:this.when?void 0:r})),!n||this.making||this.when?e.Identifiers.it=m.create("operation","I can't use 'it', or an implied 'it', in "+this.TwineScript_ObjectName):e.Identifiers.it=n;var c,l,u,p,d,t=!o&&this.via,o="where"in this||"when"in this,f=e.evalReplay;return e.evalReplay=f?[]:null,o?(c=e.eval(this.where||this.when),l=e.evalReplay,e.evalReplay=l&&t?[]:null,!n||this.making||this.when||(e.Identifiers.it=n),u=c,p=!t||e.eval(t),d=null,u=m.containsError(u)||("boolean"!=typeof u?m.create("operation","This lambda's 'where' clause must evaluate to true or false, not "+g(u)+"."):u?p:d)):c=u=!t||e.eval(t),p=t?e.evalReplay:null,e.stack.shift(),(e.evalReplay=f)&&(o||t)&&(((d=f[f.length-1])||{}).lambda&&d.lambda.obj===this||((d={lambda:{obj:this,loops:[]},code:(f[f.length-1]||{}).code||""}).fromCode=d.code,f.push(d)),d.lambda.loops.push(_objectSpread(_objectSpread(_objectSpread({it:n,pos:r},void 0!==a&&{making:a}),t&&{viaReplay:p,viaResult:u}),o&&{whereReplay:l,whereResult:null!==c&&c}))),u},filter:function(r,e){var a,o=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return e.reduce(function(e,t,n){return a||(n=o.apply(r,{loop:t,pos:n+1,ignoreVia:!0,tempVariables:i}),a=m.containsError(n))||e.concat(n?[t]:[])},[])}});return c}),define("datatypes/typedvar",["utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(e,a,o){var i=e.typeName,t=e.matches,n=e.toSource,s=e.unstorableValue,e=Object.freeze,c=Object.assign,l=Object.create,u=e({TwineScript_TypeName:"a TypedVar (typed variable name)",get TwineScript_ObjectName(){var e=n(this.datatype);return"the ".concat(e.length<24?e+"-":"","typed variable name, ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A typed variable name]`"},TwineScript_Unstorable:!0,TwineScript_Clone:function(){return c(l(u),{datatype:this.datatype.TwineScript_Clone(),varRef:this.varRef})},TwineScript_ToSource:function(){return n(this.datatype)+"-type "+this.varRef.TwineScript_ToSource()},TwineScript_GetProperty:function(e){return"name"===e?this.getName():this[e]},TwineScript_Properties:["datatype","name"],TwineScript_IsTypeOf:function(e){return t(this.datatype,e)},get:function(){var e;return(e=this.varRef).get.apply(e,arguments)},getName:function(){return this.varRef.getName()},defineType:function(){if("any"!==this.datatype.name)return this.varRef.defineType(this.datatype)},create:function(e,t){var n,r;return(n=o.containsError(t)||o.containsError(e)||t.error)||(a.isPrototypeOf(t)?(n=t.object,r=t.compiledPropertyChain,n&&n.TwineScript_VariableStore&&1===r.length&&n.TwineScript_TypeDefs?(r=s(e))&&!u.isPrototypeOf(r)?o.create("syntax","The -type syntax can't have "+i(r)+" to its left."):c(l(this),{datatype:e,varRef:t}):o.create("unimplemented","I can only restrict the datatypes of variables, not data names or anything else.")):o.create("syntax","The -type syntax must have a variable to its right."))}});return u}),define("datatypes/varbind",["jquery","utils","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(o,e,t,n,r){var a=t.objectName;return n.on("set",function(r,a){r.TwineScript_VariableStore&&e.storyElement.find("[data-2bind]").each(function(e,t){var n=(t=o(t)).data("twoWayBindEvent");"function"==typeof n&&n(t,r,a)})}),Object.freeze({TwineScript_TypeName:"a VarBind (bound variable name)",get TwineScript_ObjectName(){return"a ".concat(this.bind," bind to ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A bound variable name]`"},TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return("two way"===this.bind?"2":"")+"bind "+this.varRef.TwineScript_ToSource()},set:function(e){var e=this.varRef.set(e);if(e=r.containsError(e))return e},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"one way";return r.containsError(e)?e:n.isPrototypeOf(e)?e.error||Object.assign(Object.create(this),{varRef:e,bind:t}):r.create("operation","I can only 'bind' a variable, not "+a(e)+".")}})}),define("debugmode/highlight",["jquery","utils","utils/typecolours","macros","lexer"],function(u,e,t,p,n){var d=e.insensitiveName,f=t.versionClass,h=n.lex;return function(e,t,n,r){if(9999<e.length)return[u("<span>").text(e)];for(var a=h(e,"",t||"macro"),o=[],i="",s=a,c=a.start;c<a.end;c+=1){var l=a.pathAt(c);l[0]!==s[0]&&(o.length&&(o[o.length-1].textContent=i),i="",s=l,o.push(u("<".concat(r&&n<=c&&c<r?"mark":"span",' class="').concat(function(e){for(var t={},n="",r=0;r<e.length;r+=1){var a=e[r],o=a.type,i=a.text,s=("verbatim"!==o&&"comment"!==o||(n=""),f+o);switch(t[s]=(t[s]||0)+1,1<t[s]&&(s+="-"+t[s]),o){case"text":i.trim()&&e.slice(r+1).reduce(function(e,t){return void 0===e?"macro"===t.type||"hook"!==t.type&&e:e},void 0)&&(s+=" ".concat(f,"error"));break;case"macroName":var c,l=e[r].text[0];"_"!==l&&"$"!==l?(c=d(e[r].text.slice(0,-1)),p.has(c)?s+="-"+p.get(c).returnType.toLowerCase():s+=" ".concat(f,"error")):s+=" ".concat(f,"customMacro ").concat(f+("_"===l?"tempV":"v"),"ariable")}n+=s+" "}return n}(s),'">'))[0])),i+=a.text[c-a.start]}return o.length&&(o[o.length-1].textContent=i),o}}),define("debugmode/mode",["jquery","utils","utils/naturalsort","state","engine","internaltypes/varref","internaltypes/twineerror","utils/operationutils","utils/renderutils","passages","section","debugmode/panel","debugmode/highlight","utils/typecolours"],function(I,V,M,D,F,L,H,e,t,z,q,W,B,n){var U=e.objectName,$=e.isObject,G=e.toSource,Y=e.typeID,J=t.dialog,X=n.CSS,K=function(e,t){var f=V.escape,i=V.nth,n=V.debounce,r=I(document.documentElement),a=M(),o={darkMode:!0,fadePanel:!0,evalReplay:!0,width:null,maxHeight:400};if(D.hasStorage)try{var s=localStorage.getItem("(Debug Options "+V.options.ifid+")");s&&(o=JSON.parse(s))}catch(e){}function c(){if(D.hasStorage)try{localStorage.setItem("(Debug Options "+V.options.ifid+")",JSON.stringify(o))}catch(e){}}W.defaultMaxHeight=o.maxHeight;function l(e){return n(function(){if(V.options.debug)return e.apply(this,arguments)},{maxWait:2e3})}var h=I('<tw-debugger class="'.concat([o.darkMode?"theme-dark":"",o.fadePanel?"fade-panel":""].join(" "),'" style="').concat(o.width?"width:"+o.width+"px":"","\">\n<div class='panel panel-errors' hidden><table></table></div>\n<div class='tabs'></div>\n<label style='user-select:none'>Turns: </label><select class='turns' disabled></select>\n<button class='show-invisibles'>\ud83d\udd0d Debug View</button>\n<button class='show-dom'><span style=\"vertical-align:text-top\">&lt;</span><span style=\"vertical-align:text-bottom\">&gt;</span> DOM View</button>\n<button class='close'>\u2716</button>\n<div class='resizer-h'>\n</tw-debugger>")),s=h.find(".tabs"),u=h.find(".show-dom"),p=h.find(".show-invisibles"),d=h.find(".close"),m=h.find(".turns");I(document.documentElement).on("click","tw-expression, tw-error, tw-eval-explanation",n(function(e){var r,a,o,i,l,u,p,d,t=I(e.target).data("evalReplay");function n(){var e,s,c=r[a],t=o.find("tw-eval-explanation").empty(),n=o.find("tw-eval-code");c.toCode||c.toDesc||c.error||c.lambda?(o.find("tw-eval-code").empty().append(B(c.code,"macro",0<a&&c.start,0<a&&c.end+c.diff)),t.append(c.lambda?"":"<code class='".concat(56<c.fromCode.length?"from-block":"from-inline","'></code>"),c.error?"<span> caused an error: </span>":c.lambda?"<span>The lambda <code class='to-lambda'></code> was run, producing these results.</span>":"<span> became".concat(c.ToDesc?"\u2026":""," </span>").concat(c.toDesc?"<span class='to-desc'>".concat(f(c.toDesc),".</span>"):"<code class='to-code'></code>")),c.error?t.append(c.error):c.lambda?(s=function(e,t){return I("<".concat(e,"><code></").concat(e,">")).find("code").append(B(t,"macro")).end()},t.find(".to-lambda").append(B(c.lambda.obj.source,"macro")).end().append((e=I("<table>")).append.apply(e,[I("<tr>").append(s("th","pos"),c.lambda.obj.loop?s("th","_"+c.lambda.obj.loop.getName()).append(" / ",I("<code>").append(B("it","macro"))):s("th","it"),c.lambda.obj.making&&s("th","_"+c.lambda.obj.making.getName()),c.lambda.obj.where&&s("th","where").append(" result"),c.lambda.obj.via&&s("th","via").append(" result"))].concat(_toConsumableArray(c.lambda.loops.map(function(e){var t=e.it,n=e.pos,r=e.making,a=e.whereResult,o=e.whereReplay,i=e.viaResult,e=e.viaReplay;return I("<tr>").append(s("td",G(n)),s("td",G(t)),void 0!==r&&s("td",G(r)),null!=a&&(H.containsError(a)?I("<td>").append(a.render(c.lambda.obj.source,!0)):s("td",G(a))).append(o&&I("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",o)),null!=i&&(H.containsError(i)?I("<td>").append(i.render(c.lambda.obj.source,!0)):s("td",G(i))).append(e&&I("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",e)))})))))):c.toDesc||t.find(".to-code").append(B(c.toCode,"macro")),t.next().html(c.itIdentifier?'(The <code class="cm-harlowe-3-identifier">it</code> identifier now refers to '.concat(f(c.itIdentifier),".)"):"").next().text(c.reason||"")):(n.html(B(c.code,"macro")),t.html("<center>First, there was <code></code>.</center>").next().empty().next().empty()),c.lambda||t.find("code").first().append(B(c.fromCode,"macro")),o.find("mark").each(function(e,t){t.scrollIntoView()}),i.css("visibility",a<=9?"hidden":"visible"),l.css("visibility",a<=0?"hidden":"visible"),p.css("visibility",a>=r.length-1?"hidden":"visible"),d.css("visibility",a>=r.length-10?"hidden":"visible"),u.html("( ".concat(a+1,"/").concat(r.length," )"))}t&&(r=t,t=J({buttons:[{name:"Understood",confirm:!(a=0),callback:function(){return!h.find("tw-backdrop").length&&h.removeClass("show-dialog")}}]}).addClass("eval-replay"),o=I("<tw-eval-replay>".concat(1===r.length?"":"<tw-eval-code></tw-eval-code>","<tw-eval-explanation></tw-eval-explanation><tw-eval-it></tw-eval-it><tw-eval-reason></tw-eval-reason>").concat(1===r.length?"":"<tw-dialog-links><tw-link style='visibility:hidden'>\u2190 10</tw-link><tw-link style='visibility:hidden'>\u2190 \u2190</tw-link><b></b><tw-link>\u2192 \u2192</tw-link><tw-link>10 \u2192</tw-link></tw-dialog-links>","</tw-eval-replay>")),t.find("tw-dialog").css({width:"75vw","max-width":"75vw"}).prepend(o),i=o.find("tw-link:first-of-type"),l=i.next(),u=l.next(),p=u.next(),d=p.next(),n(),i.on("click",function(){a=Math.max(0,a-10),n()}),l.on("click",function(){a=Math.max(0,a-1),n()}),p.on("click",function(){a=Math.min(r.length-1,a+1),n()}),d.on("click",function(){a=Math.min(r.length-1,a+10),n()}),h.find("tw-backdrop").length?h.find("tw-backdrop").before(t):h.addClass("show-dialog").append(t));var s,t=I(e.target).data("goto");t&&(s=V.options.ignoreGotos,V.options.ignoreGotos=!1,t.command.TwineScript_Run(t.section),V.options.ignoreGotos=s),e.stopPropagation()})),h.find(".resizer-h").mousedown(function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageX,n=h.width();r.on("mousemove.debugger-resizer-h",function(e){e=e.pageX;h.width("".concat(n+t-e|0,"px"))}).on("mouseup.debugger-resizer-h",function(){r.off(".debugger-resizer-h"),o.width=h.width(),c()})}),h.on("mousedown",".resizer-v",function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageY,n=I(e.target.parentNode).height();r.on("mousemove.debugger-resizer-v",function(e){e=e.pageY;h.find(".panel").css("maxHeight","".concat(n+t-(0|e),"px"))}).on("mouseup.debugger-resizer-v",function(){r.off(".debugger-resizer-v"),o.maxHeight=h.find(".panel").css("maxHeight"),c()})}),p.click(function(){r.toggleClass("debug-mode").removeClass("dom-debug-mode"),p.toggleClass("enabled"),u.removeClass("enabled")}),u.click(function(){r.toggleClass("dom-debug-mode").removeClass("debug-mode"),u.toggleClass("enabled"),p.removeClass("enabled")}),d.click(function(){r.removeClass("debug-mode dom-debug-mode"),h.detach(),Object.assign(V.options,{debug:!1,speedMultiplier:1,ignoreClickEvents:!1,ignoreGotos:!1})});function g(e){(e=e.parents(".variable-row, .enchantment-row, .source-row")).next(".panel-row-source").find("td").empty().append(B(e.data("value")||G(e.data("enchantment").changer),e.is("source-row")?"markup":"macro"))}function y(){return k=new Set}function b(){I(document.body).append(h),V.options.debug=!0,V.options.evalReplay=o.evalReplay,V.options.speedMultiplier=1,V.options.ignoreClickEvents=!1,V.options.ignoreGotos=!1,R()}var v,w=l(function(){var r=m.children().get(),e=D.timeline,a=0;e.forEach(function(e,t){var n=e.turns,e=e.passage,n=(a+=1+(void 0===n?0:n))+": "+e;r[t]?r[t].textContent=n:m.append("<option value='".concat(t,"'>").concat(n,"</option>"))}),e.length<r.length&&I(r.slice(e.length)).remove(),m[1<=e.length?"removeAttr":"attr"]("disabled"),m.val(D.pastLength)}),k=(m.change(function(e){e=e.target.value-D.pastLength;0!=e&&(D[e<0?"rewind":"fastForward"](Math.abs(e)),F.showPassage(D.passage))}),w(),D.on("forward",w).on("load",w).on("forgetUndos",function(){return w}).on("back",function(){D.pastLength<=1&&m.attr("disabled"),m.find("[selected]").removeAttr("selected"),m.val(D.pastLength)}),new Set),S=W.create({className:"variables",tabName:"Variable",rowWrite:function(e,t){var n,r=e.name,a=e.dataset,o=e.path,i=e.value,s=e.tempScope,e=e.type,c=i&&48<i.length&&!i.TwineScript_DebugName,l=$(i)&&i.TwineScript_DebugName?i.TwineScript_DebugName():f(U(i)),u="",a=(o.length&&(u=o.reduce(function(e,t){return e+t+"'s "},"")),a&&(r="???"),e?G(e):""),e="object"===_typeof(i)||c;return t?(t[0].firstChild.innerHTML=a||"",u&&I(t[0].firstChild).children(".variable-path").html((s?"_":"$")+f(u)),t[0].childNodes[1].lastChild.textContent=(u?"":s?"_":"$")+f(r+""),t[0].childNodes[2].textContent=s||"",t[0].childNodes[3].innerHTML=l,n=(c=I(t[0].lastChild.firstChild)).is(".open"),c[e?"show":"hide"](),c=t.next(".panel-row-source"),n&&c.find("td").empty().append(B(G(i))),t.data("value",G(i)),t.add(c)):I('<div class="variable-row">').attr("data-name",r).attr("data-path",o+"").attr("data-scope",s||"").css("padding-left",Math.min(5,o.length)+"em").append("<td class='variable-type'>".concat(a||"","</td>"),"<td class='variable-name cm-harlowe-3-"+(s?"tempV":"v")+"ariable'><span class='variable-path'>"+(u?(s?"_":"$")+f(u):"")+"</span> "+(u?"":s?"_":"$")+f(r+"")+"</td>","<td class='temporary-variable-scope'>".concat(s||"","</td>"),"<td class='variable-value cm-harlowe-3-macroName-"+Y(i)+"'>"+l+"</td><td class='panel-row-buttons'><tw-folddown tabindex=0 style='display:"+(e?"visible":"none")+"'>(source:) </tw-folddown></td>").data("value",G(i)).find("tw-folddown").data("folddown",g).end().add("<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'></td></tr>")},rowCheck:function(e,t){var n=e.name,r=e.path,e=e.tempScope;return t[0]&&t[0].getAttribute("data-name")===n&&t[0].getAttribute("data-path")===r+""&&t[0].getAttribute("data-scope")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="variable-type">Type</th><th data-col="variable-name">Name</th><th data-col="temporary-variable-scope">Scope</th><th data-col="variable-value">Value</th></tr>'},rowSort:function(e,t,n){if("variable-value"===e)return a(t.attr("class"),n.attr("class"))||a(t.parent().data("value"),n.parent().data("value"))}}),T=l(function(){var e,t,o=[],n=D.variables,r=o.length;for(e in n)e.startsWith("TwineScript")||(r+=1,function n(e){var r,t,a;500<o.length||(o.push(e),r=e.path.concat(e.name),t=e.value,a=e.tempScope,r.length<=4&&(Array.isArray(t)?t.forEach(function(e,t){return n({name:i(t+1),path:r,value:e,tempScope:a})}):t instanceof Map?_toConsumableArray(t).forEach(function(e){var t=(e=_slicedToArray(e,2))[0],e=e[1];return n({name:t,path:r,value:e,tempScope:a})}):t instanceof Set&&_toConsumableArray(t).forEach(function(e,t){return n({name:t,dataset:!0,path:r,value:e,tempScope:a})})))}({name:e,path:[],value:n[e],tempScope:"",type:null==(t=n.TwineScript_TypeDefs)?void 0:t[e]}));o.push.apply(o,_toConsumableArray(k)),r+=k.size,S.update(o,r),0===r!==S.panel[0].classList.contains("panel-variables-empty")&&S.panel.toggleClass("panel-variables-empty")}),_=(L.on("set",function(e,t,n){var r,a;e===D.variables||"temp"!==(null==(a=e.TwineScript_VariableStore)?void 0:a.type)||null!=(a=e.TwineScript_VariableStore)&&a.name.match(/#\d+$/)||(r=null==(a=e.TwineScript_VariableStore)?void 0:a.name,e=null==(a=e.TwineScript_TypeDefs)?void 0:a[t],(a=_toConsumableArray(k).find(function(e){return e.name===t&&e.tempScope===r}))?a.value=n:k.add({name:t,path:[],value:n,tempScope:r,type:e})),T(),v()}).on("delete",function(){T(),v()}),S.panel.append("<div class='panel-variables-bottom'>\n\t\t\t<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\n\t\t\t<input class='clipboard' type=\"text\" style='opacity:0;pointer-events:none;position:absolute;'></input>\n\t\t</div>").removeAttr("hidden"),S.tab.addClass("enabled"),S.panel.find(".clipboard")),x=(r.on("click",".panel-variables-copy",function(){var e,t=[];for(e in D.variables)e.startsWith("TwineScript")||t.push("$"+e+" to "+G(D.variables[e]));_.val("(set:"+t+")")[0].select(),document.execCommand("copy")}),W.create({className:"enchantments",tabName:"Enchantment",rowWrite:function(e,t){var n=e.scope,r=e.changer,a=e.lambda,o=e.name,i=e.localHook,a=r?f(U(r)):a?f(G(a)):"<em>enchanted with ("+o+":)</em>";return t||I('<div class="enchantment-row">').data("enchantment",e).append("<td><span class='enchantment-name'>"+G(n)+(i?"</span><span class='enchantment-local cm-harlowe-3-hookName'>"+("function"==typeof i.TwineScript_ToSource?i.TwineScript_ToSource():i.attr("name")?"?"+i.attr("name"):"an unnamed hook"):"")+"</span></td><td class='enchantment-value cm-harlowe-3-macroName-"+(r?"changer":"command")+" '>"+a+"</td>"+(r?"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>":"")).find("tw-folddown").data("folddown",g).end().add(r?I("<tr class='panel-row-source' style='display:none'><td colspan='3'></td></tr>"):"")},rowCheck:function(e,t){return t.data("enchantment")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="enchantment-name">Scope</th><th data-col="enchantment-value">Value</th></div>'}})),d=l(function(e){x.update(e.enchantments,e.enchantments.length)}),O=(q.on("add",d).on("remove",d),q.create()),A=W.create({className:"storylets",tabName:"Storylet",rowWrite:function(e,t){var n=e.name,r=e.active,a=e.storyletSource,o=e.exclusive,e=e.urgent;return t?(t.toggleClass("storylet-closed",!r),t[0].firstChild.textContent=r?"\u2713":""):(t=I('<tr class="storylet-row '.concat(r?"":"storylet-closed",'">')).attr("data-name",n).append("<td class='storylet-open'>"+(r?"\u2713":"")+"</td><td class='storylet-name'>"+n+"</td><td class='storylet-lambda'></td><td class='storylet-exclusive'>"+o+"</td><td class='storylet-urgent'>"+e+"</td>")).find(".storylet-lambda").append(B(a.replace(/^when\s+/i,""))),t},rowCheck:function(e,t){e=e.name;return t[0].getAttribute("data-name")===f(e+"")},columnHead:function(){return'<tr class="panel-head"><th data-col="storylet-open" data-order="desc">Open</th><th data-col="storylet-name">Name</th><th data-col="storylet-lambda">Condition</th><th data-col="storylet-exclusive" class=\'storylet-exclusive\'>Exclusivity</th><th data-col="storylet-urgent" class=\'storylet-urgent\'>Urgency</th></tr>'}}),C=(A.tab.hide(),v=l(function(){var r,a,o=z.getStorylets(O),i=H.containsError(o),e=z.allStorylets();A.update(e.map(function(t){var e="number"==typeof t.get("exclusivity")?t.get("exclusivity"):0,n="number"==typeof t.get("urgency")?t.get("urgency"):0;return r=r||e,a=a||e,{name:t.get("name"),storyletSource:t.get("storylet").TwineScript_ToSource(),active:!i&&o.some(function(e){return e.get("name")===t.get("name")}),exclusive:e,urgent:n}}),i?0:o.length),A.panel.toggleClass("storylet-error",i),A.panel.toggleClass("panel-exclusive",r),A.panel.toggleClass("panel-urgent",a),e.length&&A.tab.show()}),W.create({className:"source",tabName:"Source",tabNameCounter:!1,rowWrite:function(e,t){var n=e.name,e=e.tag;return t?t.add(t.next(".panel-row-source")):(t=z.get(n).get("source"),I('<div class="source-row" data-tag="'.concat(e,'">')).data("value",t).append('<td class="source-name">'.concat(n,'</td><td class="source-tags">').concat(e,"</td><td class='panel-row-buttons'><tw-folddown class='").concat(e?"":"open","' tabindex=0></tw-folddown></td>")).find("tw-folddown").data("folddown",g).end().add(I("<tr class='panel-row-source' style='".concat(e?"display:none":"","'><td colspan='3'></td></tr>")).find("td").append(!e&&B(t,"markup")).end()))},rowCheck:function(e,t){e=e.name;return t[0].firstChild.textContent===f(e+"")},tabUpdate:I.noop,columnHead:I.noop})),E=["debug-startup","startup","header","debug-header","footer","debug-footer"].reduce(function(e,t){return e.concat(z.getTagged(t).map(function(e){return{name:e.get("name"),tag:t}}))},[]),N=W.create({className:"errors",tabName:"Error",rowWrite:I.noop,rowCheck:I.noop,columnHead:I.noop,tabUpdate:function(e){return N.tab.css({background:e?"rgba(230,101,204,0.3)":""}).text("".concat(e," Error").concat(1!==e?"s":""))}}),d=n(function(e){var t;V.options.debug&&(N.panelRows.append(e.reduce(function(e,t){var t=_slicedToArray(t,2),n=t[0],t=t[1];return"propagated"===n.type?e:e+'<tr class="error-row"><td class="error-passage">'+D.passage+'</td><td class="error-message" title="'+f(t)+'">'+n.message+"</td></tr>"},"")),500<(t=(e=N.panelRows.children()).length)&&I(Array.prototype.slice.call(N.panelRows[0].childNodes,0,t-500)).remove(),N.tabUpdate(Math.min(500,e.length)))},{batch:!0}),j=(H.on(d),N.panel.append("<div class='panel-errors-bottom'>\n\t\t\t<button class='panel-errors-clean'>\ud83e\uddf9 Clear this panel</button>\n\t\t</div>"),r.on("click",".panel-errors-clean",function(){N.panelRows.empty(),N.tabUpdate(0)}),W.create({className:"tools",tabName:"Tools",tabNameCounter:!1,rowWrite:function(e,t){var n=e.id,r=e.type,a=e.label,o=e.dropdownItems,i=e.dropdownValue;return"checkbox"===r?t?t.find("input").prop("checked",!1):I('<span><input id="debug-'.concat(n,'" type="checkbox"></input><label for="debug-').concat(n,'">').concat(a,"</label></span>")):"dropdown"===r?t?t.find("input").prop("checked",!1):I("<span>".concat(a,'<select style="width:3em" data-default="').concat(i,'" id="debug-').concat(n,'"></span>')).find("select").append(o.map(function(e){return"<option value='".concat(e,"' ").concat(e===i?"selected":"",">").concat(e,"x</option>")})).end():void 0},rowCheck:I.noop,columnHead:I.noop,tabUpdate:function(e){return j.tab.css({background:e?"hsla(210, 72%, 65%, .3)":""})}})),P=(r.on("click, change",'.panel-tools [type="checkbox"], .panel-tools select',function(e){var e=e.target,t=(e=I(e)).attr("id"),n=e.is(":checked")||e.is("select")&&e.val()!==+e.attr("data-default");"debug-peekBehindDialogs"===t&&r.toggleClass("debug-dialogs",n),"debug-ignoreClickEvents"===t&&(V.options.ignoreClickEvents=n),"debug-ignoreGotos"===t&&(V.options.ignoreGotos=n),"debug-speedMultiplier"===t&&(V.options.speedMultiplier=+e.val()),j.tabUpdate(n)}),j.update([{id:"peekBehindDialogs",type:"checkbox",label:"See through and click through <code>(dialog:)</code> boxes"},{id:"ignoreClickEvents",type:"checkbox",label:"Stop links, <code>(click:)</code> and <code>(hover-style:)</code> from activating"},{id:"ignoreGotos",type:"checkbox",label:"Stop <code>(go-to:)</code>, <code>(undo:)</code>, <code>(redirect:)</code> and <code>(restart:)</code> from activating<br><small>(Click 'GO' buttons in Debug View to activate later)</small>"},{id:"speedMultiplier",label:"Speed of timed events (<code>time</code>, <code>(live:)</code>, <code>(after:)</code>): ",type:"dropdown",dropdownValue:1,dropdownItems:[.25,.5,.75,1,1.25,1.5,1.75,2,3,5,10]}]),W.create({className:"options",tabName:"\u2699\ufe0f",tabNameCounter:!1,rowWrite:function(e,t){var n=e.name,e=e.label,r={darkMode:o.darkMode,fadePanel:o.fadePanel,evalReplay:o.evalReplay}[n];return t?t.find("input").prop("checked",r):I('<span><input id="debug-'.concat(n,'" type="checkbox" ').concat(r?"checked":"",'></input><label for="debug-').concat(n,'">').concat(e,"</label></span>"))},rowCheck:I.noop,tabUpdate:I.noop,columnHead:I.noop})),R=(r.on("click",'.panel-options [type="checkbox"]',function(e){var e=e.target,t=(e=I(e)).attr("id"),e=e.is(":checked");"debug-darkMode"===t&&(o.darkMode=e,h.toggleClass("theme-dark",e)),"debug-fadePanel"===t&&(o.fadePanel=e,h.toggleClass("fade-panel",e)),"debug-evalReplay"===t&&(V.options.evalReplay=o.evalReplay=e),c()}),P.update([{name:"darkMode",label:"Debug panel is dark"},{name:"fadePanel",label:"Debug panel is transparent unless the cursor is over it"},{name:"evalReplay",label:"Record expression replays (viewable via \ud83d\udd0d buttons in Debug View; slower)"}]),h.prepend(S.panel,x.panel,N.panel,A.panel,C.panel,j.panel,P.panel),s.prepend(S.tab,x.tab,N.tab,A.tab,C.tab,j.tab,P.tab),D.on("beforeForward",y).on("beforeBack",y).on("beforeLoad",y),l(function(){T(),v(),x.panelRows.empty(),x.tabUpdate(0),D.passage&&z.get(D.passage)&&(C.update(E.concat({name:D.passage,tag:""})),C.panel.find('[data-tag=""], [data-tag=""] + .panel-row-source').insertBefore(C.panel.find('[data-tag="footer"]').first()))}));D.on("forward",R).on("back",R).on("load",R);K=b,I(document.head).append(I("<style>").html(X)),b(),e&&d(e,t)};return F.registerDebugMode(function(e,t){return!V.options.debug&&K(e,t)}),K}),define("debugmode/panel",["jquery","utils/naturalsort"],function(d,e){var i=e();return Object.seal({create:function(e){var n,t=e.className,r=e.rowWrite,a=e.rowCheck,o=e.rowSort,i=e.columnHead,s=e.tabName,c=e.tabNameCounter,l=void 0===c||c,c=e.tabUpdate,u=d("<div class='panel panel-".concat(t,"' style='").concat(this.defaultMaxHeight?"max-height:"+this.defaultMaxHeight+"px":"","' hidden><div class=\"resizer-v\"></div><table class='panel-rows'></table></div>")),p=d("<button class='tab tab-".concat(t,"'>").concat(l?"0 ".concat(s,"s"):s,"</button>"));return p.click(function(){p.toggleClass("enabled"),p.parent().siblings(".panel").attr("hidden",""),p.is(".enabled")&&(p.siblings(".tab:not(.tab-"+t+")").removeClass("enabled"),u.removeAttr("hidden"))}),u.on("click","th",function(e){var e=e.target,t="desc"===(e=d(e)).attr("data-order")?"asc":"desc";n.sort(e.attr("data-col"),t),u.find("th[data-order]").removeAttr("data-order"),e.attr("data-order",t)}),c=c||function(e){return p.text(l?"".concat(e," ").concat(s).concat(1!==e?"s":""):s)},n=Object.assign(Object.create(this),{tabName:s,tab:p,panel:u,panelRows:u.find(".panel-rows"),rowWrite:r,rowSort:o,rowCheck:a,columnHead:i,tabUpdate:c})},sort:function(r,a){var o=this;this.panelRows.children(":not(.panel-head, .panel-row-source)").get().sort(function(e,t){var n;return"desc"===a&&(e=(n=[t,e])[0],t=n[1]),e=e.querySelector("."+r),t=t.querySelector("."+r),o.rowSort&&o.rowSort(r,d(e),d(t))||i(e.textContent,t.textContent)}).forEach(function(e){var t=d(e).next(".panel-row-source").get();o.panelRows.append(e,t)})},update:function(e,t){var r=this.rowCheck,a=this.rowWrite,o=this.panelRows,n=this.columnHead,i=this.panel,s=[],c=o.children(),e=(e.forEach(function(t){var e=c.get().filter(function(e){return r(t,d(e))}),n=a(t,e.length&&d(e));e.length||o.append(n),s.push.apply(s,_toConsumableArray(n.get()))}),c.filter(function(e,t){return!s.includes(t)&&!t.className.includes("panel-head")}).remove(),this.tabUpdate(t),0<t&&!o.find(".panel-head").length?o.prepend(n()):0===t&&o.find(".panel-head").remove(),i.find("th[data-order]"));e.length&&this.sort(e.attr("data-col"),e.attr("data-order"))},defaultMaxHeight:300})}),define("internaltypes/changedescriptor",["jquery","utils","renderer","datatypes/hookset","internaltypes/twineerror"],function(b,e,t,v,n){function w(e){return("string"==typeof e?e:e.map(function(e){return e.text}).join("")).split(/\n/g).reduce(function(e,t,n,r){r=r.length;return e.concat(document.createTextNode(t),n!==r-1&&document.createElement(t.length?"br":"tw-consecutive-br"))},[])}var k=e.impossible,S=e.transitionIn,T=t.exec,r=Object.assign,p=Object.keys,a=Object.create,e=Object.seal,_=Array.isArray,x={source:"",appendSource:null,enabled:!0,enablers:null,verbatim:!1,target:null,append:"",newTargets:null,transition:"",transitionTime:null,transitionDeferred:!1,transitionDelay:0,transitionSkip:0,transitionOrigin:null,loopVars:null,styles:null,attr:null,data:null,innerEnchantments:null,section:null,timestamp:0,output:!1,summary:function(){var t=this;return["source","appendSource","enabled","verbatim","target","append","newTargets","transition","transitionTime","transitionDeferred","transitionDelay","transitionSkip","transitionOrigin","innerEnchantments","enablers","output"].filter(function(e){return hasOwnProperty.call(t,e)}).concat([this.attr.length&&"attr",this.styles.length&&"styles",p(this.loopVars).length&&"loopVars",p(this.data).length&&"data"].filter(Boolean))},create:function(e,t){e=r(a(this),{attr:this.attr?this.attr.slice():[],styles:this.styles?this.styles.slice():[],loopVars:this.loopVars||{},data:this.data||{}},e);if(t){t=t.run(e);if(n.containsError(t))return t}return e},update:function(){function e(t){var e,n,r;_(a.styles)&&0<a.styles.length&&(n=(e=_slicedToArray(a.styles.reduce(function(n,r){return p(r).forEach(function(e){var t=r[e];n[+("function"==typeof t)].push(_defineProperty({},e,t))}),n},[[],[]]),2))[0],r=e[1],n.forEach(function(e){return t.css(e)}),setTimeout(function(){r.forEach(function(e){return t.css(e)})})),a.attr&&a.attr.forEach(function(e){return t.attr(e)}),a.data&&t.data(a.data)}var a=this,t=this.section,n=this.newTargets,r=this.transition,o=this.transitionDeferred,i=this.append,s=this.target;"function"==typeof s&&(s=s());if(_(n)&&n.length&&(s=n.map(function(e){return e.target})),_(s))for(var c=0;c<s.length;c+=1)v.isPrototypeOf(s[c])?s[c].forEach(t,e):e(s[c]);else v.isPrototypeOf(s)?s.forEach(t,e):e(s);if(r&&!o&&!i){for(var l,u=s;(l=u.data("timestamp"))||(u=u.parent()),!l&&u.length;);S(s,r,this.transitionTime,this.transitionDelay,this.transitionSkip,l?Date.now()-l:0,this.transitionOrigin)}},render:function(){var e,r=this,t=this.source,n=this.transition,a=this.transitionTime,o=this.transitionDeferred,i=this.enabled,s=this.enablers,c=this.data,l=this.section,u=this.newTargets,p=this.innerEnchantments,d=this.appendSource,f=this.output,h=this.target,m=this.target,g=this.append;if("function"==typeof h&&(h=h()),!g)return k("ChangeDescriptor.render","This doesn't have an 'append' method chosen."),b();if(f)return b();if(null!=s&&s.length)return s=(f=s[0]).descriptor,f=f.changer,s=s.render(),f&&(e=x.create({section:l,target:s}),f.run(e),e.update()),s;if(!i||void 0!==h.attr("hidden"))return x.create({target:h,attr:this.attr.filter(function(e){return!("style"in e)}),data:_objectSpread(_objectSpread({},c),{},{originalSource:t,hidden:!0})}).update(),b();if(!(h=_(u)&&u.length?u:h))return k("ChangeDescriptor.render","ChangeDescriptor has source but not a target!"),b();var y=b();if([].concat(h).filter(function(e){return!e.jquery}).map(function(e){var t,n,r=g;return e.target&&e.append&&(r=(t=e).append,n=t.before,e=e.target),{elements:e.hooks(l,m).filter(function(){return!(n&&1&this.compareDocumentPosition(document)&&2&this.compareDocumentPosition(m[0]))}),append:r}},[]).forEach(function(e){var t=e.elements,n=e.append;t.each(function(e,t){t=b(t),y=y.add(r.create({target:t,append:n,newTargets:null}).render()),t.filter("tw-pseudo-hook").contents().unwrap()})}),!(y.length||_(h)||v.isPrototypeOf(h))){f=g;if(!(f in h)){if("replace"!==f)return k("ChangeDescriptor.render","The target doesn't have a '"+f+"' method."),b();f=h[0]instanceof Text?"replaceWith":(h.empty(),"append")}h[0]instanceof Text&&"prepend"===(f="append"===f?"after":f)&&(f="before"),y=b(t&&(this.verbatim?w:T)(t)),_(d)&&d.forEach(function(e){var t=e.source,e=e.append,t=b((r.verbatim?w:T)(t));y="append"===e?y.add(t):"prepend"===e?t.add(y):t}),h[f](y.length?y:void 0),h.data("timestamp",Date.now()),this.update(),n&&!o&&S("replace"===g?h:y,n,a,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),p&&p.map(function(e){return e(h)}).forEach(function(e){return l.addEnchantment(e)})}return y}};return e(x)}),define("internaltypes/enchantment",["jquery","utils","internaltypes/changedescriptor","datatypes/changercommand","utils/operationutils","internaltypes/twineerror","utils/renderutils"],function(g,y,b,v,e,w,t){var k=e.objectName,S=e.toSource,T=t.collapse;return Object.freeze({create:function(e){return Object.assign(Object.create(this),{enchantments:g()},e)},enchantScope:function(){var i=this,s=this.attr,c=this.data,l=this.functions,u=this.section,p=this.scope,d=this.localHook,f=this.lambda,h=[],m=0;p.forEach(u,function(e,t){if(d){d=d.jquery?d:d.hooks(u);var n=e.find(d);if(n.length)e=n;else if(!d.has(e[0]).length)return}var r,a,o;(!e.is(":empty")||e.data("source")&&e.data("source").length)&&(m+=1,f?(o=f.apply(u,{loop:p.TwineScript_GetProperty(t),pos:m}),w.containsError(o)?(e.replaceWith(o.render()),f=o=null):v.isPrototypeOf(o)?o.canEnchant||(e.replaceWith(w.create("macrocall",'The lambda "'.concat(S(f),"\" can't be or include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")).render()),f=o=null):(e.replaceWith(w.create("macrocall",'The lambda "'.concat(S(f),'" must return a changer, not ').concat(k(o),".")).render()),f=o=null)):o=i.changer,n=!s&&!c&&(!o||o.summary().every(function(e){return e.startsWith("transition")})),r=n?e:e.wrap("<tw-enchantment>").parent(),s&&r.attr(s),c&&r.data(c),l&&l.forEach(function(e){return e(r)}),o&&(t=b.create({section:u,target:r}),o.run(t),t.update(),e.is(y.storyElement)?(a=Object.keys(Object.assign.apply(Object,[{}].concat(_toConsumableArray(t.styles)))),e.css(a.reduce(function(e,t){return"background-color"===t||"background-image"===t?(e["background-color"]="transparent",e["background-image"]="none",a.push("background-".concat("background-color"===t?"image":"color"))):e[t]="inherit",e},{})),r.data({enchantedProperties:a})):e.is("tw-passage")&&t.styles.some(function(e){return"margin-left"in e||"margin"in e||"margin-right"in e})&&(o="padding-right",y.storyElement.css(t="padding-left","0px").css(o,"0px"),r.data({enchantedProperties:[t,o]}))),e.is(y.storyElement)&&r.css({"min-width":"100%","min-height":"100%"}),"true"===r.attr("collapsing")&&(r.find("[collapsing=false]").each(function(){g(this).removeAttr("collapsing")}),T(r)),n||h.push(r))}),this.enchantments=g(h)},disenchant:function(){this.enchantments.each(function(e,t){(t=g(t)).contents().unwrap();t=t.data("enchantedProperties");t&&y.storyElement.css(t.reduce(function(e,t){return e[t]="",e},{}))})}})}),define("internaltypes/twineerror",["jquery","utils"],function(i,s){var a=s.impossible,c=s.escape,l=(i(document.documentElement).on("click","tw-folddown",function(e){var t=e.target,e=((t=i(t)).toggleClass("open"),t.popData("folddown"));for("function"==typeof e&&e(t);t&&!t.next().length;)t=t.parent();null!=(e=t)&&e.next().toggle()}),{syntax:"The markup seems to contain a mistake.",saving:"I tried to save or load the game, but I couldn't do it.",operation:"I tried to perform an operation on some data, but the data's type was incorrect.",macrocall:"I tried to use a macro, but its call wasn't written correctly.",datatype:"I tried to use a macro, but was given the wrong type of data to it.",custommacro:"I tried to use a custom macro, but its code hook had a mistake in it.",infinite:"I almost ended up doing the same thing over and over, forever.",property:"I tried to access a value in a string/array/datamap, but I couldn't find it.",unimplemented:"I currently don't have this particular feature. I'm sorry.",propagated:"Click the 'Open' button to see the code hook as it was executed.",user:"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.",assertion:"This command exists to provide a helpful error if a certain important condition wasn't true.",debugonly:"This macro is not meant to be used outside of debugging your story."}),u=[],n={TwineError:!0,create:function(e,t,n,r){return t&&"string"==typeof t||a("TwineError.create","has a bad message string"),n||e in l||a("TwineError.create","no error explanation given"),"user"!==e&&(t=t[0].toUpperCase()+t.slice(1)),Object.assign(Object.create(this),{type:e,message:t,explanation:n,source:void 0,innerDOM:r,appendTitleText:!1})},containsError:function(){for(var e=0;e<arguments.length;e+=1){var t=arguments[e];if(n.isPrototypeOf(t))return t;if(Array.isArray(t)){t=n.containsError.apply(n,t);if(t)return t}}return!1},createWarning:function(e,t){return Object.assign(this.create(e,t),{warning:!0})},render:function(t){var n=this,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=(t="string"==typeof t?t:this.source||"",i("<tw-error class='"+(this.warning?"warning":"error")+"' title='"+c(t)+"'>"+c(this.message+(this.appendTitleText?" "+t:""))+"</tw-error>")),a=i("<tw-error-explanation>").text(this.explanation||l[this.type]).hide(),o=i("<tw-folddown tabindex=0>");return this.innerDOM&&i("<tw-open-button label='Open'>").on("click",function(){var e=i("<tw-backdrop><tw-dialog></tw-backdrop>");e.find("tw-dialog").prepend(n.innerDOM,i("<tw-link tabindex=0>OK</tw-link>").on("click",function(){n.innerDOM.detach(),e.remove()}).wrap("<tw-dialog-links>").parent()),s.storyElement.prepend(e)}).appendTo(r),r.append(o).append(a),r.data("TwineError",this),e||u.forEach(function(e){return e(n,t)}),r},on:function(e){return"function"!=typeof e||u.includes(e)||u.push(e),n}};return Object.preventExtensions(n)}),define("internaltypes/twinenotifier",["jquery","utils"],function(e,t){var n=t.impossible,r={create:function(e){return e||n("TwineNotifier.create","called with only 1 string."),Object.assign(Object.create(r),{message:e})},render:function(){return e("<tw-notifier>").attr("message",this.message)}};return Object.preventExtensions(r)}),define("internaltypes/varref",["state","internaltypes/twineerror","utils","utils/operationutils","datatypes/hookset"],function(u,p,e,t,i){var c,n=e.impossible,s=e.andList,r=e.nth,o=t.is,d=t.isObject,f=t.toSource,h=t.isSequential,m=t.objectName,l=t.typeName,g=t.clone,y=t.isValidDatamapName,b=t.subset,v=t.collectionType,w=t.unstorableValue,a=t.matches,k=Array.isArray,S={set:[],delete:[]},T="You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.), slices ('1stTo2ndlast', '3rdTo5th'), ",_="You can't access the '0th' or '0thlast' position of ";function x(e,t){if(p.containsError(t))return n;if(e instanceof Map&&(n=p.containsError(y(e,t))))return n;if(h(e))if("number"==typeof t){if(0===t)return p.create("property","You can't access elements at position 0 of ".concat(m(e),"."),"Only positive and negative position values exist.");0<t&&--t}else if("string"==typeof t&&(r=/^(\d+)(?:st|[nr]d|th)last$/i.exec(t))){if("0"===r[1])return p.create("property",_+m(e)+".");t=-r[1]}else if("string"==typeof t&&(r=/^(\d+)(?:st|[nr]d|th)$/i.exec(t))){if("0"===r[1])return p.create("property",_+m(e)+".");t=r[1]-1}else if("string"==typeof t&&(r=/^(?:(\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(t))){var n=_slicedToArray(r,5),r=n[1],r=void 0===r?0:r,a=n[2],o=n[3],o=void 0===o?0:o;t={last:n[4]?-o:o-1,first:a?-r:r-1}}else if("last"===t)t=-1;else if("random"===t){if(!e.length)return p.create("property","I can't get a random value from ".concat(m(e),", because it's empty."));t=u.random()*Array.from(e).length|0}else{if(i.isPrototypeOf(e)&&!i.TwineScript_Properties.includes(t))return p.create("property","".concat(T+s(i.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."));if(!["length","some","any","all","start","end","random"].includes(t)&&!i.isPrototypeOf(e))return p.create("property","".concat(T,"'length', 'some', 'any', 'all', 'start', 'end', and 'random' of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."))}else if(e instanceof Set){if(!["length","some","any","all"].includes(t))return p.create("property","".concat(T,"'length', 'some', 'any', and 'all' of ").concat(m(e),"."),"You can't access specific individual data values from datasets.");"length"===t&&(t="size")}else{if(k(e.TwineScript_Properties)&&!e.TwineScript_Properties.includes(t))return p.create("property","You can only get the ".concat(s(e.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."));if("number"==typeof e||"boolean"==typeof e)return p.create("property","You can't get any data values, let alone ".concat(m(t),", from ").concat(m(e)))}return t}function O(e,t){return+t<0&&Math.abs(t)<=e.length?e.length+ +t:t}var A=/[^\uD801-\uDFFF]/,C=new Map;function E(e,t){var n,r,a;return void 0===e?e:e instanceof Map?e.get(t):"some"!==t&&"any"!==t&&"all"!==t&&"start"!==t&&"end"!==t||e.TwineScript_VariableStore?("string"==typeof e&&(C.has(e)?e=C.get(e):A.test(e)?(a=_toConsumableArray(e),C.set(e,a),e=a):C.set(e,e)),h(e)&&Number.isFinite(t)&&(t=O(e,t)),e.TwineScript_GetProperty?e.TwineScript_GetProperty(t):"function"!=typeof(a=e[t])?a:void 0):(n=e,r=t,a='"'.concat(r," value").concat("any"===r?"":"s",'" of '),{determiner:r,determined:n,array:_toConsumableArray(n),string:"string"==typeof n&&n,TwineScript_ObjectName:a+m(n),TwineScript_ToSource:function(){return"".concat(r," of ").concat(f(n))},TwineScript_TypeName:a+"a data structure",TwineScript_Unstorable:!0,TwineScript_Print:function(){return"`["+this.TwineScript_TypeName+"]`"}})}function N(e){var t;return e.computed?(t=e.value,"string"==typeof(t=c.isPrototypeOf(t)?t.get():t)?"('"+t+"')":"("+t+")"):"number"==typeof e?r(e):"'"+e+"'"}function j(t,e,n){if(t.TwineScript_VariableStore){if(t.TwineScript_TypeDefs&&e in t.TwineScript_TypeDefs){var r=t.TwineScript_TypeDefs[e];if("const"===r.name){if(void 0!==t[e])return p.create("operation","I can't alter ".concat(t===u.variables?"$":"_").concat(e," because it's been restricted to a constant value."),"This variable can't be changed for the rest of the story.")}else if(!a(r,n))return p.create("operation","I can't set ".concat(t===u.variables?"$":"_").concat(e," to ").concat(l(n)," because it's been restricted to ").concat(f(r),"-type data."),"You can restrict a variable or data name by giving a typed variable to (set:) or (put:).")}return!0}return k(e)?e.map(function(e){return j(t,e)}):t instanceof Map?"string"==typeof e||p.create("operation","".concat(m(t)," can only have string data names, not ").concat(m(e),".")):h(t)?["length","random","some","any","all","start","end"].includes(e)?p.create("operation","I can't forcibly alter the '"+e+"' of "+m(t)+".","start"===e||"end"===e?"Alter the values at actual positions, like 1st or 2ndlast, rather than just the '"+e+"'.":void 0):+e==(0|e)||p.create("property",m(t)+" can only have position keys ('3rd', '1st', (5), etc.), not "+N(e)+"."):t.TwineScript_Identifiers&&e in t?p.create("keyword","I can't alter the value of the '"+e+"' identifier.","You can only alter data in variables, not fixed identifiers."):p.create("operation","I can't modify "+m(t),t instanceof Set?"You should use an (array:) if you need to modify the data inside this dataset.":i.isPrototypeOf(t)?"You should alter hooks indirectly using macros like (replace:) or (enchant:).":void 0)}function P(t,e,n,r){var a=e;t instanceof Map?t.set(e,n):(h(t)&&(e=O(t,e)),t.TwineScript_Set?t.TwineScript_Set(e,n,r):t[e]=n),S.set.forEach(function(e){return e(t,a,n)})}function R(t,e){var n=e;h(t)&&(e=O(t,e)),k(t)&&/^(?:[1-9]\d*|0)$/.exec(e)?t.splice(e,1):t instanceof Map||t instanceof Set?t.delete(e):t.TwineScript_Delete?t.TwineScript_Delete(e):delete t[e],S.delete.forEach(function(e){return e(t,n)})}function I(t,e){var n,r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e,o=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return e&&"object"===_typeof(e)&&"last"in e&&"first"in e?i.isPrototypeOf(t)?t.TwineScript_GetProperty(e):(n=e.first,r=e.last,b(t,n+(0<=n),r+(0<=r))):k(e)?i.isPrototypeOf(t)?t.TwineScript_GetProperty(e):e.map(function(e){return I(t,e,e)})["string"==typeof t?"join":"valueOf"](""):void 0!==(n=E(t,e))||o?n:t===u.variables?0:"temp"===(null==(r=t.TwineScript_VariableStore)?void 0:r.type)?p.create("property","There isn't a temp variable named _".concat(a," in this place."),"Temp variables only exist inside the same passage, hook, or lambda in which they're created."):k(t)&&"number"==typeof e?p.create("property","This array of ".concat(t.length," elements doesn't have a ").concat(N(a+("number"==typeof a?1:""))," element."),t.length?"It contains: ".concat(s(t.map(m)),"."):"The array is empty."):(o=Array.from("function"==typeof t.keys&&t.keys()),p.create("property","I can't find a ".concat(N(a)," data name in ").concat(m(t)),t instanceof Map&&o.length?"Its names include: ".concat(s(o),"."):void 0))}function V(e,t){var r=this,e=this.compiledPropertyChain.reduce(function(e,t){var n=0===e.length?r.object:I.apply(void 0,_toConsumableArray(e[e.length-1]));return e.push([n,t])&&e},[]).reduceRight(e,t);return p.containsError(e)?e:void 0}return c=Object.freeze({get:function(){for(var e=this.object,t=0;t<this.compiledPropertyChain.length-1;t+=1)if(e=I(e,this.compiledPropertyChain[t]),p.containsError(e))return e;return I(e,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},has:function(){for(var e=this.object,t=0;t<this.compiledPropertyChain.length-1;t+=1)if(void 0===(e=I(e,this.compiledPropertyChain[t],void 0,!0))||p.containsError(e))return!1;return void 0!==I(e,this.compiledPropertyChain.slice(-1)[0],void 0,!0)},set:function(e,c){var l=this;return!this.object||this.object.TwineScript_VariableStore||this.object.TwineScript_Identifiers?V.call(this,function(n,e,t){var e=_slicedToArray(e,2),r=e[0],a=e[1];if(e=p.containsError(n,r,a)||p.containsError(j(r,a,n)))return e;if(e=w(n))return p.create("operation","".concat(m(n)," can't be stored").concat(!n.TwineScript_Unstorable&&v(n)?" because it holds ".concat(m(e)):"","."));if(0<t)r=g(r);else if("temp"===(null==(e=r.TwineScript_VariableStore)?void 0:e.type)&&r!==u.variables){for(var o=r;"temp"===(null==(i=o.TwineScript_VariableStore)?void 0:i.type)&&!hasOwnProperty.call(o,a);)var i,o=Object.getPrototypeOf(o);"temp"===(null==(t=o.TwineScript_VariableStore)?void 0:t.type)&&(r=o)}if("string"==typeof r){if("string"!=typeof n)return p.create("datatype","I can't put this non-string value, ".concat(m(n),", in a string."));if(n.length!==(k(a)?a.length:1))return p.create("datatype","".concat(m(n),"is not the right length to fit into this string location."));var r=_toConsumableArray(r),s=_toConsumableArray(n);[].concat(a).forEach(function(e){0+e<0&&(e=r.length+(0+e)),r=[].concat(_toConsumableArray(r.slice(0,e)),[s.shift()],_toConsumableArray(r.slice(e+1)))}),r=r.join("")}else d(r)&&(void 0!==n.TwineScript_KnownName&&((n=""!==n.TwineScript_KnownName?g(n):n).TwineScript_KnownName=f(l)),k(a)&&h(n)?("string"==typeof n&&(n=_toConsumableArray(n)),a.map(function(e,t){return[e,n[t]]}).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];return P(r,t,e,c)})):P(r,a,n,c));return r},e):p.create("macrocall","I can't (set:) ".concat(m(this),", if the ").concat((m(this.object).match(/ (.+$)/)||["","value"])[1]," isn't stored in a variable."),"Modifying data structures that aren't in variables won't change the game state at all.")},delete:function(){return V.call(this,function(e,t,n){var r,t=_slicedToArray(t,2),a=t[0],t=t[1];return(r=p.containsError(e,a,t)||p.containsError(j(a,t)))||(0<n&&(a=g(a)),null===e?((r="string"==typeof a)&&(a=_toConsumableArray(a)),k(t)?(h(a)&&(t=_toConsumableArray(new Set(t))).sort(function(e,t){return O(a,t)-O(a,e)}),t.forEach(function(e){return R(a,e)})):R(a,t),r&&(a=a.join(""))):P(a,t,e,!1),a)},null)},defineType:function(e){var t=this.object,n=this.compiledPropertyChain[0],r=(hasOwnProperty.call(t,"TwineScript_TypeDefs")||(t.TwineScript_TypeDefs=Object.create(t.TwineScript_TypeDefs||null)),t.TwineScript_TypeDefs),a=r[n];if(a&&!o(a,e))return p.create("operation","I can't redefine the type of "+m(this)+" to "+(e.TwineScript_ObjectName||l(e))+", as it is already "+(a.TwineScript_ObjectName||l(a))+".");t.TwineScript_DefineType?t.TwineScript_DefineType(n,e):r[n]=e,"const"===e.name&&(t[n]=void 0)},matches:function(e,t){return this.object===e&&this.compiledPropertyChain[0]===t},getName:function(){return this.compiledPropertyChain[0]},create:function(e,t){var n;if(n=p.containsError(e))return n;Array.isArray(t)||(t=[].concat(t)),c.isPrototypeOf(e)&&(t=e.propertyChain.concat(t),e=e.object);var r=function(e,t){for(var n,r=[],a=0;a<t.length;a+=1){var o=t[a];if(o.computed&&(o=o.value),c.isPrototypeOf(o)&&(o=o.get()),k(o)){for(var i=[],s=0;s<o.length;s+=1)i[s]=x(e,o[s]);o=i}else o=x(e,o);if(n=p.containsError(o))return n;a<t.length-1&&(e=I(e,o)),r.push(o)}return r}(e,t);return(n=p.containsError(r))||Object.assign(Object.create(c),{object:e,propertyChain:t,compiledPropertyChain:r})},TwineScript_ToSource:function(){function r(e,t){return!t&&n.object.TwineScript_VariableStore?e:N(e)}var e,n=this;return(this.object===u.variables?"$":"temp"===(null==(e=this.object.TwineScript_VariableStore)?void 0:e.type)?"_":f(this.object)+"'s ")+(1===this.propertyChain.length?r(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,n){return e+"'s "+r(t,n)}))},get TwineScript_ObjectName(){var e;return this.object.TwineScript_VariableStore?"the ".concat("temp"===(null==(e=this.object.TwineScript_VariableStore)?void 0:e.type)?"temp ":"","variable ").concat(this.TwineScript_ToSource()):m(this.object)+"'s "+(1===this.propertyChain.length?N(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,n){return e+"'s "+N(t)}))},on:function(e,t){if(e in S)return"function"!=typeof t||S[e].includes(t)||S[e].push(t),c;n("VarRef.on","invalid event name")}})}),define("internaltypes/varscope",[],function(){return Object.seal({TwineScript_ObjectName:"the temporary variables",TwineScript_VariableStore:{type:"temp",name:"an unknown scope"},TwineScript_TypeDefs:Object.create(null)})}),define("macrolib/commands",["jquery","macros","utils","state","passages","engine","internaltypes/twineerror","internaltypes/twinenotifier","datatypes/assignmentrequest","datatypes/hookset","datatypes/codehook","datatypes/colour","datatypes/gradient","internaltypes/varref","datatypes/typedvar","datatypes/varbind","utils/operationutils","utils/renderutils"],function(u,n,y,c,l,a,b,M,e,o,t,p,d,i,s,v,r,f){var h=r.printBuiltinValue,m=r.objectName,g=r.clone,w=r.toSource,k=f.dialog,S=f.geomParse,D=f.geomStringRegExp,r=n.TypeSignature,f=r.Any,F=r.Everything,T=r.rest,_=r.either,x=r.optional,O=r.zeroOrMore,L=r.percent,H=r.nonNegativeInteger,A=r.positiveInteger,r=r.positiveNumber,C=Object.assign,E=Math.floor,N=Math.ceil,j=Math.abs,z=Math.max,q=Math.min,P=u.noop;function R(e){return"(".concat(e," ").concat(y.options.ifid,") ")}["set","put","unpack"].forEach(function(r){return n.add(r,"Instant",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if("into"===n.operator&&"set"===r)return b.create("macrocall","Please say 'to' when using the (set:) macro.");if("to"===n.operator&&"set"!==r)return b.create("macrocall","Please say 'into' when using the (put:) or (unpack:) macro.");if((i.isPrototypeOf(n.dest)||s.isPrototypeOf(n.dest))===("unpack"===r))return b.create("macrocall","unpack"===r?"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.":"Please use the (".concat(r,":) macro with just single variables and typed variables to the ").concat("set"===r?"left of 'to'.":"right of 'into'."),"You may wish to change this to the (".concat("unpack"!==r?"unpack":"to"===n.operator?"set":"put",":) macro."));n=n.set();if(b.containsError(n))return n}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (".concat(r,":) operation"),TwineScript_ObjectName:"a (".concat(r,":) operation"),TwineScript_Unstorable:!0,TwineScript_Print:function(){return y.options.debug,""}}},[T(e)])}),n.add("move","Instant",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if("into"!==n.operator)return b.create("macrocall","Please say 'into' when using the (move:) macro.");n=n.set(!0);if(b.containsError(n))return n}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (move:) operation",TwineScript_ObjectName:"a (move:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return y.options.debug,""}}},[T(e)]),n.addCommand("display",function(e){if(!l.hasValid(e))return b.create("macrocall","I can't (display:) the passage '".concat(e,"' because it doesn't exist."))},function(e,t,n){return e.source=l.getTree(n),e},[String])("print",P,function(e,t,n){return C(e,{source:h(n)})},[f])(["verbatim-print","v6m-print"],P,function(e,t,n){return C(e,{verbatim:!0,source:h(n)})},[f])(["verbatim-source","v6m-source"],function(e){if("command"===(null==e?void 0:e.TwineScript_TypeID)&&!e.TwineScript_ToSource)return b.create("datatype","I can't construct the source code of a command created by a custom macro.")},function(e,t,n){return C(e,{verbatim:!0,source:h(w(n))})},[f])("go-to",function(e){if(!l.hasValid(e))return b.create("macrocall","I can't (go-to:) to the passage '".concat(e,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,t,n){if(!y.options.ignoreGotos)return requestAnimationFrame(function(){return a.goToPassage(n,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("redirect",function(e){if(!l.hasValid(e))return b.create("macrocall","I can't (redirect:) to the passage '".concat(e,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,t,n){if(!y.options.ignoreGotos)return requestAnimationFrame(function(){return a.redirect(n,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("undo",P,function(e,t,n){return c.pastLength<1?C(e,{source:n}):y.options.ignoreGotos?void 0:(requestAnimationFrame(function(){return a.goBack({transition:e.data.passageT8n})}),{blocked:!0})},[x(String)])("debug",P,a.enableDebugMode,[],!1),y.onStartup(function(){return y.storyElement.on("click.icon","tw-icon",function(e){var t=u(this),n=t.data("clickEvent"),r=t.attr("alt");n&&n(t),"Undo"===r&&(e.stopPropagation(),a.goBack()),"Redo"===r&&(e.stopPropagation(),a.goForward()),"Fullscreen"===r&&(e.stopPropagation(),a.toggleFullscreen()),"Restart"===r&&(c.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload())})}),[["Undo","&#8630;",function(){return 0<c.pastLength}],["Redo","&#8631;",function(){return 0<c.futureLength}],["Fullscreen","&#9974;",function(){return document.fullscreenEnabled||document.msFullscreenEnabled}],["Restart","&#10226;",Object]].forEach(function(e){var e=_slicedToArray(e,3),o=e[0],i=e[1],s=e[2];n.addCommand("icon-".concat(o.toLowerCase()),function(e,t){if("string"==typeof e&&"string"==typeof t)return e=_toConsumableArray(e).length,t=_toConsumableArray(t).length,1<e&&1<t?b.create("datatype","One of the two strings given to (icon-".concat(o.toLowerCase(),":) should be 1 character long, for its icon.")):1===e&&1===t?b.create("datatype","One of the two strings given to (icon-".concat(o.toLowerCase(),":) should be 2 or more characters long, for its label.")):void 0},function(t,e,n,r){var a;return("string"==typeof r&&1===_toConsumableArray(r).length||"string"==typeof n&&1<_toConsumableArray(n).length)&&(n=(a=[r,n])[0],r=a[1]),"Undo"===o&&(t.data.forgetUndosEvent=function(e){t.section.whenUnblocked(function(){return u(e).css("visibility","hidden")})}),C(t,{source:'<tw-icon tabindex=0 alt="'.concat(o,'" ').concat(r?'data-label="'.concat(r.replace('"',"&quot;"),'"'):"",' title="').concat(o,'" ').concat(s()?"":'style="visibility:hidden"',">").concat(n||i,"</tw-icon>")})},[x(String),x(String)])}),n.addCommand("icon-counter",function(e,t,n){var r=" label string given to (icon-counter:) can't be empty or only whitespace.";return t&&t.trim()?"string"!=typeof n||n.trim()?void 0:b.create("datatype","The 2nd "+r):b.create("datatype","The 1st "+r)},function(r,e,a,o,i){r.attr.push({"data-2bind":!0}),r.data.twoWayBindEvent=function(e,t,n){a.varRef.matches(t,n)&&"number"==typeof(t=a.varRef.get())&&r.target.children("tw-icon").text((0<t?E:N)(t)).attr("data-label",1!==j(t)&&void 0!==i?i:o)};var t=a.varRef.get();return"number"!=typeof t?b.create("datatype","(icon-counter:) can only be bound to a variable holding a number, not ".concat(m(t),".")):C(r,{source:'<tw-icon data-label="'.concat(y.escape(1!==j(t)&&void 0!==i?i:o),'">').concat((0<t?E:N)(t),"</tw-icon>")})},[v,String,x(String)]),n.addCommand("meter",function(e,t,n,r){return"two way"===e.bind?b.create("datatype","(meter:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".'):"string"!=typeof r||r.trim()?-1===n.search(D)||!n.includes("=")&&1<n.length?b.create("datatype",'The (meter:) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not '+JSON.stringify(n)+"."):void 0:b.create("datatype","The label string given to (meter:) can't be empty or only whitespace.")},function(r,e,a,n,t,o,i){o&&"string"!=typeof o&&(i=o,o=void 0),i=i||p.create({h:0,s:0,l:.5,a:.5}),p.isPrototypeOf(i)&&(i=d.create(90,[{colour:i,stop:0},{colour:i,stop:1}]));function s(e){var t=z(0,q(1,e/n)),e=i.repeating?i:i.multiply(n/e);return"height:100%;background-repeat:no-repeat;background-image:".concat((l?C(e,e.repeating?{}:{angle:270}).toLinearGradientString()+", ":"")+C(e,e.repeating?{}:{angle:l||0===c?90:270}).toLinearGradientString(),";background-size:").concat(l?Array(2).fill(50*t+"%"):100*t+"%",";background-position-x:").concat(l?-100/(2-t)+100+"%,"+100/(2-t)+"%":0===c?"left":"right",";text-align:").concat(l?"center":0===c?"left":"right")}var t=S(t),c=t.marginLeft,t=t.size,l=0<c&&Math.ceil(c+t)<100,u=(r.styles.push({"margin-left":c+"%",width:t+"%",height:"1.5em",display:"block"}),r.attr.push({"data-2bind":!0}),o&&e.stackTop.tempVariables),t=(r.data.twoWayBindEvent=function(e,t,n){a.varRef.matches(t,n)&&"number"==typeof(t=a.varRef.get())&&((n=r.target.children("tw-meter")).attr("style",s(t)),o)&&r.section.renderInto("",null,{source:o,target:n,append:"replace",transitionDeferred:!1},u)},a.varRef.get());return"number"!=typeof t?b.create("datatype","(meter:) can only be bound to a variable holding a number, not ".concat(m(t),".")):C(r,{source:'<tw-meter style="'.concat(s(t),'">').concat(o||"","</tw-meter>")})},[v,r,String,x(_(String,p,d)),x(_(p,d))]),[["cycling-link"],["seq-link","sequence-link"]].forEach(function(t,u){return n.addCommand(t,function(){var e;return""===(arguments.length<=0?void 0:arguments[0])?b.create("datatype","The first string in a ("+t[0]+":) can't be empty."):arguments.length<=(v.isPrototypeOf(arguments.length<=0?void 0:arguments[0])?2:1)?b.create("datatype","I need two or more strings to "+(u?"sequence":"cycle")+" through, not just '"+((e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e])+"'."):void 0},function(a,e){for(var o,t=arguments.length,i=new Array(2<t?t-2:0),n=2;n<t;n++)i[n-2]=arguments[n];v.isPrototypeOf(i[0])&&(o=i.shift());var s=0,c=("two way"===(null==(l=o)?void 0:l.bind)&&(a.attr.push({"data-2bind":!0}),-1<(l=i.indexOf(o.varRef.get())))&&(s=l),e.stackTop.tempVariables);function r(e,t){var n=s>=i.length-1&&u,r=""===i[s]?"":n?i[s]:"<tw-link>".concat(i[s],"</tw-link>");if(n&&(a.data.clickEvent=void 0),o&&!t){n=o.set(i[s]);if(b.containsError(n))return void e.replaceWith(n.render(i[s]))}t=_objectSpread(_objectSpread({},a),{},{source:r,transitionDeferred:!1});a.section.renderInto("",null,t,c)}i[s]&&(a.data.clickEvent=function(e){s=(s+1)%i.length,r(e,!1)},a.data.twoWayBindEvent=function(e,t,n){o.varRef.matches(t,n)&&(t=o.varRef.get(),-1<(n=i.indexOf(t)))&&n!==s&&(s=n,r(e,!0))});var l="<tw-link>".concat(i[s],"</tw-link>");if(o){e=o.set(i[s]);if(b.containsError(e))return e}return C(a,{source:l,append:"replace",transitionDeferred:!0})},[_(v,String),T(String)])}),y.onStartup(function(){return y.storyElement.on("change.dropdown-macro","select",function(){var e=u(this),t=e.closest("tw-expression, tw-hook").data("dropdownEvent");t&&t(e)})}),n.addCommand("dropdown",function(e){var t;return""===(arguments.length<=1?void 0:arguments[1])||""===((t=(arguments.length<=1?0:arguments.length-1)-1+1)<1||arguments.length<=t?void 0:arguments[t])?b.create("datatype","The first or last strings in a (dropdown:) can't be empty.","Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense."):(arguments.length<=1?0:arguments.length-1)<=1?b.create("datatype","I need two or more strings to create a (dropdown:) menu, not just "+(arguments.length<=1?0:arguments.length-1)+"."):void 0},function(e,t,r){for(var n=arguments.length,a=new Array(3<n?n-3:0),o=3;o<n;o++)a[o-3]=arguments[o];var i=0,s=("two way"===r.bind&&(e.attr.push({"data-2bind":!0}),-1<(c=a.indexOf(r.varRef.get())))&&(i=c),Math.max.apply(Math,_toConsumableArray(a.map(function(e){return _toConsumableArray(e).length})))),c="<select>"+a.map(function(e,t){return"<option".concat(t===i?" selected":"").concat(""===e?" disabled":"",">").concat(y.escape(e||"\u2500".repeat(s)),"</option>")}).join("\n")+"</select>",l=(e.data.dropdownEvent=function(e){var t=e.val(),n=r.set(t);b.containsError(n)&&e.replaceWith(n.render(t))},e.data.twoWayBindEvent=function(e,t,n){r.varRef.matches(t,n)&&(t=r.varRef.get(),-1<(n=a.indexOf(t)))&&n!==i&&(e.find("select").val(t),i=n)},e.styles.push({"background-color":function(){return y.parentColours(u(this)).backgroundColour}}),r.set(a[i]));return b.containsError(l)?l:C(e,{source:c,append:"replace"})},[v,String,T(String)]),y.onStartup(function(){return y.storyElement.on("input.checkbox-macro","input[type=checkbox]",function(){var e=u(this),t=e.closest("tw-expression").data("checkboxEvent");t&&t(e)})});function I(e){return["I can't use a dialog macro in "+e+".","Please rewrite this without putting such macros here."]}var V=1;n.addCommand("checkbox",function(){},function(e,t,r,n){var a=!1,o="checkbox-"+ ++V,i=("two way"===r.bind&&(e.attr.push({"data-2bind":!0}),"boolean"==typeof(i=r.varRef.get())&&(a=i),e.data.twoWayBindEvent=function(e,t,n){r.varRef.matches(t,n)&&"boolean"==typeof(t=r.varRef.get())&&e.children("input[type=checkbox]").prop("checked",t)}),e.data.checkboxEvent=function(e){var t=e.is(":checked"),t=r.set(t);b.containsError(t)&&e.replaceWith(t.render(""))},r.set(a));return b.containsError(i)?i:C(e,{source:'<input id="'.concat(o,'" type="checkbox" ').concat(a?"checked":"",'><label for="').concat(o,'">').concat(n,"</label>"),append:"replace"})},[v,String]),y.onStartup(function(){return u(document).on("fullscreenchange",function(){u("input[type=checkbox][id^=fullscreen]",y.storyElement).each(function(e,t){(u(t).closest("tw-expression").data("fullscreenEvent")||Object)(t)})})}),n.addCommand("checkbox-fullscreen",function(){},function(e,t,n){var r="fullscreenCheckbox-"+ ++V;return e.data.fullscreenEvent=function(e){return u(e).prop("checked",!(!document.fullscreenElement&&!document.msFullscreenElement))},e.data.checkboxEvent=function(){return a.toggleFullscreen()},C(e,{source:'<input id="'.concat(r,'" type="checkbox" ').concat(document.fullscreenEnabled||document.msFullscreenEnabled?" ":"disabled ").concat(document.fullscreenElement||document.msFullscreenElement?"checked":"",'><label for="').concat(r,'">').concat(n,"</label>"),append:"replace"})},[String]),y.onStartup(function(){return y.storyElement.on("input.input-box-macro","textarea, input[type=text]",function(){var e=u(this),t=e.closest("tw-expression").data("inputBoxEvent");t&&t(e)})}),["input","force-input","input-box","force-input-box"].forEach(function(g){return n.addCommand(g,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=g.endsWith("box"),a=v.isPrototypeOf(t[0]),o="string"==typeof t[+a],r=r&&"number"==typeof t[o+a],i=o?t[+a]:t[a+r],s=0<S(i).size,o=s?t[a+r+o]:i;return g.startsWith("force")&&"string"!=typeof o?b.create("datatype","The (".concat(g,":) macro requires a string of text to forcibly input.")):t.length>a+r+s+("string"==typeof o)?b.create("datatype","An incorrect combination of values was given to this (".concat(g,":) macro.")):void 0},function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o=g.startsWith("force"),i=g.endsWith("box"),s=v.isPrototypeOf(r[0]),c="string"==typeof r[+s],l=i&&"number"==typeof r[c+s],u=s&&r[0],p=l?r[1+s]:3,d=c?S(r[+s]):{},f=d.marginLeft,d=d.size,h=(d?r[s+l+c]:c&&r[+s])||"",l=o?"":h,c=!1;if("two way"===u.bind){e.attr.push({"data-2bind":!0});s=u.varRef.get();if("string"==typeof s){l=o?h.slice(0,s.length):s,s=u.set(l),c=!0;if(b.containsError(s))return s}e.data.twoWayBindEvent=function(e,t,n){u.varRef.matches(t,n)&&"string"==typeof(t=u.varRef.get())&&e.find(i?"textarea":"input").val(o?h.slice(0,t.length):t)}}if(u&&!c){s=u.set(o?"":h);if(b.containsError(s))return s}!o&&u&&(e.data.inputBoxEvent=function(e){var t=e.val(),t=u.set(t);b.containsError(t)&&e.replaceWith(t.render(""))});var m,c="<".concat(i?"textarea":"input type=text",' style="width:100%" ').concat(i?"rows=".concat(p,">"):'value="').concat(y.escape(l)).concat(i?"</textarea>":'">');return o&&(m=Array.from(h),e.data.inputBoxEvent=function(e){var t=e.val().length,t=m.slice(0,t).join("");return e.val(t),u&&(t=u.set(t),b.containsError(t))&&e.replaceWith(t.render("")),!0}),e.styles.push({display:"block","margin-left":d?f+"%":void 0,width:d?d+"%":"100%","border-style":function(){return this.style.borderStyle||"solid"}}),C(e,{source:c,append:"replace"})},g.endsWith("box")?[_(v,String),x(_(A,String)),x(_(A,String)),x(String)]:[x(_(v,String)),x(String),x(String)])}),["show","rerun"].forEach(function(s){return n.addCommand(s,function(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function e(t){var n=t.selector,t=t.next;return"name"===n.type&&"page"===n.data?(r=b.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===n.type&&e(n.data)||t&&e(t))||void 0}),r},function(o,i){for(var e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return t.forEach(function(e){return e.forEach(i,function(e){var t,n,r,a=e.data("hidden");void 0!==a!=("rerun"===s)&&(e.removeData("hidden"),a instanceof u?e.empty().append(a):(a=e.data("tempVariables"),n=(t="tw-passage"===e.tag())?l.getTree(c.passage):e.data("originalSource")||"",t&&(r=e.find("tw-sidebar").detach()),i.renderInto("",null,_objectSpread(_objectSpread({},o),{},{append:"replace",source:n,target:e}),a&&Object.create(a)),r&&e.prepend(r)))})}),o},[T(o)])});n.addCommand("hide",function(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function e(t){var n=t.selector,t=t.next;return"name"===n.type&&"page"===n.data?(r=b.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===n.type&&e(n.data)||t&&e(t))||void 0}),r},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,o=n;a<o.length;a++)o[a].forEach(e,function(e){e.data("hidden")||e.data("hidden",e.contents().detach())})},[T(o)],!1)("scroll",P,function(h,e,m){var g="number"==typeof m&&m;requestAnimationFrame(function(){e.forEach(h,function(e){if(!1!==g){var t,n;null!=(t=(n=(e=e[0]===y.storyElement[0]&&e[0].scrollHeight===e[0].clientHeight?[document.body]:e)[0]).scrollTo)&&t.call(n,0,(e[0].scrollHeight-e[0].clientHeight)*g)}else{var r,a=_createForOfIteratorHelper(m.hooks(h).get());try{for(a.s();!(r=a.n()).done;){var o=r.value;if(e.find(o)){for(var i=[],s=e[0];(s=s.parentNode)&&s!==document.body;)i.push([s,s.scrollLeft,s.scrollTop]);o.scrollIntoView();for(var c=0,l=i;c<l.length;c++){var u=_slicedToArray(l[c],3),p=u[0],d=u[1],f=u[2];p.scrollLeft=d,p.scrollTop=f}break}}}catch(e){a.e(e)}finally{a.f()}}})})},[o,_(L,o)],!1)("stop",P,P,[],!1)("load-game",P,function(e,t){var n,r;return e.loadedGame?b.create("infinite","I can't use (load-game:) immediately after loading a game."):(n=localStorage.getItem(R("Saved Game")+t))?(n=c.deserialise(e,n))instanceof Error?{blocked:r=k({message:"Sorry to interrupt... The story tried to load saved data, but there was a problem.\n"+n.message+"\n\nThat data might have been saved from a different version of this story. Should I delete it?\n(Type 'delete' and choose Yes to delete it.)\n\nEither way, the story will now continue without loading the data.",defaultValue:"",buttons:[{name:"Yes",confirm:!0,callback:function(){"delete"===r.find("input").last().val()&&localStorage.removeItem(R("Saved Game")+t),e.unblock("")}},{name:"No",cancel:!0,callback:function(){return e.unblock()}}]})}:void requestAnimationFrame(a.showPassage.bind(a,c.passage,{loadedGame:!0})):b.create("saving","I can't find a save slot named '"+t+"'!")},[String],!1)("forget-undos",P,function(e,t){c.futureLength||c.forgetUndos(t)},[parseInt],!1)("forget-visits",P,function(e,t){c.forgetVisits(t)},[parseInt],!1)("mock-visits",function(){if(!y.options.debug)return b.create("debugonly","(mock-visits:) cannot be used outside of debug mode.");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.find(function(e){return!l.hasValid(e)});return r?b.create("datatype","I can't mock-visit '"+r+"' because no passage with that name exists."):void 0},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];c.mockVisits=g(n)},[T(String)],!1)("mock-turns",function(){if(!y.options.debug)return b.create("debugonly","(mock-turns:) cannot be used outside of debug mode.")},function(e,t){c.mockTurns=t},[H],!1)("seed",P,function(e,t){c.setSeed(t)},[String],!1)(["dialog","alert"],function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(v.isPrototypeOf(e)){if("two way"===e.bind)return b.create("datatype","(dialog:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".');if(void 0===t)return b.create("datatype","(dialog:) needs a message string or codehook to display.")}else void 0!==t&&r.unshift(t);e=r.findIndex(function(e){return""===e});if(-1<e)return b.create("datatype","(dialog:)'s ".concat(y.nth(e+1)," link text shouldn't be an empty string."))},function(e,n,r,t){for(var a=arguments.length,o=new Array(4<a?a-4:0),i=4;i<a;i++)o[i-4]=arguments[i];return v.isPrototypeOf(r)||(void 0!==t&&o.unshift(t),t=r,r=void 0),o.length||(o=["OK"]),{blocked:k({section:n,message:t,cd:e,buttons:o.map(function(t){return{name:t,callback:function(){var e;n.unblock((null==(e=r)?void 0:e.set(t))||"")}}})})}},[_(v,String,t),x(_(t,String)),O(String)])("open-url",P,function(e,t){window.open(t,"")},[String],!1)(["restart","reload"],P,function(){if(!y.options.ignoreGotos){if(c.turns<=1)return b.create("infinite","I mustn't (restart:) the story in the starting passage.");c.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload()}},[],!1)("goto-url",P,function(e,t){window.location.assign(t)},[String],!1)("ignore",P,P,[O(F)])("assert-exists",function(e){if(""===e)return b.create("datatype","(assert-exists:) mustn't be given an empty string.")},function(e,t,n){var r=0;return("string"==typeof n?o.create({type:"string",data:n}):n).forEach(t,function(){++r}),r?e:b.create("assertion","I didn't see any ".concat("string"==typeof n?"text occurrences of":"hooks matching"," ").concat(w(n)," in this passage."))},[_(o,String)]),n.add("assert","Instant",function(e,t){return t?{TwineScript_TypeID:"instant",TwineScript_TypeName:"an (assert:) operation",TwineScript_ObjectName:"an (assert:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}:C(b.create("assertion","An assertion failed: "),{appendTitleText:!0})},[Boolean])("save-game","Boolean",function(e,t,n){if(n=n||"",!c.hasStorage)return!1;var r=c.serialise(!1).pastAndPresent;if(b.containsError(r))return r;if(!1===r)return!1;try{return localStorage.setItem(R("Saved Game")+t,r),localStorage.setItem(R("Saved Game Filename")+t,n),!0}catch(e){return!1}},[String,x(String)])("prompt","String",function(e,t,n,r,a){var o,i;return null!=(o=e.stackTop)&&o.evaluateOnly?b.create.apply(b,["macrocall"].concat(_toConsumableArray(I(e.stackTop.evaluateOnly)))):""===a?b.create("datatype","The text for (prompt:)'s confirm link can't be blank."):(i=k({section:e,message:t,defaultValue:n,buttons:[{name:a||"OK",confirm:!0,callback:function(){return e.unblock(i.find("input").last().val())}}].concat(""===r?[]:{name:r||"Cancel",cancel:!0,callback:function(){return e.unblock(n)}})}),e.stackTop.blocked=i,0)},[_(String,t),String,x(String),x(String)])("confirm","Boolean",function(e,t,n,r){var a;return null!=(a=e.stackTop)&&a.evaluateOnly?b.create.apply(b,["macrocall"].concat(_toConsumableArray(I(e.stackTop.evaluateOnly)))):""===r?b.create("datatype","The text for (confirm:)'s confirm link can't be blank."):(a=k({section:e,message:t,defaultValue:!1,buttons:[{name:r||"OK",confirm:!0,callback:function(){return e.unblock(!0)}}].concat(""===n?[]:{name:n||"Cancel",cancel:!0,callback:function(){return e.unblock(!1)}})}),e.stackTop.blocked=a,0)},[_(String,t),x(String),x(String)])("page-url","String",function(){return window.location.href},[])}),define("macrolib/custommacros",["utils","macros","state","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/codehook","datatypes/typedvar","internaltypes/twineerror"],function(c,l,u,e,t,p,n,d,f){function s(e,t,n){if(!t.some(function(e){if("function"==typeof e.output)return e.output(n),!0}))return f.create("macrocall","("+e+":) should only be used inside a code hook passed to (macro:).")}var h=e.objectName,m=e.toSource,e=l.add,r=l.addChanger,a=l.addCommand,o=l.TypeSignature,i=o.rest,g=o.either,y=o.Any,b=o.Everything,o=o.zeroOrMore;e("macro","CustomMacro",function(e){for(var t,n=[],r=arguments.length,a=new Array(1<r?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];for(t=0;t<a.length;t+=1){var i=t===a.length-1;if(d.isPrototypeOf(a[t])===i)return f.create("datatype","The "+(i?"":c.nth(a.length-t+1)+"-")+"last value given to (macro:) should be a "+(i?"code hook":"datatyped variable")+", not "+h(a[t]));if(!i){i="A custom macro";if(a[t].varRef.object===u.variables)return f.create("datatype",i+"'s typed variables must be temp variables (with a '_'), not global variables (with a '$').","Write them with a _ symbol at the start instead of a $ symbol.");if(1<a[t].varRef.propertyChain.length)return f.create("datatype",i+"'s typed variables can't be properties inside a data structure.");if(a[t].datatype.rest&&t!==a.length-2)return f.create("datatype",i+" can only have one spread variable, and it must be its last variable.");var s=a[t].varRef.propertyChain[0];if(n.includes(s))return f.create("datatype",i+"'s typed variables can't both be named '"+s+"'.");n.push(s)}}return p.create(a.slice(0,-1),a[a.length-1])},[i(g(d,n))]);a(["output-data","out-data"],function(){},function(e,t){e=e.stack;return s("output-data",e,t)||{blocked:!0}},[y],!1),r(["output","out"],function(){return Object.assign(t.create("output",[]))},function(e,t){if(e.section){var n,r=e.section,a=r.stack,o=r.stackTop,i={};for(n in o.tempVariables)n.startsWith("TwineScript_")||(i[n]=o.tempVariables[n]);s("output",a,{changer:t,variables:i,hook:Array.isArray(e.source)?"["+e.source.map(function(e){return e.text}).join("")+"]":e.source}),e.output=!0,o.blocked=!0}},[]),a("error",function(e){if(!e)return f.create("datatype","This (error:) macro was given an empty string.")},function(e,t){e=e.stack;return s("error",e,f.create("user",t))||{blocked:!0}},[String],!1),e("partial","CustomMacro",function(e,a){for(var t=arguments.length,o=new Array(2<t?t-2:0),n=2;n<t;n++)o[n-2]=arguments[n];var r="string"!=typeof a&&a,i=!r&&a;if(!r){if(!l.has(i))return f.create("macrocall",'The macro name given to (partial:), "'.concat(a,"\", isn't the name of a built-in macro."));if("Metadata"===l.get(i).returnType)return f.create("macrocall","(partial:) can't be used with metadata macros such as (".concat(a,":)"))}var s="(partial:".concat(m(a),",").concat(o.map(function(e){return m(e)}),")"),c=p.createFromFn(function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=l["string"==typeof a?"run":"runCustom"](a,e,o.concat(n));return f.containsError(e)&&(e.message="An error occurred while running the (partial:)-created macro, ".concat(c.TwineScript_ObjectName,":\n")+e.message),e},"a (partial:) custom macro of ".concat(i||r.TwineScript_KnownName?"(".concat(i||r.TwineScript_KnownName,":").concat(o.map(function(e){return m(e)}),")"):"another unnamed custom macro"),function(){return s},(i?l.get(i):r).typeSignature.filter(function(e,t){return t>=o.length||"rest"===e.pattern||"zero or more"===e.pattern}));return c},[g(String,p),o(b)])}),define("macrolib/datastructures",["utils","utils/naturalsort","macros","utils/operationutils","state","engine","passages","datatypes/lambda","datatypes/typedvar","internaltypes/twineerror"],function(e,i,t,n,s,r,a,c,o,l){var u=e.permutations,p=e.options,d=n.objectName,f=n.subset,h=n.collectionType,m=n.isValidDatamapName,g=n.is,y=n.unique,b=n.clone,v=n.range,e=t.TypeSignature,n=e.optional,w=e.rest,k=e.either,S=e.zeroOrMore,T=e.Any,e=e.nonNegativeInteger,_=i("en");t.add(["a","array"],"Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n},S(k(o,T)))("range","Array",function(e,t,n){return v(t,n)},[parseInt,parseInt])("subarray","Array",function(e,t,n,r){return f(t,n,r)},[Array,parseInt,parseInt])("reversed","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reverse().map(b)},S(T))("shuffled","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.shuffled.apply(s,n).map(b)},[S(T)])("sorted","Array",function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(!c.isPrototypeOf(r[0]))return(t=r.filter(function(e){return"string"!=typeof e&&"number"!=typeof e}))&&t.length?1===t.length&&Array.isArray(t[0])?l.create("macrocall","Please give multiple numbers or strings to (sorted:), not a single array.","You can use the spread ... syntax to spread out the array's values into (sorted:)."):l.create("datatype","If (sorted:) isn't given a 'via' lambda, it must be given only numbers and strings, not ".concat(d(t[0]),".")):r.sort(_);var o=r.shift();if("making"in o||"where"in o||"when"in o||!("via"in o))return l.create("datatype","The optional lambda given to (sorted:) must be a 'via' lambda, not ".concat(d(o),"."));for(var i=0;i<r.length;i+=1){var s=o.apply(e,{loop:r[i],pos:i+1});if(l.containsError(s))return s;if("string"!=typeof s&&"number"!=typeof s)return l.create("datatype",'The "via" lambda given to (sorted:) couldn\'t convert '.concat(d(r[i])," into a string or number."));r[i]=[r[i],s]}return r.sort(function(e,t){return _(e[1],t[1])}).map(function(e){return e[0]})},[S(T)])("rotated","Array",function(e,t){if(0===t)return l.create("macrocall","I can't rotate these values by 0 positions.");for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=-1*(t=Math.abs(t)%r.length*Math.sign(t));return r.slice(t).concat(r.slice(0,t)).map(b)},[parseInt,S(T)])("rotated-to","Array",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)?t:t.length?(e=r.indexOf(t[0]),r.slice(e).concat(r.slice(0,e)).map(b)):l.create("macrocall","None of these "+r.length+" values matched the lambda, so I can't rotate them.")},[c.TypeSignature("where"),w(T)])("repeated","Array",function(e,t){for(var n=[],r=arguments.length,a=new Array(2<r?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];if(!a.length)return n;for(;0<t--;)n.push.apply(n,a);return n.map(b)},[e,w(T)])("interlaced","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=Math.min.apply(Math,_toConsumableArray(n.map(function(e){return e.length}))),o=[],i=0;i<a;i+=1)for(var s=0;s<n.length;s+=1)o.push(b(n[s][i]));return o},[Array,w(Array)])("permutations","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?u.apply(void 0,n):[]},[S(T)])("unique","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.filter(y)},[S(T)])("altered","Array",function(n,r){for(var e=arguments.length,t=new Array(2<e?e-2:0),a=2;a<e;a++)t[a-2]=arguments[a];return t.map(function(e,t){t=r.apply(n,{loop:e,pos:t+1});return null===t?e:t})},[k(c.TypeSignature("via"),c.TypeSignature("where","via")),S(T)])("find","Array",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return t.filter(e,r)},[c.TypeSignature("where"),S(T)])(["all-pass","pass"],"Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||t.length===r.length},[c.TypeSignature("where"),S(T)])("some-pass","Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||0<t.length},[c.TypeSignature("where"),S(T)])("none-pass","Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||0===t.length},[c.TypeSignature("where"),S(T)])("folded","Any",function(r,a){for(var e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return"where"in a&&(t=[t[0]].concat(_toConsumableArray(a.filter(r,t.slice(1))))),l.containsError(t)||t.reduce(function(e,t,n){return a.apply(r,{making:e,loop:t,pos:n+1})})},[k(c.TypeSignature("where","via","making"),c.TypeSignature("via","making")),w(T)])(["dm-names","datamap-names","datanames"],"Array",function(e,t){return Array.from(t.keys()).sort(i("en"))},[Map])(["dm-values","datamap-values","datavalues"],"Array",function(e,t){return Array.from(t.entries()).sort(i("en",function(e){return String(e[0])})).map(function(e){return b(e[1])})},[Map])(["dm-entries","datamap-entries","dataentries"],"Array",function(e,t){return Array.from(t.entries()).sort(function(e,t){return[e[0],t[0]].sort(i("en"))[0]===e[0]?-1:1}).map(function(e){return new Map([["name",e[0]],["value",b(e[1])]])})},[Map])(["dm-altered","datamap-altered"],"Datamap",function(a,o,e){return Array.from(e.entries()).sort(function(e,t){return[e[0],t[0]].sort(i("en"))[0]===e[0]?-1:1}).reduce(function(e,t,n){if(!l.containsError(e)){var r=new Map([["name",t[0]],["value",b(t[1])]]),r=o.apply(a,{loop:r,pos:n+1});if(l.containsError(r))return r;e.set(t[0],null===r?t[1]:r)}return e},new Map)},[k(c.TypeSignature("via"),c.TypeSignature("where","via")),Map])("history","Array",function(e,t){var n=s.history();return t?(t=t.filter(e,n.map(function(e){return a.get(e)})),l.containsError(t)?t:t.map(function(e){return e.get("name")})):n},[n(c.TypeSignature("where"))])("visited","Boolean",function(e,t){var n;return"string"==typeof t?a.has(t)?0<s.passageNameVisited(t)||s.passage===t:l.create("macrocall","There's no passage named '"+t+"' in this story."):(n=s.history(),n=t.filter(e,n.concat(s.passage).map(function(e){return a.get(e)})),l.containsError(n)?n:0<n.length)},[k(String,c.TypeSignature("where"))])("passage","Datamap",function(e,t){return b(a.get(t||s.passage))||l.create("macrocall","There's no passage named '"+t+"' in this story.")},[n(String)])("passages","Array",function(e,t){var n=i("en"),r=_toConsumableArray(a.values()).map(function(e){return b(e)}),t=t?t.filter(e,r):r,e=l.containsError(t);return e||t.sort(function(e,t){return n(e.get("name"),t.get("name"))})},[n(c.TypeSignature("where"))])("open-storylets","Array",function(e,t){return e.stackTop.evaluateOnly?l.create("macrocall","(open-storylets:) can't be used in "+e.stackTop.evaluateOnly+"."):(e=a.getStorylets(e,t),l.containsError(e)||e.map(b))},[n(c.TypeSignature("where"))])("savedgames","Datamap",function(){function e(e){return"("+e+" "+p.ifid+") "}var t,n,r=0,a=new Map;do{if(!s.hasStorage)break;t=localStorage.key(r),r+=1;var o=e("Saved Game")}while(null!=(n=t)&&n.startsWith(o)&&(t=t.slice(o.length),a.set(t,localStorage.getItem(e("Saved Game Filename")+t))),t);return a},[])(["datamap","dm"],"Datamap",function(e){for(var r,a=new Map,t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=n.reduce(function(e,t){var n;if(!l.containsError(e))if(void 0===r)r=t;else{if(n=l.containsError(m(a,r)))return n;if(a.has(r))return l.create("macrocall","You used the same data name ("+d(r)+") twice in the same (datamap:) call.");a.set(r,b(t)),r=void 0}return e},!0);return l.containsError(i)?i:void 0!==r?l.create("macrocall","This datamap has a data name without a value."):a},S(k(o,T)))(["dataset","ds"],"Dataset",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Set(n.filter(y).map(b))},S(T))("count","Number",function t(n,r){for(var e,a=arguments.length,o=new Array(2<a?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];if(1<o.length)return e=o.map(function(e){return t(n,r,e)}),l.containsError(e)||e.reduce(function(e,t){return e+t},0);var s=o[0];switch(h(r)){case"dataset":case"datamap":return l.create("macrocall","(count:) shouldn't be given a datamap or dataset.","You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.");case"string":return"string"!=typeof s?l.create("macrocall",d(r)+" can't contain  "+d(s)+" because it isn't also a string."):s?r.split(s).length-1:0;case"array":return r.reduce(function(e,t){return e+g(t,s)},0);default:return l.create("macrocall",d(r)+" can't contain values, let alone "+d(s)+".")}},[T,w(T)])}),define("macrolib/enchantments",["jquery","utils","utils/operationutils","engine","state","passages","macros","datatypes/hookset","datatypes/codehook","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/enchantment","internaltypes/twineerror"],function(c,r,e,l,s,n,u,p,a,d,t,i,f,h){var m=e.is,e=u.TypeSignature,g=e.either,y=e.rest,o=e.optional,b=Object.assign;function v(e,t){if(d.isPrototypeOf(t)&&!t.canEnchant)return h.create("datatype","The changer given to (".concat(e,":) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:)."))}["enchant","change"].forEach(function(o){u.addCommand(o,function(e,t){t=v(o,t);if(t)return t},function(t,n,e){n=p.from(n);var r,a=[];return d.isPrototypeOf(e)&&(r=i.create({section:t}),e.run(r),0<(r.innerEnchantments||[]).length)&&(r=r.innerEnchantments.map(function(e){return e(n)}),a.push.apply(a,_toConsumableArray(r))),a.push(f.create((_defineProperty(r={scope:n},d.isPrototypeOf(e)?"changer":"lambda",e),_defineProperty(r,"section",t),r))),a.forEach(function(e){"enchant"===o?(t.addEnchantment(e),t.updateEnchantments()):e.enchantScope()}),""},[g(p,String),g(d,t.TypeSignature("via"))],!1)}),u.addChanger("enchant-in",function(e,t,n){var r=v("enchant-in",n);return r||d.create("enchant-in",[t,n])},function(t,n,r){return t.innerEnchantments=(t.innerEnchantments||[]).concat(function(e){return f.create((_defineProperty(e={scope:p.from(n),localHook:e},d.isPrototypeOf(r)?"changer":"lambda",r),_defineProperty(e,"section",t.section),e))}),t},[g(p,String),g(d,t.TypeSignature("via"))]),[["link-style",p.create({type:"name",data:"link"})],["line-style",p.create({type:"base",data:p.create({type:"name",data:"page"})},"lines",void 0)],["char-style",p.create({type:"base",data:p.create({type:"name",data:"page"})},"chars",void 0)]].forEach(function(e){var e=_slicedToArray(e,2),r=e[0],a=e[1];u.addChanger(r,function(e,t){var n=v(r,t);return n||d.create(r,[t])},function(t,n){return t.innerEnchantments=(t.innerEnchantments||[]).concat(function(e){return f.create((_defineProperty(e={scope:a,localHook:e},d.isPrototypeOf(n)?"changer":"lambda",n),_defineProperty(e,"section",t.section),e))}),t},[g(d,t.TypeSignature("via"))])});e=["replace","append","prepend"];function w(i,s){return r.onStartup(function(){var e=i.classList.replace(/ /g,"."),t=i.blockClassList?i.blockClassList.replace(/ /g,"."):"",n="."+e+(t?",."+t:"");r.storyElement.on(i.event.map(function(e){return e+".enchantment"}).join(" "),n,function(){var e,t=c(this);r.options.debug&&r.options.ignoreClickEvents&&!t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||t.is("tw-open-button")||(e=(t=c(Array.from(t.parents(n).add(this)).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&e(t)})}),[function(e,t,n){if(!t)return h.create("datatype","A string given to this ("+s+":) macro was empty.");if(n){var r=v(s,n);if(r)return r}return d.create(s,[p.from(t)].concat(n?[n]:[]))},function(t,e,n){t.enabled=!1,t.transitionDeferred=!0,i.rerender&&(t.newTargets=(t.newTargets||[]).concat({target:e,append:i.rerender}));var r,a=null!=(r=t.section)&&r.stackTop?t.section.stackTop.tempVariables:Object.create(null),o=f.create(_defineProperty({functions:[function(e){e.attr("class",e.children().is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(e.children().css("display"))?i.blockClassList:i.classList),e.attr({tabIndex:"0"})}],data:{enchantmentEvent:function(){var e;null!=(e=t.section.stackTop)&&e.blocked||(i.once&&t.section.removeEnchantment(o),i.goto?l.goToPassage(i.goto,{transition:i.transition}):i.undo?l.goBack({transition:i.transition}):t.section.renderInto(t.source,null,_objectSpread(_objectSpread({},t),{},{append:i.once?"append":"replace",enabled:!0,transitionDeferred:!1}),a))}},scope:e,section:t.section,name:s},d.isPrototypeOf(n)?"changer":"lambda",n));return t.section&&(t.section.addEnchantment(o),o.enchantScope()),t},[g(p,String),o(g(d,t.TypeSignature("via")))]]}e.forEach(function(o){u.addChanger(o,function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.every(Boolean)?d.create(o,n.map(p.from),null,!1):h.create("datatype","A string given to this (".concat(o,":) macro was empty."))},function(e){var t;0<c(e.target).parents().filter("tw-collapsed,[collapsing=true]").length||e.attr.some(function(e){return e.collapsing})||(e.attr=[].concat(_toConsumableArray(e.attr),[{collapsing:!1}])),e.newTargets=e.newTargets||[];for(var n=arguments.length,r=new Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=e.newTargets).push.apply(t,_toConsumableArray(r.filter(function(n){return!e.newTargets.some(function(e){var t=e.target,e=e.append;return m(n,t)&&o===e})}).map(function(e){return{target:e,append:o,before:!0}}))),e},y(g(p,String)))(o+"-with",function(e,t){return d.create(o+"-with",[t],null,!1)},function(e,t){return a.isPrototypeOf(t)&&(t=t.code),e.appendSource=(e.appendSource||[]).concat({source:t,append:o}),e},g(a,String))});var k="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,S=[{name:"click",enchantDesc:{event:["click"],once:!0,rerender:"",classList:"link enchantment-link",blockClassList:"enchantment-clickblock"}},{name:"mouseover",enchantDesc:{event:["mouseenter",k?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseover",blockClassList:"enchantment-mouseoverblock"}},{name:"mouseout",enchantDesc:{event:["mouseleave",k?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseout",blockClassList:"enchantment-mouseoutblock"}},{name:"doubleclick",enchantDesc:{event:["dblclick"],once:!0,rerender:"",classList:"link enchantment-dblclick",blockClassList:"enchantment-dblclickblock"}}];S.forEach(function(e){"doubleclick"!==e.name&&(u.addChanger.apply(u,[e.name].concat(_toConsumableArray(w(e.enchantDesc,e.name)))),"click"===e.name)&&u.addChanger.apply(u,[e.name+"-rerun"].concat(_toConsumableArray(w(_objectSpread(_objectSpread({},e.enchantDesc),{},{once:!1}),e.name+"-rerun"))))}),r.onStartup(function(){S.forEach(function(e){var n=e.enchantDesc;n.blockClassList&&r.storyElement.on(n.event.map(function(e){return e+".enchantment"}).join(" "),function(){var e,t=c(this);r.options.debug&&r.options.ignoreClickEvents&&!t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||t.is("tw-open-button")||(e=(t=c(Array.from(t.parents("."+n.blockClassList.replace(/ /g,"."))).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&e(t)})})}),e.forEach(function(n){S.forEach(function(e){var t;"doubleclick"!==e&&(t=_objectSpread(_objectSpread({},e.enchantDesc),{},{rerender:n}),e=e.name+"-"+n,u.addChanger.apply(u,[e].concat(_toConsumableArray(w(t,e)))))})}),S.forEach(function(i){"doubleclick"!==i&&["goto","undo"].forEach(function(a){var o=i.name+"-"+a;u.addCommand(o,function(e,t){return!e||!t&&"goto"===a?h.create("datatype","A string given to this ("+o+":) macro was empty."):"goto"!==a||n.hasValid(t)?void 0:h.create("macrocall","I can't ("+o+":) the passage '"+t+"' because it doesn't exist.")},function(e,t,n,r){return"undo"===a&&s.pastLength<1?h.create("macrocall","I can't (undo:) on the first turn."):((0,_slicedToArray(w(_objectSpread(_objectSpread({},i.enchantDesc),{},{transition:e.data.passageT8n},"undo"===a?{undo:!0}:{goto:r}),o),2)[1])({section:t},p.from(n)),b(e,{source:""}))},[g(p,String)].concat("undo"===a?[]:String))})})}),define("macrolib/links",["jquery","macros","utils","state","passages","engine","datatypes/changercommand","internaltypes/changedescriptor","datatypes/hookset","datatypes/lambda","internaltypes/twineerror"],function(i,e,c,l,u,p,a,d,t,f,h){var n=e.TypeSignature,r=n.optional,o=n.rest,n=n.either,m=["Links can't have empty strings for their displayed text.","In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there."],g=Object.assign;function s(e,t,n){n=n||t;var r,a=u.hasValid(t)&&t===n,e=e.evaluateTwineMarkup(c.unescape(n),"a link's passage name");return a?t=(a=0<e.children().length?"`".repeat((n.match(/`+/)||[]).reduce(function(e,t){return Math.max(e,t.length+1)},1)):"")+"\0".repeat(!!a)+t+"\0".repeat(!!a)+a:(e.findAndFilter("tw-error").length&&(r=e.findAndFilter("tw-error").data("TwineError")),n=e.text()),{text:t,passage:n,error:r}}c.onStartup(function(){var e="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints;function t(e){var t=i(this),n=t.closest("tw-expression"),r=t.closest("tw-expression, tw-hook"),a=r.data("clickEvent"),r=r.data("section");if((!c.options.debug||!c.options.ignoreClickEvents||t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *"))&&!t.is("tw-open-button")&&(null==r||!r.stackTop||!r.stackTop.blocked||r.stackTop.blocked instanceof i&&r.stackTop.blocked.find(t).length)){if(a)return 0<t.find("tw-error").length?void 0:(e.stopPropagation(),void a(t));var r=n.data("linkPassageName"),o=_objectSpread({},n.data("passageT8n")||{});n.find("tw-enchantment").each(function(e,t){Object.assign(o,i(t).data("passageT8n")||{})}),r?(e.stopPropagation(),p.goToPassage(r,{transition:o})):t.is("[undo]")?(e.stopPropagation(),p.goBack({transition:o})):t.is("[fullscreen]")&&(e.stopPropagation(),p.toggleFullscreen())}}c.storyElement.on("click.passage-link","tw-link"+(e?"":":not(.enchantment-mouseover):not(.enchantment-mouseout):not(.enchantment-dblclick)"),t).on("mouseover.passage-link","tw-link.enchantment-mouseover, tw-expression.enchantment-mouseover > tw-link",t).on("mouseout.passage-link","tw-link.enchantment-mouseout, tw-expression.enchantment-mouseout > tw-link",t).on("dblclick.passage-link","tw-link.enchantment-dblclick, tw-expression.enchantment-dblclick > tw-link",t),i(document).on("fullscreenchange",function(){i("tw-link[fullscreen]",c.storyElement).each(function(e,t){(i(t).closest("tw-expression, tw-hook").data("fullscreenEvent")||Object)(t)})})}),[["link","link-replace"],["link-reveal","link-append"],["link-repeat"],["link-rerun"]].forEach(function(s){return e.addChanger(s,function(e,t,n){return t?n&&!n.canEnchant?h.create("datatype","The changer given to (".concat(s[0],":) can't be (or include) a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")):a.create(s[0],[t].concat(n||[]),null,!0):h.create("datatype",m[0])},function(r,e,t){var n,a=s[0],o=null!=(n=r.section)&&n.stackTop?r.section.stackTop.tempVariables:Object.create(null),i=d.create({source:"<tw-link tabindex=0>"+e+"</tw-link>",target:function(){return r.target},append:"replace",data:{section:r.section,clickEvent:function(e){r.enablers=r.enablers.filter(function(e){return e.descriptor!==i}),"link-reveal"===a&&e.contents().unwrap();var t,n=e.parentsUntil(":not(tw-enchantment)").parent();n.length||(n=e.parent()),"link-rerun"===a&&(t=e.parentsUntil(":not(tw-enchantment)"),e.detach(),t.remove()),"link"!==a&&"link-rerun"!==a||n.empty(),r.section.renderInto("",null,r,o),"link-rerun"===a&&n.prepend(e)}}});return r.enablers=(r.enablers||[]).concat({descriptor:i,changer:t}),r},[String,r(a)])}),e.addCommand("link-goto",function(e){if(!e)return h.create.apply(h,["datatype"].concat(m))},function(e,t,n,r){var a,o=s(t,n,r);return n=o.text,r=o.passage,(o=o.error)||(e.transition?h.create("datatype","Please attach ("+(o="transition")+"-depart:) or ("+o+"-arrive:) to a passage link, not ("+o+":)."):(a=(a=u.hasValid(r)?a:'<tw-broken-link passage-name="'+c.escape(r)+'">'+n+"</tw-broken-link>")||"<tw-link tabindex=0 "+(0<l.passageNameVisited(r)?'class="visited" ':"")+">"+n+"</tw-link>",e.data.linkPassageName=r,e.data.section=t,g(e,{source:a,transitionDeferred:!0})))},[String,r(String)])("link-storylet",function(){var e=(e=1===arguments.length||"string"!=typeof(arguments.length<=0?void 0:arguments[0])?0:1)<0||arguments.length<=e?void 0:arguments[e];if(!e||"string"==typeof e)return h.create("datatype","(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.")},function(e,t){var n=(n=2+("string"==typeof(arguments.length<=2?void 0:arguments[2])?1:0))<2||arguments.length<=n?void 0:arguments[n],r="string"==typeof(arguments.length<=2?void 0:arguments[2])&&(arguments.length<=2?void 0:arguments[2]),a=((a=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=a?void 0:arguments[a])!==n&&((a=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=a?void 0:arguments[a]);if(e.transition)return h.create("datatype","Please attach (".concat(o="transition","-depart:) or (").concat(o,"-arrive:) to (link-storylet:), not (").concat(o,":)."));var o=f.isPrototypeOf(n),i=u.getStorylets(t,o&&n),s=h.containsError(i);if(s)return s;var c,s=i[o?0:n<0?i.length+n:n-1];if(s)s=s.get("name"),r=r||s,c=c||"<tw-link tabindex=0 "+(0<l.passageNameVisited(s)?'class="visited" ':"")+">"+r+"</tw-link>",e.data.linkPassageName=s,e.data.section=t;else{if(!a)return e;c=a}return g(e,{source:c,transitionDeferred:!0})},[n(parseInt,String,f.TypeSignature("where")),r(n(parseInt,String,f.TypeSignature("where"))),r(String)])("link-undo",function(e){if(!e)return h.create("datatype",m[0])},function(t,e,n){var r,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";return l.pastLength<1?g(t,{source:a}):(r=(t.data.section=e).stackTop.tempVariables,t.data.forgetUndosEvent=function(){return t.data.section.whenUnblocked(function(){var e=_objectSpread(_objectSpread({},t),{},{append:"replace",source:a,transitionDeferred:!1});t.section.renderInto("",null,e,r)})},g(t,{source:"<tw-link tabindex=0 undo>"+n+"</tw-link>",transitionDeferred:!0}))},[String,r(String)])("link-show",function(e){if(!e)return h.create("datatype",m[0])},function(r,a,e){for(var t=arguments.length,n=new Array(3<t?t-3:0),o=3;o<t;o++)n[o-3]=arguments[o];return r.data.section=a,r.data.clickEvent=function(e){e.contents().unwrap(),n.forEach(function(e){return e.forEach(a,function(e){var t=e.data("originalSource")||"",n=e.data("hidden");n&&(e.removeData("hidden"),n instanceof i?e.empty().append(n):(n=e.data("tempVariables"),a.renderInto("",null,_objectSpread(_objectSpread({},r),{},{source:t,target:e,transitionDeferred:!1}),n&&Object.create(n))))})})},g(r,{source:"<tw-link tabindex=0>"+e+"</tw-link>",transitionDeferred:!0})},[String,o(t)])("link-fullscreen",function(e,t){if(!e||!t)return h.create("datatype",m[0])},function(t,e,n,r){function a(){return document.fullscreenEnabled||document.msFullscreenEnabled?"<tw-link tabindex=0 fullscreen>"+(document.fullscreenElement||document.msFullscreenElement?r:n)+"</tw-link>":r?"<tw-broken-link>"+r+"</tw-broken-link>":""}var o=e.stackTop.tempVariables;return t.data.section=e,t.data.fullscreenEvent=function(){(document.fullscreenEnabled||document.msFullscreenEnabled)&&t.data.section.whenUnblocked(function(){var e=_objectSpread(_objectSpread({},t),{},{append:"replace",source:a(),transitionDeferred:!1});t.section.renderInto("",null,e,o)})},g(t,{source:a(),transitionDeferred:!0})},[String,String,r(String)]),e.addChanger(["link-reveal-goto"],function(e,t,n,r){if(!t)return h.create.apply(h,["datatype"].concat(m));if(a.isPrototypeOf(n)){if(a.isPrototypeOf(r))return h.create("datatype","You mustn't give two changers to (link-reveal-goto:)");r=n,n=void 0}return r&&!r.canEnchant?h.create("datatype","The changer given to (link-reveal-goto:) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:)."):(t=(e=s(e,t,n)).text,n=e.passage,e.error||a.create("link-reveal-goto",[t,n,r].filter(function(e){return void 0!==e}),null,!1))},function(t,e,n,r){var a,o,i,s;if(u.hasValid(n))return o=l.passageNameVisited(n),i=null!=(a=t.section)&&a.stackTop?t.section.stackTop.tempVariables:Object.create(null),s=d.create({source:"<tw-link tabindex=0 "+(0<o?'class="visited" ':"")+">"+e+"</tw-link>",target:t.target,append:"replace",data:{section:t.section,append:"replace",clickEvent:function(e){t.enablers=t.enablers.filter(function(e){return e.descriptor!==s}),e.contents().unwrap(),t.section.renderInto("",null,t,i),t.section.whenUnblocked(function(){return p.goToPassage(n,{transition:t.data.passageT8n})})}}}),t.enablers=(t.enablers||[]).concat({descriptor:s,changer:r}),t;t.source='<tw-broken-link passage-name="'+c.escape(n)+'">'+e+"</tw-broken-link>"},[String,r(n(a,String)),r(a)])}),define("macrolib/metadata",["macros","utils/operationutils","datatypes/lambda","internaltypes/twineerror"],function(t,e,n,s){function c(e){return{TwineScript_TypeName:"a ("+e+":) macro",TwineScript_ObjectName:"a ("+e+":) macro",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}}var l=e.clone,u=e.objectName,p=e.isValidDatamapName,e=t.TypeSignature,r=e.zeroOrMore,e=e.Any;[["storylet",n.TypeSignature("when")],["urgency",Number],["exclusivity",Number]].forEach(function(e){var e=_slicedToArray(e,2),n=e[0],e=e[1];t.add(n,"Metadata",function(e,t){return e.stackTop.speculativePassage?t:c(n)},e)}),t.add("metadata","Metadata",function(e){for(var r,a=new Map,t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=n.reduce(function(e,t){var n;if(!s.containsError(e))if(void 0===r)r=t;else{if(n=s.containsError(p(a,r)))return n;if(a.has(r))return s.create("macrocall","You used the same data name ("+u(r)+") twice in the same (metadata:) call.");a.set(r,l(t)),r=void 0}return e},!0);return s.containsError(i)?i:void 0!==r?s.create("macrocall","This (metadata:) macro has a data name without a value."):e.stackTop.speculativePassage?a:c("metadata")},r(e))}),define("macrolib/patterns",["macros","utils","utils/operationutils","datatypes/lambda","datatypes/datatype","datatypes/typedvar","internaltypes/twineerror","internaltypes/varscope"],function(e,t,n,y,b,h,v,w){function k(e){var r,t,a=e.name,n=e.fullArgs,o=e.args,i=e.makeRegExpString,s=void 0===i?function(e){return e.join("")}:i,c=void 0!==(i=e.insensitive)&&i,l=void 0===(i=e.canContainTypedVars)||i,u=void 0===(i=e.canBeUsedAlone)||i,p=void 0===(i=e.canContainTypedGlobals)||i,d=o||n,f=E(null),e=d.map(function e(t){if(h.isPrototypeOf(t)){var n=t.varRef;if(!l)return v.create("operation","Optional string patterns, like (".concat(a,":)").concat("p-many"===a?" with a minimum of 0 matches":"",", can't have typed variables inside them."));if(!p&&!w.isPrototypeOf(n.object))return v.create("operation","Only typed temp variables can be used in patterns given to (".concat(a,":)"));n=n.getName();if(n in f)return v.create("operation","There's already a typed temp variable named _".concat(n," inside this (").concat(a,":) call."));f[n]=!0;n=e(t.datatype);return v.containsError(n)?n:"("+n+")"}if(b.isPrototypeOf(t)){if(!(l&&p||"function"!=typeof t.typedVars)){n=t.typedVars();if(!l&&n.length)return v.create("operation","(".concat(a,":) can't have typed variables inside its pattern."));if(!p&&n.some(function(e){return!w.isPrototypeOf(e.varRef.object)}))return v.create("operation","Only typed temp variables can be used in patterns given to (".concat(a,":)"))}var r;return t.regExp?(t.rest?"(?:":"")+(c?t.insensitive():t).regExp+(t.rest?")*":""):(n=t.name,r=t.rest?"*":"","alnum"===n?m+r:"whitespace"===n?_+r:"uppercase"===n?(c?T:g)+r:"lowercase"===n?(c?T:S)+r:"anycase"===n?T+r:"digit"===n?"\\d"+r:"linebreak"===n?"(?:\\r|\\n|\\r\\n)"+r:"str"===n?".*?":["even","odd","int","num"].includes(n)?v.create("datatype","Please use string datatypes like 'digit' in (".concat(a,":) instead of number datatypes.")):v.create("datatype","The (".concat(a,":) macro must only be given string-related datatypes, not ").concat(O(t),".")))}return"string"==typeof t?(t=t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),c?t.replace(RegExp("(".concat(g,"|").concat(S,")"),"g"),function(e){return"["+e.toUpperCase()+e.toLowerCase()+"]"}):t):(x("createPattern","mapper() was given a non-string non-datatype "+t),"")});return(i=v.containsError(e))||(r=s(e),t=C(E(b),{name:a,regExp:r,insensitive:function(){return c?t:k({name:a,fullArgs:n,args:d.map(function(e){return b.isPrototypeOf(e)&&"function"==typeof e.insensitive?e.insensitive():e}),makeRegExpString:s,insensitive:!0,canContainTypedVars:l,canBeUsedAlone:u})},typedVars:function(){return d.reduce(function(e,t){return h.isPrototypeOf(t)&&(e=e.concat(c?h.create(k({name:"p-ins",fullArgs:[t.datatype],insensitive:!0}),t.varRef):t),t=t.datatype),e=b.isPrototypeOf(t)&&"function"==typeof t.typedVars?e.concat(t.typedVars()):e},[])},destructure:function(e){var n,t;return"string"!=typeof e?[v.create("operation","I can't put ".concat(O(e)," into ").concat(this.TwineScript_ToSource()," because it isn't a string."))]:(n=this.typedVars()).length?(t=(RegExp("^"+(this.rest?"(?:":"")+r+(this.rest?")*":"")+"$").exec(e)||[]).slice(1)).length?t.map(function(e,t){t=n[t];if(t)return t.datatype.rest&&!t.datatype.regExp&&((t=t.TwineScript_Clone()).datatype=k({name:"p",fullArgs:[t.datatype]})),{dest:t,value:e||"",src:void 0}}).filter(Boolean):[v.create("operation","I can't put ".concat(O(e)," because it doesn't match the pattern ").concat(this.TwineScript_ToSource(),"."))]:[]},TwineScript_IsTypeOf:function(e){return u?"string"==typeof e&&!!e.match("^"+(this.rest?"(?:":"")+r+(this.rest?")*":"")+"$"):v.create("operation","A (".concat(a,":) datatype must only be used with a (p:) macro."))},TwineScript_toTypeSignatureObject:function(){var t=this;return{pattern:"range",name:a,range:function(e){return t.TwineScript_IsTypeOf(e)}}},TwineScript_ToSource:function(){return(this.rest?"...":"")+"("+a+":"+n.map(A)+")"}}),Object.defineProperty(t,"TwineScript_ObjectName",{get:function(){return"a (".concat(a,":) datatype")}}),t)}var m=t.anyRealLetter,g=t.anyUppercase,S=t.anyLowercase,T=t.anyCasedLetter,_=t.realWhitespace,x=t.impossible,O=n.objectName,A=n.toSource,t=e.TypeSignature,n=t.rest,r=t.either,a=t.optional,t=t.nonNegativeInteger,C=Object.assign,E=Object.create,o=n(r(String,b,h));e.add(["p","pattern"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p",fullArgs:n})},o)(["p-either","pattern-either"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-either",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("|")+")"}})},o)(["p-opt","pattern-opt","p-optional","pattern-optional"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-opt",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("")+")?"}})},o)(["p-not","pattern-not"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.find(function(e){return"string"==typeof e?1!==_toConsumableArray(e).length:e.rest||e.regExp||["str","empty"].includes(e.name)})?v.create("datatype","(p-not:) should only be given single characters, or datatypes that match single characters"):k({name:"p-not",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"[^"+e.map(function(e){return e.startsWith("[")&&e.endsWith("]")?e.slice(1,-1):e}).join("")+"]"}})},o)(["p-not-before","pattern-not-before"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-not-before",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?!"+e.join("")+")"}})},o)(["p-before","pattern-before"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-before",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?="+e.join("")+")"}})},o)(["p-start","pattern-start"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-start",fullArgs:n,makeRegExpString:function(e){return"^(?:"+e.join("")+")"}})},o)(["p-end","pattern-end"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-end",fullArgs:n,makeRegExpString:function(e){return"(?:"+e.join("")+")$"}})},o)(["p-many","pattern-many"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,o,i,s=n.slice();return"number"==typeof n[0]&&(a=n.shift(),o="number"==typeof n[0]?n.shift():1/0),!(void 0!==o&&o<a)&&n.length?(i=n.find(function(e){return"string"!=typeof e&&!b.isPrototypeOf(e)&&!h.isPrototypeOf(e)}))?v.create("datatype","This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given "+O(i)+"."):k({name:"p-many",args:n,fullArgs:s,canContainTypedVars:0<a,makeRegExpString:function(e){return"(?:"+e.join("")+")"+(void 0!==a?"{"+a+(o===1/0?",":o!==a?","+o:"")+"}":"+")}}):v.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.")},[n(r(t,String,b,h))])(["p-ins","pattern-ins","p-insensitive","pattern-insensitive"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-ins",fullArgs:n,insensitive:!0})},o)(["split","splitted"],"Array",function(e,t,n){if(t=k({name:"split",fullArgs:[t],canContainTypedVars:!1}),v.containsError(t))return t;if(!n)return[""];if(!t.regExp)return _toConsumableArray(n);for(var r,a=RegExp(t.regExp),o=[];n&&(r=a.exec(n));){if(r.index+r[0].length===0)return o;o.push(n.slice(0,r.index)),n=n.slice(r.index+r[0].length)}return o.concat(n||[])},[r(String,b),String])("trimmed","String",function(e,t,n){return void 0===n||b.isPrototypeOf(t)&&"whitespace"===t.name?t.trim():(t=k({name:"trimmed",fullArgs:[t],canContainTypedVars:!1}),v.containsError(t)?t:t.regExp?n.replace(RegExp("^("+t.regExp+")*|("+t.regExp+")*$","g"),""):n)},[r(String,b),a(String)])(["str-find","string-find"],"String",function(e,t,n){if(t=k({name:"str-find",fullArgs:[t],canContainTypedGlobals:!1}),v.containsError(t))return t;for(var r,a=t.typedVars(),o=RegExp(t.regExp,"g"),i=[],s=o.lastIndex;(r=o.exec(n))&&s!==o.lastIndex;)if(s=o.lastIndex,a.length){for(var c=new Map,l=0;l<a.length;l+=1){if("match"===a[l].varRef.getName())return v.create("macrocall","There was a typed temp variable named _match in the pattern given to (str-find:)","The variable _match is reserved, and can't be used inside (str-find:)'s pattern.");c.set(a[l].varRef.getName(),r[l+1]),c.set("match",r[0])}i.push(c)}else i.push(r[0]);return i},[b,String])(["str-replaced","string-replaced","replaced"],"String",function(e,t,n,r,a){if("number"!=typeof t){if(void 0!==a)return v.create("macrocall","1 too many values were given to (str-replaced:).","If this is given 5 values, the first value must be a number of replacements.");a=r,r=n,n=t,t=1/0}else if(void 0===a)return v.create("macrocall","The (str-replaced:) macro needs 1 more value.","The final string seems to be missing.");if(b.isPrototypeOf(r))return v.create("datatype","The replacement value for (str-replaced:) must be a string or lambda, not ".concat(O(r)));if(y.isPrototypeOf(a)||y.isPrototypeOf(n))return v.create("datatype","The ".concat(y.isPrototypeOf(a)?"final string":"search pattern"," given to (str-replaced:) can't be a lambda."),"Only the replacement value (after the search pattern) can be a 'via' lambda.");if(n=k({name:"str-replaced",fullArgs:[n],canContainTypedGlobals:!1}),v.containsError(n))return n;if(!n.regExp)return a;for(var o,i=RegExp(n.regExp,"g"),s=y.isPrototypeOf(r)?n.typedVars():[],c=1,l=0,u="",p=i.lastIndex;a&&(o=i.exec(a))&&0<t&&p!==i.lastIndex;){for(var p=i.lastIndex,d=Object.create(e.stack.length?e.stackTop.tempVariables:w),f=0;f<s.length;f+=1){var h=s[f],m=h.varRef.create(d,h.varRef.propertyChain);if(v.containsError(m))return m;h=m.defineType(h.datatype);if(v.containsError(h))return h;m.set(o[f+1])}var g=y.isPrototypeOf(r)?r.apply(e,{loop:o[0],pos:c,tempVariables:d}):r;if(v.containsError(g))return g;if("string"!=typeof g)return v.create("datatype","(str-replaced:)'s lambda must produce a string, but it produced ".concat(O(g),' when given "').concat(o[0],'".'));u+=a.slice(l,o.index)+g,c+=1,--t,l=o.index+o[0].length}return u+=a.slice(l)},[r(t,String,b),r(b,String,y.TypeSignature("via")),r(String,y.TypeSignature("via")),a(String)])}),define("macrolib/stylechangers",["jquery","macros","utils","utils/renderutils","datatypes/colour","datatypes/hookset","datatypes/gradient","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/twineerror"],function(s,e,c,t,a,n,r,o,i,l,u){var p,d,f=t.geomParse,h=t.geomStringRegExp,m=Object.assign,t=e.TypeSignature,g=t.either,y=t.wrapped,b=t.optional,v=t.Any,w=t.Everything,k=t.zeroOrMore,S=t.rest,T=t.insensitiveSet,_=t.positiveNumber,x=t.positiveInteger,O=t.nonNegativeNumber,t=t.percent,y=[y(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not "".')],A=(c.onStartup(function(){return c.storyElement.on("mouseenter.hover-macro","[hover=false]",function(){var e=s(this),t=e.data("hoverChanger");c.options.debug&&c.options.ignoreClickEvents&&!e.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||(e.data({mouseoutStyle:e.attr("style")||""}),l.create({target:e},t).update(),e.attr("hover",!0))}).on("mouseleave.hover-macro","[hover=true]",function(){var e=s(this),t=e.data("mouseoutStyle");e.attr("style",t).removeData("mouseoutStyle").attr("hover",!1)})}),u.on(function(){s("tw-expression, tw-hook",c.storyElement).each(function(e,t){((t=s(t)).data("errorEvent")||Object)(t)})}),T("instant","dissolve","fade","rumble","shudder","pulse","zoom","flicker","slideleft","slideright","slideup","slidedown","fadeleft","faderight","fadeup","fadedown","blur")),C=T("dotted","dashed","solid","double","groove","ridge","inset","outset","none");e.addChanger("if",function(e,t){return o.create("if",[t])},function(e,t){return e.enabled=e.enabled&&t},y)("unless",function(e,t){return o.create("unless",[t])},function(e,t){return e.enabled=e.enabled&&!t},y)("elseif",function(e,t){return"lastHookShown"in e.stack[0]?o.create("elseif",[!1===e.stack[0].lastHookShown&&!!t]):u.create("macrocall","There's no (if:) or something else before this to do (else-if:) with.")},function(e,t){return e.enabled=e.enabled&&t},y)("else",function(e){return"lastHookShown"in e.stack[0]?o.create("else",[!1===e.stack[0].lastHookShown]):u.create("macrocall","There's nothing before this to do (else:) with.")},function(e,t){return e.enabled=e.enabled&&t},null)("hidden",function(){return o.create("hidden")},function(e){return e.enabled=!1},null)(["verbatim","v6m"],function(){return o.create("verbatim")},function(e){return e.verbatim=!0},null)("live",function(e,t){return o.create("live",t?[t]:[])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={delay:t}},b(Number))("event",function(e,t){return o.create("event",[t])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:t}},i.TypeSignature("when"))("more",function(){return o.create("more")},function(e){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return 0!==e.Identifiers.exits?[]:[!0]}}}},null)("after",function(e,t,n){return o.create("after",[t].concat(void 0!==n?[n]:[]))},function(e,t,n){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return c.anyInputDown()&&n&&(t-=n),e.Identifiers.time>t?[!0]:[]}}}},[_,b(O)])("after-error",function(){return o.create("after-error",[])},function(n){n.enabled=!1,n.transitionDeferred=!0;var r=n.section.stackTop.tempVariables;n.data.errorEvent=function(e){e.removeData("errorEvent");var t=_objectSpread(_objectSpread({},n),{},{enabled:!0,transitionDeferred:!1});t.data&&(t.data.errorEvent=void 0),n.section.whenUnblocked(function(){return n.section.renderInto("",null,t,r)})}},[])("hook",function(e,t){var n;return t?(n=c.insensitiveName(t))?o.create("hook",[n]):u.create("datatype",'The string given to (hook:), "'.concat(t,'", contained only dashes and underscores.')):u.create("datatype","The string given to (hook:) was empty.")},function(e,t){return e.attr.push({name:t})},[String])(["for","loop"],function(e,t){if(!t.loop)return u.create("datatype","The lambda provided to (for:) must refer to a temp variable, not just 'it'.");for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return o.create("for",[t].concat(r))},function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o,i=t.filter(e.section,r);if(o=u.containsError(i))return o;e.loopVars[t.loop.getName()]=i||[]},[i.TypeSignature("where"),k(v)])(["transition","t8n"],function(e,t){return o.create("transition",[c.insensitiveName(t)])},function(e,t){return"zoom"===(e.transition=t)&&(e.transitionOrigin=function(){var e=s(this).offset(),t=e.left,e=e.top;return c.mouseCoords.x-t+"px "+(c.mouseCoords.y-e)+"px"}),e},[A])(["transition-time","t8n-time"],function(e,t){return o.create("transition-time",[t])},function(e,t){return e.transitionTime=t,e.data.passageT8n=m(e.data.passageT8n||{},{time:t}),e},[_])(["transition-delay","t8n-delay"],function(e,t){return o.create("transition-delay",[t])},function(e,t){return e.transitionDelay=t,e},[O])(["transition-skip","t8n-skip"],function(e,t){return o.create("transition-skip",[t])},function(e,t){return e.transitionSkip=t,e},[_])(["transition-depart","t8n-depart"],function(e,t){return o.create("transition-depart",[c.insensitiveName(t)])},function(e,t){return e.data.passageT8n=m(e.data.passageT8n||{},{depart:t}),"zoom"===t&&(e.data.passageT8n.departOrigin=function(){var e=s(this).offset(),t=e.left,e=e.top;return c.mouseCoords.x-t+"px "+(c.mouseCoords.y-e)+"px"}),e},[A])(["transition-arrive","t8n-arrive"],function(e,t){return o.create("transition-arrive",[c.insensitiveName(t)])},function(e,t){return e.data.passageT8n=m(e.data.passageT8n||{},{arrive:t}),"zoom"===t&&(e.data.passageT8n.arriveOrigin=function(){var e=s(this),t=e.offset(),n=t.left,t=t.top,r=e.height();return{"transform-origin":100*(c.mouseCoords.x-n)/e.width()+"% "+100*(c.mouseCoords.y-t)/r+"%",height:r+"px"}}),e},[A])("button",function(e,t){return void 0===t||f(t).size?o.create("button",t?[t]:[]):u.create("datatype",'The string given to (button:) should be a sizing line ("==X==", "==X", "=XXXX=" etc.), not '.concat(JSON.stringify(t),"."))},function(e,t){var t=f(t),n=t.marginLeft,t=t.size;return e.attr.push({class:function(){return this.className+(this.classList.contains("enchantment-button")?"":" ".repeat(0<this.className.length)+"enchantment-button")}}),e.styles.push({"margin-left":t?n+"%":void 0,width:t?t+"%":"100%"}),e},[b(String)]).apply(void 0,_toConsumableArray((d={click:{className:"enchantment-link",blockClassName:"enchantment-clickblock"},doubleclick:{className:"enchantment-dblclick",blockClassName:"enchantment-dblclickblock"},mouseover:{className:"enchantment-mouseover",blockClassName:"enchantment-mouseoverblock"},mouseout:{className:"enchantment-mouseout",blockClassName:"enchantment-mouseoutblock"}},["action",function(e,t){return o.create("action",[c.insensitiveName(t)])},function(e,t){return e.attr.push({class:function(){var e=function e(t){return(t=s(t)).is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(t.css("display"))||t.children().get().some(e)}(this);return Array.from(this.classList).filter(function(t){return!Object.keys(d).some(function(e){return d[e].className===t||d[e].blockClassName===t})}).concat(d[t][e?"blockClassName":"className"]).join(" ")}}),e},[T.apply(void 0,_toConsumableArray(Object.keys(d)))]])))(["border","b4r"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border",n.map(c.insensitiveName))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({display:function(){var e=s(this).css("display");return n.every(function(e){return"none"===e})||!e.includes("inline")?e:"inline-block"},"border-style":n.join(" "),"border-width":function(){return this.style.borderWidth||"2px"}}),e},[C].concat(_toConsumableArray(Array(3).fill(b(C)))))(["border-size","b4r-size"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border-size",n)},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-width":n.map(function(e){return e+"px"}).join(" ")}),e},[O].concat(_toConsumableArray(Array(3).fill(b(O)))))("corner-radius",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("corner-radius",n)},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-radius":n.map(function(e){return e+"px"}).join(" "),padding:function(){return this.style.padding||n.map(function(e){return e+"px"}).join(" ")}}),e},[O].concat(_toConsumableArray(Array(3).fill(b(O)))))(["border-colour","b4r-colour","border-color","b4r-color"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border-colour",n.map(function(e){return a.isPrototypeOf(e)?e.toRGBAString(e):e}))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-color":n.join(" ")}),e},[g(String,a)].concat(_toConsumableArray(Array(3).fill(b(g(String,a))))))("opacity",function(e,t){return o.create("opacity",[t])},function(e,t){return e.styles.push({opacity:t})},[t])("font",function(e,t){return o.create("font",[t])},function(e,t){return e.styles.push({"font-family":t}),e},[String])("align",function(e,t){var n=t.indexOf("><");return/^(==+>|<=+|=+><=+|<==+>)$/.test(t)?((n=~n?_objectSpread({"text-align":"center","max-width":"50%"},25===(n=Math.round(n/(t.length-2)*50))?{"margin-left":"auto","margin-right":"auto"}:{"margin-left":n+"%"}):"<"===t[0]&&">"===t.slice(-1)?{"text-align":"justify","max-width":"50%"}:t.includes(">")?{"text-align":"right"}:{"text-align":"left"}).display="block",o.create("align",[n])):u.create("datatype",'The (align:) macro requires an alignment arrow ("==>", "<==", "==><=" etc.) be provided, not "'+t+'"')},function(e,t){e.styles.push(t)},[String])(["text-colour","text-color","color","colour"],function(e,t){return o.create("text-colour",[t])},function(e,t){return a.isPrototypeOf(t)&&(t=t.toRGBAString(t)),e.styles.push({color:t}),e},[g(String,a)])(["text-size","size"],function(e,t){return o.create("text-size",[t])},function(e,t){return e.styles.push({"font-size":24*t+"px","line-height":36*t+"px"}),e},[O])("text-indent",function(e,t){return o.create("text-indent",[t])},function(e,t){return e.styles.push({"text-indent":t+"px",display:"inline-block"}),e},[O])(["text-rotate-z","text-rotate"],function(e,t){return o.create("text-rotate-z",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" rotate("+t+"deg)"}}),e},[Number])("text-rotate-y",function(e,t){return o.create("text-rotate-y",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateY("+t+"deg)"}}),e},[Number])("text-rotate-x",function(e,t){return o.create("text-rotate-x",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateX("+t+"deg)"}}),e},[Number])(["background","bg"],function(e,t){return o.create("background",[t])},function(e,t){return a.isPrototypeOf(t)?t=t.toRGBAString():r.isPrototypeOf(t)&&(t=t.toLinearGradientString()),t=a.isHexString(t)||a.isCSS3Function(t)?{"background-color":t}:t.startsWith("linear-gradient(")||t.startsWith("repeating-linear-gradient(")?{"background-image":t}:{"background-size":"cover","background-image":"url(".concat(t,")"),"background-attachment":"fixed"},e.styles.push(t,{display:function(){var e=s(this);return!e.children().length||c.childrenProbablyInline(e)?s(this).css("display"):"block"}}),e},[g(String,a,r)]).apply(void 0,_toConsumableArray((y={color:function(){return"transparent"}},p=m(Object.create(null),{none:{},bold:{"font-weight":"bold"},italic:{"font-style":"italic"},underline:{"text-decoration":"underline"},doubleunderline:{"text-decoration":"underline","text-decoration-style":"double"},wavyunderline:{"text-decoration":"underline","text-decoration-style":"wavy"},strike:{"text-decoration":"line-through"},doublestrike:{"text-decoration":"line-through","text-decoration-style":"double"},wavystrike:{"text-decoration":"line-through","text-decoration-style":"wavy"},superscript:{"vertical-align":"super","font-size":".83em"},subscript:{"vertical-align":"sub","font-size":".83em"},blink:{animation:"fade-in-out 1s steps(1,end) infinite alternate"},shudder:{animation:"shudder linear 0.1s 0s infinite"},mark:{"background-color":"hsla(60, 100%, 50%, 0.6)"},condense:{"letter-spacing":"-0.08em"},expand:{"letter-spacing":"0.1em"},outline:[{"text-shadow":function(){var e=s(this).css("color");return"-1px -1px 0 "+e+", 1px -1px 0 "+e+",-1px  1px 0 "+e+", 1px  1px 0 "+e}},{color:function(){return c.parentColours(s(this)).backgroundColour}}],shadow:{"text-shadow":function(){return"0.08em 0.08em 0.08em "+s(this).css("color")}},emboss:{"text-shadow":function(){return"0.04em 0.04em 0em "+s(this).css("color")}},smear:[{"text-shadow":function(){var e=s(this).css("color");return"0em   0em 0.02em "+e+",-0.2em 0em  0.5em "+e+", 0.2em 0em  0.5em "+e}},y],blur:[{"text-shadow":function(){return"0em 0em 0.08em "+s(this).css("color")}},y],blurrier:[{"text-shadow":function(){return"0em 0em 0.2em "+s(this).css("color")},"user-select":"none"},y],mirror:{display:"inline-block",transform:"scaleX(-1)"},upsidedown:{display:"inline-block",transform:"scaleY(-1)"},tall:{display:"inline-block",transform:"scaleY(1.5) translateY(-0.25ex)"},flat:{display:"inline-block",transform:"scaleY(0.5) translateY(0.25ex)"},fadeinout:{animation:"fade-in-out 2s ease-in-out infinite alternate"},rumble:{animation:"rumble linear 0.1s 0s infinite"},sway:{animation:"sway linear 2.5s 0s infinite"},buoy:{animation:"buoy linear 2.5s 0s infinite"},fidget:{animation:function(){return"fidget step-end 60s "+60*-Math.random()+"s infinite"+(Math.random()<.5?" reverse":"")}}}),["text-style",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("text-style",n.map(c.insensitiveName))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a+=1)"none"===n[a]?e.styles=[]:e.styles=e.styles.concat(p[n[a]]);return e},[S(T.apply(void 0,_toConsumableArray(Object.keys(p))))]])))("collapse",function(){return o.create("collapse")},function(e){return e.attr.push({collapsing:!0}),e},[])("hover-style",function(e,t){var n=l.create(),r=(t.run(n),n.summary());return r+""=="styles"||r.every(function(e){return"styles"===e||"attr"===e})&&n.attr.every(function(e){return Object.keys(e)+""=="style"})?o.create("hover-style",[t]):u.create("datatype","The changer given to (hover-style:) must only change the hook's style.")},function(e,t){return e.data.hoverChanger=t,e.attr.push({hover:function(e,t){return void 0!==t&&t}}),e},[o])("css",function(e,t){return t.trim().endsWith(";")||(t+=";"),o.create("css",[t])},function(e,t){return e.attr.push({style:function(){return(s(this).attr("style")||"")+t}}),e},[String])("test-true",function(){return o.create("test-true",[])},function(e){return e.enabled=!0},k(w))("test-false",function(){return o.create("test-false",[])},function(e){return e.enabled=!1},k(w)),e.addCommand("animate",s.noop,function(r,e,t,a,o){t.forEach(e,function(e){var t,n;"zoom"===name&&(n=(t=e.offset()).left,t=t.top,n=c.mouseCoords.x-n+"px "+(c.mouseCoords.y-t)+"px"),c.transitionIn(e,a,r.transitionTime||o,r.transitionDelay,r.transitionSkip,0,n)})},[S(n),T.apply(void 0,_toConsumableArray(A.innerType.filter(function(e){return"instant"!==e}))),b(_)]),["box","float-box"].forEach(function(i){return e.addChanger(i,function(e,t,n){var r=-1===t.search(h)||1<t.length&&!t.includes("="),a="float-box"===i&&(-1===n.search(h)||1<n.length&&!n.includes("="));return r||a?u.create("datatype","The ("+i+':) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not "'+(r?t:n)+'".'):o.create(i,[t,n].filter(function(e){return void 0!==e}))},function(e,t,n){var r,t=f(t),a=t.marginLeft,t=t.size,o=("float-box"===i&&(r=(o=f(n)).marginLeft,n=o.size),"box"===i?"%":"vw"),a=(_defineProperty(t={display:"block",width:t+o,"max-width":t+o},"box"===i?"margin-left":"left",a+o),_defineProperty(t,"overflow-y","auto"),_defineProperty(t,"padding",function(){var e=s(this).css("padding");return e&&"0px"!==e?e:"1em"}),t);return void 0!==n&&(a.height="box"===i?1.5*n+2+"em":n+"vh"),"float-box"===i&&m(a,{position:"fixed",top:r+"vh","background-color":function(){return c.parentColours(s(this)).backgroundColour}}),e.styles.push(a),e},[String,"box"===i?b(x):String])})}),define("macrolib/values",["macros","state","utils","utils/operationutils","datatypes/colour","datatypes/gradient","datatypes/datatype","datatypes/hookset","datatypes/codehook","internaltypes/twineerror"],function(t,r,e,n,l,c,a,o,i,f){var s=e.realWhitespace,u=e.nth,p=e.anyRealLetter,d=e.plural,h=n.subset,m=n.objectName,g=n.clone,y=n.toSource,e=t.TypeSignature,n=e.rest,b=e.zeroOrMore,v=e.either,w=e.optional,k=e.insensitiveSet,S=e.numberRange,T=e.percent,_=e.nonNegativeInteger,x=e.positiveInteger,e=e.Any,O=Math.max,A=Math.min,C=Math.round,E=Math.floor,N=Math.ceil;function j(t){return function(){var e=t.apply(void 0,arguments);return"number"!=typeof e||isNaN(e)?f.create("macrocall","This mathematical expression doesn't compute!"):e}}t.add(["str","string","text"],"String",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.map(function(e){return i.isPrototypeOf(e)?e.source:e}).join("")},[b(t.TypeSignature.either(String,Number,Boolean,Array,i))])("source","String",function(e,t){return"command"!==(null==t?void 0:t.TwineScript_TypeID)||t.TwineScript_ToSource?y(t):f.create("datatype","I can't construct the source code of a command created by a custom macro.")},[e])("substring","String",function(e,t,n,r){return h(t,n,r)},[String,parseInt,parseInt])("lowercase","String",function(e,t){return t.toLowerCase()},[String])("uppercase","String",function(e,t){return t.toUpperCase()},[String])("lowerfirst","String",function(e,t){return t.replace(RegExp(p+"+"),function(e){return(e=Array.from(e))[0].toLowerCase()+e.slice(1).join("").toLowerCase()})},[String])("upperfirst","String",function(e,t){return t.replace(RegExp(p+"+"),function(e){return(e=Array.from(e))[0].toUpperCase()+e.slice(1).join("").toLowerCase()})},[String])("words","Array",function(e,t){return t.split(RegExp(s+"+")).filter(Boolean)},[String])(["str-repeated","string-repeated"],"String",function(e,t,n){return 0===n.length?f.create("macrocall","I can't repeat an empty string."):n.repeat(t)},[_,String])(["str-reversed","string-reversed"],"String",function(e,t){return _toConsumableArray(t).reverse().join("")},[String])("joined","String",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return r.join(t)},[n(String)])("plural","String",function(e,t,n,r){return n&&""!==r?d(t,n,r):f.create("macrocall","The (plural:) macro can't be given empty strings.")},[parseInt,String,w(String)])(["str-nth","string-nth"],"String",function(e,t){return u(t)},[parseInt])("digit-format","String",function(e,t,n){if(1e21<=Math.abs(n))return f.create("macrocall","The number given to (digit-format:) is too big.");for(var r=/([^#0])(?=[#0]*$)/g,a=(r.exec(t)||[])[1],o=(/^[#0]*([^#0])/g.exec(t)||[])[1],i=(t=_toConsumableArray(t)).length,s=(a&&(","!==a||o&&","!==o)&&(i=r.lastIndex-1),Math.abs(n).toFixed(16).replace(/(\.\d*?)0+$/,function(e,t){return t}).replace(/^0+/,"")),c=s.includes(".")?s.indexOf("."):s.length,l=0,u="",p=t.length-1;0<=p;--p){var d=t[p];"0"===d||"#"===d?u=(s[c-i+p+l]||("0"===d?"0":""))+u:p<t.length-1&&0<p&&(u=d+u,l+=p===i?0:1)}return(n<0?"-":"")+u},[String,Number])(["num","number"],"Number",function(e,t){return Number.isNaN(+t)?f.create("macrocall","I couldn't convert "+m(t)+" to a number."):+t},[String])("datatype","Datatype",function(e,t){return a.from(t)},[e])("datapattern","Any",function(e,t){return function n(e){var r;return Array.isArray(e)?r=e.map(n):e instanceof Map?(r=new Map,_toConsumableArray(e).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];return r.set(t,n(e))})):r=a.from(e),(e=f.containsError(r))||r}(t)},[e])(["rgb","rgba"],"Colour",function(e){return l.create({r:arguments.length<=1?void 0:arguments[1],g:arguments.length<=2?void 0:arguments[2],b:arguments.length<=3?void 0:arguments[3],a:arguments.length<=4?void 0:arguments[4]})},[S(0,255),S(0,255),S(0,255),w(T)])(["hsl","hsla"],"Colour",function(e,t,n,r,a){return(t=C(t)%360)<0&&(t+=360),l.create({h:t,s:n,l:r,a:a})},[Number,T,T,w(T)])(["lch","lcha"],"Colour",function(e,t,n,r,a){return(r=C(r)%360)<0&&(r+=360),l.create({l:t,c:n,h:r,a:a})},[T,S(0,132),Number,w(T)])("complement","Colour",function(e,t){return t.LCHRotate(180)},[l])("mix","Colour",function(e,t,n,r,a){n=n.toLCHA(),a=a.toLCHA();var o=1,i=(t+r!==1&&(t+r<1&&(o=t+r),t=(i=[t/(t+r),r/(t+r)])[0],r=i[1]),n.c<2||n.l<.01||.99<n.l?n.h=a.h:(a.c<2||a.l<.01||.99<a.l)&&(a.h=n.h),n.l*=n.a,n.c*=n.a,a.l*=a.a,a.c*=a.a,180<a.h-n.h?n.h+=360:a.h-n.h<-180&&(a.h+=360),n.a*t+a.a*r),s=(n.l*t+a.l*r)/i,c=(n.c*t+a.c*r)/i,n=(n.h*t+a.h*r)/i;return l.create({l:s,c:c,h:n,a:i*o})},[T,l,T,l])("palette","Array",function(e,t,n){var r,a=n.toLCHA(),o=a.l,a={l:o<=.75?.75+o/3:.75-3*(1-o),c:80,h:a.h,a:1},i=l.create(a);return a.l+=o<=.75?-.1:.1,a.l<.5&&(a.l*=.5/a.l),r=l.create(a),a.l+=o<=.85?.15:-.15,o=l.create(a),"adjacent"===t?(r=(i=i.LCHRotate(-30)).LCHRotate(30),o=i.LCHRotate(60)):"triad"===t&&(o=i.LCHRotate(180),r=i.LCHRotate(140),i=i.LCHRotate(-140)),[n,i,r,o]},[k("mono","adjacent","triad"),l])("gradient","Gradient",function(e,t){(t=C(t)%360)<0&&(t+=360);for(var n,r,a,o=arguments.length,i=new Array(2<o?o-2:0),s=2;s<o;s++)i[s-2]=arguments[s];return i.length<4?f.create("datatype","(gradient:) must be given at least 2 colour-stop pairs of numbers and colours."):(r=[],a=i.reduce(function(e,t){if(!f.containsError(e))if(void 0===n)n=t;else{if("number"!=typeof n||!l.isPrototypeOf(t))return f.create("datatype","(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.");r.push({stop:n,colour:g(t)}),n=void 0}return e},!0),f.containsError(a)?a:void 0!==n?f.create("macrocall","This gradient has a colour-stop percent without a colour."):c.create(t,r))},[Number,n(v(T,l))])("stripes","Gradient",function(e,t,n){(t=C(t)%360)<0&&(t+=360);for(var r=0,a=[],o=arguments.length,i=new Array(3<o?o-3:0),s=3;s<o;s++)i[s-3]=arguments[s];return i.forEach(function(e){a.push({stop:r,colour:g(e)}),r+=n,a.push({stop:r,colour:g(e)})}),c.create(t,a,!0)},[Number,x,l,n(l)])("hooks-named","HookName",function(e,t){return t?o.create({type:"name",data:t}):f.create("datatype","(hooks-named:) can't be given an empty string.")},[String])("cond","Any",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a+=2){var o=n[a];if(a===n.length-1||f.containsError(o))return o;if("boolean"!=typeof o)return f.create("datatype","(cond:)'s "+u(a+1)+" value is "+m(o)+", but should be a boolean.");if(o)return n[a+1]}return f.create("macrocall","An odd number of values must be given to (cond:), not "+n.length,"(cond:) must be given one or more pairs of booleans and values, as well as one final value.")},[Boolean,e,n(e)]);({weekday:[function(){return["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][(new Date).getDay()]+"day"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var e=new Date,t=e.getHours()<12;return(e.getHours()%12||12)+":"+((e.getMinutes()<10?"0":"")+e.getMinutes())+" "+(t?"A":"P")+"M"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[A,n(Number)],max:[O,n(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[E,Number],round:[C,Number],trunc:[function(e){return(0<e?E:N)(e)},Number],ceil:[N,Number],pow:[j(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[j(Math.sqrt),Number],log:[j(Math.log),Number],log10:[j(Math.log10),Number],log2:[j(Math.log2),Number],random:[function(e,t){var n,t=t?(n=A(e,t),O(e,t)):(n=0,e);return t+=1,~~(r.random()*(t-n))+n},[parseInt,t.TypeSignature.optional(parseInt)]],"":function(){for(var e in this)e&&hasOwnProperty.call(this,e)&&t.add(e,"Number",function(a){return function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return a.apply(void 0,n)}}(this[e][0]),this[e][1])}})[""](),t.add("either","Any",function(e){var t=1+~~(r.random()*(arguments.length<=1?0:arguments.length-1));return t<1||arguments.length<=t?void 0:arguments[t]},n(e))("nth","Any",function(e,t){return t<=0?f.create("datatype","(nth:)'s first value should be a positive whole number, not "+t):(t=(t-1)%(arguments.length<=2?0:arguments.length-2)+2)<2||arguments.length<=t?void 0:arguments[t]},[parseInt,n(e)])}),!function(){var a,k={};function o(e){for(var t in e)this[t]=e[t]}function i(e,t){for(var n,r,a=e.innerText,o=null,i=0,s=i,c=a.length,l=null;i<c;){for(var u=a.slice(i),p=(o&&o.length?o[0]:e).innerMode,d=0,f=p.length;d<f;d+=1){var h=k[p[d]];if(!(h.constraint&&!h.constraint(l)||h.cannotFollowText&&("text"===(null==(w=l)?void 0:w.type)||s<i))&&(h.plainCompare?u.startsWith(h.pattern):h.pattern.test(u))){var m=h.fn(h.plainCompare?h.pattern:h.pattern.exec(u)),g=!1,y=0;if(m.matches){for(;o&&y<o.length;y+=1){var b=o[y],v=b.type,b=b.aka;if(v in m.matches){g=!0;break}b&&(v=b),-1<(null==(b=m.cannotCross)?void 0:b.indexOf(v))&&(y=o.length-1)}if((!o||y>=o.length)&&!m.isFront)continue}s<i&&e.addChild({type:"text",text:a.slice(s,i),innerMode:p});var s=i+=(l=e.addChild(m)).text.length,w=!1;g&&(t&&S(e,l,o[y]),o=o.slice(y+1),w=!0),!w&&l.isFront&&(o?o.unshift(l):o=[l]);break}}d===f&&(i+=1,null===l)&&(l={type:"text"})}for(s<i&&e.addChild({type:"text",text:a.slice(s,i),innerMode:(null!=(n=o)&&n.length?o[0]:e).innerMode});0<(null==(r=o)?void 0:r.length);)o.shift().demote();return e}function S(e,t,n){var r=e.children.indexOf(t),a=e.children.indexOf(n);t.children=e.children.splice(a+1,r-(a+1)),t.type=t.matches[n.type],t.innerText="";for(var o,i=0,s=t.children.length;i<s;i++)t.innerText+=t.children[i].text;for(o in t.start=n.start,t.text=n.text+t.innerText+t.text,n)hasOwnProperty.call(n,o)&&!hasOwnProperty.call(t,o)&&(t[o]=n[o]);t.isFront&&(t.isFront=!1),e.children.splice(a,1)}o.prototype={constructor:o,addChild:function(e){var t=this.lastChildEnd(),n=new o(e);return n.start=t,n.end=e.text&&t+e.text.length,n.place=this.place,n.children=[],n.innerText&&i(n),this.children.push(n),n},lastChildEnd:function(){var e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(var t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){var n=this.children[t].tokenAt(e);if(n)return n}return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];var t=[];if(this.children.length)for(var n=0;n<this.children.length;n+=1)if(e>=this.children[n].start&&e<this.children[n].end){var r=this.children[n].pathAt(e);if(r.length){t=t.concat(r);break}}return t.concat(this)},nearestTokenAt:function(n){return n<this.start||n>=this.end?null:this.children?this.children.reduce(function(e,t){return e||(n>=t.start&&n<t.end?t:null)},null):this},everyLeaf:function(n){return this.children&&0!==this.children.length?this.children.reduce(function(e,t){return e&&t.everyLeaf(n)},!0):!!n(this)},demote:function(){this.type="text"},error:function(e){this.type="error",this.message=e},toString:function(){var e=this.type+"("+this.start+"\u2192"+this.end+")";return this.children&&0<this.children.length&&(e+="["+this.children+"]"),e},copy:function(){var e=new o(this);return e.children=e.children.slice(),e},foldChildren:function(){for(var e=[],t=this.children.slice(),n=0;n<t.length;n+=1){var r=t[n],a=!1;if(r.matches)for(var o=0;o<e.length;o+=1)e[o].type in r.matches&&(S(this,r,e[o]),e=e.slice(o+1),a=!0);!a&&r.isFront&&e.unshift(r)}}},a={lex:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"start",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return i(new o({type:"root",place:t,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:a.modes[n]}),!r)},rules:k,modes:{}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=a:"function"==typeof define&&define.amd?define("lexer",[],function(){return a}):this&&null!=this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=a):this.Lexer=a}.call(eval("this")||("undefined"!=typeof global?global:window)),!function(){Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var m,g=Object.keys,y=Object.assign;function t(e){function t(n){return n=n||"innerText",function(e){var e=e.reduceRight(function(e,t,n){return e||(n?t:"")},""),t={};return t[n]=e,t}}function n(e,t){var n={};return n[e]=t,function(){return{isFront:!0,matches:n,cannotCross:["verbatimOpener"]}}}var r=Object.bind(0,null);function a(a,e){return Object.keys(e).forEach(function(n){var r=e[n].fn;e[n].fn=function(e){var t=r(e);return t.text||(t.text="string"==typeof e?e:e[0]),t.type||(t.type=n),t.innerMode||(t.innerMode=a),t}}),e}function o(e){switch(e&&e.type){case null:case"br":case"hr":case"bulleted":case"numbered":case"heading":case"align":case"column":case"escapedLine":return!0}return!1}var i=[],s=[],c=[],l=a(i,{hr:{fn:r},bulleted:{fn:function(e){return{depth:e[1].length}}},numbered:{fn:function(e){return{depth:e[1].length/2}}},heading:{fn:function(e){return{depth:e[1].length}}},align:{fn:function(e){var t,e=e[1],n=e.indexOf("><");return~n?25===(t=Math.round(n/(e.length-2)*50))&&(t="center"):"<"===e[0]&&">"===e.slice(-1)?t="justify":-1<e.indexOf(">")?t="right":-1<e.indexOf("<")&&(t="left"),{align:t}}},column:{fn:function(e){var t,e=e[1],n=e.indexOf("|");return n&&n<e.length-1?t="center":"|"===e[0]&&"|"===e.slice(-1)?t="none":n===e.length-1?t="right":n||(t="left"),{column:t,width:/\|+/.exec(e)[0].length,marginLeft:/^=*/.exec(e)[0].length,marginRight:/=*$/.exec(e)[0].length}}}}),u=(g(l).forEach(function(e){l[e].constraint=o,l[e].cannotFollowText=!0}),a(i,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."}}},emBack:{fn:function(){return{matches:{emFront:"em"},cannotCross:["verbatimOpener"]}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:n("boldOpener","bold")},italicOpener:{fn:n("italicOpener","italic")},strikeOpener:{fn:n("strikeOpener","strike")},supOpener:{fn:n("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:r},tag:{fn:r},url:{fn:r},hookPrependedFront:{fn:function(e){return{name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"}}},hookFront:{fn:function(){return{isFront:!0}}},hookBack:{fn:function(){return{matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]}}},hookAppendedBack:{fn:function(e){return{name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]}}},unclosedHook:{fn:r},unclosedHookPrepended:{fn:function(e){return{type:"unclosedHook",name:e[1],hidden:")"===e[2]}}},verbatimOpener:{fn:function(e){var e=e[0].length,t={};return{type:(t["verbatim"+e]="verbatim")+e,isFront:!0,matches:t,aka:"verbatimOpener"}}},unclosedCollapsed:{fn:r},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]}}},escapedLine:{fn:r},legacyLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[2],innerMode:i}}},br:{fn:r}})),p=y(a(s,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener","hookFront"]}}},passageLink:{fn:function(e){var t=e[1]||"",n=e[2]||"",e=e[3]||"";return{type:"twineLink",innerText:n?e:t,passage:t?e:n,innerMode:i}}},simpleLink:{fn:function(e){return{type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:i}}},variable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:t("name")},tempVariable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:t("name")}}),{hookFront:u.hookFront,hookBack:u.hookBack}),d=a(s,_objectSpread(_objectSpread({commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},macroName:{constraint:function(e){return e&&"macroFront"===e.type},fn:t("name")},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:t("name"),constraint:function(e){if(e)switch(e.type){case"variable":case"hookName":case"property":case"tempVariable":case"colour":case"itsProperty":case"belongingItProperty":case"macro":case"grouping":case"string":case"datatype":case"hook":case"boolean":case"number":return!0}}},possessiveOperator:{fn:r},itsProperty:{cannotFollowText:!0,fn:t("name")},itsOperator:{cannotFollowText:!0,fn:r},belongingItProperty:{cannotFollowText:!0,fn:t("name")},belongingItOperator:{cannotFollowText:!0,fn:r},belongingProperty:{cannotFollowText:!0,fn:t("name")},belongingOperator:{cannotFollowText:!0,fn:r},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"},innerMode:c}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"},innerMode:c}}},hookName:{fn:t("name")},cssTime:{fn:function(e){return{value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)}}},datatype:{cannotFollowText:!0,fn:function(e){return{name:e[0].toLowerCase()}}},colour:{cannotFollowText:!0,fn:function(e){var e=e[0].toLowerCase(),t={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"},t=hasOwnProperty.call(t,e)?"#"+t[e]:e;return{colour:t}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},inequality:{fn:function(e){return{operator:e[2],negate:-1<e[1].indexOf("not")}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:t("name"),cannotFollowText:!0},whitespace:{fn:r,cannotFollowText:!0},incorrectOperator:{fn:function(e){var t={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:"Please say "+(t?"'"+t+"'":"something else")+" instead of '"+e[0]+"'.",explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollowText:!0}},["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","bind"].reduce(function(e,t){return e[t]={fn:r,cannotFollowText:!0},e},{})),["comma","spread","typeSignature","addition","subtraction","multiplication","division"].reduce(function(e,t){return e[t]={fn:r},e},{}))),f=a(c,{singleStringCloser:d.singleStringOpener,doubleStringCloser:d.doubleStringOpener,escapedStringChar:d.escapedStringChar}),h=(i.push.apply(i,_toConsumableArray(g(l)).concat(_toConsumableArray(g(p)),_toConsumableArray(g(u)))),s.push.apply(s,_toConsumableArray(g(p)).concat(_toConsumableArray(g(d)))),c.push.apply(c,_toConsumableArray(g(f))),_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({},l),u),p),d),f)),u=(g(h).forEach(function(e){m.PlainCompare[e]?(h[e].pattern=m.PlainCompare[e],h[e].plainCompare=!0):h[e].pattern=RegExp("^(?:"+m[e]+")","i")}),y(e.rules,h),e.modes);return u.start=u.markup=i,u.macro=s,u.string=c,e}function n(e){return Object.freeze({lex:t(e).lex,Patterns:m})}"object"===("undefined"==typeof module?"undefined":_typeof(module))?(m=require("./patterns"),module.exports=n(require("./lexer"))):"function"==typeof define&&define.amd?define("markup",["lexer","patterns"],function(e,t){return m=t,n(e)}):this&&this.loaded&&this.modules?(m=this.modules.Patterns,this.modules.Markup=n(this.modules.Lexer)):(m=this.Patterns,this.Markup=n(this.Lexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),!function(){var e;function n(t){return t&&"object"===_typeof(t)?(Object.keys(t).forEach(function(e){t[e]=n(t[e])}),t):(t+"").replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function t(e){return function(){return"("+e+Array.apply(0,arguments).join("|")+")"}}var r=t("?:"),a=t("?!"),o=t("?="),i="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",s=i.replace("*","+"),c="\\b",l="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",u=l.replace("\\-",""),p=r("\\n","$"),d=i+"(\\*+)"+s,f=i+"((?:0\\.)+)"+s,h=i+"-{3,}"+i+p,m=i+"(==+>|<=+|=+><=+|<==+>)"+i+p,p=i+"(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)"+i+p,g={opener:"\\[\\[(?!\\[)",text:"("+function(){return"[^"+Array.apply(0,arguments).map(n).join("")+"]*"}("]")+")",rightSeparator:r("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+r("[^\\|\\]]","\\]"+a("\\]"))+"+)"},y=u+"*"+u.replace("\\w","a-zA-Z")+u+"*",b="\\$("+y+")",v="_("+y+")",w="'s"+s+a("_")+"("+y+")",k="("+y+")"+s+"of"+c+a("it\\b"),S="'s"+s,T=r("it","time","turns?","visits?","exits?","pos")+c,_="its"+s+"("+y+")",x="("+y+")"+s+"of"+s+"it"+c,O="of"+s+"it"+c,A={opener:"\\(",name:"("+r("\\$","_")+"?"+l+"+):"+a("\\/"),closer:"\\)"},C=r("=<","=>","[gl]te?\\b","n?eq\\b","isnot\\b","are\\b","x\\b","isa\\b","or"+s+"a"+c),E="[a-zA-Z][\\w\\-]*",N="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",j="\\|("+l+"+)(>|\\))",P="(<|\\()("+l+"+)\\|",R="((?:\\b\\d+(?:\\.\\d+)?|\\.\\d+)(?:[eE][+\\-]?\\d+)?)"+a("m?s")+c;g.main=g.opener+r(g.text+g.rightSeparator,g.text.replace("*","*?")+g.leftSeparator)+g.text,e={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:l,anyLetterStrict:u,whitespace:s.replace("[","[\\n\\r"),escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",tag:"<\\/?"+E+N+">",scriptStyleTag:"<("+r("script","style","textarea")+")"+N+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+r("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:"\\*",hr:h,heading:"[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*(#{1,6})[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",align:m,column:p,bulleted:d,numbered:f,verbatimOpener:"`+",hookAppendedFront:"\\["+a("=+"),hookPrependedFront:j+"\\["+a("=+"),hookFront:"\\["+a("=+"),hookBack:"\\]"+a(P),hookAppendedBack:"\\]"+P,unclosedHook:"\\[=+",unclosedHookPrepended:j+"\\[=+",unclosedCollapsed:"\\{=+",passageLink:g.main+g.closer,legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,simpleLink:g.opener+g.legacyText+g.closer,macroFront:A.opener+o(A.name),macroName:A.name,groupingFront:"\\("+a(A.name),twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",validPropertyName:y,property:w,belongingProperty:k,possessiveOperator:S,belongingOperator:"of\\b",itsOperator:"its\\b",belongingItOperator:O,variable:b,tempVariable:v,hookName:"\\?("+l+"+)\\b",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)\\b",colour:r(r("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:r("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","codehook","colou?r","const","command","dm","data"+r("map","type","set"),"ds","digit","gradient","empty","even","int"+a("o")+"(?:eger)?","lambda","lowercase","macro","linebreak","newline","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+c,number:R,boolean:r("true","false")+c,identifier:T,itsProperty:_,belongingItProperty:x,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:"is"+a(s+"not"+c,s+"an?"+c,s+"in"+c,s+"<",s+">")+c,isNot:"is"+s+"not"+a(s+r("an?","in")+c)+c,isA:"is"+s+"an?"+c,isNotA:"is"+s+"not"+s+"an?"+c,matches:"matches\\b",doesNotMatch:"does"+s+"not"+s+"match"+c,and:"and\\b",or:"or\\b",not:"not\\b",inequality:"((?:is(?:"+s+"not)?"+i+")*)("+r("<(?!=)","<=",">(?!=)",">=")+")",isIn:"is"+s+"in"+c,contains:"contains\\b",doesNotContain:"does"+s+"not"+s+"contain"+c,isNotIn:"is"+s+"not"+s+"in"+c,addition:n("+")+a("="),subtraction:n("-")+a("=","type"),multiplication:n("*")+a("="),division:r("/","%")+a("="),spread:"\\.\\.\\."+a("\\."),to:r("to\\b","="),into:"into\\b",making:"making\\b",where:"where\\b",when:"when\\b",via:"via\\b",each:"each\\b",augmentedAssign:r("\\+","\\-","\\*","\\/","%")+"=",bind:"2?bind\\b",typeSignature:n("-type")+c,incorrectOperator:C,PlainCompare:{comma:",",commentFront:"\x3c!--",commentBack:"--\x3e",strikeOpener:"~~",italicOpener:"//",boldOpener:"''",supOpener:"^^",strongFront:"**",strongBack:"**",emFront:"*",emBack:"*",collapsedFront:"{",collapsedBack:"}",groupingBack:")"}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("patterns",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=e):this.Patterns=e}.call(eval("this")||("undefined"!=typeof global?global:window)),define("twinescript/operations",["utils","utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/twineerror"],function(e,t,n,r,m){var a=e.plural,o=t.isObject,i=t.collectionType,s=t.is,c=t.isA,l=t.clone,u=t.unique,p=t.contains,e=t.matches,g=t.objectName,d=t.toSource;function f(r,a,o,i){return o=o||"do this to",function(e,t){var n;return 1===a.length&&(t=e),(n=m.containsError(e,t))||(_typeof(e)!==r||_typeof(t)!==r?m.create("operation","I can only ".concat(o," ").concat(r,"s, not ").concat(g(_typeof(e)!==r?e:t),"."),i):a(e,t))}}function h(a){return function(e,t){var n,r;return(n=m.containsError(e,t))||(_typeof(e)!==_typeof(t)||o(e)&&"TwineScript_TypeName"in e&&o(t)&&"TwineScript_TypeName"in t&&e.TwineScript_TypeName!==t.TwineScript_TypeName||i(e)!==i(t)?(n="".concat(g(e)," isn't the same type of data as ").concat(g(t)),_typeof(e)+_typeof(t)!=="stringnumber"&&_typeof(e)+_typeof(t)!=="numberstring"||(r="You might want to convert one side to a number using (num:), or to a string using (str:)."),m.create("operation",n[0].toUpperCase()+n.slice(1),r)):a(e,t))}}function y(d,f,e){var h=2<arguments.length&&void 0!==e&&e;return function r(a,o){var e;if(e=m.containsError(a,o))return e;var t=_slicedToArray(a.determiner?[a,o]:o.determiner?[o,a]:[],2),i=t[0],t=t[1];if(i){var n=i,s=n.determiner,n=n.determined;if("start"===s||"end"===s){if(f)return m.create("operation","I can't use '".concat(f,"' with the 'start' or 'end' of ").concat(g(n),"."));if(t.determiner){if("start"===t.determiner||"end"===t.determiner)return m.create("operation","I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.","Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.");n=[t,i],i=n[0]}for(var c=i.string||i.array,l=0;l<c.length+1;l+=1){var u=l?"end"===s?c.slice(-l):c.slice(0,l):c.constructor(),u=i===a?r(u,o):r(a,u);if(e=m.containsError(u))return e;if(u!==h)return u}return h}var p="all"===s;return i.array.reduce(function(e,t){var n,t=i===a?r(t,o):r(a,t);return(n=m.containsError(e,t))||(p?e&&t:e||t)},p)}return d(a,o)}}function b(n,e){return y(function(e,t){e=n(e,t);return m.containsError(e)?e:!e},e,!0)}t="If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \"\" '.",t={and:f("boolean",h(function(e,t){return e&&t}),"use 'and' to join",t),or:f("boolean",h(function(e,t){return e||t}),"use 'or' to join",t),not:f("boolean",function(e){return!e},"use 'not' to invert",t),"+":h(function(e,t){var n;return Array.isArray(e)?[].concat(_toConsumableArray(e),_toConsumableArray(t)):e instanceof Map?(n=new Map(e),t.forEach(function(e,t){return n.set(t,e)}),n):e instanceof Set?new Set([].concat(_toConsumableArray(e),_toConsumableArray(t)).filter(u).map(l)):"function"==typeof e["TwineScript_+"]?e["TwineScript_+"](t):"string|number|boolean".includes(_typeof(e))?e+t:m.create("operation","I can't use + on ".concat(g(e),"."))}),"-":h(function(e,n){var r;return Array.isArray(e)?e.filter(function(t){return!n.some(function(e){return s(t,e)})}):e instanceof Set?(r=_toConsumableArray(n),new Set(_toConsumableArray(e).filter(function(t){return!r.some(function(e){return s(t,e)})}))):"string"==typeof e?e.split(n).join(""):"number"==typeof e?e-n:m.create("operation","I can't use - on ".concat(g(e),"."))}),"*":f("number",h(function(e,t){return e*t}),"multiply"),"/":f("number",h(function(e,t){return 0===t?m.create("operation","I can't divide ".concat(g(e)," by zero.")):e/t}),"divide"),"%":f("number",h(function(e,t){return 0===t?m.create("operation","I can't modulo ".concat(g(e)," by zero.")):e%t}),"modulus"),"<":y(f("number",h(function(e,t){return e<t}),"do < to"),"<"),">":y(f("number",h(function(e,t){return t<e}),"do > to"),">"),"<=":y(f("number",h(function(e,t){return e<=t}),"do <= to"),"<="),">=":y(f("number",h(function(e,t){return t<=e}),"do >= to"),">="),is:y(s),isNot:b(s),contains:y(p,"contains"),doesNotContain:b(p,"does not contain"),isIn:y(function(e,t){return p(t,e)},"is in"),isNotIn:b(function(e,t){return p(t,e)},"is not in"),isA:y(c,"is a"),isNotA:b(c,"is not a"),typifies:y(function(e,t){return c(t,e)}),untypifies:b(function(e,t){return c(t,e)}),matches:y(e),doesNotMatch:b(e),makeSpreader:function(e){var t;return m.containsError(e)?e:n.isPrototypeOf(e)||r.isPrototypeOf(e)?(t=l(e),(n.isPrototypeOf(e)?t.datatype:t).rest=!0,t):{value:e,spreader:!0,TwineScript_TypeName:"a spreaded '...' value",TwineScript_ObjectName:a("string"==typeof e||Array.isArray(e)?_toConsumableArray(e).length:1,"spreaded '...' value"),TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return""+_toConsumableArray(e).map(d)}}}};return Object.freeze(t)}),define("twinescript/runner",["macros","state","utils","utils/operationutils","twinescript/operations","datatypes/colour","datatypes/hookset","datatypes/lambda","datatypes/datatype","datatypes/varbind","datatypes/codehook","datatypes/typedvar","datatypes/assignmentrequest","internaltypes/varref","internaltypes/twineerror"],function(Macros,State,Utils,_ref127,Operations,Colour,HookSet,Lambda,Datatype,VarBind,CodeHook,TypedVar,AssignmentRequest,VarRef,TwineError){var toSource=_ref127.toSource,typeName=_ref127.typeName,objectName=_ref127.objectName,insensitiveName=Utils.insensitiveName,impossible=Utils.impossible,hash=Utils.hash;function addFreeVariable(e,t){var n,r=e.freeVariables;"macro"===t.type?"current-time"===(n=insensitiveName(t.name))||"current-date"===n||"monthday"===n||"weekday"===n||"history"===n||"visited"===n||"passage"===n?e.freeVariables=!0:t.blockedValue&&!r.blockedValues?r.blockedValues=e.stackTop.blockedValues.concat():"random"!==n&&"either"!==n&&"shuffled"!==n||r.seed||(r.seed=State.seed,r.seedIter=State.seedIter):"identifier"===t.type?"time"!==(n=insensitiveName(t.text))&&"exits"!==n&&"it"!==n&&"visits"!==n&&"turns"!==n||(e.freeVariables=!0):"property"===t.type||"belongingProperty"===t.type?"random"!==insensitiveName(t.name)||r.seed||(r.seed=State.seed,r.seedIter=State.seedIter):"variable"!==t.type&&"tempVariable"!==t.type||(e.freeVariables=!0)}var precedenceTable=[["error","text"],["comma"],["to","into"],["where","when","via","making","each"],["typeSignature"],["augmentedAssign"],["and","or"],["is","isNot"],["contains","doesNotContain","isIn","isNotIn"],["isA","isNotA","matches","doesNotMatch"],["inequality"],["addition","subtraction"],["multiplication","division"],{rightAssociative:["spread","bind"]},{rightAssociative:["not","positive","negative"]},{rightAssociative:["belongingProperty","belongingItProperty","belongingOperator","belongingItOperator"]},["property","itsProperty","possessiveOperator","itsOperator"],["twineLink","macro","identifier","variable","tempVariable","hookName","number","cssTime","boolean","string","hook","colour","datatype","root"],["grouping"]];function precedentToken(e,t){var n,r,a,o=[];if(e.length)for("most"===t?(n=precedenceTable.length-1,r=a=-1):(n=0,r=precedenceTable.length,a=1);n!==r;n+=a){var i=precedenceTable[n],s=NaN;if(i.rightAssociative){for(var c=0;c<e.length;c+=1)if(i.rightAssociative.includes(e[c].type)){s=c;break}}else for(var l=e.length-1;0<=l;--l)if(i.includes(e[l].type)){s=l;break}if(!Number.isNaN(s)&&-1<s){o=[e[s],s];break}}return o}var comparisonOpTypes=["inequality","is","isNot","isIn","contains","doesNotContain","isNotIn","isA","typifies","isNotA","untypifies","matches","doesNotMatch"],inequalityNegator={">":"<=","<":">=",">=":"<","<=":">"};function compileComparisonOperator(e){return"inequality"===e.type?e.negate?inequalityNegator[e.operator]:e.operator:e.type}var comparisonReverser={">":"<","<":">",">=":"<=","<=":">=",contains:"isIn",doesNotContain:"isNotIn",isIn:"contains",isA:"typifies",typifies:"isA",isNotA:"untypifies",untypifies:"isNotA"};function reverseComparisonOperator(e){e=compileComparisonOperator(e);return comparisonReverser[e]||e}var tokenSides={error:"neither",identifier:"neither",variable:"neither",tempVariable:"neither",hookName:"neither",number:"neither",boolean:"neither",string:"neither",hook:"neither",colour:"neither",datatype:"neither",root:"neither",twineLink:"neither",macro:"neither",grouping:"neither",itsProperty:"neither",belongingItProperty:"neither",to:"both",into:"both",typeSignature:"both",augmentedAssign:"both",and:"both",or:"both",belongingOperator:"both",possessiveOperator:"both",multiplication:"both",division:"both",spread:"after",bind:"after",not:"after",belongingProperty:"after",each:"after",itsOperator:"after",positive:"after",negative:"after",belongingItOperator:"before",property:"before"};function missingSideError(e,t,n){return TwineError.create("syntax","I need usable code to be ".concat(e?"left ":"").concat(e&&t?"and ":"").concat(t?"right ":"","of ").concat(n.text,"."))}function wrongSideError(e,t,n){return TwineError.create("syntax","There can't be a ".concat(e&&t?e.map(function(e){return e.text}).join("")+" or "+t.map(function(e){return e.text}).join(""):(e||t).map(function(e){return e.text}).join("")," to the ").concat(e?"left ":"").concat(e&&t?"or ":"").concat(t?"right ":"","of ").concat(n.text,"."),"There could be a comma missing between them.")}function makeEvalReplayFrame(e,t){var n=t.val,r=t.fromCode,a=t.toCode,o=t.toDesc,i=t.reason,s=t.it,c=t.tokens,t=t.i;if(!(200<=e.length)){var l=c[t],u=c.slice(0,t),t=c.slice(t+1);if(1===c.length&&(u=t=!1,l=c[0]),!e[e.length-1].error){var p,d,c=TwineError.containsError(n),f=e[e.length-1].code,h=e[0].basis,m=(null!=(p=u)&&p.length&&null!=(p=t)&&p.length&&u[0].start>t[0].start&&(u=(p=[t,u])[0],t=p[1]),p=a||"".concat(null!=(p=u)&&p.length&&"whitespace"===u[u.length-1].type?" ":"").concat(c?" \ud83d\udc1e ":(n&&!n.TwineScript_ToSource&&n.TwineScript_Unstorable?objectName:toSource)(n)).concat(null==(p=t)||!p.length||"whitespace"!==t[0].type&&"addition"!==l.type&&"subtraction"!==l.type?"":" "),(u.length?u[0]:l).start-h),g=(t.length?t[t.length-1]:l).end-h,y=_createForOfIteratorHelper(e);try{for(y.s();!(d=y.n()).done;){var b=d.value;b.start<m?(m+=b.diff,g+=b.diff):b.start<g&&(g+=b.diff)}}catch(e){y.e(e)}finally{y.f()}!r&&(r=f.slice(m,g),a)&&a.trim()===r.trim()||(u=p.length-(g-m),e.push({code:f.slice(0,m)+p+f.slice(g),fromCode:r,toCode:!c&&a,toDesc:!c&&!a&&(o||objectName(n)),start:m,end:g,diff:u,reason:i,itIdentifier:void 0!==s&&objectName(s),error:c&&c.render(f.slice(m,g),!0)}))}}}function setIt(e,t){return(VarRef.isPrototypeOf(t)||TypedVar.isPrototypeOf(t))&&(e.Identifiers.it=t.get()),t}return function run(section,tokens){var isVarRef=2<arguments.length&&void 0!==arguments[2]&&arguments[2],isTypedVar=3<arguments.length&&void 0!==arguments[3]&&arguments[3],evalReplay=section.evalReplay,hasEvalReplay=null==evalReplay?void 0:evalReplay.length,evalReplayReason,evalReplaySkip=!1,evalReplayIt,ops=Operations,token,ret,i,before,after,_precedentToken,_precedentToken2,token,i,before,after;if(Array.isArray(tokens)||(tokens=[tokens]),!tokens.length||!tokens[0])return impossible("Runner.run","No tokens to run!"),0;1===tokens.length?token=tokens[0]:(_precedentToken=precedentToken(tokens,"least"),_precedentToken2=_slicedToArray(_precedentToken,2),token=_precedentToken2[0],i=_precedentToken2[1],before=tokens.slice(0,i),after=tokens.slice(i+1),before.length&&(1!==before.length||"whitespace"!==before[0].type)||(before=!1),after.length&&(1!==after.length||"whitespace"!==after[0].type)||(after=!1));var type=token.type;if(!type)return impossible("Runner.run","Token has no type!"),0;var sides=tokenSides[type]||"",VARREF=("both"!==sides||before&&after?"neither"===sides&&(before||after)?ret=wrongSideError(before,after,token):"before"===sides?before?after&&(ret=wrongSideError(null,after,token)):ret=missingSideError(!0,!1,token):"after"===sides&&(after?before&&(ret=wrongSideError(before,null,token)):ret=missingSideError(!1,!0,token)):ret=missingSideError(!before,!after,token),section.freeVariables&&"object"===_typeof(section.freeVariables)&&addFreeVariable(section,token),!0),TYPEDVAR=!0,_ret4,val,evalReplayReason,ret,source,_source4,_value4,msg;if(!ret){if("comma"===type)return impossible("Section.run","a comma token was run() somehow."),0;if("root"===type)ret=run(section,token.children);else if("identifier"===type)ret=isVarRef?VarRef.create(section.Identifiers,token.text.toLowerCase()):section.Identifiers[token.text.toLowerCase()];else if("variable"===type||"tempVariable"===type){ret=VarRef.create("tempVariable"===type?section.stackTop.tempVariables:State.variables,token.name),isTypedVar?(ret=TypedVar.create(Datatype.create("any"),ret),evalReplayReason=hasEvalReplay&&"Variables in 'to' or 'into' expressions with no -type to their left are considered to be 'any-type' variables that can store any storable value."):isVarRef||TwineError.containsError(ret)?evalReplaySkip=!0:(val=ret.get(),evalReplayReason=hasEvalReplay&&((null==(_ret4=ret)?void 0:_ret4.object)!==State.variables||hasOwnProperty.call(ret.object,ret.compiledPropertyChain[0])?"":"This variable didn't exist; for story-wide $ variables, a default value of 0 is used if they don't exist."),ret=val)}else if("hookName"===type)ret=HookSet.create({type:"name",data:token.name}),evalReplaySkip=!0;else if("number"===type||"cssTime"===type)ret=token.value,evalReplayReason=hasEvalReplay&&"cssTime"===type&&(token.text.endsWith("ms")?"The letters 'ms' at the end of numbers are ignored, so you can use them to indicate that a number represents milliseconds.":"The letter 's' at the end of numbers represents 'seconds'. Harlowe converts them to milliseconds (multiplies them by 1000)."),evalReplaySkip=!evalReplayReason;else if("boolean"===type)ret="true"===token.text.toLowerCase(),evalReplaySkip=!0;else if("string"===type){var t=token.text.replace(/(.?)\n/g,function(e,t){return("\\"===t?"\\\\":"\n"===t?"\\n":t)+"\\n"}).replace(/(\\*)\\0/g,function(e,t){return(t?"\\".repeat(2*t.length):"")+"0"});ret=eval(t),evalReplaySkip=!0}else if("hook"===type)ret=CodeHook.create(token.children,token.text),evalReplaySkip=!0;else if("colour"===type)ret=Colour.create(token.colour),evalReplaySkip=!0;else if("datatype"===type)ret=Datatype.create(token.name),evalReplaySkip=!0;else if("spread"===type)ret=ops.makeSpreader(run(section,after,!1,isTypedVar));else if("bind"===type)ret=VarBind.create(run(section,after,VARREF),token.text.startsWith("2")?"two way":""),evalReplaySkip=!0;else if("to"===type||"into"===type){var dest="to"===type?setIt(section,run(section,before,VARREF,TYPEDVAR)):run(section,after,VARREF,TYPEDVAR);if(TwineError.containsError(dest))ret=dest;else{(VarRef.isPrototypeOf(dest)&&dest.propertyChain.length<=1||TypedVar.isPrototypeOf(dest)&&dest.varRef.propertyChain.length<=1)&&(section.freeVariables=Object.create(null));var src="to"===type?run(section,after,VARREF):setIt(section,run(section,before,VARREF));if(TwineError.containsError(src))return src;var freeVariables=section.freeVariables,srcRef;section.freeVariables=null,token.place&&freeVariables&&"object"===_typeof(freeVariables)&&"boolean"!=typeof src&&"number"!=typeof src&&!Utils.options.uncompressedPureValues&&(srcRef=freeVariables,srcRef.at=token.place,srcRef.from=after[0].start,srcRef.to=after[after.length-1].end,srcRef.hash=hash(after.reduce(function(e,t){return e+t.text},"")).toString(16),JSON.stringify(srcRef).length>=toSource(src).length)&&(srcRef=void 0),ret=AssignmentRequest.create(dest,src,type,srcRef),evalReplaySkip=!0,evalReplayIt=section.Identifiers.it}}else if("typeSignature"===type){var datatype=run(section,before),free=section.freeVariables,variable=(section.freeVariables=null,run(section,after,VARREF));section.freeVariables=free,ret=TypedVar.create(datatype,variable),evalReplaySkip=!0}else if("where"===type||"when"===type||"via"===type){after?(source=tokens.map(function(e){return e.text}).join(""),ret=Lambda.create(before?run(section,before,VARREF):void 0,token.type,after,source),evalReplaySkip=!0):ret=missingSideError(!1,!0,token)}else if("making"===type||"each"===type){after?(_source4=[].concat(tokens).map(function(e){return e.text}).join(""),ret="each"===type?Lambda.create(run(section,after,VARREF),"each",null,_source4):Lambda.create(before?run(section,before,VARREF):void 0,token.type,run(section,after,VARREF),_source4),evalReplaySkip=!0):ret=missingSideError(!1,!0,token)}else if("augmentedAssign"===type)ret=ops.makeAssignmentRequest(run(section,before,VARREF),ops[token.operator](run(section,before),run(section,after)),token.operator),evalReplaySkip=!0;else if("and"===type||"or"===type){var isComparisonOp=function e(t){var n=_slicedToArray(precedentToken(t,"least"),2),r=n[0],n=n[1];if(r&&"whitespace"!==r.type)return comparisonOpTypes.includes(r.type)?r:r.type===type?e(t.slice(0,n))||e(t.slice(n+1)):void 0},leftIsComparison=isComparisonOp(before),rightIsComparison=isComparisonOp(after),ambiguityError=TwineError.create("operation",'This use of "is not" and "'.concat(type,'" is grammatically ambiguous.'),'Maybe try rewriting this as "__ is not __ '.concat(type,' __ is not __"')),operator,getElisionOperands=function e(t){var n,r=_slicedToArray(precedentToken(t,"least"),2),a=r[0],r=r[1];return a&&"whitespace"!==a.type?a.type===type?[].concat(_toConsumableArray(e(t.slice(0,r))),_toConsumableArray(e(t.slice(r+1)))):(a=run(section,t),hasEvalReplay&&"boolean"!=typeof a&&(n=operator.replace(/[A-Z]/g,function(e){return" "+e.toLowerCase()}),makeEvalReplayFrame(evalReplay,{toCode:" it ".concat(n," ").concat(toSource(a)," "),reason:"A missing 'it ".concat(n,"' was inferred to correct the '").concat(type,"' operation."),tokens:t,i:r}),makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(section.Identifiers.it)," ").concat(n," ").concat(toSource(a)," "),tokens:t,i:r})),[{val:a,tokens:t,i:r}]):[]},elidedComparisonOperator=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){var n=t.val,r=t.tokens,t=t.i;return"boolean"==typeof n?n:(e=Operations[token.type](e,Operations[operator](section.Identifiers.it,n)),hasEvalReplay&&makeEvalReplayFrame(evalReplay,{val:e,tokens:r,i:t}),e)},"and"===token.type)},leftSide,evalBefore,operator,rightSide,rightIndex,swappedSides,evalAfter;ret=leftIsComparison&&!rightIsComparison?(leftSide=leftIsComparison,operator=compileComparisonOperator(leftSide),"isNot"===leftSide.type||"isNotA"===leftSide.type||"untypifies"===leftSide.type?ambiguityError:(evalBefore=run(section,before),ops[type](evalBefore,elidedComparisonOperator.apply(void 0,_toConsumableArray(getElisionOperands(after)))))):!leftIsComparison&&rightIsComparison?(rightSide=rightIsComparison,rightIndex=tokens.indexOf(rightSide),operator=reverseComparisonOperator(rightSide),"isNot"===rightSide.type||"isNotA"===rightSide.type||"untypifies"===rightSide.type?ambiguityError:(swappedSides=[].concat(_toConsumableArray(tokens.slice(rightIndex+1)),[Object.assign(Object.create(rightSide),_defineProperty({},"inequality"===rightSide.type?"operator":"type",reverseComparisonOperator(rightSide)))],_toConsumableArray(tokens.slice(i+1,rightIndex))),evalAfter=run(section,swappedSides),ops[type](evalAfter,elidedComparisonOperator.apply(void 0,_toConsumableArray(getElisionOperands(before)))))):ops[type](run(section,before),run(section,after))}else if(comparisonOpTypes.includes(type)){after||missingSideError(!1,!0,token);var leftOp=before?run(section,before):section.Identifiers.it;ret=ops[compileComparisonOperator(token)](leftOp,run(section,after)),section.Identifiers.it=leftOp,evalReplayIt=leftOp,evalReplayReason=hasEvalReplay&&!before&&"A missing 'it' was inferred to complete the operation."}else if("addition"===type||"subtraction"===type){after||missingSideError(!1,!0,token);var convert=!before,_precedentToken7,_precedentToken8,previousPrecedentToken,_i10,_sides,pType,convert;before&&(_precedentToken7=precedentToken(before,"least"),_precedentToken8=_slicedToArray(_precedentToken7,2),previousPrecedentToken=_precedentToken8[0],_i10=_precedentToken8[1],_sides=tokenSides[previousPrecedentToken.type],pType=previousPrecedentToken.type,convert=("both"===_sides||"after"===_sides||"addition"===pType||"subtraction"===pType)&&(_i10===before.length-1||_i10===before.length-2&&"whitespace"===before[before.length-1].type)),convert?(token.type="addition"===type?"positive":"negative",ret=run(section,tokens),token.type=type,evalReplaySkip=!0):ret=ops[token.text](run(section,before),run(section,after))}else if("multiplication"===type||"division"===type)ret=ops[token.text](run(section,before),run(section,after));else if("positive"===type||"negative"===type)ret=ops["*"]("negative"===type?-1:1,run(section,after)),evalReplaySkip=!0;else if("not"===type)ret=ops.not(run(section,after));else if("belongingProperty"===type){var container=run(section,after,isVarRef),isRef=(ret=VarRef.create(container,token.name),isVarRef||TwineError.containsError(ret));ret=isRef?ret:ret.get(),isRef=isVarRef||TwineError.containsError(ret),hasEvalReplay&&!isRef?makeEvalReplayFrame(evalReplay,{toCode:" ".concat(token.name," of ").concat(toSource(VarRef.isPrototypeOf(container)?container.get():container)," "),tokens:tokens,i:i}):isRef||(evalReplayReason="The value to the right of 'of', ".concat(typeName(container),', had a "').concat(token.name,'" data name corresponding to that data value.'))}else if("belongingOperator"===type||"belongingItOperator"===type){var value=run(section,before);"random"===value&&section.freeVariables&&"object"===_typeof(section.freeVariables)&&!section.freeVariables.seed&&(section.freeVariables.seed=State.seed,section.freeVariables.seedIter=State.seedIter),ret=VarRef.create("belongingItOperator"===type?section.Identifiers.it:run(section,after,isVarRef),{computed:!0,value:value}),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),"belongingItOperator"===type&&hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(value)," of ").concat(toSource(section.Identifiers.it)," "),tokens:tokens,i:i})}else if("property"===type){var _container=run(section,before,VARREF),_isRef=(ret=VarRef.create(_container,token.name),isVarRef||TwineError.containsError(ret));ret=_isRef?ret:ret.get(),_isRef=isVarRef||TwineError.containsError(ret),hasEvalReplay&&VarRef.isPrototypeOf(_container)&&!_isRef?makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(_container.get()),"'s ").concat(token.name," "),tokens:tokens,i:i}):_isRef||(evalReplayReason="The value to the left of 's, ".concat(typeName(_container),', had a "').concat(token.name,'" data name corresponding to that data value.'))}else if("itsProperty"===type||"belongingItProperty"===type)ret=VarRef.create(section.Identifiers.it,token.name),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:"itsProperty"===type?" ".concat(toSource(section.Identifiers.it),"'s ").concat(token.name," "):" ".concat(token.name," of ").concat(toSource(section.Identifiers.it)," "),tokens:tokens,i:i});else if("possessiveOperator"===type||"itsOperator"===type){!after||!before&&"itsOperator"!==token.type?ret=missingSideError(!before,!after,token):(_value4=run(section,after),"random"===_value4&&section.freeVariables&&"object"===_typeof(section.freeVariables)&&!section.freeVariables.seed&&(section.freeVariables.seed=State.seed,section.freeVariables.seedIter=State.seedIter),ret=VarRef.create("itsOperator"===token.type?section.Identifiers.it:run(section,before,isVarRef),{computed:!0,value:_value4}),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),"itsOperator"===type&&hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(section.Identifiers.it),"'s ").concat(toSource(_value4)," "),tokens:tokens,i:i}))}else if("twineLink"===type)ret=Macros.run("link-goto",section,[token.innerText,token.passage]),evalReplayReason=hasEvalReplay&&"Passage links are the same as (link-goto:) macro calls.";else if("macro"===type)if(token.blockedValue&&!section.blocked){if(ret=section.blockedValue(),void 0===ret)return impossible("Runner.run","section.blockedValue() returned undefined"),0}else{var macroNameToken=token.children[0],variableCall="$"===macroNameToken.text[0]||"_"===macroNameToken.text[0],macroRef;if("macroName"!==macroNameToken.type&&!variableCall)return impossible("Runner.run","macro token had no macroName child token"),0;variableCall?(macroRef=VarRef.create("_"===macroNameToken.text[0]?section.stackTop.tempVariables:State.variables,macroNameToken.text.trim().slice(1,-1)),TwineError.containsError(macroRef)||(macroRef=macroRef.get())):macroRef=token.name,ret=Macros[variableCall?"runCustom":"run"](macroRef,section,token.children.slice(1).reduce(function(e,t){return"comma"===t.type?e.push([]):e[e.length-1].push(t),e},[[]]).filter(function(e){return e.length&&(1<e.length||"whitespace"!==e[0].type)}).map(function(e){return run(section,e,!1,isTypedVar)})),evalReplayReason=hasEvalReplay&&variableCall&&"I called ".concat(objectName(macroRef),".")}else if("grouping"===type)ret=run(section,token.children,isVarRef),evalReplaySkip=!0;else if("error"===type)ret=TwineError.create("syntax",token.message,token.explanation||"");else{if("text"!==type)return impossible("Section.run","unknown syntax token type: ".concat(type,"!!")),0;token.text.trim().match(/^\d+(?:th|nd|st|rd)(?:last)?(?:to\d+(?:nth|nd|st|rd)(?:last)?)?$/g)&&(msg='Position data names like "'.concat(token.text,'" need to be either left of "of" or right of "\'s".')),ret=TwineError.create("syntax",msg||'"'.concat(token.text,"\" isn't valid Harlowe syntax for the inside of a macro call."),"Maybe you misspelled something? Also, as of 3.3.0, Javascript syntax is not allowed inside macro calls.")}}return void 0===ret?(impossible("Section.run","token ".concat(type).concat(token.name?" (".concat(token.name,":)"):""," produced undefined")),0):ret===section?(impossible("Section.run","token ".concat(type).concat(token.name?" (".concat(token.name,":)"):""," produced the section")),0):(hasEvalReplay&&!evalReplaySkip&&makeEvalReplayFrame(evalReplay,{val:ret,reason:evalReplayReason,it:evalReplayIt,tokens:tokens,i:i}),ret)}}),define("utils/jqueryplugins",["jquery"],function(e){e.prototype.extend({popAttr:function(e){var t=this.attr(e);return this.removeAttr(e),t},popData:function(e){var t=this.data(e);return this.removeData(e),t},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*";return 1===this.length&&this[0]&&this[0].nodeType===Node.TEXT_NODE?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(function(e,t,n){return(null==e?void 0:e.nodeType)===Node.TEXT_NODE&&n.indexOf(e)===t}).sort(function(e,t){return 2&e.compareDocumentPosition(t)?1:-1})},findAndFilter:function(e){var t=this.find(e),e=this.filter(e);return e.length?t.add(e):t}})}),define("utils/naturalsort",[],function(){return function(h){var m=1<arguments.length&&void 0!==arguments[1]?arguments[1]:String;return function(e,t){var n,r,a,o,i=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[/-]\d{1,4}[/-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,l=/^0/,e=m(e).trim(),t=m(t).trim(),u=e.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=t.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),i=parseInt(e.match(c))||1!==u.length&&e.match(s)&&Date.parse(e),e=parseInt(t.match(c))||i&&t.match(s)&&Date.parse(t)||null;if(h&&window.Intl&&window.Intl.Collator&&(a=window.Intl.Collator(h)),e){if(i<e)return-1;if(e<i)return 1}for(var d=0,f=Math.max(u.length,p.length);d<f;d++){if(n=!(u[d]||"").match(l)&&parseFloat(u[d])||u[d]||0,r=!(p[d]||"").match(l)&&parseFloat(p[d])||p[d]||0,isNaN(n)!==isNaN(r))return isNaN(n)?1:-1;if(_typeof(n)!==_typeof(r))n+="",r+="";else if("string"==typeof n&&a&&0!==(o=a.compare(n,r)))return o;if(n<r)return-1;if(r<n)return 1}return 0}}}),define("utils/operationutils",["utils/naturalsort","utils","internaltypes/twineerror","patterns"],function(f,e,h,t){var m=e.impossible,g=e.nth,u=e.permutations,s=e.plural,y=t.validPropertyName,r="object",n="boolean",b="string",v="number",w="function";function a(e){return!!e&&(_typeof(e)===r||_typeof(e)===w)}var k=Array.isArray;function S(e){return e&&Object.getPrototypeOf(e)===Object.prototype}function i(e){return k(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":_typeof(e)===b?b:e&&_typeof(e)===r?r:""}function c(e){if(a(e)){if(_typeof(e.TwineScript_Clone)===w)return e.TwineScript_Clone();if(k(e))return _toConsumableArray(e);if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(_typeof(e)===w)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return _objectSpread({},e);case null:return Object.assign(Object.create(null),e)}m("OperationUtils.clone","The value "+e+" cannot be cloned!")}return e}function o(e,t,n,r){for(var a="",o=0;a.length<=t&&o<e.length;){var i=r(e[o]);if(!(i.length+a.length<=t)){a+=(0<o?" and ":"")+s(e.length-o,(0<o?"other ":"")+n);break}a+=(0<o&&o===e.length-1?" and ":"")+i+(o<e.length-1?", ":""),o+=1}return a}function l(e){var t;return a(e)&&"TwineScript_ObjectName"in e?e.TwineScript_ObjectName:k(e)?0===e.length?"an empty array":"an array (with "+o(e,48,"item",l)+")":e instanceof Map?0===e.size?"an empty datamap":"a datamap (with "+o(_toConsumableArray(e.keys()),48,"dataname",_)+")":e instanceof Set?0===e.size?"an empty dataset":"a dataset (with "+o(_toConsumableArray(e.values()),48,"item",l)+")":_typeof(e)===b?0===e.length?"an empty string":48<(t=_toConsumableArray(e)).length?"a ".concat(t.length,"-character string starting with ").concat(JSON.stringify(t.slice(0,48).join(""))):"the string ".concat(JSON.stringify(e)):_typeof(e)===n?"the boolean value '"+e+"'":_typeof(e)===v?"the number "+JSON.stringify(e):void 0===e?"an empty variable":"...whatever this is"}function T(e,t){return[e[0],t[0]].sort(f("en"))[0]===e[0]?-1:1}function _(e,t){var n=h.containsError(e);if(n&&m("toSource","received a TwineError: "+n.message),_typeof(e.TwineScript_ToSource)===w)return e.TwineScript_ToSource();if(S(e)&&"first"in e&&"last"in e)return(e.first<0?(-1!==e.first?g(-e.first):"")+"last":g(e.first+1))+"to"+(e.last<0?(-1!==e.last?g(-e.last):"")+"last":g(e.last+1));if(k(e)){var r,a="",o=_createForOfIteratorHelper(e);try{for(o.s();!(r=o.n()).done;)var i=r.value,a=(a+=a?",":"(a:")+("property"===t?i+(0<i):_(i))}catch(e){o.e(e)}finally{o.f()}return a+(a?")":"(a:)")}if(e instanceof Map){var s,c="",l=_createForOfIteratorHelper(Array.from(e.entries()).sort(T));try{for(l.s();!(s=l.n()).done;){var u=_slicedToArray(s.value,2),p=u[0],d=u[1];c+=(c?",":"(dm:")+_(p)+","+_(d)}}catch(e){l.e(e)}finally{l.f()}return c+(c?")":"(dm:)")}return e instanceof Set?"(ds:"+Array.from(e).sort(f("en")).map(_)+")":_typeof(e)===v&&"property"===t?e<0?-1===e?"last":g(-e)+"last":g(e+1):_typeof(e)===b&&"property"===t?RegExp(y).test(e)?e:"("+JSON.stringify(e)+")":JSON.stringify(e)}function p(t,n){return _typeof(t)!==r&&_typeof(n)!==r?t===n:k(t)&&k(n)?t.length===n.length&&t.every(function(e,t){return p(n[t],e)}):t instanceof Map&&n instanceof Map?p(Array.from(t.entries()).sort(),Array.from(n.entries()).sort()):t instanceof Set&&n instanceof Set?p(_toConsumableArray(t),_toConsumableArray(n)):t&&_typeof(t.TwineScript_is)===w?t.TwineScript_is(n):t&&_typeof(t)===r&&n&&_typeof(n)===r&&S(t)&&S(n)?p(Object.getOwnPropertyNames(t).map(function(e){return[e,t[e]]}),Object.getOwnPropertyNames(n).map(function(e){return[e,n[e]]})):Object.is(t,n)}return Object.freeze({isObject:a,isValidDatamapName:function(e,t){var n;return e instanceof Map||m("isValidDatamapName","called with non-Map"),h.containsError(t)?t:_typeof(t)!==b&&_typeof(t)!==v?h.create("property","Only strings and numbers can be used as data names for "+l(e)+", not "+l(t)+"."):(n=_typeof(t)===b?+t:""+t,!(!Number.isNaN(n)&&e.has(n))||h.create("property","You mustn't use both "+l(t)+" and "+l(n)+" as data names in the same datamap."))},collectionType:i,isSequential:function(e){return _typeof(e)===b||k(e)||_typeof(e.hooks)===w},unstorableValue:function e(t){return(null==t?void 0:t.TwineScript_Unstorable)&&t||k(t)&&t.find(e)||t instanceof Map&&_toConsumableArray(t.values()).find(e)||t instanceof Set&&_toConsumableArray(t).find(e)},isHarloweJSValue:function e(t){return _typeof(t)===b||_typeof(t)===n||_typeof(t)===v&&!Number.isNaN(t)&&Math.abs(t)!==1/0||Array.isArray(t)&&t.every(e)||t instanceof Set&&_toConsumableArray(t).every(e)||t instanceof Map&&_toConsumableArray(t.values()).every(e)&&_toConsumableArray(t.keys()).every(function(e){return _typeof(e)===b})},clone:c,objectName:l,typeName:function e(t){var n,r=S(t);return r&&t.innerType?t.typeName||("insensitive set"===t.pattern?"a case-insensitive string name":"either"===t.pattern?(k(t.innerType)||m("typeName",'"either" pattern had non-array inner type'),t.innerType.map(e).join(" or ")):"optional"===t.pattern?"(optional) "+e(t.innerType):e(t.innerType)):r&&"range"===t.pattern?t.name||(r=t.min,n=t.max,"a"+(0<r?" positive":"")+(t.integer?" whole":"")+" number"+(0===r?" between 0 and "+n:n<1/0?" up to "+n:"")):t===String||t===Number||t===Boolean?"a "+_typeof(t()):t===parseInt?"a whole number":t===Map?"a datamap":t===Set?"a dataset":t===Array?"an array":a(t)&&"TwineScript_TypeName"in t?t.TwineScript_TypeName:l(t)},typeID:function(e){var t=_typeof(e);return[n,b,v].includes(t)?t:k(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":e.TwineScript_TypeID||""},toSource:_,is:p,contains:function(e,t){if(e||""===e){if(_typeof(e)===b)return _typeof(t)!==b?h.create("operation",l(e)+" can only contain strings, not "+l(t)+"."):e.includes(t);if(k(e))return e.some(function(e){return p(e,t)});if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some(function(e){return p(e,t)})}return h.create("operation",l(e)+" cannot contain any values, let alone "+l(t))},isA:function(e,t){return _typeof(t.TwineScript_IsTypeOf)===w?t.TwineScript_IsTypeOf(e):h.create("operation",'"is a" should only be used to compare type names, not '+l(t)+".")},matches:function t(n,e){var r=!1;if(n&&_typeof(n.TwineScript_IsTypeOf)===w){var a=n.TwineScript_IsTypeOf(e);if(h.containsError(a))return a;r|=a}if(e&&_typeof(e.TwineScript_IsTypeOf)===w){if(a=e.TwineScript_IsTypeOf(n),h.containsError(a))return a;r|=a}if(r)return!0;if(k(n)&&k(e)){for(var o=0,i=0,s=!0;s&&o<n.length&&i<e.length;){var c=n[o],l=e[i];if(c.rest){for(;i<e.length&&t(c,l);)l=e[i+=1];o+=1}else if(l.rest){for(;o<n.length&&t(c,l);)c=n[o+=1];i+=1}else t(c,l)?(o+=1,i+=1):s=!1}return s&&o>=n.length&&i>=e.length}return n instanceof Map&&e instanceof Map?t(Array.from(n.entries()).sort(),Array.from(e.entries()).sort()):n instanceof Set&&e instanceof Set?(n=_toConsumableArray(n),u.apply(void 0,_toConsumableArray(e)).some(function(e){return t(n,e)})):p(n,e)},subset:function e(t,n,r){var a,o;return n&&r?((a=_typeof(t)===b)&&(t=Array.from(t)),n<0&&(n=Math.max(0,t.length+n+1)),(r=r<0?Math.max(0,t.length+r+1):r)<n?e(arguments[0],r,n):(o=t.slice(0<n?n-1:n,r).map(c),a?o.join(""):o)):h.create("macrocall","The sub"+i(t)+" index value must not be "+(n&&r)+".")},range:function e(t,n){if(n<t)return e(n,t);var r=[t];for(n-=t;0<n--;)r.push(++t);return r},printBuiltinValue:function r(e){return h.containsError(e)?e:e&&_typeof(e.TwineScript_Print)===w?e.TwineScript_Print():e instanceof Map?(e=Array.from(e.entries()),h.containsError(e)?e:e.reduce(function(e,t){var n=(t=_slicedToArray(t,2))[0],t=t[1];return e+"<tr><td>`"+r(n)+"`</td><td>`"+r(t)+"`</td></tr>"},"<table class=datamap>")+"</table>"):e instanceof Set?Array.from(e.values()).map(r)+"":k(e)?e.map(r)+"":e&&_typeof(e.jquery)===b?e:a(e)?h.create("unimplemented","I don't know how to print this value yet."):e+""},unique:function(t,e,n){return n.findIndex(function(e){return p(t,e)})===e}})}),define("utils/polyfills",[],function(){var o=Array.prototype;"function"!=typeof o.includes&&(o.includes=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!Number.isNaN(e)&&Number.isFinite(t)&&void 0!==e)return-1<o.indexOf.call(this,e,t);var n=Object(this),r=parseInt(n.length);if(!(r<=0))for(var a=0<=t?t:Math.max(0,r+t);a<r;){if(Object.is(e,n[a]))return!0;a+=1}return!1}),window.Symbol||(window.Symbol={iterator:"_es6-shim iterator_"})}),define("utils/renderutils",["jquery","utils","renderer"],function(l,u,p){var n=RegExp(u.realWhitespace+"+"),s=RegExp(u.realWhitespace+"+","g");function d(e,t,n){var r,a=e.textContent.length;if(!(a<=t))return r=[e=0===t?e:e.splitText(t)],n&&(n=n<=0?a-n:n)<a&&r.push(e.splitText(n-t)),r}var t,c=function(){var e;return void 0!==t?t:(e=l("<p>"),t=!!e[0].normalize&&(e.append(document.createTextNode("0-"),document.createTextNode("2"),document.createTextNode(""))[0].normalize(),1===e.contents().length))};var f="tw-collapsed,[collapsing=true]";var o=/^(=*)([^=]+)=*$/;return Object.freeze({dialog:function(){var e,t=(c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).section,n=void 0===(n=c.parent)?u.storyElement:n,r=c.cd,a=void 0===(a=c.message)?"":a,o=c.defaultValue,i=void 0===(c=c.buttons)?[{name:"OK",confirm:!0,callback:Object}]:c,s=("a code hook"===a.TwineScript_TypeName&&(a=a.code),l("<tw-backdrop><tw-dialog>"+(o||""===o?"<input type=text style='display:block;margin:0 auto'></input>\n":"")+"<tw-dialog-links>"+(i.length?i.reduce(function(e,t,n){t=t.name;return e+"<tw-link style='margin:0 "+(n===i.length-1?"0 0 0.5em":0===n?"0.5em 0 0":"0.5em")+"' tabindex=0>"+t+"</tw-link>"},""):"<tw-link tabindex=0>"+i[0].name+"</tw-link>")+"</tw-dialog-links></tw-dialog></tw-backdrop>")),c=s.find("tw-dialog");return n.append(s),t?(t.renderInto(a,c,_objectSpread(_objectSpread({},r),{},{append:"prepend"})),null!=(n=(null==r?void 0:r.transition)&&s.find("tw-dialog > tw-transition-container"))&&n.length&&n.appendTo(s).append(c.prepend(n.contents().detach()))):c.prepend(p.exec(a)),o&&((e=s.find("input").last()).val(o).on("keypress",function(e){13===e.which&&(s.remove(),i.filter(function(e){return e.confirm}).forEach(function(e){return e.callback()}))}),setTimeout(function(){return e.focus()},100)),i.reverse().forEach(function(e,t){l(s.find("tw-link").get(-t-1)).on("click",function(){u.options.debug&&u.options.ignoreClickEvents&&!l(s).is(".eval-replay, .harlowe-crash")||(s.remove(),e.callback())})}),s},realWhitespace:n,textNodeToChars:function(r){var e=_toConsumableArray(r.textContent);return 1===e.length?[r]:e.reduce(function(e,t){return t.match(n)&&e.length&&e[e.length-1].match(n)?e[e.length-1]+=t:e.push(t),e},[]).reduce(function(e,t){var n=r;return t.length<r.textContent.length&&(r=r.splitText(t.length)),e.concat(n)},[])},findTextInNodes:function e(t,n){var r=[],a="",o=[];if(!t.length||!n)return o;for(;0<t.length;){r.push(t[0]),a+=t[0].textContent,t.shift();var i=a.indexOf(n);if(-1<i){for(var s=a.length-(i+n.length);i>=r[0].textContent.length;)i-=r[0].textContent.length,r.shift();if(1===r.length){var c=d(r[0],i,i+n.length);o.push(c[0]),c[1]&&t.unshift(c[1]);break}o.push(d(r[0],i,r[0].length)[0]),o.push.apply(o,_toConsumableArray(r.slice(1,-1))),c=d(r[r.length-1],0,r[r.length-1].textContent.length-s),o.push(c[0]),c[1]&&t.unshift(c[1]),o=o.filter(Boolean);break}}return[o].concat(_toConsumableArray(e(t,n)))},collapse:function(e){function n(e){return 0===l(this||e).parentsUntil(f).filter("tw-verbatim, tw-expression, [collapsing=false]").length}var t=function e(t){var n=t[0],r=t.parent();return!r.length||t.findAndFilter("tw-story").length?null:(t=(t=r.textNodes().filter(function(e){return 4&(e=e.compareDocumentPosition(n))&&!(8&e)}))[t.length-1])||e(r)}(e),r=(l(t).parents(f).length||(t=null),function e(t){var n=t[0],r=t.parent();return!r.length||t.findAndFilter("tw-story").length?null:r.textNodes().filter(function(e){return 2&(e=e.compareDocumentPosition(n))&&!(8&e)})[0]||e(r)}(e)),a=(l(r).parents(f).length||(r=null),"br:not([data-raw]),tw-consecutive-br:not([data-raw])"),o=(e.find(a).filter(n).replaceWith(document.createTextNode(" ")),(e=l(e.get().map(function(e){return l(e).filter(n).is(a)?l(document.createTextNode(" ")).replaceAll(e)[0]:e}))).textNodes()),i=0;o.reduce(function(e,t){return n(t)?(t.textContent=t.textContent.replace(s," ")," "!==t.textContent[0]||e&&e.textContent&&!(-1<e.textContent.search(/\s$/))||(t.textContent=t.textContent.slice(1)),t):document.createTextNode("A")},t),_toConsumableArray(o).reverse().every(function(e){return!(!n(e)||(e.textContent.match(/^\s*$/)?(i+=e.textContent.length,e.textContent=""):(e.textContent=e.textContent.replace(/\s+$/,function(e){return i+=e.length,""}),1)))}),0<i&&r&&(o[o.length-1].textContent+=" "),e[0]&&c()&&e[0].normalize()},geomStringRegExp:o,geomParse:function(e){var t,n,r,a;return!e||(t=e.length,n=(a=_slicedToArray(o.exec(e)||[],3))[0],r=a[1],a=a[2],!n)||a===e&&1<a.length?{marginLeft:0,size:0}:{marginLeft:r.length/t*100,size:a.length/t*100}}})}),define("utils/scripttag",["state","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(a,o,i,s){return function(e,r){Function("script","scope","with(scope){var scope=void 0,arguments=void 0;eval([script,script=void 0][0]);}")(e,Object.create(null,Object.keys(a.variables).map(function(e){return!e.startsWith("TwineScript_")&&"$"+e}).concat(Object.keys(r).map(function(e){return!e.startsWith("TwineScript_")&&"_"+e})).reduce(function(e,n){return n&&(e[n]={get:function(){var e=("$"===n[0]?a.variables:r)[n.slice(1)];if(o.isHarloweJSValue(e))return o.clone(e);throw s.create("","The contents of the variable ".concat(n,", ").concat(o.objectName(e),", couldn't be converted to a Javascript value."),"Only booleans, strings, numbers, datamaps, datasets and arrays can be converted to Javascript values.")},set:function(e){var t="$"===n[0]?a.variables:r;if(!o.isHarloweJSValue(e))throw s.create("","The Javascript value, ".concat(e,", couldn't be converted to a Harlowe value and assigned to the variable ").concat(n,"."),"Only booleans, strings, numbers (except NaN and Infinity), Maps, Sets and Arrays can be converted to Harlowe values.");e=o.clone(e);t=i.create(t,n.slice(1)).set(e);if(s.containsError(t))throw t}}),e},{})))}}),!function(){function e(t,n,r){return function(e){return"background-color: hsla(".concat(t,",").concat(n,"%,").concat(r,"%,").concat(e,");")}}var t={boolean:"color:hsla(0,0%,30%,1.0)",array:"color:hsla(0,100%,30%,1.0)",dataset:"color:hsla(30,100%,40%,1.0)",number:"color:hsla(30,100%,30%,1.0)",datamap:"color:hsla(60,100%,30%,1.0)",changer:"color:hsla(90,100%,30%,1.0)",lambda:"color:hsla(120,100%,40%,1.0)",hookName:"color:hsla(160,100%,30%,1.0)",string:"color:hsla(180,100%,30%,1.0)",identifier:"color:hsla(200,80%,40%,1.0)",variable:"color:hsla(200,100%,30%,1.0)",tempVariable:"color:hsla(200,70%,20%,1.0)",datatype:"color:hsla(220,100%,30%,1.0)",colour:"color:hsla(280,100%,30%,1.0)",macro:"color:hsla(320,80%,30%,1.0)",twineLink:"color:hsla(240,100%,20%,1.0)"},o=(t.gradient=t.colour,t.command=t.twineLink,t.instant=t.metadata=t.any=t.customMacro=t.macro,Math.min),n=e(40,100,50),r=e(220,100,50),i=/hsla\((\d+),\s*(\d+)%,\s*(\d+)%,\s*(\d+\.\d+)\)/g,s="cm-harlowe-3-",a=(_defineProperty(n={root:"box-sizing:border-box;",hook:n(.05),"hook-2":n(.1),"hook-3":n(.15),"hook-4":n(.2),"hook-5":n(.25),"hook-6":n(.3),"hook-7":n(.35),"hook-8":n(.4),"^=hook , ^=hook-":"font-weight:bold;",unclosedHook:n(.05)+"font-weight:bold;"},"error:not([class*='"+s+"string'])","background-color: hsla(17,100%,50%,0.5) !important;"),_defineProperty(n,"^=macroName","font-style:italic;"),_defineProperty(n,"macroName-boolean",t.boolean),_defineProperty(n,"macroName-array",t.array),_defineProperty(n,"macroName-dataset",t.dataset),_defineProperty(n,"macroName-datatype",t.datatype),_defineProperty(n,"macroName-number",t.number),_defineProperty(n,"macroName-datamap",t.datamap),_defineProperty(n,"macroName-changer",t.changer),_defineProperty(n,"macroName-string",t.string),_defineProperty(n,"macroName-colour, macroName-gradient",t.colour),_defineProperty(n,"macroName-command, macroName-instant, macroName-metadata",t.command),_defineProperty(n,"macroName-custommacro, macroName-macro, macroName-any",t.macro),_defineProperty(n,"^=macro ","font-weight:bold;"+t.macro),_defineProperty(n,"comma, spread",t.macro),_defineProperty(n,"addition",t.any),_defineProperty(n,"subtraction, multiplication, division",t.number),_defineProperty(n,"is, and, or, not, isNot, contains, doesNotContain, isIn, isA, isNotA, isNotIn, matches, doesNotMatch",t.boolean),_defineProperty(n,"bold, strong","font-weight:bold;"),_defineProperty(n,"italic, em","font-style:italic;"),_defineProperty(n,"sup","vertical-align: super;font-size:0.8em;"),_defineProperty(n,"strike","text-decoration: line-through;"),_defineProperty(n,"verbatim","background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)"),_defineProperty(n,"^=bold, ^=strong, ^=italic, ^=em, ^=sup, ^=verbatim, ^=strike","font-weight:100; color: hsla(0,0%,0%,0.5)"),_defineProperty(n,"^=collapsed","font-weight:bold; color: hsla(201,100%,30%,1.0);"),_defineProperty(n,"unclosedCollapsed",r(.025)+"font-weight:bold; color: hsla(201,100%,30%,1.0);"),_defineProperty(n,"collapsed",r(.025)),_defineProperty(n,"collapsed.hook",r(.05)),_defineProperty(n,"collapsed.hook-2",r(.1)),_defineProperty(n,"collapsed.hook-3",r(.15)),_defineProperty(n,"collapsed.hook-4",r(.2)),_defineProperty(n,"collapsed.hook-5",r(.25)),_defineProperty(n,"collapsed.hook-6",r(.3)),_defineProperty(n,"collapsed.hook-7",r(.35)),_defineProperty(n,"collapsed.hook-8",r(.4)),_defineProperty(n,"twineLink:not(.text)",t.twineLink),_defineProperty(n,"tag, scriptStyleTag, comment","color: hsla(240,34%,25%,1.0);"),_defineProperty(n,"boolean",t.boolean),_defineProperty(n,"string",t.string),_defineProperty(n,"number",t.number),_defineProperty(n,"variable",t.variable),_defineProperty(n,"tempVariable",t.tempVariable),_defineProperty(n,"hookName",t.hookName),_defineProperty(n,"datatype",t.datatype),_defineProperty(n,"colour",t.colour),_defineProperty(n,"cssTime",t.number),_defineProperty(n,"passageString",t.variable+";text-decoration:underline 1px;"),_defineProperty(n,"tagString",t.variable+";text-decoration:underline 1px dotted;"),_defineProperty(n,"variableOccurrence, hookOccurrence","background: hsla(159,50%,75%,1.0) !important;"),_defineProperty(n,"^=where, ^=via, ^=with, ^=making, ^=each, ^=when",t.lambda+"; font-style:italic;"),_defineProperty(n,"heading","font-weight:bold;"),_defineProperty(n,"hr","background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);"),_defineProperty(n,"align","color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);"),_defineProperty(n,"column","color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);"),_defineProperty(n,"escapedLine","font-weight:bold; color: hsla(51,100%,30%,1.0);"),_defineProperty(n,"identifier, property, belongingProperty, itsProperty, belongingItProperty, belongingItOperator, possessiveOperator, belongingOperator",t.identifier),_defineProperty(n,"toString",function(){var a=this;return Object.keys(this).reduce(function(e,n){var r;return"toString"!==n&&(r=n.split(", ").map(function e(t){return-1<t.indexOf(".")?t.split(/\./g).map(e).join(""):0===t.indexOf("^=")?"[class^='"+s+t.slice(2)+"']":"."+s+t}),e+=r.join(", ")+"{"+a[n]+"}",a[n].match(i))&&[".theme-dark","[data-app-theme=dark]"].forEach(function(t){e+=r.map(function(e){return t+" "+e}).join(", ")+"{"+a[n].replace(i,function(e,t,n,r,a){return"hsla("+t+","+o(100,1.5*+n)+"%,"+(100-r)+"%,"+a+")"})+"}"}),e},"")}),n+"");"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports={Colours:t,CSS:a,versionClass:s}:"function"==typeof define&&define.amd&&define("utils/typecolours",[],function(){return{Colours:t,CSS:a,versionClass:s}})}.call(void 0);
;require("harlowe")}());
</script>

</body>
</html>
